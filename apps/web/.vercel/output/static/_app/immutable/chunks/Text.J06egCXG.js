import{K as xn,L as Fn,I as Cn,s as Dn,M as ut,N as Nt,H as En,y as An,O as Mn,t as Gn,p as Pn,u as On,v as Ln,w as Rn,x as Bn}from"./scheduler.lc6pDmfW.js";import{S as In,i as Wn,b as Nn,d as zn,m as Vn,a as on,t as sn,e as jn}from"./index._UJvAQqJ.js";import{g as Xn,a as Yn}from"./spread.rEx3vLA9.js";import{U as Hn,M as Jn,R as Kn,b as Qn,S as Zn,d as pt,F as qn,e as gt,V as Ir,f as $n,L as zt,I as ea,g as ra,B as ta,h as na,D as fn,i as aa,j as Vt,k as oa,l as ia,m as sa,n as mt,P as yt,o as fa,p as la,T as ua,u as ca,q as ha}from"./vertex.ocSICPKy.js";import{p as da}from"./index.XRl7aEt-.js";import{d as va,r as pa}from"./index.k8f3s86m.js";const ga=Symbol("THRELTE_SUSPENSE_CONTEXT_IDENTIFIER"),ma=()=>{const c=xn(ga),t=Fn(),d=r=>(c?.suspend(t,r),r),u={suspended:va(c?.suspended??pa(!1),r=>r)};return Cn(()=>{c?.onComponentDestroy(t)}),Object.assign(d,u)};function ya(){var c=Object.create(null);function t(r,e){var o=r.id,a=r.name,n=r.dependencies;n===void 0&&(n=[]);var i=r.init;i===void 0&&(i=function(){});var s=r.getTransferables;if(s===void 0&&(s=null),!c[o])try{n=n.map(function(l){return l&&l.isWorkerModule&&(t(l,function(h){if(h instanceof Error)throw h}),l=c[l.id].value),l}),i=u("<"+a+">.init",i),s&&(s=u("<"+a+">.getTransferables",s));var f=null;typeof i=="function"?f=i.apply(void 0,n):console.error("worker module init function failed to rehydrate"),c[o]={id:o,value:f,getTransferables:s},e(f)}catch(l){l&&l.noLog||console.error(l),e(l)}}function d(r,e){var o,a=r.id,n=r.args;(!c[a]||typeof c[a].value!="function")&&e(new Error("Worker module "+a+": not found or its 'init' did not return a function"));try{var i=(o=c[a]).value.apply(o,n);i&&typeof i.then=="function"?i.then(s,function(f){return e(f instanceof Error?f:new Error(""+f))}):s(i)}catch(f){e(f)}function s(f){try{var l=c[a].getTransferables&&c[a].getTransferables(f);(!l||!Array.isArray(l)||!l.length)&&(l=void 0),e(f,l)}catch(h){console.error(h),e(h)}}}function u(r,e){var o=void 0;self.troikaDefine=function(n){return o=n};var a=URL.createObjectURL(new Blob(["/** "+r.replace(/\*/g,"")+` **/

troikaDefine(
`+e+`
)`],{type:"application/javascript"}));try{importScripts(a)}catch(n){console.error(n)}return URL.revokeObjectURL(a),delete self.troikaDefine,o}self.addEventListener("message",function(r){var e=r.data,o=e.messageId,a=e.action,n=e.data;try{a==="registerModule"&&t(n,function(i){i instanceof Error?postMessage({messageId:o,success:!1,error:i.message}):postMessage({messageId:o,success:!0,result:{isCallable:typeof i=="function"}})}),a==="callModule"&&d(n,function(i,s){i instanceof Error?postMessage({messageId:o,success:!1,error:i.message}):postMessage({messageId:o,success:!0,result:i},s||void 0)})}catch(i){postMessage({messageId:o,success:!1,error:i.stack})}})}function ba(c){var t=function(){for(var d=[],u=arguments.length;u--;)d[u]=arguments[u];return t._getInitResult().then(function(r){if(typeof r=="function")return r.apply(void 0,d);throw new Error("Worker module function was called but `init` did not return a callable function")})};return t._getInitResult=function(){var d=c.dependencies,u=c.init;d=Array.isArray(d)?d.map(function(e){return e&&e._getInitResult?e._getInitResult():e}):[];var r=Promise.all(d).then(function(e){return u.apply(null,e)});return t._getInitResult=function(){return r},r},t}var ln=function(){var c=!1;if(typeof window<"u"&&typeof window.document<"u")try{var t=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));t.terminate(),c=!0}catch(d){typeof da<"u",console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+d.message+"]")}return ln=function(){return c},c},_a=0,Ua=0,it=!1,br=Object.create(null),_r=Object.create(null),ct=Object.create(null);function Ur(c){if((!c||typeof c.init!="function")&&!it)throw new Error("requires `options.init` function");var t=c.dependencies,d=c.init,u=c.getTransferables,r=c.workerId;if(!ln())return ba(c);r==null&&(r="#default");var e="workerModule"+ ++_a,o=c.name||e,a=null;t=t&&t.map(function(i){return typeof i=="function"&&!i.workerModuleData&&(it=!0,i=Ur({workerId:r,name:"<"+o+"> function dependency: "+i.name,init:`function(){return (
`+Rr(i)+`
)}`}),it=!1),i&&i.workerModuleData&&(i=i.workerModuleData),i});function n(){for(var i=[],s=arguments.length;s--;)i[s]=arguments[s];if(!a){a=jt(r,"registerModule",n.workerModuleData);var f=function(){a=null,_r[r].delete(f)};(_r[r]||(_r[r]=new Set)).add(f)}return a.then(function(l){var h=l.isCallable;if(h)return jt(r,"callModule",{id:e,args:i});throw new Error("Worker module function was called but `init` did not return a callable function")})}return n.workerModuleData={isWorkerModule:!0,id:e,name:o,dependencies:t,init:Rr(d),getTransferables:u&&Rr(u)},n}function Sa(c){_r[c]&&_r[c].forEach(function(t){t()}),br[c]&&(br[c].terminate(),delete br[c])}function Rr(c){var t=c.toString();return!/^function/.test(t)&&/^\w+\s*\(/.test(t)&&(t="function "+t),t}function Ta(c){var t=br[c];if(!t){var d=Rr(ya);t=br[c]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+c.replace(/\*/g,"")+` **/

;(`+d+")()"],{type:"application/javascript"}))),t.onmessage=function(u){var r=u.data,e=r.messageId,o=ct[e];if(!o)throw new Error("WorkerModule response with empty or unknown messageId");delete ct[e],o(r)}}return t}function jt(c,t,d){return new Promise(function(u,r){var e=++Ua;ct[e]=function(o){o.success?u(o.result):r(new Error("Error in worker "+t+" call: "+o.error))},Ta(c).postMessage({messageId:e,action:t,data:d})})}function un(){var c=function(t){function d(P,W,p,w,L,O,D,I){var C=1-D;I.x=C*C*P+2*C*D*p+D*D*L,I.y=C*C*W+2*C*D*w+D*D*O}function u(P,W,p,w,L,O,D,I,C,M){var z=1-C;M.x=z*z*z*P+3*z*z*C*p+3*z*C*C*L+C*C*C*D,M.y=z*z*z*W+3*z*z*C*w+3*z*C*C*O+C*C*C*I}function r(P,W){for(var p=/([MLQCZ])([^MLQCZ]*)/g,w,L,O,D,I;w=p.exec(P);){var C=w[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(M){return parseFloat(M)});switch(w[1]){case"M":D=L=C[0],I=O=C[1];break;case"L":(C[0]!==D||C[1]!==I)&&W("L",D,I,D=C[0],I=C[1]);break;case"Q":{W("Q",D,I,D=C[2],I=C[3],C[0],C[1]);break}case"C":{W("C",D,I,D=C[4],I=C[5],C[0],C[1],C[2],C[3]);break}case"Z":(D!==L||I!==O)&&W("L",D,I,L,O);break}}}function e(P,W,p){p===void 0&&(p=16);var w={x:0,y:0};r(P,function(L,O,D,I,C,M,z,Z,V){switch(L){case"L":W(O,D,I,C);break;case"Q":{for(var A=O,de=D,ce=1;ce<p;ce++)d(O,D,M,z,I,C,ce/(p-1),w),W(A,de,w.x,w.y),A=w.x,de=w.y;break}case"C":{for(var X=O,q=D,fe=1;fe<p;fe++)u(O,D,M,z,Z,V,I,C,fe/(p-1),w),W(X,q,w.x,w.y),X=w.x,q=w.y;break}}})}var o="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",a="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",n=new WeakMap,i={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function s(P,W){var p=P.getContext?P.getContext("webgl",i):P,w=n.get(p);if(!w){let z=function(X){var q=O[X];if(!q&&(q=O[X]=p.getExtension(X),!q))throw new Error(X+" not supported");return q},Z=function(X,q){var fe=p.createShader(q);return p.shaderSource(fe,X),p.compileShader(fe),fe},V=function(X,q,fe,R){if(!D[X]){var re={},K={},G=p.createProgram();p.attachShader(G,Z(q,p.VERTEX_SHADER)),p.attachShader(G,Z(fe,p.FRAGMENT_SHADER)),p.linkProgram(G),D[X]={program:G,transaction:function(Q){p.useProgram(G),Q({setUniform:function(H,me){for(var pe=[],ee=arguments.length-2;ee-- >0;)pe[ee]=arguments[ee+2];var ue=K[me]||(K[me]=p.getUniformLocation(G,me));p["uniform"+H].apply(p,[ue].concat(pe))},setAttribute:function(H,me,pe,ee,ue){var ge=re[H];ge||(ge=re[H]={buf:p.createBuffer(),loc:p.getAttribLocation(G,H),data:null}),p.bindBuffer(p.ARRAY_BUFFER,ge.buf),p.vertexAttribPointer(ge.loc,me,p.FLOAT,!1,0,0),p.enableVertexAttribArray(ge.loc),L?p.vertexAttribDivisor(ge.loc,ee):z("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(ge.loc,ee),ue!==ge.data&&(p.bufferData(p.ARRAY_BUFFER,ue,pe),ge.data=ue)}})}}}D[X].transaction(R)},A=function(X,q){C++;try{p.activeTexture(p.TEXTURE0+C);var fe=I[X];fe||(fe=I[X]=p.createTexture(),p.bindTexture(p.TEXTURE_2D,fe),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST)),p.bindTexture(p.TEXTURE_2D,fe),q(fe,C)}finally{C--}},de=function(X,q,fe){var R=p.createFramebuffer();M.push(R),p.bindFramebuffer(p.FRAMEBUFFER,R),p.activeTexture(p.TEXTURE0+q),p.bindTexture(p.TEXTURE_2D,X),p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,X,0);try{fe(R)}finally{p.deleteFramebuffer(R),p.bindFramebuffer(p.FRAMEBUFFER,M[--M.length-1]||null)}},ce=function(){O={},D={},I={},C=-1,M.length=0};var L=typeof WebGL2RenderingContext<"u"&&p instanceof WebGL2RenderingContext,O={},D={},I={},C=-1,M=[];p.canvas.addEventListener("webglcontextlost",function(X){ce(),X.preventDefault()},!1),n.set(p,w={gl:p,isWebGL2:L,getExtension:z,withProgram:V,withTexture:A,withTextureFramebuffer:de,handleContextLoss:ce})}W(w)}function f(P,W,p,w,L,O,D,I){D===void 0&&(D=15),I===void 0&&(I=null),s(P,function(C){var M=C.gl,z=C.withProgram,Z=C.withTexture;Z("copy",function(V,A){M.texImage2D(M.TEXTURE_2D,0,M.RGBA,L,O,0,M.RGBA,M.UNSIGNED_BYTE,W),z("copy",o,a,function(de){var ce=de.setUniform,X=de.setAttribute;X("aUV",2,M.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),ce("1i","image",A),M.bindFramebuffer(M.FRAMEBUFFER,I||null),M.disable(M.BLEND),M.colorMask(D&8,D&4,D&2,D&1),M.viewport(p,w,L,O),M.scissor(p,w,L,O),M.drawArrays(M.TRIANGLES,0,3)})})})}function l(P,W,p){var w=P.width,L=P.height;s(P,function(O){var D=O.gl,I=new Uint8Array(w*L*4);D.readPixels(0,0,w,L,D.RGBA,D.UNSIGNED_BYTE,I),P.width=W,P.height=p,f(D,I,0,0,w,L)})}var h=Object.freeze({__proto__:null,withWebGLContext:s,renderImageData:f,resizeWebGLCanvasWithoutClearing:l});function y(P,W,p,w,L,O){O===void 0&&(O=1);var D=new Uint8Array(P*W),I=w[2]-w[0],C=w[3]-w[1],M=[];e(p,function(X,q,fe,R){M.push({x1:X,y1:q,x2:fe,y2:R,minX:Math.min(X,fe),minY:Math.min(q,R),maxX:Math.max(X,fe),maxY:Math.max(q,R)})}),M.sort(function(X,q){return X.maxX-q.maxX});for(var z=0;z<P;z++)for(var Z=0;Z<W;Z++){var V=de(w[0]+I*(z+.5)/P,w[1]+C*(Z+.5)/W),A=Math.pow(1-Math.abs(V)/L,O)/2;V<0&&(A=1-A),A=Math.max(0,Math.min(255,Math.round(A*255))),D[Z*P+z]=A}return D;function de(X,q){for(var fe=1/0,R=1/0,re=M.length;re--;){var K=M[re];if(K.maxX+R<=X)break;if(X+R>K.minX&&q-R<K.maxY&&q+R>K.minY){var G=k(X,q,K.x1,K.y1,K.x2,K.y2);G<fe&&(fe=G,R=Math.sqrt(fe))}}return ce(X,q)&&(R=-R),R}function ce(X,q){for(var fe=0,R=M.length;R--;){var re=M[R];if(re.maxX<=X)break;var K=re.y1>q!=re.y2>q&&X<(re.x2-re.x1)*(q-re.y1)/(re.y2-re.y1)+re.x1;K&&(fe+=re.y1<re.y2?1:-1)}return fe!==0}}function m(P,W,p,w,L,O,D,I,C,M){O===void 0&&(O=1),I===void 0&&(I=0),C===void 0&&(C=0),M===void 0&&(M=0),g(P,W,p,w,L,O,D,null,I,C,M)}function g(P,W,p,w,L,O,D,I,C,M,z){O===void 0&&(O=1),C===void 0&&(C=0),M===void 0&&(M=0),z===void 0&&(z=0);for(var Z=y(P,W,p,w,L,O),V=new Uint8Array(Z.length*4),A=0;A<Z.length;A++)V[A*4+z]=Z[A];f(D,V,C,M,P,W,1<<3-z,I)}function k(P,W,p,w,L,O){var D=L-p,I=O-w,C=D*D+I*I,M=C?Math.max(0,Math.min(1,((P-p)*D+(W-w)*I)/C)):0,z=P-(p+M*D),Z=W-(w+M*I);return z*z+Z*Z}var v=Object.freeze({__proto__:null,generate:y,generateIntoCanvas:m,generateIntoFramebuffer:g}),U="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",F="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",_="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",T=new Float32Array([0,0,2,0,0,2]),x=null,S=!1,Y={},J=new WeakMap;function ne(P){if(!S&&!j(P))throw new Error("WebGL generation not supported")}function b(P,W,p,w,L,O,D){if(O===void 0&&(O=1),D===void 0&&(D=null),!D&&(D=x,!D)){var I=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!I)throw new Error("OffscreenCanvas or DOM canvas not supported");D=x=I.getContext("webgl",{depth:!1})}ne(D);var C=new Uint8Array(P*W*4);s(D,function(V){var A=V.gl,de=V.withTexture,ce=V.withTextureFramebuffer;de("readable",function(X,q){A.texImage2D(A.TEXTURE_2D,0,A.RGBA,P,W,0,A.RGBA,A.UNSIGNED_BYTE,null),ce(X,q,function(fe){E(P,W,p,w,L,O,A,fe,0,0,0),A.readPixels(0,0,P,W,A.RGBA,A.UNSIGNED_BYTE,C)})})});for(var M=new Uint8Array(P*W),z=0,Z=0;z<C.length;z+=4)M[Z++]=C[z];return M}function B(P,W,p,w,L,O,D,I,C,M){O===void 0&&(O=1),I===void 0&&(I=0),C===void 0&&(C=0),M===void 0&&(M=0),E(P,W,p,w,L,O,D,null,I,C,M)}function E(P,W,p,w,L,O,D,I,C,M,z){O===void 0&&(O=1),C===void 0&&(C=0),M===void 0&&(M=0),z===void 0&&(z=0),ne(D);var Z=[];e(p,function(V,A,de,ce){Z.push(V,A,de,ce)}),Z=new Float32Array(Z),s(D,function(V){var A=V.gl,de=V.isWebGL2,ce=V.getExtension,X=V.withProgram,q=V.withTexture,fe=V.withTextureFramebuffer,R=V.handleContextLoss;if(q("rawDistances",function(re,K){(P!==re._lastWidth||W!==re._lastHeight)&&A.texImage2D(A.TEXTURE_2D,0,A.RGBA,re._lastWidth=P,re._lastHeight=W,0,A.RGBA,A.UNSIGNED_BYTE,null),X("main",U,F,function(G){var ae=G.setAttribute,Q=G.setUniform,te=!de&&ce("ANGLE_instanced_arrays"),H=!de&&ce("EXT_blend_minmax");ae("aUV",2,A.STATIC_DRAW,0,T),ae("aLineSegment",4,A.DYNAMIC_DRAW,1,Z),Q.apply(void 0,["4f","uGlyphBounds"].concat(w)),Q("1f","uMaxDistance",L),Q("1f","uExponent",O),fe(re,K,function(me){A.enable(A.BLEND),A.colorMask(!0,!0,!0,!0),A.viewport(0,0,P,W),A.scissor(0,0,P,W),A.blendFunc(A.ONE,A.ONE),A.blendEquationSeparate(A.FUNC_ADD,de?A.MAX:H.MAX_EXT),A.clear(A.COLOR_BUFFER_BIT),de?A.drawArraysInstanced(A.TRIANGLES,0,3,Z.length/4):te.drawArraysInstancedANGLE(A.TRIANGLES,0,3,Z.length/4)})}),X("post",o,_,function(G){G.setAttribute("aUV",2,A.STATIC_DRAW,0,T),G.setUniform("1i","tex",K),A.bindFramebuffer(A.FRAMEBUFFER,I),A.disable(A.BLEND),A.colorMask(z===0,z===1,z===2,z===3),A.viewport(C,M,P,W),A.scissor(C,M,P,W),A.drawArrays(A.TRIANGLES,0,3)})}),A.isContextLost())throw R(),new Error("webgl context lost")})}function j(P){var W=!P||P===x?Y:P.canvas||P,p=J.get(W);if(p===void 0){S=!0;var w=null;try{var L=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],O=b(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,P);p=O&&L.length===O.length&&O.every(function(D,I){return D===L[I]}),p||(w="bad trial run results",console.info(L,O))}catch(D){p=!1,w=D.message}w&&console.warn("WebGL SDF generation not supported:",w),S=!1,J.set(W,p)}return p}var N=Object.freeze({__proto__:null,generate:b,generateIntoCanvas:B,generateIntoFramebuffer:E,isSupported:j});function se(P,W,p,w,L,O){L===void 0&&(L=Math.max(w[2]-w[0],w[3]-w[1])/2),O===void 0&&(O=1);try{return b.apply(N,arguments)}catch(D){return console.info("WebGL SDF generation failed, falling back to JS",D),y.apply(v,arguments)}}function ie(P,W,p,w,L,O,D,I,C,M){L===void 0&&(L=Math.max(w[2]-w[0],w[3]-w[1])/2),O===void 0&&(O=1),I===void 0&&(I=0),C===void 0&&(C=0),M===void 0&&(M=0);try{return B.apply(N,arguments)}catch(z){return console.info("WebGL SDF generation failed, falling back to JS",z),m.apply(v,arguments)}}return t.forEachPathCommand=r,t.generate=se,t.generateIntoCanvas=ie,t.javascript=v,t.pathToLineSegments=e,t.webgl=N,t.webglUtils=h,Object.defineProperty(t,"__esModule",{value:!0}),t}({});return c}function wa(){var c=function(t){var d={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},u={},r={};u.L=1,r[1]="L",Object.keys(d).forEach(function(R,re){u[R]=1<<re+1,r[u[R]]=R}),Object.freeze(u);var e=u.LRI|u.RLI|u.FSI,o=u.L|u.R|u.AL,a=u.B|u.S|u.WS|u.ON|u.FSI|u.LRI|u.RLI|u.PDI,n=u.BN|u.RLE|u.LRE|u.RLO|u.LRO|u.PDF,i=u.S|u.WS|u.B|e|u.PDI|n,s=null;function f(){if(!s){s=new Map;var R=function(K){if(d.hasOwnProperty(K)){var G=0;d[K].split(",").forEach(function(ae){var Q=ae.split("+"),te=Q[0],H=Q[1];te=parseInt(te,36),H=H?parseInt(H,36):0,s.set(G+=te,u[K]);for(var me=0;me<H;me++)s.set(++G,u[K])})}};for(var re in d)R(re)}}function l(R){return f(),s.get(R.codePointAt(0))||u.L}function h(R){return r[l(R)]}var y={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function m(R,re){var K=36,G=0,ae=new Map,Q=re&&new Map,te;return R.split(",").forEach(function H(me){if(me.indexOf("+")!==-1)for(var pe=+me;pe--;)H(te);else{te=me;var ee=me.split(">"),ue=ee[0],ge=ee[1];ue=String.fromCodePoint(G+=parseInt(ue,K)),ge=String.fromCodePoint(G+=parseInt(ge,K)),ae.set(ue,ge),re&&Q.set(ge,ue)}}),{map:ae,reverseMap:Q}}var g,k,v;function U(){if(!g){var R=m(y.pairs,!0),re=R.map,K=R.reverseMap;g=re,k=K,v=m(y.canonical,!1).map}}function F(R){return U(),g.get(R)||null}function _(R){return U(),k.get(R)||null}function T(R){return U(),v.get(R)||null}var x=u.L,S=u.R,Y=u.EN,J=u.ES,ne=u.ET,b=u.AN,B=u.CS,E=u.B,j=u.S,N=u.ON,se=u.BN,ie=u.NSM,P=u.AL,W=u.LRO,p=u.RLO,w=u.LRE,L=u.RLE,O=u.PDF,D=u.LRI,I=u.RLI,C=u.FSI,M=u.PDI;function z(R,re){for(var K=125,G=new Uint32Array(R.length),ae=0;ae<R.length;ae++)G[ae]=l(R[ae]);var Q=new Map;function te(Pe,je){var Oe=G[Pe];G[Pe]=je,Q.set(Oe,Q.get(Oe)-1),Oe&a&&Q.set(a,Q.get(a)-1),Q.set(je,(Q.get(je)||0)+1),je&a&&Q.set(a,(Q.get(a)||0)+1)}for(var H=new Uint8Array(R.length),me=new Map,pe=[],ee=null,ue=0;ue<R.length;ue++)ee||pe.push(ee={start:ue,end:R.length-1,level:re==="rtl"?1:re==="ltr"?0:It(ue,!1)}),G[ue]&E&&(ee.end=ue,ee=null);for(var ge=L|w|p|W|e|M|O|E,xe=function(Pe){return Pe+(Pe&1?1:2)},le=function(Pe){return Pe+(Pe&1?2:1)},Ue=0;Ue<pe.length;Ue++){ee=pe[Ue];var ve=[{_level:ee.level,_override:0,_isolate:0}],oe=void 0,ye=0,_e=0,Fe=0;Q.clear();for(var he=ee.start;he<=ee.end;he++){var Se=G[he];if(oe=ve[ve.length-1],Q.set(Se,(Q.get(Se)||0)+1),Se&a&&Q.set(a,(Q.get(a)||0)+1),Se&ge)if(Se&(L|w)){H[he]=oe._level;var Me=(Se===L?le:xe)(oe._level);Me<=K&&!ye&&!_e?ve.push({_level:Me,_override:0,_isolate:0}):ye||_e++}else if(Se&(p|W)){H[he]=oe._level;var Ye=(Se===p?le:xe)(oe._level);Ye<=K&&!ye&&!_e?ve.push({_level:Ye,_override:Se&p?S:x,_isolate:0}):ye||_e++}else if(Se&e){Se&C&&(Se=It(he+1,!0)===1?I:D),H[he]=oe._level,oe._override&&te(he,oe._override);var Ze=(Se===I?le:xe)(oe._level);Ze<=K&&ye===0&&_e===0?(Fe++,ve.push({_level:Ze,_override:0,_isolate:1,_isolInitIndex:he})):ye++}else if(Se&M){if(ye>0)ye--;else if(Fe>0){for(_e=0;!ve[ve.length-1]._isolate;)ve.pop();var He=ve[ve.length-1]._isolInitIndex;He!=null&&(me.set(He,he),me.set(he,He)),ve.pop(),Fe--}oe=ve[ve.length-1],H[he]=oe._level,oe._override&&te(he,oe._override)}else Se&O?(ye===0&&(_e>0?_e--:!oe._isolate&&ve.length>1&&(ve.pop(),oe=ve[ve.length-1])),H[he]=oe._level):Se&E&&(H[he]=ee.level);else H[he]=oe._level,oe._override&&Se!==se&&te(he,oe._override)}for(var Ie=[],Le=null,Te=ee.start;Te<=ee.end;Te++){var sr=G[Te];if(!(sr&n)){var ke=H[Te],we=sr&e,Ne=sr===M;Le&&ke===Le._level?(Le._end=Te,Le._endsWithIsolInit=we):Ie.push(Le={_start:Te,_end:Te,_level:ke,_startsWithPDI:Ne,_endsWithIsolInit:we})}}for(var Re=[],be=0;be<Ie.length;be++){var De=Ie[be];if(!De._startsWithPDI||De._startsWithPDI&&!me.has(De._start)){for(var We=[Le=De],Ae=void 0;Le&&Le._endsWithIsolInit&&(Ae=me.get(Le._end))!=null;)for(var Ce=be+1;Ce<Ie.length;Ce++)if(Ie[Ce]._start===Ae){We.push(Le=Ie[Ce]);break}for(var Ge=[],Je=0;Je<We.length;Je++)for(var ze=We[Je],qe=ze._start;qe<=ze._end;qe++)Ge.push(qe);for(var _n=H[Ge[0]],_t=ee.level,Sr=Ge[0]-1;Sr>=0;Sr--)if(!(G[Sr]&n)){_t=H[Sr];break}var Nr=Ge[Ge.length-1],Un=H[Nr],Ut=ee.level;if(!(G[Nr]&e)){for(var Tr=Nr+1;Tr<=ee.end;Tr++)if(!(G[Tr]&n)){Ut=H[Tr];break}}Re.push({_seqIndices:Ge,_sosType:Math.max(_t,_n)%2?S:x,_eosType:Math.max(Ut,Un)%2?S:x})}}for(var zr=0;zr<Re.length;zr++){var Vr=Re[zr],$=Vr._seqIndices,fr=Vr._sosType,Sn=Vr._eosType,rr=H[$[0]]&1?S:x;if(Q.get(ie))for(var wr=0;wr<$.length;wr++){var St=$[wr];if(G[St]&ie){for(var jr=fr,kr=wr-1;kr>=0;kr--)if(!(G[$[kr]]&n)){jr=G[$[kr]];break}te(St,jr&(e|M)?N:jr)}}if(Q.get(Y))for(var xr=0;xr<$.length;xr++){var Tt=$[xr];if(G[Tt]&Y)for(var Fr=xr-1;Fr>=-1;Fr--){var wt=Fr===-1?fr:G[$[Fr]];if(wt&o){wt===P&&te(Tt,b);break}}}if(Q.get(P))for(var Xr=0;Xr<$.length;Xr++){var kt=$[Xr];G[kt]&P&&te(kt,S)}if(Q.get(J)||Q.get(B))for(var lr=1;lr<$.length-1;lr++){var Yr=$[lr];if(G[Yr]&(J|B)){for(var tr=0,Hr=0,Jr=lr-1;Jr>=0&&(tr=G[$[Jr]],!!(tr&n));Jr--);for(var Kr=lr+1;Kr<$.length&&(Hr=G[$[Kr]],!!(Hr&n));Kr++);tr===Hr&&(G[Yr]===J?tr===Y:tr&(Y|b))&&te(Yr,tr)}}if(Q.get(Y))for(var Xe=0;Xe<$.length;Xe++){var Tn=$[Xe];if(G[Tn]&Y){for(var Cr=Xe-1;Cr>=0&&G[$[Cr]]&(ne|n);Cr--)te($[Cr],Y);for(Xe++;Xe<$.length&&G[$[Xe]]&(ne|n|Y);Xe++)G[$[Xe]]!==Y&&te($[Xe],Y)}}if(Q.get(ne)||Q.get(J)||Q.get(B))for(var ur=0;ur<$.length;ur++){var xt=$[ur];if(G[xt]&(ne|J|B)){te(xt,N);for(var Dr=ur-1;Dr>=0&&G[$[Dr]]&n;Dr--)te($[Dr],N);for(var Er=ur+1;Er<$.length&&G[$[Er]]&n;Er++)te($[Er],N)}}if(Q.get(Y))for(var Qr=0,Ft=fr;Qr<$.length;Qr++){var Ct=$[Qr],Zr=G[Ct];Zr&Y?Ft===x&&te(Ct,x):Zr&o&&(Ft=Zr)}if(Q.get(a)){var cr=S|Y|b,Dt=cr|x,Ar=[];{for(var nr=[],ar=0;ar<$.length;ar++)if(G[$[ar]]&a){var hr=R[$[ar]],Et=void 0;if(F(hr)!==null)if(nr.length<63)nr.push({char:hr,seqIndex:ar});else break;else if((Et=_(hr))!==null)for(var dr=nr.length-1;dr>=0;dr--){var qr=nr[dr].char;if(qr===Et||qr===_(T(hr))||F(T(qr))===hr){Ar.push([nr[dr].seqIndex,ar]),nr.length=dr;break}}}Ar.sort(function(Pe,je){return Pe[0]-je[0]})}for(var $r=0;$r<Ar.length;$r++){for(var At=Ar[$r],Mr=At[0],et=At[1],Mt=!1,Ve=0,rt=Mr+1;rt<et;rt++){var Gt=$[rt];if(G[Gt]&Dt){Mt=!0;var Pt=G[Gt]&cr?S:x;if(Pt===rr){Ve=Pt;break}}}if(Mt&&!Ve){Ve=fr;for(var tt=Mr-1;tt>=0;tt--){var Ot=$[tt];if(G[Ot]&Dt){var Lt=G[Ot]&cr?S:x;Lt!==rr?Ve=Lt:Ve=rr;break}}}if(Ve){if(G[$[Mr]]=G[$[et]]=Ve,Ve!==rr){for(var vr=Mr+1;vr<$.length;vr++)if(!(G[$[vr]]&n)){l(R[$[vr]])&ie&&(G[$[vr]]=Ve);break}}if(Ve!==rr){for(var pr=et+1;pr<$.length;pr++)if(!(G[$[pr]]&n)){l(R[$[pr]])&ie&&(G[$[pr]]=Ve);break}}}}for(var Ke=0;Ke<$.length;Ke++)if(G[$[Ke]]&a){for(var Rt=Ke,nt=Ke,at=fr,gr=Ke-1;gr>=0;gr--)if(G[$[gr]]&n)Rt=gr;else{at=G[$[gr]]&cr?S:x;break}for(var Bt=Sn,mr=Ke+1;mr<$.length;mr++)if(G[$[mr]]&(a|n))nt=mr;else{Bt=G[$[mr]]&cr?S:x;break}for(var ot=Rt;ot<=nt;ot++)G[$[ot]]=at===Bt?at:rr;Ke=nt}}}for(var Be=ee.start;Be<=ee.end;Be++){var wn=H[Be],Gr=G[Be];if(wn&1?Gr&(x|Y|b)&&H[Be]++:Gr&S?H[Be]++:Gr&(b|Y)&&(H[Be]+=2),Gr&n&&(H[Be]=Be===0?ee.level:H[Be-1]),Be===ee.end||l(R[Be])&(j|E))for(var Pr=Be;Pr>=0&&l(R[Pr])&i;Pr--)H[Pr]=ee.level}}return{levels:H,paragraphs:pe};function It(Pe,je){for(var Oe=Pe;Oe<R.length;Oe++){var Qe=G[Oe];if(Qe&(S|P))return 1;if(Qe&(E|x)||je&&Qe===M)return 0;if(Qe&e){var Wt=kn(Oe);Oe=Wt===-1?R.length:Wt}}return 0}function kn(Pe){for(var je=1,Oe=Pe+1;Oe<R.length;Oe++){var Qe=G[Oe];if(Qe&E)break;if(Qe&M){if(--je===0)return Oe}else Qe&e&&je++}return-1}}var Z="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",V;function A(){if(!V){var R=m(Z,!0),re=R.map,K=R.reverseMap;K.forEach(function(G,ae){re.set(ae,G)}),V=re}}function de(R){return A(),V.get(R)||null}function ce(R,re,K,G){var ae=R.length;K=Math.max(0,K==null?0:+K),G=Math.min(ae-1,G==null?ae-1:+G);for(var Q=new Map,te=K;te<=G;te++)if(re[te]&1){var H=de(R[te]);H!==null&&Q.set(te,H)}return Q}function X(R,re,K,G){var ae=R.length;K=Math.max(0,K==null?0:+K),G=Math.min(ae-1,G==null?ae-1:+G);var Q=[];return re.paragraphs.forEach(function(te){var H=Math.max(K,te.start),me=Math.min(G,te.end);if(H<me){for(var pe=re.levels.slice(H,me+1),ee=me;ee>=H&&l(R[ee])&i;ee--)pe[ee]=te.level;for(var ue=te.level,ge=1/0,xe=0;xe<pe.length;xe++){var le=pe[xe];le>ue&&(ue=le),le<ge&&(ge=le|1)}for(var Ue=ue;Ue>=ge;Ue--)for(var ve=0;ve<pe.length;ve++)if(pe[ve]>=Ue){for(var oe=ve;ve+1<pe.length&&pe[ve+1]>=Ue;)ve++;ve>oe&&Q.push([oe+H,ve+H])}}}),Q}function q(R,re,K,G){var ae=fe(R,re,K,G),Q=[].concat(R);return ae.forEach(function(te,H){Q[H]=(re.levels[te]&1?de(R[te]):null)||R[te]}),Q.join("")}function fe(R,re,K,G){for(var ae=X(R,re,K,G),Q=[],te=0;te<R.length;te++)Q[te]=te;return ae.forEach(function(H){for(var me=H[0],pe=H[1],ee=Q.slice(me,pe+1),ue=ee.length;ue--;)Q[pe-ue]=ee[ue]}),Q}return t.closingToOpeningBracket=_,t.getBidiCharType=l,t.getBidiCharTypeName=h,t.getCanonicalBracket=T,t.getEmbeddingLevels=z,t.getMirroredCharacter=de,t.getMirroredCharactersMap=ce,t.getReorderSegments=X,t.getReorderedIndices=fe,t.getReorderedString=q,t.openingToClosingBracket=F,Object.defineProperty(t,"__esModule",{value:!0}),t}({});return c}const cn=/\bvoid\s+main\s*\(\s*\)\s*{/g;function ht(c){const t=/^[ \t]*#include +<([\w\d./]+)>/gm;function d(u,r){let e=Zn[r];return e?ht(e):u}return c.replace(t,d)}const Ee=[];for(let c=0;c<256;c++)Ee[c]=(c<16?"0":"")+c.toString(16);function ka(){const c=Math.random()*4294967295|0,t=Math.random()*4294967295|0,d=Math.random()*4294967295|0,u=Math.random()*4294967295|0;return(Ee[c&255]+Ee[c>>8&255]+Ee[c>>16&255]+Ee[c>>24&255]+"-"+Ee[t&255]+Ee[t>>8&255]+"-"+Ee[t>>16&15|64]+Ee[t>>24&255]+"-"+Ee[d&63|128]+Ee[d>>8&255]+"-"+Ee[d>>16&255]+Ee[d>>24&255]+Ee[u&255]+Ee[u>>8&255]+Ee[u>>16&255]+Ee[u>>24&255]).toUpperCase()}const $e=Object.assign||function(){let c=arguments[0];for(let t=1,d=arguments.length;t<d;t++){let u=arguments[t];if(u)for(let r in u)Object.prototype.hasOwnProperty.call(u,r)&&(c[r]=u[r])}return c},xa=Date.now(),Xt=new WeakMap,Yt=new Map;let Fa=1e10;function dt(c,t){const d=Aa(t);let u=Xt.get(c);if(u||Xt.set(c,u=Object.create(null)),u[d])return new u[d];const r=`_onBeforeCompile${d}`,e=function(i,s){c.onBeforeCompile.call(this,i,s);const f=this.customProgramCacheKey()+"|"+i.vertexShader+"|"+i.fragmentShader;let l=Yt[f];if(!l){const h=Ca(this,i,t,d);l=Yt[f]=h}i.vertexShader=l.vertexShader,i.fragmentShader=l.fragmentShader,$e(i.uniforms,this.uniforms),t.timeUniform&&(i.uniforms[t.timeUniform]={get value(){return Date.now()-xa}}),this[r]&&this[r](i)},o=function(){return a(t.chained?c:c.clone())},a=function(i){const s=Object.create(i,n);return Object.defineProperty(s,"baseMaterial",{value:c}),Object.defineProperty(s,"id",{value:Fa++}),s.uuid=ka(),s.uniforms=$e({},i.uniforms,t.uniforms),s.defines=$e({},i.defines,t.defines),s.defines[`TROIKA_DERIVED_MATERIAL_${d}`]="",s.extensions=$e({},i.extensions,t.extensions),s._listeners=void 0,s},n={constructor:{value:o},isDerivedMaterial:{value:!0},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return c.customProgramCacheKey()+"|"+d}},onBeforeCompile:{get(){return e},set(i){this[r]=i}},copy:{writable:!0,configurable:!0,value:function(i){return c.copy.call(this,i),!c.isShaderMaterial&&!c.isDerivedMaterial&&($e(this.extensions,i.extensions),$e(this.defines,i.defines),$e(this.uniforms,Hn.clone(i.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const i=new c.constructor;return a(i).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let i=this._depthMaterial;return i||(i=this._depthMaterial=dt(c.isDerivedMaterial?c.getDepthMaterial():new Jn({depthPacking:Kn}),t),i.defines.IS_DEPTH_MATERIAL="",i.uniforms=this.uniforms),i}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let i=this._distanceMaterial;return i||(i=this._distanceMaterial=dt(c.isDerivedMaterial?c.getDistanceMaterial():new Qn,t),i.defines.IS_DISTANCE_MATERIAL="",i.uniforms=this.uniforms),i}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:i,_distanceMaterial:s}=this;i&&i.dispose(),s&&s.dispose(),c.dispose.call(this)}}};return u[d]=o,new o}function Ca(c,{vertexShader:t,fragmentShader:d},u,r){let{vertexDefs:e,vertexMainIntro:o,vertexMainOutro:a,vertexTransform:n,fragmentDefs:i,fragmentMainIntro:s,fragmentMainOutro:f,fragmentColorTransform:l,customRewriter:h,timeUniform:y}=u;if(e=e||"",o=o||"",a=a||"",i=i||"",s=s||"",f=f||"",(n||h)&&(t=ht(t)),(l||h)&&(d=d.replace(/^[ \t]*#include <((?:tonemapping|encodings|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),d=ht(d)),h){let m=h({vertexShader:t,fragmentShader:d});t=m.vertexShader,d=m.fragmentShader}if(l){let m=[];d=d.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,g=>(m.push(g),"")),f=`${l}
${m.join(`
`)}
${f}`}if(y){const m=`
uniform float ${y};
`;e=m+e,i=m+i}return n&&(t=`vec3 troika_position_${r};
vec3 troika_normal_${r};
vec2 troika_uv_${r};
${t}
`,e=`${e}
void troikaVertexTransform${r}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${n}
}
`,o=`
troika_position_${r} = vec3(position);
troika_normal_${r} = vec3(normal);
troika_uv_${r} = vec2(uv);
troikaVertexTransform${r}(troika_position_${r}, troika_normal_${r}, troika_uv_${r});
${o}
`,t=t.replace(/\b(position|normal|uv)\b/g,(m,g,k,v)=>/\battribute\s+vec[23]\s+$/.test(v.substr(0,k))?g:`troika_${g}_${r}`),c.map&&c.map.channel>0||(t=t.replace(/\bMAP_UV\b/g,`troika_uv_${r}`))),t=Ht(t,r,e,o,a),d=Ht(d,r,i,s,f),{vertexShader:t,fragmentShader:d}}function Ht(c,t,d,u,r){return(u||r||d)&&(c=c.replace(cn,`
${d}
void troikaOrigMain${t}() {`),c+=`
void main() {
  ${u}
  troikaOrigMain${t}();
  ${r}
}`),c}function Da(c,t){return c==="uniforms"?void 0:typeof t=="function"?t.toString():t}let Ea=0;const Jt=new Map;function Aa(c){const t=JSON.stringify(c,Da);let d=Jt.get(t);return d==null&&Jt.set(t,d=++Ea),d}function Ma(c,t,d){const{defaultFontURL:u}=d,r=Object.create(null),e=1/0,o=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,a="[^\\S\\u00A0]",n=new RegExp(`${a}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function i(v,U){function F(){const _=T=>{console.error(`Failure loading font ${v}${v===u?"":"; trying fallback"}`,T),v!==u&&(v=u,F())};try{const T=new XMLHttpRequest;T.open("get",v,!0),T.responseType="arraybuffer",T.onload=function(){if(T.status>=400)_(new Error(T.statusText));else if(T.status>0)try{const x=c(T.response);U(x)}catch(x){_(x)}},T.onerror=_,T.send()}catch(T){_(T)}}F()}function s(v,U){v||(v=u);let F=r[v];F?F.pending?F.pending.push(U):U(F):(r[v]={pending:[U]},i(v,_=>{let T=r[v].pending;r[v]=_,T.forEach(x=>x(_))}))}function f({text:v="",font:U=u,sdfGlyphSize:F=64,fontSize:_=1,letterSpacing:T=0,lineHeight:x="normal",maxWidth:S=e,direction:Y,textAlign:J="left",textIndent:ne=0,whiteSpace:b="normal",overflowWrap:B="normal",anchorX:E=0,anchorY:j=0,includeCaretPositions:N=!1,chunkedBoundsSize:se=8192,colorRanges:ie=null},P,W=!1){const p=m(),w={fontLoad:0,typesetting:0};v.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),v=v.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),_=+_,T=+T,S=+S,x=x||"normal",ne=+ne,s(U,L=>{const O=isFinite(S);let D=null,I=null,C=null,M=null,z=null,Z=null,V=null,A=0,de=0,ce=b!=="nowrap";const{ascender:X,descender:q,unitsPerEm:fe,lineGap:R,capHeight:re,xHeight:K}=L;w.fontLoad=m()-p;const G=m(),ae=_/fe;x==="normal"&&(x=(X-q+R)/fe),x=x*_;const Q=(x-(X-q)*ae)/2,te=-(X*ae+Q),H=Math.min(x,(X-q)*ae),me=(X+q)/2*ae-H/2;let pe=ne,ee=new g;const ue=[ee];L.forEachGlyph(v,_,T,(le,Ue,ve)=>{const oe=v.charAt(ve),ye=le.advanceWidth*ae,_e=ee.count;let Fe;if("isEmpty"in le||(le.isWhitespace=!!oe&&new RegExp(a).test(oe),le.canBreakAfter=!!oe&&n.test(oe),le.isEmpty=le.xMin===le.xMax||le.yMin===le.yMax||o.test(oe)),!le.isWhitespace&&!le.isEmpty&&de++,ce&&O&&!le.isWhitespace&&Ue+ye+pe>S&&_e){if(ee.glyphAt(_e-1).glyphObj.canBreakAfter)Fe=new g,pe=-Ue;else for(let Se=_e;Se--;)if(Se===0&&B==="break-word"){Fe=new g,pe=-Ue;break}else if(ee.glyphAt(Se).glyphObj.canBreakAfter){Fe=ee.splitAt(Se+1);const Me=Fe.glyphAt(0).x;pe-=Me;for(let Ye=Fe.count;Ye--;)Fe.glyphAt(Ye).x-=Me;break}Fe&&(ee.isSoftWrapped=!0,ee=Fe,ue.push(ee),A=S)}let he=ee.glyphAt(ee.count);he.glyphObj=le,he.x=Ue+pe,he.width=ye,he.charIndex=ve,oe===`
`&&(ee=new g,ue.push(ee),pe=-(Ue+ye+T*_)+ne)}),ue.forEach(le=>{for(let Ue=le.count;Ue--;){let{glyphObj:ve,x:oe,width:ye}=le.glyphAt(Ue);if(!ve.isWhitespace){le.width=oe+ye,le.width>A&&(A=le.width);return}}});let ge=0,xe=0;if(E&&(typeof E=="number"?ge=-E:typeof E=="string"&&(ge=-A*(E==="left"?0:E==="center"?.5:E==="right"?1:h(E)))),j){if(typeof j=="number")xe=-j;else if(typeof j=="string"){let le=ue.length*x;xe=j==="top"?0:j==="top-baseline"?-te:j==="top-cap"?-te-re*ae:j==="top-ex"?-te-K*ae:j==="middle"?le/2:j==="bottom"?le:j==="bottom-baseline"?le-Q+q*ae:h(j)*le}}if(!W){const le=t.getEmbeddingLevels(v,Y);D=new Uint16Array(de),I=new Float32Array(de*2),C={},Z=[e,e,-e,-e],V=[];let Ue=te;N&&(z=new Float32Array(v.length*3)),ie&&(M=new Uint8Array(de*3));let ve=0,oe=-1,ye=-1,_e,Fe;if(ue.forEach((he,Se)=>{let{count:Me,width:Ye}=he;if(Me>0){let Ze=0;for(let ke=Me;ke--&&he.glyphAt(ke).glyphObj.isWhitespace;)Ze++;let He=0,Ie=0;if(J==="center")He=(A-Ye)/2;else if(J==="right")He=A-Ye;else if(J==="justify"&&he.isSoftWrapped){let ke=0;for(let we=Me-Ze;we--;)he.glyphAt(we).glyphObj.isWhitespace&&ke++;Ie=(A-Ye)/ke}if(Ie||He){let ke=0;for(let we=0;we<Me;we++){let Ne=he.glyphAt(we);const Re=Ne.glyphObj;Ne.x+=He+ke,Ie!==0&&Re.isWhitespace&&we<Me-Ze&&(ke+=Ie,Ne.width+=Ie)}}const Le=t.getReorderSegments(v,le,he.glyphAt(0).charIndex,he.glyphAt(he.count-1).charIndex);for(let ke=0;ke<Le.length;ke++){const[we,Ne]=Le[ke];let Re=1/0,be=-1/0;for(let De=0;De<Me;De++)if(he.glyphAt(De).charIndex>=we){let We=De,Ae=De;for(;Ae<Me;Ae++){let Ce=he.glyphAt(Ae);if(Ce.charIndex>Ne)break;Ae<Me-Ze&&(Re=Math.min(Re,Ce.x),be=Math.max(be,Ce.x+Ce.width))}for(let Ce=We;Ce<Ae;Ce++){const Ge=he.glyphAt(Ce);Ge.x=be-(Ge.x+Ge.width-Re)}break}}let Te;const sr=ke=>Te=ke;for(let ke=0;ke<Me;ke++){let we=he.glyphAt(ke);Te=we.glyphObj;const Ne=Te.index,Re=le.levels[we.charIndex]&1;if(Re){const be=t.getMirroredCharacter(v[we.charIndex]);be&&L.forEachGlyph(be,0,0,sr)}if(N){const{charIndex:be}=we,De=we.x+ge,We=we.x+we.width+ge;z[be*3]=Re?We:De,z[be*3+1]=Re?De:We,z[be*3+2]=Ue+me+xe;const Ae=be-oe;Ae>1&&y(z,oe,Ae),oe=be}if(ie){const{charIndex:be}=we;for(;be>ye;)ye++,ie.hasOwnProperty(ye)&&(Fe=ie[ye])}if(!Te.isWhitespace&&!Te.isEmpty){const be=ve++;C[Ne]||(C[Ne]={path:Te.path,pathBounds:[Te.xMin,Te.yMin,Te.xMax,Te.yMax]});const De=we.x+ge,We=Ue+xe;I[be*2]=De,I[be*2+1]=We;const Ae=De+Te.xMin*ae,Ce=We+Te.yMin*ae,Ge=De+Te.xMax*ae,Je=We+Te.yMax*ae;Ae<Z[0]&&(Z[0]=Ae),Ce<Z[1]&&(Z[1]=Ce),Ge>Z[2]&&(Z[2]=Ge),Je>Z[3]&&(Z[3]=Je),be%se===0&&(_e={start:be,end:be,rect:[e,e,-e,-e]},V.push(_e)),_e.end++;const ze=_e.rect;if(Ae<ze[0]&&(ze[0]=Ae),Ce<ze[1]&&(ze[1]=Ce),Ge>ze[2]&&(ze[2]=Ge),Je>ze[3]&&(ze[3]=Je),D[be]=Ne,ie){const qe=be*3;M[qe]=Fe>>16&255,M[qe+1]=Fe>>8&255,M[qe+2]=Fe&255}}}}Ue-=x}),z){const he=v.length-oe;he>1&&y(z,oe,he)}}w.typesetting=m()-G,P({glyphIds:D,glyphPositions:I,glyphData:C,caretPositions:z,caretHeight:H,glyphColors:M,chunkedBounds:V,fontSize:_,unitsPerEm:fe,ascender:X*ae,descender:q*ae,capHeight:re*ae,xHeight:K*ae,lineHeight:x,topBaseline:te,blockBounds:[ge,xe-ue.length*x,ge+A,xe],visibleBounds:Z,timings:w})})}function l(v,U){f(v,F=>{const[_,T,x,S]=F.blockBounds;U({width:x-_,height:S-T})},{metricsOnly:!0})}function h(v){let U=v.match(/^([\d.]+)%$/),F=U?parseFloat(U[1]):NaN;return isNaN(F)?0:F/100}function y(v,U,F){const _=v[U*3],T=v[U*3+1],x=v[U*3+2],S=(T-_)/F;for(let Y=0;Y<F;Y++){const J=(U+Y)*3;v[J]=_+S*Y,v[J+1]=_+S*(Y+1),v[J+2]=x}}function m(){return(self.performance||Date).now()}function g(){this.data=[]}const k=["glyphObj","x","width","charIndex"];return g.prototype={width:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/k.length)},glyphAt(v){let U=g.flyweight;return U.data=this.data,U.index=v,U},splitAt(v){let U=new g;return U.data=this.data.splice(v*k.length),U}},g.flyweight=k.reduce((v,U,F,_)=>(Object.defineProperty(v,U,{get(){return this.data[this.index*k.length+F]},set(T){this.data[this.index*k.length+F]=T}}),v),{data:null,index:0}),{typeset:f,measure:l,loadFont:s}}const er=()=>(self.performance||Date).now(),Wr=un();let Kt;function Ga(c,t,d,u,r,e,o,a,n,i,s=!0){return s?Oa(c,t,d,u,r,e,o,a,n,i).then(null,f=>(Kt||(console.warn("WebGL SDF generation failed, falling back to JS",f),Kt=!0),Zt(c,t,d,u,r,e,o,a,n,i))):Zt(c,t,d,u,r,e,o,a,n,i)}const Br=[],Pa=5;let vt=0;function hn(){const c=er();for(;Br.length&&er()-c<Pa;)Br.shift()();vt=Br.length?setTimeout(hn,0):0}const Oa=(...c)=>new Promise((t,d)=>{Br.push(()=>{const u=er();try{Wr.webgl.generateIntoCanvas(...c),t({timing:er()-u})}catch(r){d(r)}}),vt||(vt=setTimeout(hn,0))}),La=4,Ra=2e3,Qt={};let Ba=0;function Zt(c,t,d,u,r,e,o,a,n,i){const s="TroikaTextSDFGenerator_JS_"+Ba++%La;let f=Qt[s];return f||(f=Qt[s]={workerModule:Ur({name:s,workerId:s,dependencies:[un,er],init(l,h){const y=l().javascript.generate;return function(...m){const g=h();return{textureData:y(...m),timing:h()-g}}},getTransferables(l){return[l.textureData.buffer]}}),requests:0,idleTimer:null}),f.requests++,clearTimeout(f.idleTimer),f.workerModule(c,t,d,u,r,e).then(({textureData:l,timing:h})=>{const y=er(),m=new Uint8Array(l.length*4);for(let g=0;g<l.length;g++)m[g*4+i]=l[g];return Wr.webglUtils.renderImageData(o,m,a,n,c,t,1<<3-i),h+=er()-y,--f.requests===0&&(f.idleTimer=setTimeout(()=>{Sa(s)},Ra)),{timing:h}})}function Ia(c){c._warm||(Wr.webgl.isSupported(c),c._warm=!0)}const Wa=Wr.webglUtils.resizeWebGLCanvasWithoutClearing;/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function Na(){return typeof window>"u"&&(self.window=self),function(c){var t={parse:function(r){var e=t._bin,o=new Uint8Array(r);if(e.readASCII(o,0,4)=="ttcf"){var a=4;e.readUshort(o,a),a+=2,e.readUshort(o,a),a+=2;var n=e.readUint(o,a);a+=4;for(var i=[],s=0;s<n;s++){var f=e.readUint(o,a);a+=4,i.push(t._readFont(o,f))}return i}return[t._readFont(o,0)]},_readFont:function(r,e){var o=t._bin,a=e;o.readFixed(r,e),e+=4;var n=o.readUshort(r,e);e+=2,o.readUshort(r,e),e+=2,o.readUshort(r,e),e+=2,o.readUshort(r,e),e+=2;for(var i=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GPOS","GSUB","SVG "],s={_data:r,_offset:a},f={},l=0;l<n;l++){var h=o.readASCII(r,e,4);e+=4,o.readUint(r,e),e+=4;var y=o.readUint(r,e);e+=4;var m=o.readUint(r,e);e+=4,f[h]={offset:y,length:m}}for(l=0;l<i.length;l++){var g=i[l];f[g]&&(s[g.trim()]=t[g.trim()].parse(r,f[g].offset,f[g].length,s))}return s},_tabOffset:function(r,e,o){for(var a=t._bin,n=a.readUshort(r,o+4),i=o+12,s=0;s<n;s++){var f=a.readASCII(r,i,4);i+=4,a.readUint(r,i),i+=4;var l=a.readUint(r,i);if(i+=4,a.readUint(r,i),i+=4,f==e)return l}return 0}};t._bin={readFixed:function(r,e){return(r[e]<<8|r[e+1])+(r[e+2]<<8|r[e+3])/65540},readF2dot14:function(r,e){return t._bin.readShort(r,e)/16384},readInt:function(r,e){return t._bin._view(r).getInt32(e)},readInt8:function(r,e){return t._bin._view(r).getInt8(e)},readShort:function(r,e){return t._bin._view(r).getInt16(e)},readUshort:function(r,e){return t._bin._view(r).getUint16(e)},readUshorts:function(r,e,o){for(var a=[],n=0;n<o;n++)a.push(t._bin.readUshort(r,e+2*n));return a},readUint:function(r,e){return t._bin._view(r).getUint32(e)},readUint64:function(r,e){return 4294967296*t._bin.readUint(r,e)+t._bin.readUint(r,e+4)},readASCII:function(r,e,o){for(var a="",n=0;n<o;n++)a+=String.fromCharCode(r[e+n]);return a},readUnicode:function(r,e,o){for(var a="",n=0;n<o;n++){var i=r[e++]<<8|r[e++];a+=String.fromCharCode(i)}return a},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(r,e,o){var a=t._bin._tdec;return a&&e==0&&o==r.length?a.decode(r):t._bin.readASCII(r,e,o)},readBytes:function(r,e,o){for(var a=[],n=0;n<o;n++)a.push(r[e+n]);return a},readASCIIArray:function(r,e,o){for(var a=[],n=0;n<o;n++)a.push(String.fromCharCode(r[e+n]));return a},_view:function(r){return r._dataView||(r._dataView=r.buffer?new DataView(r.buffer,r.byteOffset,r.byteLength):new DataView(new Uint8Array(r).buffer))}},t._lctf={},t._lctf.parse=function(r,e,o,a,n){var i=t._bin,s={},f=e;i.readFixed(r,e),e+=4;var l=i.readUshort(r,e);e+=2;var h=i.readUshort(r,e);e+=2;var y=i.readUshort(r,e);return e+=2,s.scriptList=t._lctf.readScriptList(r,f+l),s.featureList=t._lctf.readFeatureList(r,f+h),s.lookupList=t._lctf.readLookupList(r,f+y,n),s},t._lctf.readLookupList=function(r,e,o){var a=t._bin,n=e,i=[],s=a.readUshort(r,e);e+=2;for(var f=0;f<s;f++){var l=a.readUshort(r,e);e+=2;var h=t._lctf.readLookupTable(r,n+l,o);i.push(h)}return i},t._lctf.readLookupTable=function(r,e,o){var a=t._bin,n=e,i={tabs:[]};i.ltype=a.readUshort(r,e),e+=2,i.flag=a.readUshort(r,e),e+=2;var s=a.readUshort(r,e);e+=2;for(var f=i.ltype,l=0;l<s;l++){var h=a.readUshort(r,e);e+=2;var y=o(r,f,n+h,i);i.tabs.push(y)}return i},t._lctf.numOfOnes=function(r){for(var e=0,o=0;o<32;o++)r>>>o&1&&e++;return e},t._lctf.readClassDef=function(r,e){var o=t._bin,a=[],n=o.readUshort(r,e);if(e+=2,n==1){var i=o.readUshort(r,e);e+=2;var s=o.readUshort(r,e);e+=2;for(var f=0;f<s;f++)a.push(i+f),a.push(i+f),a.push(o.readUshort(r,e)),e+=2}if(n==2){var l=o.readUshort(r,e);for(e+=2,f=0;f<l;f++)a.push(o.readUshort(r,e)),e+=2,a.push(o.readUshort(r,e)),e+=2,a.push(o.readUshort(r,e)),e+=2}return a},t._lctf.getInterval=function(r,e){for(var o=0;o<r.length;o+=3){var a=r[o],n=r[o+1];if(r[o+2],a<=e&&e<=n)return o}return-1},t._lctf.readCoverage=function(r,e){var o=t._bin,a={};a.fmt=o.readUshort(r,e),e+=2;var n=o.readUshort(r,e);return e+=2,a.fmt==1&&(a.tab=o.readUshorts(r,e,n)),a.fmt==2&&(a.tab=o.readUshorts(r,e,3*n)),a},t._lctf.coverageIndex=function(r,e){var o=r.tab;if(r.fmt==1)return o.indexOf(e);if(r.fmt==2){var a=t._lctf.getInterval(o,e);if(a!=-1)return o[a+2]+(e-o[a])}return-1},t._lctf.readFeatureList=function(r,e){var o=t._bin,a=e,n=[],i=o.readUshort(r,e);e+=2;for(var s=0;s<i;s++){var f=o.readASCII(r,e,4);e+=4;var l=o.readUshort(r,e);e+=2;var h=t._lctf.readFeatureTable(r,a+l);h.tag=f.trim(),n.push(h)}return n},t._lctf.readFeatureTable=function(r,e){var o=t._bin,a=e,n={},i=o.readUshort(r,e);e+=2,i>0&&(n.featureParams=a+i);var s=o.readUshort(r,e);e+=2,n.tab=[];for(var f=0;f<s;f++)n.tab.push(o.readUshort(r,e+2*f));return n},t._lctf.readScriptList=function(r,e){var o=t._bin,a=e,n={},i=o.readUshort(r,e);e+=2;for(var s=0;s<i;s++){var f=o.readASCII(r,e,4);e+=4;var l=o.readUshort(r,e);e+=2,n[f.trim()]=t._lctf.readScriptTable(r,a+l)}return n},t._lctf.readScriptTable=function(r,e){var o=t._bin,a=e,n={},i=o.readUshort(r,e);e+=2,n.default=t._lctf.readLangSysTable(r,a+i);var s=o.readUshort(r,e);e+=2;for(var f=0;f<s;f++){var l=o.readASCII(r,e,4);e+=4;var h=o.readUshort(r,e);e+=2,n[l.trim()]=t._lctf.readLangSysTable(r,a+h)}return n},t._lctf.readLangSysTable=function(r,e){var o=t._bin,a={};o.readUshort(r,e),e+=2,a.reqFeature=o.readUshort(r,e),e+=2;var n=o.readUshort(r,e);return e+=2,a.features=o.readUshorts(r,e,n),a},t.CFF={},t.CFF.parse=function(r,e,o){var a=t._bin;(r=new Uint8Array(r.buffer,e,o))[e=0],r[++e],r[++e],r[++e],e++;var n=[];e=t.CFF.readIndex(r,e,n);for(var i=[],s=0;s<n.length-1;s++)i.push(a.readASCII(r,e+n[s],n[s+1]-n[s]));e+=n[n.length-1];var f=[];e=t.CFF.readIndex(r,e,f);var l=[];for(s=0;s<f.length-1;s++)l.push(t.CFF.readDict(r,e+f[s],e+f[s+1]));e+=f[f.length-1];var h=l[0],y=[];e=t.CFF.readIndex(r,e,y);var m=[];for(s=0;s<y.length-1;s++)m.push(a.readASCII(r,e+y[s],y[s+1]-y[s]));if(e+=y[y.length-1],t.CFF.readSubrs(r,e,h),h.CharStrings){e=h.CharStrings,y=[],e=t.CFF.readIndex(r,e,y);var g=[];for(s=0;s<y.length-1;s++)g.push(a.readBytes(r,e+y[s],y[s+1]-y[s]));h.CharStrings=g}if(h.ROS){e=h.FDArray;var k=[];for(e=t.CFF.readIndex(r,e,k),h.FDArray=[],s=0;s<k.length-1;s++){var v=t.CFF.readDict(r,e+k[s],e+k[s+1]);t.CFF._readFDict(r,v,m),h.FDArray.push(v)}e+=k[k.length-1],e=h.FDSelect,h.FDSelect=[];var U=r[e];if(e++,U!=3)throw U;var F=a.readUshort(r,e);for(e+=2,s=0;s<F+1;s++)h.FDSelect.push(a.readUshort(r,e),r[e+2]),e+=3}return h.Encoding&&(h.Encoding=t.CFF.readEncoding(r,h.Encoding,h.CharStrings.length)),h.charset&&(h.charset=t.CFF.readCharset(r,h.charset,h.CharStrings.length)),t.CFF._readFDict(r,h,m),h},t.CFF._readFDict=function(r,e,o){var a;for(var n in e.Private&&(a=e.Private[1],e.Private=t.CFF.readDict(r,a,a+e.Private[0]),e.Private.Subrs&&t.CFF.readSubrs(r,a+e.Private.Subrs,e.Private)),e)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(n)!=-1&&(e[n]=o[e[n]-426+35])},t.CFF.readSubrs=function(r,e,o){var a=t._bin,n=[];e=t.CFF.readIndex(r,e,n);var i,s=n.length;i=s<1240?107:s<33900?1131:32768,o.Bias=i,o.Subrs=[];for(var f=0;f<n.length-1;f++)o.Subrs.push(a.readBytes(r,e+n[f],n[f+1]-n[f]))},t.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],t.CFF.glyphByUnicode=function(r,e){for(var o=0;o<r.charset.length;o++)if(r.charset[o]==e)return o;return-1},t.CFF.glyphBySE=function(r,e){return e<0||e>255?-1:t.CFF.glyphByUnicode(r,t.CFF.tableSE[e])},t.CFF.readEncoding=function(r,e,o){t._bin;var a=[".notdef"],n=r[e];if(e++,n!=0)throw"error: unknown encoding format: "+n;var i=r[e];e++;for(var s=0;s<i;s++)a.push(r[e+s]);return a},t.CFF.readCharset=function(r,e,o){var a=t._bin,n=[".notdef"],i=r[e];if(e++,i==0)for(var s=0;s<o;s++){var f=a.readUshort(r,e);e+=2,n.push(f)}else{if(i!=1&&i!=2)throw"error: format: "+i;for(;n.length<o;){f=a.readUshort(r,e),e+=2;var l=0;for(i==1?(l=r[e],e++):(l=a.readUshort(r,e),e+=2),s=0;s<=l;s++)n.push(f),f++}}return n},t.CFF.readIndex=function(r,e,o){var a=t._bin,n=a.readUshort(r,e)+1,i=r[e+=2];if(e++,i==1)for(var s=0;s<n;s++)o.push(r[e+s]);else if(i==2)for(s=0;s<n;s++)o.push(a.readUshort(r,e+2*s));else if(i==3)for(s=0;s<n;s++)o.push(16777215&a.readUint(r,e+3*s-1));else if(n!=1)throw"unsupported offset size: "+i+", count: "+n;return(e+=n*i)-1},t.CFF.getCharString=function(r,e,o){var a=t._bin,n=r[e],i=r[e+1];r[e+2],r[e+3],r[e+4];var s=1,f=null,l=null;n<=20&&(f=n,s=1),n==12&&(f=100*n+i,s=2),21<=n&&n<=27&&(f=n,s=1),n==28&&(l=a.readShort(r,e+1),s=3),29<=n&&n<=31&&(f=n,s=1),32<=n&&n<=246&&(l=n-139,s=1),247<=n&&n<=250&&(l=256*(n-247)+i+108,s=2),251<=n&&n<=254&&(l=256*-(n-251)-i-108,s=2),n==255&&(l=a.readInt(r,e+1)/65535,s=5),o.val=l??"o"+f,o.size=s},t.CFF.readCharString=function(r,e,o){for(var a=e+o,n=t._bin,i=[];e<a;){var s=r[e],f=r[e+1];r[e+2],r[e+3],r[e+4];var l=1,h=null,y=null;s<=20&&(h=s,l=1),s==12&&(h=100*s+f,l=2),s!=19&&s!=20||(h=s,l=2),21<=s&&s<=27&&(h=s,l=1),s==28&&(y=n.readShort(r,e+1),l=3),29<=s&&s<=31&&(h=s,l=1),32<=s&&s<=246&&(y=s-139,l=1),247<=s&&s<=250&&(y=256*(s-247)+f+108,l=2),251<=s&&s<=254&&(y=256*-(s-251)-f-108,l=2),s==255&&(y=n.readInt(r,e+1)/65535,l=5),i.push(y??"o"+h),e+=l}return i},t.CFF.readDict=function(r,e,o){for(var a=t._bin,n={},i=[];e<o;){var s=r[e],f=r[e+1];r[e+2],r[e+3],r[e+4];var l=1,h=null,y=null;if(s==28&&(y=a.readShort(r,e+1),l=3),s==29&&(y=a.readInt(r,e+1),l=5),32<=s&&s<=246&&(y=s-139,l=1),247<=s&&s<=250&&(y=256*(s-247)+f+108,l=2),251<=s&&s<=254&&(y=256*-(s-251)-f-108,l=2),s==255)throw y=a.readInt(r,e+1)/65535,l=5,"unknown number";if(s==30){var m=[];for(l=1;;){var g=r[e+l];l++;var k=g>>4,v=15&g;if(k!=15&&m.push(k),v!=15&&m.push(v),v==15)break}for(var U="",F=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],_=0;_<m.length;_++)U+=F[m[_]];y=parseFloat(U)}s<=21&&(h=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][s],l=1,s==12&&(h=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][f],l=2)),h!=null?(n[h]=i.length==1?i[0]:i,i=[]):i.push(y),e+=l}return n},t.cmap={},t.cmap.parse=function(r,e,o){r=new Uint8Array(r.buffer,e,o),e=0;var a=t._bin,n={};a.readUshort(r,e),e+=2;var i=a.readUshort(r,e);e+=2;var s=[];n.tables=[];for(var f=0;f<i;f++){var l=a.readUshort(r,e);e+=2;var h=a.readUshort(r,e);e+=2;var y=a.readUint(r,e);e+=4;var m="p"+l+"e"+h,g=s.indexOf(y);if(g==-1){var k;g=n.tables.length,s.push(y);var v=a.readUshort(r,y);v==0?k=t.cmap.parse0(r,y):v==4?k=t.cmap.parse4(r,y):v==6?k=t.cmap.parse6(r,y):v==12?k=t.cmap.parse12(r,y):console.debug("unknown format: "+v,l,h,y),n.tables.push(k)}if(n[m]!=null)throw"multiple tables for one platform+encoding";n[m]=g}return n},t.cmap.parse0=function(r,e){var o=t._bin,a={};a.format=o.readUshort(r,e),e+=2;var n=o.readUshort(r,e);e+=2,o.readUshort(r,e),e+=2,a.map=[];for(var i=0;i<n-6;i++)a.map.push(r[e+i]);return a},t.cmap.parse4=function(r,e){var o=t._bin,a=e,n={};n.format=o.readUshort(r,e),e+=2;var i=o.readUshort(r,e);e+=2,o.readUshort(r,e),e+=2;var s=o.readUshort(r,e);e+=2;var f=s/2;n.searchRange=o.readUshort(r,e),e+=2,n.entrySelector=o.readUshort(r,e),e+=2,n.rangeShift=o.readUshort(r,e),e+=2,n.endCount=o.readUshorts(r,e,f),e+=2*f,e+=2,n.startCount=o.readUshorts(r,e,f),e+=2*f,n.idDelta=[];for(var l=0;l<f;l++)n.idDelta.push(o.readShort(r,e)),e+=2;for(n.idRangeOffset=o.readUshorts(r,e,f),e+=2*f,n.glyphIdArray=[];e<a+i;)n.glyphIdArray.push(o.readUshort(r,e)),e+=2;return n},t.cmap.parse6=function(r,e){var o=t._bin,a={};a.format=o.readUshort(r,e),e+=2,o.readUshort(r,e),e+=2,o.readUshort(r,e),e+=2,a.firstCode=o.readUshort(r,e),e+=2;var n=o.readUshort(r,e);e+=2,a.glyphIdArray=[];for(var i=0;i<n;i++)a.glyphIdArray.push(o.readUshort(r,e)),e+=2;return a},t.cmap.parse12=function(r,e){var o=t._bin,a={};a.format=o.readUshort(r,e),e+=2,e+=2,o.readUint(r,e),e+=4,o.readUint(r,e),e+=4;var n=o.readUint(r,e);e+=4,a.groups=[];for(var i=0;i<n;i++){var s=e+12*i,f=o.readUint(r,s+0),l=o.readUint(r,s+4),h=o.readUint(r,s+8);a.groups.push([f,l,h])}return a},t.glyf={},t.glyf.parse=function(r,e,o,a){for(var n=[],i=0;i<a.maxp.numGlyphs;i++)n.push(null);return n},t.glyf._parseGlyf=function(r,e){var o=t._bin,a=r._data,n=t._tabOffset(a,"glyf",r._offset)+r.loca[e];if(r.loca[e]==r.loca[e+1])return null;var i={};if(i.noc=o.readShort(a,n),n+=2,i.xMin=o.readShort(a,n),n+=2,i.yMin=o.readShort(a,n),n+=2,i.xMax=o.readShort(a,n),n+=2,i.yMax=o.readShort(a,n),n+=2,i.xMin>=i.xMax||i.yMin>=i.yMax)return null;if(i.noc>0){i.endPts=[];for(var s=0;s<i.noc;s++)i.endPts.push(o.readUshort(a,n)),n+=2;var f=o.readUshort(a,n);if(n+=2,a.length-n<f)return null;i.instructions=o.readBytes(a,n,f),n+=f;var l=i.endPts[i.noc-1]+1;for(i.flags=[],s=0;s<l;s++){var h=a[n];if(n++,i.flags.push(h),(8&h)!=0){var y=a[n];n++;for(var m=0;m<y;m++)i.flags.push(h),s++}}for(i.xs=[],s=0;s<l;s++){var g=(2&i.flags[s])!=0,k=(16&i.flags[s])!=0;g?(i.xs.push(k?a[n]:-a[n]),n++):k?i.xs.push(0):(i.xs.push(o.readShort(a,n)),n+=2)}for(i.ys=[],s=0;s<l;s++)g=(4&i.flags[s])!=0,k=(32&i.flags[s])!=0,g?(i.ys.push(k?a[n]:-a[n]),n++):k?i.ys.push(0):(i.ys.push(o.readShort(a,n)),n+=2);var v=0,U=0;for(s=0;s<l;s++)v+=i.xs[s],U+=i.ys[s],i.xs[s]=v,i.ys[s]=U}else{var F;i.parts=[];do{F=o.readUshort(a,n),n+=2;var _={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(i.parts.push(_),_.glyphIndex=o.readUshort(a,n),n+=2,1&F){var T=o.readShort(a,n);n+=2;var x=o.readShort(a,n);n+=2}else T=o.readInt8(a,n),n++,x=o.readInt8(a,n),n++;2&F?(_.m.tx=T,_.m.ty=x):(_.p1=T,_.p2=x),8&F?(_.m.a=_.m.d=o.readF2dot14(a,n),n+=2):64&F?(_.m.a=o.readF2dot14(a,n),n+=2,_.m.d=o.readF2dot14(a,n),n+=2):128&F&&(_.m.a=o.readF2dot14(a,n),n+=2,_.m.b=o.readF2dot14(a,n),n+=2,_.m.c=o.readF2dot14(a,n),n+=2,_.m.d=o.readF2dot14(a,n),n+=2)}while(32&F);if(256&F){var S=o.readUshort(a,n);for(n+=2,i.instr=[],s=0;s<S;s++)i.instr.push(a[n]),n++}}return i},t.GPOS={},t.GPOS.parse=function(r,e,o,a){return t._lctf.parse(r,e,o,a,t.GPOS.subt)},t.GPOS.subt=function(r,e,o,a){var n=t._bin,i=o,s={};if(s.fmt=n.readUshort(r,o),o+=2,e==1||e==2||e==3||e==7||e==8&&s.fmt<=2){var f=n.readUshort(r,o);o+=2,s.coverage=t._lctf.readCoverage(r,f+i)}if(e==1&&s.fmt==1){var l=n.readUshort(r,o);o+=2;var h=t._lctf.numOfOnes(l);l!=0&&(s.pos=t.GPOS.readValueRecord(r,o,l))}else if(e==2&&s.fmt>=1&&s.fmt<=2){l=n.readUshort(r,o),o+=2;var y=n.readUshort(r,o);o+=2,h=t._lctf.numOfOnes(l);var m=t._lctf.numOfOnes(y);if(s.fmt==1){s.pairsets=[];var g=n.readUshort(r,o);o+=2;for(var k=0;k<g;k++){var v=i+n.readUshort(r,o);o+=2;var U=n.readUshort(r,v);v+=2;for(var F=[],_=0;_<U;_++){var T=n.readUshort(r,v);v+=2,l!=0&&(b=t.GPOS.readValueRecord(r,v,l),v+=2*h),y!=0&&(B=t.GPOS.readValueRecord(r,v,y),v+=2*m),F.push({gid2:T,val1:b,val2:B})}s.pairsets.push(F)}}if(s.fmt==2){var x=n.readUshort(r,o);o+=2;var S=n.readUshort(r,o);o+=2;var Y=n.readUshort(r,o);o+=2;var J=n.readUshort(r,o);for(o+=2,s.classDef1=t._lctf.readClassDef(r,i+x),s.classDef2=t._lctf.readClassDef(r,i+S),s.matrix=[],k=0;k<Y;k++){var ne=[];for(_=0;_<J;_++){var b=null,B=null;l!=0&&(b=t.GPOS.readValueRecord(r,o,l),o+=2*h),y!=0&&(B=t.GPOS.readValueRecord(r,o,y),o+=2*m),ne.push({val1:b,val2:B})}s.matrix.push(ne)}}}else{if(e==9&&s.fmt==1){var E=n.readUshort(r,o);o+=2;var j=n.readUint(r,o);if(o+=4,a.ltype==9)a.ltype=E;else if(a.ltype!=E)throw"invalid extension substitution";return t.GPOS.subt(r,a.ltype,i+j)}console.debug("unsupported GPOS table LookupType",e,"format",s.fmt)}return s},t.GPOS.readValueRecord=function(r,e,o){var a=t._bin,n=[];return n.push(1&o?a.readShort(r,e):0),e+=1&o?2:0,n.push(2&o?a.readShort(r,e):0),e+=2&o?2:0,n.push(4&o?a.readShort(r,e):0),e+=4&o?2:0,n.push(8&o?a.readShort(r,e):0),e+=8&o?2:0,n},t.GSUB={},t.GSUB.parse=function(r,e,o,a){return t._lctf.parse(r,e,o,a,t.GSUB.subt)},t.GSUB.subt=function(r,e,o,a){var n=t._bin,i=o,s={};if(s.fmt=n.readUshort(r,o),o+=2,e!=1&&e!=4&&e!=5&&e!=6)return null;if(e==1||e==4||e==5&&s.fmt<=2||e==6&&s.fmt<=2){var f=n.readUshort(r,o);o+=2,s.coverage=t._lctf.readCoverage(r,i+f)}if(e==1&&s.fmt>=1&&s.fmt<=2){if(s.fmt==1)s.delta=n.readShort(r,o),o+=2;else if(s.fmt==2){var l=n.readUshort(r,o);o+=2,s.newg=n.readUshorts(r,o,l),o+=2*s.newg.length}}else if(e==4){s.vals=[],l=n.readUshort(r,o),o+=2;for(var h=0;h<l;h++){var y=n.readUshort(r,o);o+=2,s.vals.push(t.GSUB.readLigatureSet(r,i+y))}}else if(e==5&&s.fmt==2){if(s.fmt==2){var m=n.readUshort(r,o);o+=2,s.cDef=t._lctf.readClassDef(r,i+m),s.scset=[];var g=n.readUshort(r,o);for(o+=2,h=0;h<g;h++){var k=n.readUshort(r,o);o+=2,s.scset.push(k==0?null:t.GSUB.readSubClassSet(r,i+k))}}}else if(e==6&&s.fmt==3){if(s.fmt==3){for(h=0;h<3;h++){l=n.readUshort(r,o),o+=2;for(var v=[],U=0;U<l;U++)v.push(t._lctf.readCoverage(r,i+n.readUshort(r,o+2*U)));o+=2*l,h==0&&(s.backCvg=v),h==1&&(s.inptCvg=v),h==2&&(s.ahedCvg=v)}l=n.readUshort(r,o),o+=2,s.lookupRec=t.GSUB.readSubstLookupRecords(r,o,l)}}else{if(e==7&&s.fmt==1){var F=n.readUshort(r,o);o+=2;var _=n.readUint(r,o);if(o+=4,a.ltype==9)a.ltype=F;else if(a.ltype!=F)throw"invalid extension substitution";return t.GSUB.subt(r,a.ltype,i+_)}console.debug("unsupported GSUB table LookupType",e,"format",s.fmt)}return s},t.GSUB.readSubClassSet=function(r,e){var o=t._bin.readUshort,a=e,n=[],i=o(r,e);e+=2;for(var s=0;s<i;s++){var f=o(r,e);e+=2,n.push(t.GSUB.readSubClassRule(r,a+f))}return n},t.GSUB.readSubClassRule=function(r,e){var o=t._bin.readUshort,a={},n=o(r,e),i=o(r,e+=2);e+=2,a.input=[];for(var s=0;s<n-1;s++)a.input.push(o(r,e)),e+=2;return a.substLookupRecords=t.GSUB.readSubstLookupRecords(r,e,i),a},t.GSUB.readSubstLookupRecords=function(r,e,o){for(var a=t._bin.readUshort,n=[],i=0;i<o;i++)n.push(a(r,e),a(r,e+2)),e+=4;return n},t.GSUB.readChainSubClassSet=function(r,e){var o=t._bin,a=e,n=[],i=o.readUshort(r,e);e+=2;for(var s=0;s<i;s++){var f=o.readUshort(r,e);e+=2,n.push(t.GSUB.readChainSubClassRule(r,a+f))}return n},t.GSUB.readChainSubClassRule=function(r,e){for(var o=t._bin,a={},n=["backtrack","input","lookahead"],i=0;i<n.length;i++){var s=o.readUshort(r,e);e+=2,i==1&&s--,a[n[i]]=o.readUshorts(r,e,s),e+=2*a[n[i]].length}return s=o.readUshort(r,e),e+=2,a.subst=o.readUshorts(r,e,2*s),e+=2*a.subst.length,a},t.GSUB.readLigatureSet=function(r,e){var o=t._bin,a=e,n=[],i=o.readUshort(r,e);e+=2;for(var s=0;s<i;s++){var f=o.readUshort(r,e);e+=2,n.push(t.GSUB.readLigature(r,a+f))}return n},t.GSUB.readLigature=function(r,e){var o=t._bin,a={chain:[]};a.nglyph=o.readUshort(r,e),e+=2;var n=o.readUshort(r,e);e+=2;for(var i=0;i<n-1;i++)a.chain.push(o.readUshort(r,e)),e+=2;return a},t.head={},t.head.parse=function(r,e,o){var a=t._bin,n={};return a.readFixed(r,e),e+=4,n.fontRevision=a.readFixed(r,e),e+=4,a.readUint(r,e),e+=4,a.readUint(r,e),e+=4,n.flags=a.readUshort(r,e),e+=2,n.unitsPerEm=a.readUshort(r,e),e+=2,n.created=a.readUint64(r,e),e+=8,n.modified=a.readUint64(r,e),e+=8,n.xMin=a.readShort(r,e),e+=2,n.yMin=a.readShort(r,e),e+=2,n.xMax=a.readShort(r,e),e+=2,n.yMax=a.readShort(r,e),e+=2,n.macStyle=a.readUshort(r,e),e+=2,n.lowestRecPPEM=a.readUshort(r,e),e+=2,n.fontDirectionHint=a.readShort(r,e),e+=2,n.indexToLocFormat=a.readShort(r,e),e+=2,n.glyphDataFormat=a.readShort(r,e),e+=2,n},t.hhea={},t.hhea.parse=function(r,e,o){var a=t._bin,n={};return a.readFixed(r,e),e+=4,n.ascender=a.readShort(r,e),e+=2,n.descender=a.readShort(r,e),e+=2,n.lineGap=a.readShort(r,e),e+=2,n.advanceWidthMax=a.readUshort(r,e),e+=2,n.minLeftSideBearing=a.readShort(r,e),e+=2,n.minRightSideBearing=a.readShort(r,e),e+=2,n.xMaxExtent=a.readShort(r,e),e+=2,n.caretSlopeRise=a.readShort(r,e),e+=2,n.caretSlopeRun=a.readShort(r,e),e+=2,n.caretOffset=a.readShort(r,e),e+=2,e+=8,n.metricDataFormat=a.readShort(r,e),e+=2,n.numberOfHMetrics=a.readUshort(r,e),e+=2,n},t.hmtx={},t.hmtx.parse=function(r,e,o,a){for(var n=t._bin,i={aWidth:[],lsBearing:[]},s=0,f=0,l=0;l<a.maxp.numGlyphs;l++)l<a.hhea.numberOfHMetrics&&(s=n.readUshort(r,e),e+=2,f=n.readShort(r,e),e+=2),i.aWidth.push(s),i.lsBearing.push(f);return i},t.kern={},t.kern.parse=function(r,e,o,a){var n=t._bin,i=n.readUshort(r,e);if(e+=2,i==1)return t.kern.parseV1(r,e-2,o,a);var s=n.readUshort(r,e);e+=2;for(var f={glyph1:[],rval:[]},l=0;l<s;l++){e+=2,o=n.readUshort(r,e),e+=2;var h=n.readUshort(r,e);e+=2;var y=h>>>8;if((y&=15)!=0)throw"unknown kern table format: "+y;e=t.kern.readFormat0(r,e,f)}return f},t.kern.parseV1=function(r,e,o,a){var n=t._bin;n.readFixed(r,e),e+=4;var i=n.readUint(r,e);e+=4;for(var s={glyph1:[],rval:[]},f=0;f<i;f++){n.readUint(r,e),e+=4;var l=n.readUshort(r,e);e+=2,n.readUshort(r,e),e+=2;var h=l>>>8;if((h&=15)!=0)throw"unknown kern table format: "+h;e=t.kern.readFormat0(r,e,s)}return s},t.kern.readFormat0=function(r,e,o){var a=t._bin,n=-1,i=a.readUshort(r,e);e+=2,a.readUshort(r,e),e+=2,a.readUshort(r,e),e+=2,a.readUshort(r,e),e+=2;for(var s=0;s<i;s++){var f=a.readUshort(r,e);e+=2;var l=a.readUshort(r,e);e+=2;var h=a.readShort(r,e);e+=2,f!=n&&(o.glyph1.push(f),o.rval.push({glyph2:[],vals:[]}));var y=o.rval[o.rval.length-1];y.glyph2.push(l),y.vals.push(h),n=f}return e},t.loca={},t.loca.parse=function(r,e,o,a){var n=t._bin,i=[],s=a.head.indexToLocFormat,f=a.maxp.numGlyphs+1;if(s==0)for(var l=0;l<f;l++)i.push(n.readUshort(r,e+(l<<1))<<1);if(s==1)for(l=0;l<f;l++)i.push(n.readUint(r,e+(l<<2)));return i},t.maxp={},t.maxp.parse=function(r,e,o){var a=t._bin,n={},i=a.readUint(r,e);return e+=4,n.numGlyphs=a.readUshort(r,e),e+=2,i==65536&&(n.maxPoints=a.readUshort(r,e),e+=2,n.maxContours=a.readUshort(r,e),e+=2,n.maxCompositePoints=a.readUshort(r,e),e+=2,n.maxCompositeContours=a.readUshort(r,e),e+=2,n.maxZones=a.readUshort(r,e),e+=2,n.maxTwilightPoints=a.readUshort(r,e),e+=2,n.maxStorage=a.readUshort(r,e),e+=2,n.maxFunctionDefs=a.readUshort(r,e),e+=2,n.maxInstructionDefs=a.readUshort(r,e),e+=2,n.maxStackElements=a.readUshort(r,e),e+=2,n.maxSizeOfInstructions=a.readUshort(r,e),e+=2,n.maxComponentElements=a.readUshort(r,e),e+=2,n.maxComponentDepth=a.readUshort(r,e),e+=2),n},t.name={},t.name.parse=function(r,e,o){var a=t._bin,n={};a.readUshort(r,e),e+=2;var i=a.readUshort(r,e);e+=2,a.readUshort(r,e);for(var s,f=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],l=e+=2,h=0;h<i;h++){var y=a.readUshort(r,e);e+=2;var m=a.readUshort(r,e);e+=2;var g=a.readUshort(r,e);e+=2;var k=a.readUshort(r,e);e+=2;var v=a.readUshort(r,e);e+=2;var U=a.readUshort(r,e);e+=2;var F,_=f[k],T=l+12*i+U;if(y==0)F=a.readUnicode(r,T,v/2);else if(y==3&&m==0)F=a.readUnicode(r,T,v/2);else if(m==0)F=a.readASCII(r,T,v);else if(m==1)F=a.readUnicode(r,T,v/2);else if(m==3)F=a.readUnicode(r,T,v/2);else{if(y!=1)throw"unknown encoding "+m+", platformID: "+y;F=a.readASCII(r,T,v),console.debug("reading unknown MAC encoding "+m+" as ASCII")}var x="p"+y+","+g.toString(16);n[x]==null&&(n[x]={}),n[x][_!==void 0?_:k]=F,n[x]._lang=g}for(var S in n)if(n[S].postScriptName!=null&&n[S]._lang==1033)return n[S];for(var S in n)if(n[S].postScriptName!=null&&n[S]._lang==0)return n[S];for(var S in n)if(n[S].postScriptName!=null&&n[S]._lang==3084)return n[S];for(var S in n)if(n[S].postScriptName!=null)return n[S];for(var S in n){s=S;break}return console.debug("returning name table with languageID "+n[s]._lang),n[s]},t["OS/2"]={},t["OS/2"].parse=function(r,e,o){var a=t._bin.readUshort(r,e);e+=2;var n={};if(a==0)t["OS/2"].version0(r,e,n);else if(a==1)t["OS/2"].version1(r,e,n);else if(a==2||a==3||a==4)t["OS/2"].version2(r,e,n);else{if(a!=5)throw"unknown OS/2 table version: "+a;t["OS/2"].version5(r,e,n)}return n},t["OS/2"].version0=function(r,e,o){var a=t._bin;return o.xAvgCharWidth=a.readShort(r,e),e+=2,o.usWeightClass=a.readUshort(r,e),e+=2,o.usWidthClass=a.readUshort(r,e),e+=2,o.fsType=a.readUshort(r,e),e+=2,o.ySubscriptXSize=a.readShort(r,e),e+=2,o.ySubscriptYSize=a.readShort(r,e),e+=2,o.ySubscriptXOffset=a.readShort(r,e),e+=2,o.ySubscriptYOffset=a.readShort(r,e),e+=2,o.ySuperscriptXSize=a.readShort(r,e),e+=2,o.ySuperscriptYSize=a.readShort(r,e),e+=2,o.ySuperscriptXOffset=a.readShort(r,e),e+=2,o.ySuperscriptYOffset=a.readShort(r,e),e+=2,o.yStrikeoutSize=a.readShort(r,e),e+=2,o.yStrikeoutPosition=a.readShort(r,e),e+=2,o.sFamilyClass=a.readShort(r,e),e+=2,o.panose=a.readBytes(r,e,10),e+=10,o.ulUnicodeRange1=a.readUint(r,e),e+=4,o.ulUnicodeRange2=a.readUint(r,e),e+=4,o.ulUnicodeRange3=a.readUint(r,e),e+=4,o.ulUnicodeRange4=a.readUint(r,e),e+=4,o.achVendID=[a.readInt8(r,e),a.readInt8(r,e+1),a.readInt8(r,e+2),a.readInt8(r,e+3)],e+=4,o.fsSelection=a.readUshort(r,e),e+=2,o.usFirstCharIndex=a.readUshort(r,e),e+=2,o.usLastCharIndex=a.readUshort(r,e),e+=2,o.sTypoAscender=a.readShort(r,e),e+=2,o.sTypoDescender=a.readShort(r,e),e+=2,o.sTypoLineGap=a.readShort(r,e),e+=2,o.usWinAscent=a.readUshort(r,e),e+=2,o.usWinDescent=a.readUshort(r,e),e+=2},t["OS/2"].version1=function(r,e,o){var a=t._bin;return e=t["OS/2"].version0(r,e,o),o.ulCodePageRange1=a.readUint(r,e),e+=4,o.ulCodePageRange2=a.readUint(r,e),e+=4},t["OS/2"].version2=function(r,e,o){var a=t._bin;return e=t["OS/2"].version1(r,e,o),o.sxHeight=a.readShort(r,e),e+=2,o.sCapHeight=a.readShort(r,e),e+=2,o.usDefault=a.readUshort(r,e),e+=2,o.usBreak=a.readUshort(r,e),e+=2,o.usMaxContext=a.readUshort(r,e),e+=2},t["OS/2"].version5=function(r,e,o){var a=t._bin;return e=t["OS/2"].version2(r,e,o),o.usLowerOpticalPointSize=a.readUshort(r,e),e+=2,o.usUpperOpticalPointSize=a.readUshort(r,e),e+=2},t.post={},t.post.parse=function(r,e,o){var a=t._bin,n={};return n.version=a.readFixed(r,e),e+=4,n.italicAngle=a.readFixed(r,e),e+=4,n.underlinePosition=a.readShort(r,e),e+=2,n.underlineThickness=a.readShort(r,e),e+=2,n},t==null&&(t={}),t.U==null&&(t.U={}),t.U.codeToGlyph=function(r,e){var o=r.cmap,a=-1;if(o.p0e4!=null?a=o.p0e4:o.p3e1!=null?a=o.p3e1:o.p1e0!=null?a=o.p1e0:o.p0e3!=null&&(a=o.p0e3),a==-1)throw"no familiar platform and encoding!";var n=o.tables[a];if(n.format==0)return e>=n.map.length?0:n.map[e];if(n.format==4){for(var i=-1,s=0;s<n.endCount.length;s++)if(e<=n.endCount[s]){i=s;break}return i==-1||n.startCount[i]>e?0:65535&(n.idRangeOffset[i]!=0?n.glyphIdArray[e-n.startCount[i]+(n.idRangeOffset[i]>>1)-(n.idRangeOffset.length-i)]:e+n.idDelta[i])}if(n.format==12){if(e>n.groups[n.groups.length-1][1])return 0;for(s=0;s<n.groups.length;s++){var f=n.groups[s];if(f[0]<=e&&e<=f[1])return f[2]+(e-f[0])}return 0}throw"unknown cmap table format "+n.format},t.U.glyphToPath=function(r,e){var o={cmds:[],crds:[]};if(r.SVG&&r.SVG.entries[e]){var a=r.SVG.entries[e];return a==null?o:(typeof a=="string"&&(a=t.SVG.toPath(a),r.SVG.entries[e]=a),a)}if(r.CFF){var n={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:r.CFF.Private?r.CFF.Private.defaultWidthX:0,open:!1},i=r.CFF,s=r.CFF.Private;if(i.ROS){for(var f=0;i.FDSelect[f+2]<=e;)f+=2;s=i.FDArray[i.FDSelect[f+1]].Private}t.U._drawCFF(r.CFF.CharStrings[e],n,i,s,o)}else r.glyf&&t.U._drawGlyf(e,r,o);return o},t.U._drawGlyf=function(r,e,o){var a=e.glyf[r];a==null&&(a=e.glyf[r]=t.glyf._parseGlyf(e,r)),a!=null&&(a.noc>-1?t.U._simpleGlyph(a,o):t.U._compoGlyph(a,e,o))},t.U._simpleGlyph=function(r,e){for(var o=0;o<r.noc;o++){for(var a=o==0?0:r.endPts[o-1]+1,n=r.endPts[o],i=a;i<=n;i++){var s=i==a?n:i-1,f=i==n?a:i+1,l=1&r.flags[i],h=1&r.flags[s],y=1&r.flags[f],m=r.xs[i],g=r.ys[i];if(i==a)if(l){if(!h){t.U.P.moveTo(e,m,g);continue}t.U.P.moveTo(e,r.xs[s],r.ys[s])}else h?t.U.P.moveTo(e,r.xs[s],r.ys[s]):t.U.P.moveTo(e,(r.xs[s]+m)/2,(r.ys[s]+g)/2);l?h&&t.U.P.lineTo(e,m,g):y?t.U.P.qcurveTo(e,m,g,r.xs[f],r.ys[f]):t.U.P.qcurveTo(e,m,g,(m+r.xs[f])/2,(g+r.ys[f])/2)}t.U.P.closePath(e)}},t.U._compoGlyph=function(r,e,o){for(var a=0;a<r.parts.length;a++){var n={cmds:[],crds:[]},i=r.parts[a];t.U._drawGlyf(i.glyphIndex,e,n);for(var s=i.m,f=0;f<n.crds.length;f+=2){var l=n.crds[f],h=n.crds[f+1];o.crds.push(l*s.a+h*s.b+s.tx),o.crds.push(l*s.c+h*s.d+s.ty)}for(f=0;f<n.cmds.length;f++)o.cmds.push(n.cmds[f])}},t.U._getGlyphClass=function(r,e){var o=t._lctf.getInterval(e,r);return o==-1?0:e[o+2]},t.U.getPairAdjustment=function(r,e,o){var a=!1;if(r.GPOS)for(var n=r.GPOS,i=n.lookupList,s=n.featureList,f=[],l=0;l<s.length;l++){var h=s[l];if(h.tag=="kern"){a=!0;for(var y=0;y<h.tab.length;y++)if(!f[h.tab[y]]){f[h.tab[y]]=!0;for(var m=i[h.tab[y]],g=0;g<m.tabs.length;g++)if(m.tabs[g]!=null){var k,v=m.tabs[g];if((!v.coverage||(k=t._lctf.coverageIndex(v.coverage,e))!=-1)&&m.ltype!=1){if(m.ltype==2){var U=null;if(v.fmt==1){var F=v.pairsets[k];for(l=0;l<F.length;l++)F[l].gid2==o&&(U=F[l])}else if(v.fmt==2){var _=t.U._getGlyphClass(e,v.classDef1),T=t.U._getGlyphClass(o,v.classDef2);U=v.matrix[_][T]}if(U){var x=0;return U.val1&&U.val1[2]&&(x+=U.val1[2]),U.val2&&U.val2[0]&&(x+=U.val2[0]),x}}}}}}}if(r.kern&&!a){var S=r.kern.glyph1.indexOf(e);if(S!=-1){var Y=r.kern.rval[S].glyph2.indexOf(o);if(Y!=-1)return r.kern.rval[S].vals[Y]}}return 0},t.U._applySubs=function(r,e,o,a){for(var n=r.length-e-1,i=0;i<o.tabs.length;i++)if(o.tabs[i]!=null){var s,f=o.tabs[i];if(!f.coverage||(s=t._lctf.coverageIndex(f.coverage,r[e]))!=-1){if(o.ltype==1)r[e],f.fmt==1?r[e]=r[e]+f.delta:r[e]=f.newg[s];else if(o.ltype==4)for(var l=f.vals[s],h=0;h<l.length;h++){var y=l[h],m=y.chain.length;if(!(m>n)){for(var g=!0,k=0,v=0;v<m;v++){for(;r[e+k+(1+v)]==-1;)k++;y.chain[v]!=r[e+k+(1+v)]&&(g=!1)}if(g){for(r[e]=y.nglyph,v=0;v<m+k;v++)r[e+v+1]=-1;break}}}else if(o.ltype==5&&f.fmt==2)for(var U=t._lctf.getInterval(f.cDef,r[e]),F=f.cDef[U+2],_=f.scset[F],T=0;T<_.length;T++){var x=_[T],S=x.input;if(!(S.length>n)){for(g=!0,v=0;v<S.length;v++){var Y=t._lctf.getInterval(f.cDef,r[e+1+v]);if(U==-1&&f.cDef[Y+2]!=S[v]){g=!1;break}}if(g){var J=x.substLookupRecords;for(h=0;h<J.length;h+=2)J[h],J[h+1]}}}else if(o.ltype==6&&f.fmt==3){if(!t.U._glsCovered(r,f.backCvg,e-f.backCvg.length)||!t.U._glsCovered(r,f.inptCvg,e)||!t.U._glsCovered(r,f.ahedCvg,e+f.inptCvg.length))continue;var ne=f.lookupRec;for(T=0;T<ne.length;T+=2){U=ne[T];var b=a[ne[T+1]];t.U._applySubs(r,e+U,b,a)}}}}},t.U._glsCovered=function(r,e,o){for(var a=0;a<e.length;a++)if(t._lctf.coverageIndex(e[a],r[o+a])==-1)return!1;return!0},t.U.glyphsToPath=function(r,e,o){for(var a={cmds:[],crds:[]},n=0,i=0;i<e.length;i++){var s=e[i];if(s!=-1){for(var f=i<e.length-1&&e[i+1]!=-1?e[i+1]:0,l=t.U.glyphToPath(r,s),h=0;h<l.crds.length;h+=2)a.crds.push(l.crds[h]+n),a.crds.push(l.crds[h+1]);for(o&&a.cmds.push(o),h=0;h<l.cmds.length;h++)a.cmds.push(l.cmds[h]);o&&a.cmds.push("X"),n+=r.hmtx.aWidth[s],i<e.length-1&&(n+=t.U.getPairAdjustment(r,s,f))}}return a},t.U.P={},t.U.P.moveTo=function(r,e,o){r.cmds.push("M"),r.crds.push(e,o)},t.U.P.lineTo=function(r,e,o){r.cmds.push("L"),r.crds.push(e,o)},t.U.P.curveTo=function(r,e,o,a,n,i,s){r.cmds.push("C"),r.crds.push(e,o,a,n,i,s)},t.U.P.qcurveTo=function(r,e,o,a,n){r.cmds.push("Q"),r.crds.push(e,o,a,n)},t.U.P.closePath=function(r){r.cmds.push("Z")},t.U._drawCFF=function(r,e,o,a,n){for(var i=e.stack,s=e.nStems,f=e.haveWidth,l=e.width,h=e.open,y=0,m=e.x,g=e.y,k=0,v=0,U=0,F=0,_=0,T=0,x=0,S=0,Y=0,J=0,ne={val:0,size:0};y<r.length;){t.CFF.getCharString(r,y,ne);var b=ne.val;if(y+=ne.size,b=="o1"||b=="o18")i.length%2!=0&&!f&&(l=i.shift()+a.nominalWidthX),s+=i.length>>1,i.length=0,f=!0;else if(b=="o3"||b=="o23")i.length%2!=0&&!f&&(l=i.shift()+a.nominalWidthX),s+=i.length>>1,i.length=0,f=!0;else if(b=="o4")i.length>1&&!f&&(l=i.shift()+a.nominalWidthX,f=!0),h&&t.U.P.closePath(n),g+=i.pop(),t.U.P.moveTo(n,m,g),h=!0;else if(b=="o5")for(;i.length>0;)m+=i.shift(),g+=i.shift(),t.U.P.lineTo(n,m,g);else if(b=="o6"||b=="o7")for(var B=i.length,E=b=="o6",j=0;j<B;j++){var N=i.shift();E?m+=N:g+=N,E=!E,t.U.P.lineTo(n,m,g)}else if(b=="o8"||b=="o24"){B=i.length;for(var se=0;se+6<=B;)k=m+i.shift(),v=g+i.shift(),U=k+i.shift(),F=v+i.shift(),m=U+i.shift(),g=F+i.shift(),t.U.P.curveTo(n,k,v,U,F,m,g),se+=6;b=="o24"&&(m+=i.shift(),g+=i.shift(),t.U.P.lineTo(n,m,g))}else{if(b=="o11")break;if(b=="o1234"||b=="o1235"||b=="o1236"||b=="o1237")b=="o1234"&&(v=g,U=(k=m+i.shift())+i.shift(),J=F=v+i.shift(),T=F,S=g,m=(x=(_=(Y=U+i.shift())+i.shift())+i.shift())+i.shift(),t.U.P.curveTo(n,k,v,U,F,Y,J),t.U.P.curveTo(n,_,T,x,S,m,g)),b=="o1235"&&(k=m+i.shift(),v=g+i.shift(),U=k+i.shift(),F=v+i.shift(),Y=U+i.shift(),J=F+i.shift(),_=Y+i.shift(),T=J+i.shift(),x=_+i.shift(),S=T+i.shift(),m=x+i.shift(),g=S+i.shift(),i.shift(),t.U.P.curveTo(n,k,v,U,F,Y,J),t.U.P.curveTo(n,_,T,x,S,m,g)),b=="o1236"&&(k=m+i.shift(),v=g+i.shift(),U=k+i.shift(),J=F=v+i.shift(),T=F,x=(_=(Y=U+i.shift())+i.shift())+i.shift(),S=T+i.shift(),m=x+i.shift(),t.U.P.curveTo(n,k,v,U,F,Y,J),t.U.P.curveTo(n,_,T,x,S,m,g)),b=="o1237"&&(k=m+i.shift(),v=g+i.shift(),U=k+i.shift(),F=v+i.shift(),Y=U+i.shift(),J=F+i.shift(),_=Y+i.shift(),T=J+i.shift(),x=_+i.shift(),S=T+i.shift(),Math.abs(x-m)>Math.abs(S-g)?m=x+i.shift():g=S+i.shift(),t.U.P.curveTo(n,k,v,U,F,Y,J),t.U.P.curveTo(n,_,T,x,S,m,g));else if(b=="o14"){if(i.length>0&&!f&&(l=i.shift()+o.nominalWidthX,f=!0),i.length==4){var ie=i.shift(),P=i.shift(),W=i.shift(),p=i.shift(),w=t.CFF.glyphBySE(o,W),L=t.CFF.glyphBySE(o,p);t.U._drawCFF(o.CharStrings[w],e,o,a,n),e.x=ie,e.y=P,t.U._drawCFF(o.CharStrings[L],e,o,a,n)}h&&(t.U.P.closePath(n),h=!1)}else if(b=="o19"||b=="o20")i.length%2!=0&&!f&&(l=i.shift()+a.nominalWidthX),s+=i.length>>1,i.length=0,f=!0,y+=s+7>>3;else if(b=="o21")i.length>2&&!f&&(l=i.shift()+a.nominalWidthX,f=!0),g+=i.pop(),m+=i.pop(),h&&t.U.P.closePath(n),t.U.P.moveTo(n,m,g),h=!0;else if(b=="o22")i.length>1&&!f&&(l=i.shift()+a.nominalWidthX,f=!0),m+=i.pop(),h&&t.U.P.closePath(n),t.U.P.moveTo(n,m,g),h=!0;else if(b=="o25"){for(;i.length>6;)m+=i.shift(),g+=i.shift(),t.U.P.lineTo(n,m,g);k=m+i.shift(),v=g+i.shift(),U=k+i.shift(),F=v+i.shift(),m=U+i.shift(),g=F+i.shift(),t.U.P.curveTo(n,k,v,U,F,m,g)}else if(b=="o26")for(i.length%2&&(m+=i.shift());i.length>0;)k=m,v=g+i.shift(),m=U=k+i.shift(),g=(F=v+i.shift())+i.shift(),t.U.P.curveTo(n,k,v,U,F,m,g);else if(b=="o27")for(i.length%2&&(g+=i.shift());i.length>0;)v=g,U=(k=m+i.shift())+i.shift(),F=v+i.shift(),m=U+i.shift(),g=F,t.U.P.curveTo(n,k,v,U,F,m,g);else if(b=="o10"||b=="o29"){var O=b=="o10"?a:o;if(i.length==0)console.debug("error: empty stack");else{var D=i.pop(),I=O.Subrs[D+O.Bias];e.x=m,e.y=g,e.nStems=s,e.haveWidth=f,e.width=l,e.open=h,t.U._drawCFF(I,e,o,a,n),m=e.x,g=e.y,s=e.nStems,f=e.haveWidth,l=e.width,h=e.open}}else if(b=="o30"||b=="o31"){var C=i.length,M=(se=0,b=="o31");for(se+=C-(B=-3&C);se<B;)M?(v=g,U=(k=m+i.shift())+i.shift(),g=(F=v+i.shift())+i.shift(),B-se==5?(m=U+i.shift(),se++):m=U,M=!1):(k=m,v=g+i.shift(),U=k+i.shift(),F=v+i.shift(),m=U+i.shift(),B-se==5?(g=F+i.shift(),se++):g=F,M=!0),t.U.P.curveTo(n,k,v,U,F,m,g),se+=4}else{if((b+"").charAt(0)=="o")throw console.debug("Unknown operation: "+b,r),b;i.push(b)}}}e.x=m,e.y=g,e.nStems=s,e.haveWidth=f,e.width=l,e.open=h};var d=t,u={Typr:d};return c.Typr=d,c.default=u,Object.defineProperty(c,"__esModule",{value:!0}),c}({}).Typr}/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function za(){return function(c){var t=Uint8Array,d=Uint16Array,u=Uint32Array,r=new t([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),e=new t([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),o=new t([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),a=function(b,B){for(var E=new d(31),j=0;j<31;++j)E[j]=B+=1<<b[j-1];var N=new u(E[30]);for(j=1;j<30;++j)for(var se=E[j];se<E[j+1];++se)N[se]=se-E[j]<<5|j;return[E,N]},n=a(r,2),i=n[0],s=n[1];i[28]=258,s[258]=28;for(var f=a(e,0)[0],l=new d(32768),h=0;h<32768;++h){var y=(43690&h)>>>1|(21845&h)<<1;y=(61680&(y=(52428&y)>>>2|(13107&y)<<2))>>>4|(3855&y)<<4,l[h]=((65280&y)>>>8|(255&y)<<8)>>>1}var m=function(b,B,E){for(var j=b.length,N=0,se=new d(B);N<j;++N)++se[b[N]-1];var ie,P=new d(B);for(N=0;N<B;++N)P[N]=P[N-1]+se[N-1]<<1;if(E){ie=new d(1<<B);var W=15-B;for(N=0;N<j;++N)if(b[N])for(var p=N<<4|b[N],w=B-b[N],L=P[b[N]-1]++<<w,O=L|(1<<w)-1;L<=O;++L)ie[l[L]>>>W]=p}else for(ie=new d(j),N=0;N<j;++N)b[N]&&(ie[N]=l[P[b[N]-1]++]>>>15-b[N]);return ie},g=new t(288);for(h=0;h<144;++h)g[h]=8;for(h=144;h<256;++h)g[h]=9;for(h=256;h<280;++h)g[h]=7;for(h=280;h<288;++h)g[h]=8;var k=new t(32);for(h=0;h<32;++h)k[h]=5;var v=m(g,9,1),U=m(k,5,1),F=function(b){for(var B=b[0],E=1;E<b.length;++E)b[E]>B&&(B=b[E]);return B},_=function(b,B,E){var j=B/8|0;return(b[j]|b[j+1]<<8)>>(7&B)&E},T=function(b,B){var E=B/8|0;return(b[E]|b[E+1]<<8|b[E+2]<<16)>>(7&B)},x=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],S=function(b,B,E){var j=new Error(B||x[b]);if(j.code=b,Error.captureStackTrace&&Error.captureStackTrace(j,S),!E)throw j;return j},Y=function(b,B,E){var j=b.length;if(!j||E&&!E.l&&j<5)return B||new t(0);var N=!B||E,se=!E||E.i;E||(E={}),B||(B=new t(3*j));var ie,P=function(oe){var ye=B.length;if(oe>ye){var _e=new t(Math.max(2*ye,oe));_e.set(B),B=_e}},W=E.f||0,p=E.p||0,w=E.b||0,L=E.l,O=E.d,D=E.m,I=E.n,C=8*j;do{if(!L){E.f=W=_(b,p,1);var M=_(b,p+1,3);if(p+=3,!M){var z=b[(K=((ie=p)/8|0)+(7&ie&&1)+4)-4]|b[K-3]<<8,Z=K+z;if(Z>j){se&&S(0);break}N&&P(w+z),B.set(b.subarray(K,Z),w),E.b=w+=z,E.p=p=8*Z;continue}if(M==1)L=v,O=U,D=9,I=5;else if(M==2){var V=_(b,p,31)+257,A=_(b,p+10,15)+4,de=V+_(b,p+5,31)+1;p+=14;for(var ce=new t(de),X=new t(19),q=0;q<A;++q)X[o[q]]=_(b,p+3*q,7);p+=3*A;var fe=F(X),R=(1<<fe)-1,re=m(X,fe,1);for(q=0;q<de;){var K,G=re[_(b,p,R)];if(p+=15&G,(K=G>>>4)<16)ce[q++]=K;else{var ae=0,Q=0;for(K==16?(Q=3+_(b,p,3),p+=2,ae=ce[q-1]):K==17?(Q=3+_(b,p,7),p+=3):K==18&&(Q=11+_(b,p,127),p+=7);Q--;)ce[q++]=ae}}var te=ce.subarray(0,V),H=ce.subarray(V);D=F(te),I=F(H),L=m(te,D,1),O=m(H,I,1)}else S(1);if(p>C){se&&S(0);break}}N&&P(w+131072);for(var me=(1<<D)-1,pe=(1<<I)-1,ee=p;;ee=p){var ue=(ae=L[T(b,p)&me])>>>4;if((p+=15&ae)>C){se&&S(0);break}if(ae||S(2),ue<256)B[w++]=ue;else{if(ue==256){ee=p,L=null;break}var ge=ue-254;if(ue>264){var xe=r[q=ue-257];ge=_(b,p,(1<<xe)-1)+i[q],p+=xe}var le=O[T(b,p)&pe],Ue=le>>>4;if(le||S(3),p+=15&le,H=f[Ue],Ue>3&&(xe=e[Ue],H+=T(b,p)&(1<<xe)-1,p+=xe),p>C){se&&S(0);break}N&&P(w+131072);for(var ve=w+ge;w<ve;w+=4)B[w]=B[w-H],B[w+1]=B[w+1-H],B[w+2]=B[w+2-H],B[w+3]=B[w+3-H];w=ve}}E.l=L,E.p=ee,E.b=w,L&&(W=1,E.m=D,E.d=O,E.n=I)}while(!W);return w==B.length?B:function(oe,ye,_e){(ye==null||ye<0)&&(ye=0),(_e==null||_e>oe.length)&&(_e=oe.length);var Fe=new(oe instanceof d?d:oe instanceof u?u:t)(_e-ye);return Fe.set(oe.subarray(ye,_e)),Fe}(B,0,w)},J=new t(0),ne=typeof TextDecoder<"u"&&new TextDecoder;try{ne.decode(J,{stream:!0})}catch{}return c.convert_streams=function(b){var B=new DataView(b),E=0;function j(){var V=B.getUint16(E);return E+=2,V}function N(){var V=B.getUint32(E);return E+=4,V}function se(V){z.setUint16(Z,V),Z+=2}function ie(V){z.setUint32(Z,V),Z+=4}for(var P={signature:N(),flavor:N(),length:N(),numTables:j(),reserved:j(),totalSfntSize:N(),majorVersion:j(),minorVersion:j(),metaOffset:N(),metaLength:N(),metaOrigLength:N(),privOffset:N(),privLength:N()},W=0;Math.pow(2,W)<=P.numTables;)W++;W--;for(var p=16*Math.pow(2,W),w=16*P.numTables-p,L=12,O=[],D=0;D<P.numTables;D++)O.push({tag:N(),offset:N(),compLength:N(),origLength:N(),origChecksum:N()}),L+=16;var I,C=new Uint8Array(12+16*O.length+O.reduce(function(V,A){return V+A.origLength+4},0)),M=C.buffer,z=new DataView(M),Z=0;return ie(P.flavor),se(P.numTables),se(p),se(W),se(w),O.forEach(function(V){ie(V.tag),ie(V.origChecksum),ie(L),ie(V.origLength),V.outOffset=L,(L+=V.origLength)%4!=0&&(L+=4-L%4)}),O.forEach(function(V){var A,de=b.slice(V.offset,V.offset+V.compLength);if(V.compLength!=V.origLength){var ce=new Uint8Array(V.origLength);A=new Uint8Array(de,2),Y(A,ce)}else ce=new Uint8Array(de);C.set(ce,V.outOffset);var X=0;(L=V.outOffset+V.origLength)%4!=0&&(X=4-L%4),C.set(new Uint8Array(X).buffer,V.outOffset+V.origLength),I=L+X}),M.slice(0,I)},Object.defineProperty(c,"__esModule",{value:!0}),c}({}).convert_streams}function Va(c,t){const d={M:2,L:2,Q:4,C:6,Z:0},u={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},r=1,e=2,o=4,a=8,n=16,i=32;let s;function f(_){if(!s){const T={R:e,L:r,D:o,C:n,U:i,T:a};s=new Map;for(let x in u){let S=0;u[x].split(",").forEach(Y=>{let[J,ne]=Y.split("+");J=parseInt(J,36),ne=ne?parseInt(ne,36):0,s.set(S+=J,T[x]);for(let b=ne;b--;)s.set(++S,T[x])})}}return s.get(_)||i}const l=1,h=2,y=3,m=4,g=[null,"isol","init","fina","medi"];function k(_){const T=new Uint8Array(_.length);let x=i,S=l,Y=-1;for(let J=0;J<_.length;J++){const ne=_.codePointAt(J);let b=f(ne)|0,B=l;b&a||(x&(r|o|n)?b&(e|o|n)?(B=y,(S===l||S===y)&&T[Y]++):b&(r|i)&&(S===h||S===m)&&T[Y]--:x&(e|i)&&(S===h||S===m)&&T[Y]--,S=T[J]=B,x=b,Y=J,ne>65535&&J++)}return T}function v(_,T){const x=[];for(let Y=0;Y<T.length;Y++){const J=T.codePointAt(Y);J>65535&&Y++,x.push(c.U.codeToGlyph(_,J))}const S=_.GSUB;if(S){const{lookupList:Y,featureList:J}=S;let ne;const b=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws)$/,B=[];J.forEach(E=>{if(b.test(E.tag))for(let j=0;j<E.tab.length;j++){if(B[E.tab[j]])continue;B[E.tab[j]]=!0;const N=Y[E.tab[j]],se=/^(isol|init|fina|medi)$/.test(E.tag);se&&!ne&&(ne=k(T));for(let ie=0;ie<x.length;ie++)(!ne||!se||g[ne[ie]]===E.tag)&&c.U._applySubs(x,ie,N,Y)}})}return x}function U(..._){for(let T=0;T<_.length;T++)if(typeof _[T]=="number")return _[T]}function F(_){const T=Object.create(null),x=_["OS/2"],S=_.hhea,Y=_.head.unitsPerEm,J=U(x&&x.sTypoAscender,S&&S.ascender,Y),ne={unitsPerEm:Y,ascender:J,descender:U(x&&x.sTypoDescender,S&&S.descender,0),capHeight:U(x&&x.sCapHeight,J),xHeight:U(x&&x.sxHeight,J),lineGap:U(x&&x.sTypoLineGap,S&&S.lineGap),forEachGlyph(b,B,E,j){let N=0;const se=1/ne.unitsPerEm*B,ie=v(_,b);let P=0,W=-1;return ie.forEach((p,w)=>{if(p!==-1){let L=T[p];if(!L){const{cmds:O,crds:D}=c.U.glyphToPath(_,p);let I="",C=0;for(let A=0,de=O.length;A<de;A++){const ce=d[O[A]];I+=O[A];for(let X=1;X<=ce;X++)I+=(X>1?",":"")+D[C++]}let M,z,Z,V;if(D.length){M=z=1/0,Z=V=-1/0;for(let A=0,de=D.length;A<de;A+=2){let ce=D[A],X=D[A+1];ce<M&&(M=ce),X<z&&(z=X),ce>Z&&(Z=ce),X>V&&(V=X)}}else M=Z=z=V=0;L=T[p]={index:p,advanceWidth:_.hmtx.aWidth[p],xMin:M,yMin:z,xMax:Z,yMax:V,path:I,pathCommandCount:O.length}}W!==-1&&(N+=c.U.getPairAdjustment(_,W,p)*se),j.call(null,L,N,P),L.advanceWidth&&(N+=L.advanceWidth*se),E&&(N+=E*B),W=p}P+=b.codePointAt(P)>65535?2:1}),N}};return ne}return function(T){const x=new Uint8Array(T,0,4),S=c._bin.readASCII(x,0,4);if(S==="wOFF")T=t(T);else if(S==="wOF2")throw new Error("woff2 fonts not supported");return F(c.parse(T)[0])}}const ja=Ur({name:"Typr Font Parser",dependencies:[Na,za,Va],init(c,t,d){const u=c(),r=t();return d(u,r)}}),ir={defaultFontURL:"https://fonts.gstatic.com/s/roboto/v18/KFOmCnqEu92Fr1Mu4mxM.woff",sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},Xa=new gt;function or(){return(self.performance||Date).now()}const qt=Object.create(null);function dn(c,t){c=Ja({},c);const d=or();if(c.font=Ka(c.font||ir.defaultFontURL),c.text=""+c.text,c.sdfGlyphSize=c.sdfGlyphSize||ir.sdfGlyphSize,c.colorRanges!=null){let f={};for(let l in c.colorRanges)if(c.colorRanges.hasOwnProperty(l)){let h=c.colorRanges[l];typeof h!="number"&&(h=Xa.set(h).getHex()),f[l]=h}c.colorRanges=f}Object.freeze(c);const{textureWidth:u,sdfExponent:r}=ir,{sdfGlyphSize:e}=c,o=u/e*4;let a=qt[e];if(!a){const f=document.createElement("canvas");f.width=u,f.height=e*256/o,a=qt[e]={glyphCount:0,sdfGlyphSize:e,sdfCanvas:f,sdfTexture:new $n(f,void 0,void 0,void 0,zt,zt),contextLost:!1,glyphsByFont:new Map},a.sdfTexture.generateMipmaps=!1,Ya(a)}const{sdfTexture:n,sdfCanvas:i}=a;let s=a.glyphsByFont.get(c.font);s||a.glyphsByFont.set(c.font,s=new Map),Za(c).then(f=>{const{glyphIds:l,glyphPositions:h,fontSize:y,unitsPerEm:m,timings:g}=f,k=[],v=new Float32Array(l.length*4),U=y/m;let F=0,_=0;const T=or();l.forEach((ne,b)=>{let B=s.get(ne);if(!B){const{path:se,pathBounds:ie}=f.glyphData[ne],P=Math.max(ie[2]-ie[0],ie[3]-ie[1])/e*(ir.sdfMargin*e+.5),W=a.glyphCount++,p=[ie[0]-P,ie[1]-P,ie[2]+P,ie[3]+P];s.set(ne,B={path:se,atlasIndex:W,sdfViewBox:p}),k.push(B)}const{sdfViewBox:E}=B,j=h[_++],N=h[_++];v[F++]=j+E[0]*U,v[F++]=N+E[1]*U,v[F++]=j+E[2]*U,v[F++]=N+E[3]*U,l[b]=B.atlasIndex}),g.quads=(g.quads||0)+(or()-T);const x=or();g.sdf={};const S=i.height,Y=Math.ceil(a.glyphCount/o),J=Math.pow(2,Math.ceil(Math.log2(Y*e)));J>S&&(console.info(`Increasing SDF texture size ${S}->${J}`),Wa(i,u,J),n.dispose()),Promise.all(k.map(ne=>vn(ne,a,c.gpuAccelerateSDF).then(({timing:b})=>{g.sdf[ne.atlasIndex]=b}))).then(()=>{k.length&&!a.contextLost&&(pn(a),n.needsUpdate=!0),g.sdfTotal=or()-x,g.total=or()-d,t(Object.freeze({parameters:c,sdfTexture:n,sdfGlyphSize:e,sdfExponent:r,glyphBounds:v,glyphAtlasIndices:l,glyphColors:f.glyphColors,caretPositions:f.caretPositions,caretHeight:f.caretHeight,chunkedBounds:f.chunkedBounds,ascender:f.ascender,descender:f.descender,lineHeight:f.lineHeight,capHeight:f.capHeight,xHeight:f.xHeight,topBaseline:f.topBaseline,blockBounds:f.blockBounds,visibleBounds:f.visibleBounds,timings:f.timings}))})}),Promise.resolve().then(()=>{a.contextLost||Ia(i)})}function vn({path:c,atlasIndex:t,sdfViewBox:d},{sdfGlyphSize:u,sdfCanvas:r,contextLost:e},o){if(e)return Promise.resolve({timing:-1});const{textureWidth:a,sdfExponent:n}=ir,i=Math.max(d[2]-d[0],d[3]-d[1]),s=Math.floor(t/4),f=s%(a/u)*u,l=Math.floor(s/(a/u))*u,h=t%4;return Ga(u,u,c,d,i,n,r,f,l,h,o)}function Ya(c){const t=c.sdfCanvas;t.addEventListener("webglcontextlost",d=>{console.log("Context Lost",d),d.preventDefault(),c.contextLost=!0}),t.addEventListener("webglcontextrestored",d=>{console.log("Context Restored",d),c.contextLost=!1;const u=[];c.glyphsByFont.forEach(r=>{r.forEach(e=>{u.push(vn(e,c,!0))})}),Promise.all(u).then(()=>{pn(c),c.sdfTexture.needsUpdate=!0})})}function Ha({font:c,characters:t,sdfGlyphSize:d},u){let r=Array.isArray(t)?t.join(`
`):""+t;dn({font:c,sdfGlyphSize:d,text:r},u)}function Ja(c,t){for(let d in t)t.hasOwnProperty(d)&&(c[d]=t[d]);return c}let Or;function Ka(c){return Or||(Or=typeof document>"u"?{}:document.createElement("a")),Or.href=c,Or.href}function pn(c){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:t,sdfTexture:d}=c,{width:u,height:r}=t,e=c.sdfCanvas.getContext("webgl");let o=d.image.data;(!o||o.length!==u*r*4)&&(o=new Uint8Array(u*r*4),d.image={width:u,height:r,data:o},d.flipY=!1,d.isDataTexture=!0),e.readPixels(0,0,u,r,e.RGBA,e.UNSIGNED_BYTE,o)}}const Qa=Ur({name:"Typesetter",dependencies:[ir,ja,Ma,wa],init(c,t,d,u){const{defaultFontURL:r}=c;return d(t,u(),{defaultFontURL:r})}}),Za=Ur({name:"Typesetter",dependencies:[Qa],init(c){return function(t){return new Promise(d=>{c.typeset(t,d)})}},getTransferables(c){const t=[c.glyphPositions.buffer,c.glyphIds.buffer];return c.caretPositions&&t.push(c.caretPositions.buffer),c.glyphColors&&t.push(c.glyphColors.buffer),t}}),$t={};function qa(c){let t=$t[c];if(!t){const d=new yt(1,1,c,c),u=d.clone(),r=d.attributes,e=u.attributes,o=new fa,a=r.uv.count;for(let n=0;n<a;n++)e.position.array[n*3]*=-1,e.normal.array[n*3+2]*=-1;["position","normal","uv"].forEach(n=>{o.setAttribute(n,new la([...r[n].array,...e[n].array],r[n].itemSize))}),o.setIndex([...d.index.array,...u.index.array.map(n=>n+a)]),o.translate(.5,.5,0),t=$t[c]=o}return t}const $a="aTroikaGlyphBounds",en="aTroikaGlyphIndex",eo="aTroikaGlyphColor";class ro extends ea{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new ra,this.boundingBox=new ta}computeBoundingSphere(){}computeBoundingBox(){}setSide(t){const d=this.getIndex().count;this.setDrawRange(t===na?d/2:0,t===fn?d:d/2)}set detail(t){if(t!==this._detail){this._detail=t,(typeof t!="number"||t<1)&&(t=1);let d=qa(t);["position","normal","uv"].forEach(u=>{this.attributes[u]=d.attributes[u].clone()}),this.setIndex(d.getIndex().clone())}}get detail(){return this._detail}set curveRadius(t){t!==this._curveRadius&&(this._curveRadius=t,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(t,d,u,r,e){st(this,$a,t,4),st(this,en,d,1),st(this,eo,e,3),this._blockBounds=u,this._chunkedBounds=r,this.instanceCount=d.length,this._updateBounds()}_updateBounds(){const t=this._blockBounds;if(t){const{curveRadius:d,boundingBox:u}=this;if(d){const{PI:r,floor:e,min:o,max:a,sin:n,cos:i}=Math,s=r/2,f=r*2,l=Math.abs(d),h=t[0]/l,y=t[2]/l,m=e((h+s)/f)!==e((y+s)/f)?-l:o(n(h)*l,n(y)*l),g=e((h-s)/f)!==e((y-s)/f)?l:a(n(h)*l,n(y)*l),k=e((h+r)/f)!==e((y+r)/f)?l*2:a(l-i(h)*l,l-i(y)*l);u.min.set(m,t[1],d<0?-k:0),u.max.set(g,t[3],d<0?0:k)}else u.min.set(t[0],t[1],0),u.max.set(t[2],t[3],0);u.getBoundingSphere(this.boundingSphere)}}applyClipRect(t){let d=this.getAttribute(en).count,u=this._chunkedBounds;if(u)for(let r=u.length;r--;){d=u[r].end;let e=u[r].rect;if(e[1]<t.w&&e[3]>t.y&&e[0]<t.z&&e[2]>t.x)break}this.instanceCount=d}}function st(c,t,d,u){const r=c.getAttribute(t);d?r&&r.array.length===d.length?(r.array.set(d),r.needsUpdate=!0):(c.setAttribute(t,new aa(d,u)),delete c._maxInstanceCount,c.dispose()):r&&c.deleteAttribute(t)}const to=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaDistanceOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,no=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaDistanceOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaDistanceOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,ao=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaDistanceOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaOutlineOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,oo=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaDistanceOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function io(c){const t=dt(c,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new Ir},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new Vt(0,0,0,0)},uTroikaClipRect:{value:new Vt(0,0,0,0)},uTroikaDistanceOffset:{value:0},uTroikaOutlineOpacity:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new Ir},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new gt},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new oa},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:to,vertexTransform:no,fragmentDefs:ao,fragmentColorTransform:oo,customRewriter({vertexShader:d,fragmentShader:u}){let r=/\buniform\s+vec3\s+diffuse\b/;return r.test(u)&&(u=u.replace(r,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),r.test(d)||(d=d.replace(cn,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:d,fragmentShader:u}}});return t.transparent=!0,Object.defineProperties(t,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),t}const bt=new ia({color:16777215,side:fn,transparent:!0}),rn=8421504,tn=new sa,Lr=new mt,ft=new mt,yr=[],so=new mt,lt="+x+y";function nn(c){return Array.isArray(c)?c[0]:c}let gn=()=>{const c=new pt(new yt(1,1),bt);return gn=()=>c,c},mn=()=>{const c=new pt(new yt(1,1,32,1),bt);return mn=()=>c,c};const fo={type:"syncstart"},lo={type:"synccomplete"},yn=["font","fontSize","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],uo=yn.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");class bn extends pt{constructor(){const t=new ro;super(t,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.fontSize=.1,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=rn,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=lt,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(t){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(t):(this._isSyncing=!0,this.dispatchEvent(fo),dn({text:this.text,font:this.font,fontSize:this.fontSize||.1,letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF},d=>{this._isSyncing=!1,this._textRenderInfo=d,this.geometry.updateGlyphs(d.glyphBounds,d.glyphAtlasIndices,d.blockBounds,d.chunkedBounds,d.glyphColors);const u=this._queuedSyncs;u&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{u.forEach(r=>r&&r())})),this.dispatchEvent(lo),t&&t()})))}onBeforeRender(t,d,u,r,e,o){this.sync(),e.isTroikaTextMaterial&&this._prepareForRender(e),e._hadOwnSide=e.hasOwnProperty("side"),this.geometry.setSide(e._actualSide=e.side),e.side=qn}onAfterRender(t,d,u,r,e,o){e._hadOwnSide?e.side=e._actualSide:delete e.side}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}get material(){let t=this._derivedMaterial;const d=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=bt.clone());if((!t||t.baseMaterial!==d)&&(t=this._derivedMaterial=io(d),d.addEventListener("dispose",function u(){d.removeEventListener("dispose",u),t.dispose()})),this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY){let u=t._outlineMtl;return u||(u=t._outlineMtl=Object.create(t,{id:{value:t.id+.1}}),u.isTextOutlineMaterial=!0,u.depthWrite=!1,u.map=null,t.addEventListener("dispose",function r(){t.removeEventListener("dispose",r),u.dispose()})),[u,t]}else return t}set material(t){t&&t.isTroikaTextMaterial?(this._derivedMaterial=t,this._baseMaterial=t.baseMaterial):this._baseMaterial=t}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(t){this.geometry.detail=t}get curveRadius(){return this.geometry.curveRadius}set curveRadius(t){this.geometry.curveRadius=t}get customDepthMaterial(){return nn(this.material).getDepthMaterial()}get customDistanceMaterial(){return nn(this.material).getDistanceMaterial()}_prepareForRender(t){const d=t.isTextOutlineMaterial,u=t.uniforms,r=this.textRenderInfo;if(r){const{sdfTexture:a,blockBounds:n}=r;u.uTroikaSDFTexture.value=a,u.uTroikaSDFTextureSize.value.set(a.image.width,a.image.height),u.uTroikaSDFGlyphSize.value=r.sdfGlyphSize,u.uTroikaSDFExponent.value=r.sdfExponent,u.uTroikaTotalBounds.value.fromArray(n),u.uTroikaUseGlyphColors.value=!d&&!!r.glyphColors;let i=0,s=0,f=0,l,h,y,m=0,g=0;if(d){let{outlineWidth:v,outlineOffsetX:U,outlineOffsetY:F,outlineBlur:_,outlineOpacity:T}=this;i=this._parsePercent(v)||0,s=Math.max(0,this._parsePercent(_)||0),l=T,m=this._parsePercent(U)||0,g=this._parsePercent(F)||0}else f=Math.max(0,this._parsePercent(this.strokeWidth)||0),f&&(y=this.strokeColor,u.uTroikaStrokeColor.value.set(y??rn),h=this.strokeOpacity,h==null&&(h=1)),l=this.fillOpacity;u.uTroikaDistanceOffset.value=i,u.uTroikaPositionOffset.value.set(m,g),u.uTroikaBlurRadius.value=s,u.uTroikaStrokeWidth.value=f,u.uTroikaStrokeOpacity.value=h,u.uTroikaFillOpacity.value=l??1,u.uTroikaCurveRadius.value=this.curveRadius||0;let k=this.clipRect;if(k&&Array.isArray(k)&&k.length===4)u.uTroikaClipRect.value.fromArray(k);else{const v=(this.fontSize||.1)*100;u.uTroikaClipRect.value.set(n[0]-v,n[1]-v,n[2]+v,n[3]+v)}this.geometry.applyClipRect(u.uTroikaClipRect.value)}u.uTroikaSDFDebug.value=!!this.debugSDF,t.polygonOffset=!!this.depthOffset,t.polygonOffsetFactor=t.polygonOffsetUnits=this.depthOffset||0;const e=d?this.outlineColor||0:this.color;if(e==null)delete t.color;else{const a=t.hasOwnProperty("color")?t.color:t.color=new gt;(e!==a._input||typeof e=="object")&&a.set(a._input=e)}let o=this.orientation||lt;if(o!==t._orientation){let a=u.uTroikaOrient.value;o=o.replace(/[^-+xyz]/g,"");let n=o!==lt&&o.match(/^([-+])([xyz])([-+])([xyz])$/);if(n){let[,i,s,f,l]=n;Lr.set(0,0,0)[s]=i==="-"?1:-1,ft.set(0,0,0)[l]=f==="-"?-1:1,tn.lookAt(so,Lr.cross(ft),ft),a.setFromMatrix4(tn)}else a.identity();t._orientation=o}}_parsePercent(t){if(typeof t=="string"){let d=t.match(/^(-?[\d.]+)%$/),u=d?parseFloat(d[1]):NaN;t=(isNaN(u)?0:u/100)*this.fontSize}return t}localPositionToTextCoords(t,d=new Ir){d.copy(t);const u=this.curveRadius;return u&&(d.x=Math.atan2(t.x,Math.abs(u)-Math.abs(t.z))*Math.abs(u)),d}worldPositionToTextCoords(t,d=new Ir){return Lr.copy(t),this.localPositionToTextCoords(this.worldToLocal(Lr),d)}raycast(t,d){const{textRenderInfo:u,curveRadius:r}=this;if(u){const e=u.blockBounds,o=r?mn():gn(),a=o.geometry,{position:n,uv:i}=a.attributes;for(let s=0;s<i.count;s++){let f=e[0]+i.getX(s)*(e[2]-e[0]);const l=e[1]+i.getY(s)*(e[3]-e[1]);let h=0;r&&(h=r-Math.cos(f/r)*r,f=Math.sin(f/r)*r),n.setXYZ(s,f,l,h)}a.boundingSphere=this.geometry.boundingSphere,a.boundingBox=this.geometry.boundingBox,o.matrixWorld=this.matrixWorld,o.material.side=this.material.side,yr.length=0,o.raycast(t,yr);for(let s=0;s<yr.length;s++)yr[s].object=this,d.push(yr[s])}}copy(t){const d=this.geometry;return super.copy(t),this.geometry=d,uo.forEach(u=>{this[u]=t[u]}),this}clone(){return new this.constructor().copy(this)}}yn.forEach(c=>{const t="_private_"+c;Object.defineProperty(bn.prototype,c,{get(){return this[t]},set(d){d!==this[t]&&(this[t]=d,this._needsSync=!0)}})});const co=c=>({ref:c&8}),an=c=>({ref:c[3]});function ho(c){let t;const d=c[7].default,u=On(d,c,c[9],an);return{c(){u&&u.c()},l(r){u&&u.l(r)},m(r,e){u&&u.m(r,e),t=!0},p(r,e){u&&u.p&&(!t||e&520)&&Ln(u,d,r,r[9],t?Bn(d,r[9],e,co):Rn(r[9]),an)},i(r){t||(on(u,r),t=!0)},o(r){sn(u,r),t=!1},d(r){u&&u.d(r)}}}function vo(c){let t,d;const u=[{is:c[3]},c[6],{font:c[0]},{characters:c[1]},{sdfGlyphSize:c[2]}];let r={$$slots:{default:[ho,({ref:e})=>({3:e}),({ref:e})=>e?8:0]},$$scope:{ctx:c}};for(let e=0;e<u.length;e+=1)r=ut(r,u[e]);return t=new ua({props:r}),c[8](t),{c(){Nn(t.$$.fragment)},l(e){zn(t.$$.fragment,e)},m(e,o){Vn(t,e,o),d=!0},p(e,[o]){const a=o&79?Xn(u,[o&8&&{is:e[3]},o&64&&Yn(e[6]),o&1&&{font:e[0]},o&2&&{characters:e[1]},o&4&&{sdfGlyphSize:e[2]}]):{};o&520&&(a.$$scope={dirty:o,ctx:e}),t.$set(a)},i(e){d||(on(t.$$.fragment,e),d=!0)},o(e){sn(t.$$.fragment,e),d=!1},d(e){c[8](null),jn(t,e)}}}function po(c,t,d){const u=["font","characters","sdfGlyphSize","ref"];let r=Nt(t,u),e,{$$slots:o={},$$scope:a}=t,{font:n=void 0}=t,{characters:i=void 0}=t,{sdfGlyphSize:s=void 0}=t;const f=new bn,{invalidate:l}=ca(),h=En(),y=ha();An(c,y,v=>d(4,e=v));const m=async()=>{await Gn(),f.sync(()=>{l(),h("sync")})},g=ma();function k(v){Pn[v?"unshift":"push"](()=>{e=v,y.set(e)})}return c.$$set=v=>{t=ut(ut({},t),Mn(v)),d(6,r=Nt(t,u)),"font"in v&&d(0,n=v.font),"characters"in v&&d(1,i=v.characters),"sdfGlyphSize"in v&&d(2,s=v.sdfGlyphSize),"$$scope"in v&&d(9,a=v.$$scope)},c.$$.update=()=>{r&&m(),c.$$.dirty&7&&g(new Promise(v=>Ha({font:n,characters:i,sdfGlyphSize:s},v)))},[n,i,s,f,e,y,r,o,k,a]}class So extends In{constructor(t){super(),Wn(this,t,po,vo,Dn,{font:0,characters:1,sdfGlyphSize:2,ref:3})}get ref(){return this.$$.ctx[3]}}export{So as T};
