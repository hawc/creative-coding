import{T as Ux,s as Qe,e as R,i as O,C as nt,d as E,f as rn,g as on,h as ln,k as Pe,y as Ps,K as mi,P as mc,z as Hx,I as ha,u as mn,a as kr,c as Sr,v as vn,w as fn,x as _n,M as B,p as y,F as V,N as je,o as ca,O as Cn,j as Cu,A as iT,U as Vl,B as sT,E as Fp,S as rT,V as oT,r as Fc,J as zx,l as lT,m as aT,n as uT}from"./scheduler.lc6pDmfW.js";import{t as b,a as _,S as Je,i as et,g as ii,c as si,b as A,d as M,m as T,e as D,f as k}from"./index._UJvAQqJ.js";import{g as zt,a as qt}from"./spread.rEx3vLA9.js";import{w as Pf}from"./index.k8f3s86m.js";import{a as hT,B as kC,d as cT}from"./store.6RS7_RVs.js";const dT=globalThis||void 0||self,pT=typeof window<"u"?window:typeof globalThis<"u"?globalThis:dT;function Hl(n){return n?.length!==void 0?n:Array.from(n)}function mT(n,e){b(n,1,1,()=>{e.delete(n.key)})}function vT(n,e,t,i,s,r,o,l,a,u,h,c){let p=n.length,d=r.length,m=p;const f={};for(;m--;)f[n[m].key]=m;const v=[],w=new Map,P=new Map,Ce=[];for(m=d;m--;){const ke=c(s,r,m),tt=t(ke);let Mt=o.get(tt);Mt?i&&Ce.push(()=>Mt.p(ke,e)):(Mt=u(tt,ke),Mt.c()),w.set(tt,v[m]=Mt),tt in f&&P.set(tt,Math.abs(m-f[tt]))}const x=new Set,g=new Set;function Wt(ke){_(ke,1),ke.m(l,h),o.set(ke.key,ke),h=ke.first,d--}for(;p&&d;){const ke=v[d-1],tt=n[p-1],Mt=ke.key,pt=tt.key;ke===tt?(h=ke.first,p--,d--):w.has(pt)?!o.has(Mt)||x.has(Mt)?Wt(ke):g.has(pt)?p--:P.get(Mt)>P.get(pt)?(g.add(Mt),Wt(ke)):(x.add(pt),p--):(a(tt,o),p--)}for(;p--;){const ke=n[p];w.has(ke.key)||a(ke,o)}for(;d;)Wt(v[d-1]);return Ux(Ce),v}function $e(n){return n==null}function yf(n){return n!==null&&typeof n=="object"}function vv(n){return n!==null&&typeof n=="object"}function fT(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function lo(n,e){return Array.from(new Set([...Object.keys(n),...Object.keys(e)])).reduce((i,s)=>{const r=n[s],o=e[s];return vv(r)&&vv(o)?Object.assign(Object.assign({},i),{[s]:lo(r,o)}):Object.assign(Object.assign({},i),{[s]:s in e?o:r})},{})}function _T(n){return yf(n)?"target"in n:!1}const wT={alreadydisposed:()=>"View has been already disposed",invalidparams:n=>`Invalid parameters for '${n.name}'`,nomatchingcontroller:n=>`No matching controller for '${n.key}'`,nomatchingview:n=>`No matching view for '${JSON.stringify(n.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:n=>`Not compatible with  plugin '${n.id}'`,propertynotfound:n=>`Property '${n.name}' not found`,shouldneverhappen:()=>"This error should never happen"};let ys=class bl{static alreadyDisposed(){return new bl({type:"alreadydisposed"})}static notBindable(){return new bl({type:"notbindable"})}static notCompatible(e,t){return new bl({type:"notcompatible",context:{id:`${e}.${t}`}})}static propertyNotFound(e){return new bl({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new bl({type:"shouldneverhappen"})}constructor(e){var t;this.message=(t=wT[e.type](e.context))!==null&&t!==void 0?t:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}toString(){return this.message}},SC=class qx{constructor(e,t){this.obj_=e,this.key=t}static isBindable(e){return!(e===null||typeof e!="object"&&typeof e!="function")}read(){return this.obj_[this.key]}write(e){this.obj_[this.key]=e}writeProperty(e,t){const i=this.read();if(!qx.isBindable(i))throw ys.notBindable();if(!(e in i))throw ys.propertyNotFound(e);i[e]=t}},$t=class{constructor(){this.observers_={}}on(e,t){let i=this.observers_[e];return i||(i=this.observers_[e]=[]),i.push({handler:t}),this}off(e,t){const i=this.observers_[e];return i&&(this.observers_[e]=i.filter(s=>s.handler!==t)),this}emit(e,t){const i=this.observers_[e];i&&i.forEach(s=>{s.handler(t)})}},bT=class{constructor(e,t){var i;this.constraint_=t?.constraint,this.equals_=(i=t?.equals)!==null&&i!==void 0?i:(s,r)=>s===r,this.emitter=new $t,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},s=this.constraint_?this.constraint_.constrain(e):e,r=this.rawValue_;this.equals_(r,s)&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=s,this.emitter.emit("change",{options:i,previousRawValue:r,rawValue:s,sender:this}))}},gT=class{constructor(e){this.emitter=new $t,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},s=this.value_;s===e&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:i,previousRawValue:s,rawValue:this.value_,sender:this}))}},CT=class{constructor(e){this.emitter=new $t,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}};function Ne(n,e){const t=e?.constraint,i=e?.equals;return!t&&!i?new gT(n):new bT(n,e)}function PT(n){return[new CT(n),(e,t)=>{n.setRawValue(e,t)}]}let j=class Gx{constructor(e){this.emitter=new $t,this.valMap_=e;for(const t in this.valMap_)this.valMap_[t].emitter.on("change",()=>{this.emitter.emit("change",{key:t,sender:this})})}static createCore(e){return Object.keys(e).reduce((i,s)=>Object.assign(i,{[s]:Ne(e[s])}),{})}static fromObject(e){const t=this.createCore(e);return new Gx(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}},ah=class{constructor(e){this.values=j.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");return Math.min(Math.max(e,i),t)}},Ef=class{constructor(e){this.values=j.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");let s=e;return $e(i)||(s=Math.max(s,i)),$e(t)||(s=Math.min(s,t)),s}},yT=class{constructor(e,t=0){this.step=e,this.origin=t}constrain(e){const t=this.origin%this.step,i=Math.round((e-t)/this.step);return t+i*this.step}},ET=class{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}};const xT={"**":(n,e)=>Math.pow(n,e),"*":(n,e)=>n*e,"/":(n,e)=>n/e,"%":(n,e)=>n%e,"+":(n,e)=>n+e,"-":(n,e)=>n-e,"<<":(n,e)=>n<<e,">>":(n,e)=>n>>e,">>>":(n,e)=>n>>>e,"&":(n,e)=>n&e,"^":(n,e)=>n^e,"|":(n,e)=>n|e};let $T=class{constructor(e,t,i){this.left=t,this.operator=e,this.right=i}evaluate(){const e=xT[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}};const VT={"+":n=>n,"-":n=>-n,"~":n=>~n};let kT=class{constructor(e,t){this.operator=e,this.expression=t}evaluate(){const e=VT[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}};function xf(n){return(e,t)=>{for(let i=0;i<n.length;i++){const s=n[i](e,t);if(s!=="")return s}return""}}function yu(n,e){var t;const i=n.substr(e).match(/^\s+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function ST(n,e){const t=n.substr(e,1);return t.match(/^[1-9]$/)?t:""}function Eu(n,e){var t;const i=n.substr(e).match(/^[0-9]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function LT(n,e){const t=Eu(n,e);if(t!=="")return t;const i=n.substr(e,1);if(e+=1,i!=="-"&&i!=="+")return"";const s=Eu(n,e);return s===""?"":i+s}function $f(n,e){const t=n.substr(e,1);if(e+=1,t.toLowerCase()!=="e")return"";const i=LT(n,e);return i===""?"":t+i}function Yx(n,e){const t=n.substr(e,1);if(t==="0")return t;const i=ST(n,e);return e+=i.length,i===""?"":i+Eu(n,e)}function AT(n,e){const t=Yx(n,e);if(e+=t.length,t==="")return"";const i=n.substr(e,1);if(e+=i.length,i!==".")return"";const s=Eu(n,e);return e+=s.length,t+i+s+$f(n,e)}function MT(n,e){const t=n.substr(e,1);if(e+=t.length,t!==".")return"";const i=Eu(n,e);return e+=i.length,i===""?"":t+i+$f(n,e)}function TT(n,e){const t=Yx(n,e);return e+=t.length,t===""?"":t+$f(n,e)}const DT=xf([AT,MT,TT]);function RT(n,e){var t;const i=n.substr(e).match(/^[01]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function OT(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0b")return"";const i=RT(n,e);return i===""?"":t+i}function jT(n,e){var t;const i=n.substr(e).match(/^[0-7]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function NT(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0o")return"";const i=jT(n,e);return i===""?"":t+i}function BT(n,e){var t;const i=n.substr(e).match(/^[0-9a-f]+/i);return(t=i&&i[0])!==null&&t!==void 0?t:""}function IT(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0x")return"";const i=BT(n,e);return i===""?"":t+i}const FT=xf([OT,NT,IT]),KT=xf([FT,DT]);function UT(n,e){const t=KT(n,e);return e+=t.length,t===""?null:{evaluable:new ET(t),cursor:e}}function HT(n,e){const t=n.substr(e,1);if(e+=t.length,t!=="(")return null;const i=Wx(n,e);if(!i)return null;e=i.cursor,e+=yu(n,e).length;const s=n.substr(e,1);return e+=s.length,s!==")"?null:{evaluable:i.evaluable,cursor:e}}function zT(n,e){var t;return(t=UT(n,e))!==null&&t!==void 0?t:HT(n,e)}function Xx(n,e){const t=zT(n,e);if(t)return t;const i=n.substr(e,1);if(e+=i.length,i!=="+"&&i!=="-"&&i!=="~")return null;const s=Xx(n,e);return s?(e=s.cursor,{cursor:e,evaluable:new kT(i,s.evaluable)}):null}function qT(n,e,t){t+=yu(e,t).length;const i=n.filter(s=>e.startsWith(s,t))[0];return i?(t+=i.length,t+=yu(e,t).length,{cursor:t,operator:i}):null}function GT(n,e){return(t,i)=>{const s=n(t,i);if(!s)return null;i=s.cursor;let r=s.evaluable;for(;;){const o=qT(e,t,i);if(!o)break;i=o.cursor;const l=n(t,i);if(!l)return null;i=l.cursor,r=new $T(o.operator,r,l.evaluable)}return r?{cursor:i,evaluable:r}:null}}const YT=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((n,e)=>GT(n,e),Xx);function Wx(n,e){return e+=yu(n,e).length,YT(n,e)}function XT(n){const e=Wx(n,0);return!e||e.cursor+yu(n,e.cursor).length!==n.length?null:e.evaluable}function ei(n){var e;const t=XT(n);return(e=t?.evaluate())!==null&&e!==void 0?e:null}function Vf(n){if(typeof n=="number")return n;if(typeof n=="string"){const e=ei(n);if(!$e(e))return e}return 0}function vt(n){return e=>e.toFixed(Math.max(Math.min(n,20),0))}function L(n,e,t,i,s){const r=(n-e)/(t-e);return i+r*(s-i)}function LC(n){return String(n.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Se(n,e,t){return Math.min(Math.max(n,e),t)}function Zx(n,e){return(n%e+e)%e}function WT(n,e){return $e(n.step)?Math.max(LC(e),2):LC(n.step)}function Qx(n){var e;return(e=n.step)!==null&&e!==void 0?e:1}function ZT(n,e){var t;const i=Math.abs((t=n.step)!==null&&t!==void 0?t:e);return i===0?.1:Math.pow(10,Math.floor(Math.log10(i))-1)}function kf(n,e){return $e(n.step)?null:new yT(n.step,e)}function Sf(n){return!$e(n.max)&&!$e(n.min)?new ah({max:n.max,min:n.min}):!$e(n.max)||!$e(n.min)?new Ef({max:n.max,min:n.min}):null}function Lf(n,e){var t,i,s;return{formatter:(t=n.format)!==null&&t!==void 0?t:vt(WT(n,e)),keyScale:(i=n.keyScale)!==null&&i!==void 0?i:Qx(n),pointerScale:(s=n.pointerScale)!==null&&s!==void 0?s:ZT(n,e)}}function Af(n){return{format:n.optional.function,keyScale:n.optional.number,max:n.optional.number,min:n.optional.number,pointerScale:n.optional.number,step:n.optional.number}}function Mf(n){return{constraint:n.constraint,textProps:j.fromObject(Lf(n.params,n.initialValue))}}let Oo=class{constructor(e){this.controller=e}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(e){this.controller.viewProps.set("disabled",e)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(e){this.controller.viewProps.set("hidden",e)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(e){return this.controller.importState(e)}exportState(){return this.controller.exportState()}},da=class{constructor(e){this.target=e}},gd=class extends da{constructor(e,t,i){super(e),this.value=t,this.last=i??!0}},QT=class extends da{constructor(e,t){super(e),this.expanded=t}},JT=class extends da{constructor(e,t){super(e),this.index=t}},Tf=class extends Oo{constructor(e){super(e),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new $t,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(e){this.controller.tag=e}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}refresh(){this.controller.value.fetch()}onValueChange_(e){const t=this.controller.value;this.emitter_.emit("change",new gd(this,t.binding.target.read(),e.options.last))}};function eD(n,e){const i=Object.keys(e).reduce((s,r)=>{if(s===void 0)return;const o=e[r],l=o(n[r]);return l.succeeded?Object.assign(Object.assign({},s),{[r]:l.value}):void 0},{});return i}function tD(n,e){return n.reduce((t,i)=>{if(t===void 0)return;const s=e(i);if(!(!s.succeeded||s.value===void 0))return[...t,s.value]},[])}function nD(n){return n===null?!1:typeof n=="object"}function Xi(n){return e=>t=>{if(!e&&t===void 0)return{succeeded:!1,value:void 0};if(e&&t===void 0)return{succeeded:!0,value:void 0};const i=n(t);return i!==void 0?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}function AC(n){return{custom:e=>Xi(e)(n),boolean:Xi(e=>typeof e=="boolean"?e:void 0)(n),number:Xi(e=>typeof e=="number"?e:void 0)(n),string:Xi(e=>typeof e=="string"?e:void 0)(n),function:Xi(e=>typeof e=="function"?e:void 0)(n),constant:e=>Xi(t=>t===e?e:void 0)(n),raw:Xi(e=>e)(n),object:e=>Xi(t=>{if(nD(t))return eD(t,e)})(n),array:e=>Xi(t=>{if(Array.isArray(t))return tD(t,e)})(n)}}const fv={optional:AC(!0),required:AC(!1)};function Be(n,e){const t=e(fv),i=fv.required.object(t)(n);return i.succeeded?i.value:void 0}function ri(n,e,t,i){if(e&&!e(n))return!1;const s=Be(n,t);return s?i(s):!1}function oi(n,e){var t;return lo((t=n?.())!==null&&t!==void 0?t:{},e)}function vc(n){return"value"in n}function iD(n){if(!yf(n)||!("binding"in n))return!1;const e=n.binding;return _T(e)}const it="http://www.w3.org/2000/svg";function Kc(n){n.offsetHeight}function sD(n,e){const t=n.style.transition;n.style.transition="none",e(),n.style.transition=t}function Cd(n){return n.ontouchstart!==void 0}function rD(n){const e=n.ownerDocument.defaultView;return e&&"document"in e?n.getContext("2d",{willReadFrequently:!0}):null}const oD={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Pd(n,e){const t=n.createElementNS(it,"svg");return t.innerHTML=oD[e],t}function Jx(n,e,t){n.insertBefore(e,n.children[t])}function Df(n){n.parentElement&&n.parentElement.removeChild(n)}function e$(n){for(;n.children.length>0;)n.removeChild(n.children[0])}function lD(n){for(;n.childNodes.length>0;)n.removeChild(n.childNodes[0])}function Rf(n){return n.relatedTarget?n.relatedTarget:"explicitOriginalTarget"in n?n.explicitOriginalTarget:null}function Wn(n,e){n.emitter.on("change",t=>{e(t.rawValue)}),e(n.rawValue)}function Qn(n,e,t){Wn(n.value(e),t)}const aD="tp";function N(n){return(t,i)=>[aD,"-",n,"v",t?`_${t}`:"",i?`-${i}`:""].join("")}const ja=N("lbl");function uD(n,e){const t=n.createDocumentFragment();return e.split(`
`).map(s=>n.createTextNode(s)).forEach((s,r)=>{r>0&&t.appendChild(n.createElement("br")),t.appendChild(s)}),t}let t$=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(ja()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(ja("l")),Qn(t.props,"label",r=>{$e(r)?this.element.classList.add(ja(void 0,"nol")):(this.element.classList.remove(ja(void 0,"nol")),lD(i),i.appendChild(uD(e,r)))}),this.element.appendChild(i),this.labelElement=i;const s=e.createElement("div");s.classList.add(ja("v")),this.element.appendChild(s),this.valueElement=s}},yd=class{constructor(e,t){this.props=t.props,this.valueController=t.valueController,this.viewProps=t.valueController.viewProps,this.view=new t$(e,{props:t.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(e){return ri(e,null,t=>({label:t.optional.string}),t=>(this.props.set("label",t.label),!0))}exportProps(){return oi(null,{label:this.props.get("label")})}};function hD(){return["veryfirst","first","last","verylast"]}const MC=N(""),TC={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};let uh=class{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",()=>{hD().forEach(i=>{t.classList.remove(MC(void 0,TC[i]))}),this.blade.get("positions").forEach(i=>{t.classList.add(MC(void 0,TC[i]))})}),this.viewProps.handleDispose(()=>{Df(t)})}get parent(){return this.parent_}set parent(e){this.parent_=e,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(e){return ri(e,null,t=>({disabled:t.required.boolean,hidden:t.required.boolean}),t=>(this.viewProps.importState(t),!0))}exportState(){return oi(null,Object.assign({},this.viewProps.exportState()))}},Uc=class extends uh{constructor(e,t){if(t.value!==t.valueController.value)throw ys.shouldNeverHappen();const i=t.valueController.viewProps,s=new yd(e,{blade:t.blade,props:t.props,valueController:t.valueController});super(Object.assign(Object.assign({},t),{view:new t$(e,{props:t.props,viewProps:i}),viewProps:i})),this.labelController=s,this.value=t.value,this.valueController=t.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}importState(e){return ri(e,t=>{var i,s,r;return super.importState(t)&&this.labelController.importProps(t)&&((r=(s=(i=this.valueController).importProps)===null||s===void 0?void 0:s.call(i,e))!==null&&r!==void 0?r:!0)},t=>({value:t.optional.raw}),t=>(t.value&&(this.value.rawValue=t.value),!0))}exportState(){var e,t,i;return oi(()=>super.exportState(),Object.assign(Object.assign({value:this.value.rawValue},this.labelController.exportProps()),(i=(t=(e=this.valueController).exportProps)===null||t===void 0?void 0:t.call(e))!==null&&i!==void 0?i:{}))}};function n$(n,e){for(;n.length<e;)n.push(void 0)}function cD(n){const e=[];return n$(e,n),e}function dD(n){const e=n.indexOf(void 0);return e<0?n:n.slice(0,e)}function pD(n,e){const t=[...dD(n),e];return t.length>n.length?t.splice(0,t.length-n.length):n$(t,n.length),t}let mD=class extends Oo{get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get title(){var e;return(e=this.controller.buttonController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.buttonController.props.set("title",e)}on(e,t){const i=t.bind(this);return this.controller.buttonController.emitter.on(e,()=>{i(new da(this))}),this}};function vD(n,e,t){t?n.classList.add(e):n.classList.remove(e)}function Nr(n,e){return t=>{vD(n,e,t)}}function Of(n,e){Wn(n,t=>{e.textContent=t??""})}const Kp=N("btn");let fD=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Kp()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("button");i.classList.add(Kp("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(Kp("t")),Of(t.props.value("title"),s),this.buttonElement.appendChild(s)}},i$=class{constructor(e,t){this.emitter=new $t,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new fD(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(e){return ri(e,null,t=>({title:t.optional.string}),t=>(this.props.set("title",t.title),!0))}exportProps(){return oi(null,{title:this.props.get("title")})}onClick_(){this.emitter.emit("click",{sender:this})}},DC=class extends uh{constructor(e,t){const i=new i$(e,{props:t.buttonProps,viewProps:t.viewProps}),s=new yd(e,{blade:t.blade,props:t.labelProps,valueController:i});super({blade:t.blade,view:s.view,viewProps:t.viewProps}),this.buttonController=i,this.labelController=s}importState(e){return ri(e,t=>super.importState(t)&&this.buttonController.importProps(t)&&this.labelController.importProps(t),()=>({}),()=>!0)}exportState(){return oi(()=>super.exportState(),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}},_D=class{constructor(e){const[t,i]=e.split("-"),s=t.split(".");this.major=parseInt(s[0],10),this.minor=parseInt(s[1],10),this.patch=parseInt(s[2],10),this.prerelease=i??null}toString(){const e=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[e,this.prerelease].join("-"):e}};const wD=new _D("2.0.0-beta.2");function Ie(n){return Object.assign({core:wD},n)}Ie({id:"button",type:"blade",accept(n){const e=Be(n,t=>({title:t.required.string,view:t.required.constant("button"),label:t.optional.string}));return e?{params:e}:null},controller(n){return new DC(n.document,{blade:n.blade,buttonProps:j.fromObject({title:n.params.title}),labelProps:j.fromObject({label:n.params.label}),viewProps:n.viewProps})},api(n){return n.controller instanceof DC?new mD(n.controller):null}});function bD(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}function gD(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}function CD(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}function PD(n){return yf(n)?"refresh"in n&&typeof n.refresh=="function":!1}function yD(n,e){if(!SC.isBindable(n))throw ys.notBindable();return new SC(n,e)}let ED=class{constructor(e,t){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=e,this.emitter_=new $t,this.pool_=t,this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map(e=>this.pool_.createApi(e))}addBinding(e,t,i){const s=i??{},r=this.controller_.element.ownerDocument,o=this.pool_.createBinding(r,yD(e,t),s),l=this.pool_.createBindingApi(o);return this.add(l,s.index)}addFolder(e){return gD(this,e)}addButton(e){return bD(this,e)}addTab(e){return CD(this,e)}add(e,t){const i=e.controller;return this.controller_.rack.add(i,t),e}remove(e){this.controller_.rack.remove(e.controller)}addBlade(e){const t=this.controller_.element.ownerDocument,i=this.pool_.createBlade(t,e),s=this.pool_.createApi(i);return this.add(s,e.index)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}refresh(){this.children.forEach(e=>{PD(e)&&e.refresh()})}onRackValueChange_(e){const t=e.bladeController,i=this.pool_.createApi(t),s=iD(t.value)?t.value.binding:null;this.emitter_.emit("change",new gd(i,s?s.target.read():t.value.rawValue,e.options.last))}},jf=class extends Oo{constructor(e,t){super(e),this.rackApi_=new ED(e.rackController,t)}},Nf=class extends uh{constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps}),this.rackController=e.rackController}importState(e){return ri(e,t=>super.importState(t),t=>({children:t.required.array(t.required.raw)}),t=>this.rackController.rack.children.every((i,s)=>i.importState(t.children[s])))}exportState(){return oi(()=>super.exportState(),{children:this.rackController.rack.children.map(e=>e.exportState())})}};function _v(n){return"rackController"in n}let xD=class{constructor(e){this.emitter=new $t,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const t of this.allItems())if(e(t))return t;return null}includes(e){return this.cache_.has(e)}add(e,t){if(this.includes(e))throw ys.shouldNeverHappen();const i=t!==void 0?t:this.items_.length;this.items_.splice(i,0,e),this.cache_.add(e);const s=this.extract_(e);s&&(s.emitter.on("add",this.onSubListAdd_),s.emitter.on("remove",this.onSubListRemove_),s.allItems().forEach(r=>{this.cache_.add(r)})),this.emitter.emit("add",{index:i,item:e,root:this,target:this})}remove(e){const t=this.items_.indexOf(e);if(t<0)return;this.items_.splice(t,1),this.cache_.delete(e);const i=this.extract_(e);i&&(i.allItems().forEach(s=>{this.cache_.delete(s)}),i.emitter.off("add",this.onSubListAdd_),i.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}};function $D(n,e){for(let t=0;t<n.length;t++){const i=n[t];if(vc(i)&&i.value===e)return i}return null}function VD(n){return _v(n)?n.rackController.rack.bcSet_:null}let kD=class{constructor(e){var t,i;this.emitter=new $t,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=(t=e.blade)!==null&&t!==void 0?t:null,(i=this.blade_)===null||i===void 0||i.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=e.viewProps,this.bcSet_=new xD(VD),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,t){var i;(i=e.parent)===null||i===void 0||i.remove(e),e.parent=this,this.bcSet_.add(e,t)}remove(e){e.parent=null,this.bcSet_.remove(e)}find(e){return this.bcSet_.allItems().filter(e)}onSetAdd_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,root:t,sender:this}),!t)return;const i=e.item;if(i.viewProps.emitter.on("change",this.onChildViewPropsChange_),i.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),i.viewProps.handleDispose(this.onChildDispose_),vc(i))i.value.emitter.on("change",this.onChildValueChange_);else if(_v(i)){const s=i.rackController.rack;if(s){const r=s.emitter;r.on("layout",this.onRackLayout_),r.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,root:t,sender:this}),!t)return;const i=e.item;if(vc(i))i.value.emitter.off("change",this.onChildValueChange_);else if(_v(i)){const s=i.rackController.rack;if(s){const r=s.emitter;r.off("layout",this.onRackLayout_),r.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){const e=this.bcSet_.items.filter(s=>!s.viewProps.get("hidden")),t=e[0],i=e[e.length-1];this.bcSet_.items.forEach(s=>{const r=[];s===t&&(r.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&r.push("veryfirst")),s===i&&(r.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&r.push("verylast")),s.blade.set("positions",r)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(t=>t.viewProps.get("disposed")).forEach(t=>{this.bcSet_.remove(t)})}onChildValueChange_(e){const t=$D(this.find(vc),e.sender);if(!t)throw ys.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:t,options:e.options,sender:this})}onRackLayout_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(e){this.emitter.emit("valuechange",{bladeController:e.bladeController,options:e.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}},Bf=class{constructor(e){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=e.element,this.viewProps=e.viewProps;const t=new kD({blade:e.root?void 0:e.blade,viewProps:e.viewProps});t.emitter.on("add",this.onRackAdd_),t.emitter.on("remove",this.onRackRemove_),this.rack=t,this.viewProps.handleDispose(()=>{for(let i=this.rack.children.length-1;i>=0;i--)this.rack.children[i].viewProps.set("disposed",!0)})}onRackAdd_(e){e.root&&Jx(this.element,e.bladeController.view.element,e.index)}onRackRemove_(e){e.root&&Df(e.bladeController.view.element)}};function s$(){return new j({positions:Ne([],{equals:fT})})}let Ed=class r$ extends j{constructor(e){super(e)}static create(e){const t={completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},i=j.createCore(t);return new r$(i)}get styleExpanded(){var e;return(e=this.get("temporaryExpanded"))!==null&&e!==void 0?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!$e(e)?`${e}px`:"auto"}bindExpandedClass(e,t){const i=()=>{this.styleExpanded?e.classList.add(t):e.classList.remove(t)};Qn(this,"expanded",i),Qn(this,"temporaryExpanded",i)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}};function SD(n,e){let t=0;return sD(e,()=>{n.set("expandedHeight",null),n.set("temporaryExpanded",!0),Kc(e),t=e.clientHeight,n.set("temporaryExpanded",null),Kc(e)}),t}function RC(n,e){e.style.height=n.styleHeight}function xd(n,e){n.value("expanded").emitter.on("beforechange",()=>{if(n.set("completed",!1),$e(n.get("expandedHeight"))){const t=SD(n,e);t>0&&n.set("expandedHeight",t)}n.set("shouldFixHeight",!0),Kc(e)}),n.emitter.on("change",()=>{RC(n,e)}),RC(n,e),e.addEventListener("transitionend",t=>{t.propertyName==="height"&&n.cleanUpTransition()})}let LD=class extends jf{constructor(e,t){super(e,t),this.emitter_=new $t,this.controller.foldable.value("expanded").emitter.on("change",i=>{this.emitter_.emit("fold",new QT(this,i.sender.rawValue))}),this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)})}get expanded(){return this.controller.foldable.get("expanded")}set expanded(e){this.controller.foldable.set("expanded",e)}get title(){return this.controller.props.get("title")}set title(e){this.controller.props.set("title",e)}get children(){return this.rackApi_.children}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){return this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}refresh(){this.rackApi_.refresh()}};const o$=N("cnt");let AD=class{constructor(e,t){var i;this.className_=N((i=t.viewName)!==null&&i!==void 0?i:"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),o$()),t.viewProps.bindClassModifiers(this.element),this.foldable_=t.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),Qn(this.foldable_,"completed",Nr(this.element,this.className_(void 0,"cpl")));const s=e.createElement("button");s.classList.add(this.className_("b")),Qn(t.props,"title",u=>{$e(u)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s;const r=e.createElement("div");r.classList.add(this.className_("i")),this.element.appendChild(r);const o=e.createElement("div");o.classList.add(this.className_("t")),Of(t.props.value("title"),o),this.buttonElement.appendChild(o),this.titleElement=o;const l=e.createElement("div");l.classList.add(this.className_("m")),this.buttonElement.appendChild(l);const a=e.createElement("div");a.classList.add(this.className_("c")),this.element.appendChild(a),this.containerElement=a}},OC=class extends Nf{constructor(e,t){var i;const s=Ed.create((i=t.expanded)!==null&&i!==void 0?i:!0),r=new AD(e,{foldable:s,props:t.props,viewName:t.root?"rot":void 0,viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new Bf({blade:t.blade,element:r.containerElement,root:t.root,viewProps:t.viewProps}),view:r})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=t.props,this.foldable=s,xd(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(e){return ri(e,t=>super.importState(t),t=>({expanded:t.required.boolean,title:t.optional.string}),t=>(this.foldable.set("expanded",t.expanded),this.props.set("title",t.title),!0))}exportState(){return oi(()=>super.exportState(),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}};Ie({id:"folder",type:"blade",accept(n){const e=Be(n,t=>({title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean}));return e?{params:e}:null},controller(n){return new OC(n.document,{blade:n.blade,expanded:n.params.expanded,props:j.fromObject({title:n.params.title}),viewProps:n.viewProps})},api(n){return n.controller instanceof OC?new LD(n.controller,n.pool):null}});const MD=N("");function jC(n,e){return Nr(n,MD(void 0,e))}let ao=class l$ extends j{constructor(e){var t;super(e),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=PT(Ne(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(e){var t,i,s;const r=e??{};return new l$(j.createCore({disabled:(t=r.disabled)!==null&&t!==void 0?t:!1,disposed:!1,hidden:(i=r.hidden)!==null&&i!==void 0?i:!1,parent:(s=r.parent)!==null&&s!==void 0?s:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(e){Wn(this.globalDisabled_,jC(e,"disabled")),Qn(this,"hidden",jC(e,"hidden"))}bindDisabled(e){Wn(this.globalDisabled_,t=>{e.disabled=t})}bindTabIndex(e){Wn(this.globalDisabled_,t=>{e.tabIndex=t?-1:0})}handleDispose(e){this.value("disposed").emitter.on("change",t=>{t&&e()})}importState(e){this.set("disabled",e.disabled),this.set("hidden",e.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){const e=this.get("parent");return(e?e.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(e){var t;const i=e.previousRawValue;i?.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}};const NC=N("tbp");let TD=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(NC()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(NC("c")),this.element.appendChild(i),this.containerElement=i}};const Na=N("tbi");let DD=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Na()),t.viewProps.bindClassModifiers(this.element),Qn(t.props,"selected",r=>{r?this.element.classList.add(Na(void 0,"sel")):this.element.classList.remove(Na(void 0,"sel"))});const i=e.createElement("button");i.classList.add(Na("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(Na("t")),Of(t.props.value("title"),s),this.buttonElement.appendChild(s),this.titleElement=s}},RD=class{constructor(e,t){this.emitter=new $t,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new DD(e,{props:t.props,viewProps:t.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}},wv=class extends Nf{constructor(e,t){const i=new TD(e,{viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new Bf({blade:t.blade,element:i.containerElement,viewProps:t.viewProps}),view:i})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new RD(e,{props:t.itemProps,viewProps:ao.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=t.props,Qn(this.props,"selected",s=>{this.itemController.props.set("selected",s),this.viewProps.set("hidden",!s)})}get itemController(){return this.ic_}importState(e){return ri(e,t=>super.importState(t),t=>({selected:t.required.boolean,title:t.required.string}),t=>(this.ic_.props.set("selected",t.selected),this.ic_.props.set("title",t.title),!0))}exportState(){return oi(()=>super.exportState(),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}},OD=class extends jf{constructor(e,t){super(e,t),this.emitter_=new $t,this.onSelect_=this.onSelect_.bind(this),this.pool_=t,this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)}),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(e){const t=this.controller.view.element.ownerDocument,i=new wv(t,{blade:s$(),itemProps:j.fromObject({selected:!1,title:e.title}),props:j.fromObject({selected:!1}),viewProps:ao.create()}),s=this.pool_.createApi(i);return this.rackApi_.add(s,e.index)}removePage(e){this.rackApi_.remove(this.rackApi_.children[e])}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}onSelect_(e){this.emitter_.emit("select",new JT(this,e.rawValue))}},jD=class extends jf{get title(){var e;return(e=this.controller.itemController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.itemController.props.set("title",e)}get selected(){return this.controller.props.get("selected")}set selected(e){this.controller.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addBlade(e){return this.rackApi_.addBlade(e)}refresh(){this.rackApi_.refresh()}};const BC=-1;let ND=class{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=Ne(!0),this.selectedIndex=Ne(BC),this.items_=[]}add(e,t){const i=t??this.items_.length;this.items_.splice(i,0,e),e.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(e){const t=this.items_.indexOf(e);t<0||(this.items_.splice(t,1),e.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=BC,this.empty.rawValue=!0;return}const e=this.items_.findIndex(t=>t.rawValue);e<0?(this.items_.forEach((t,i)=>{t.rawValue=i===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((t,i)=>{t.rawValue=i===e}),this.selectedIndex.rawValue=e),this.empty.rawValue=!1}onItemSelectedChange_(e){if(e.rawValue){const t=this.items_.findIndex(i=>i===e.sender);this.items_.forEach((i,s)=>{i.rawValue=s===t}),this.selectedIndex.rawValue=t}else this.keepSelection_()}};const Ba=N("tab");let BD=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Ba(),o$()),t.viewProps.bindClassModifiers(this.element),Wn(t.empty,Nr(this.element,Ba(void 0,"nop")));const i=e.createElement("div");i.classList.add(Ba("t")),this.element.appendChild(i),this.itemsElement=i;const s=e.createElement("div");s.classList.add(Ba("i")),this.element.appendChild(s);const r=e.createElement("div");r.classList.add(Ba("c")),this.element.appendChild(r),this.contentsElement=r}},IC=class extends Nf{constructor(e,t){const i=new ND,s=new BD(e,{empty:i.empty,viewProps:t.viewProps});super({blade:t.blade,rackController:new Bf({blade:t.blade,element:s.contentsElement,viewProps:t.viewProps}),view:s}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const r=this.rackController.rack;r.emitter.on("add",this.onRackAdd_),r.emitter.on("remove",this.onRackRemove_),this.tab=i}add(e,t){this.rackController.rack.add(e,t)}remove(e){this.rackController.rack.remove(this.rackController.rack.children[e])}onRackAdd_(e){if(!e.root)return;const t=e.bladeController;Jx(this.view.itemsElement,t.itemController.view.element,e.index),t.itemController.viewProps.set("parent",this.viewProps),this.tab.add(t.props.value("selected"))}onRackRemove_(e){if(!e.root)return;const t=e.bladeController;Df(t.itemController.view.element),t.itemController.viewProps.set("parent",null),this.tab.remove(t.props.value("selected"))}};Ie({id:"tab",type:"blade",accept(n){const e=Be(n,t=>({pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")}));return!e||e.pages.length===0?null:{params:e}},controller(n){const e=new IC(n.document,{blade:n.blade,viewProps:n.viewProps});return n.params.pages.forEach(t=>{const i=new wv(n.document,{blade:s$(),itemProps:j.fromObject({selected:!1,title:t.title}),props:j.fromObject({selected:!1}),viewProps:ao.create()});e.add(i)}),e},api(n){return n.controller instanceof IC?new OD(n.controller,n.pool):n.controller instanceof wv?new jD(n.controller,n.pool):null}});let If=class extends Tf{get options(){return this.controller.valueController.props.get("options")}set options(e){this.controller.valueController.props.set("options",e)}},ID=class{constructor(){this.disabled=!1,this.emitter=new $t}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}},FD=class{constructor(e,t){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=e,this.emitter=new $t,this.interval_=t,this.setTimer_()}get disabled(){return this.disabled_}set disabled(e){this.disabled_=e,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const e=this.doc_.defaultView;e&&e.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const e=this.doc_.defaultView;e&&(this.timerId_=e.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}},pa=class{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce((t,i)=>i.constrain(t),e)}};function xu(n,e){if(n instanceof e)return n;if(n instanceof pa){const t=n.constraints.reduce((i,s)=>i||(s instanceof e?s:null),null);if(t)return t}return null}let $d=class{constructor(e){this.values=j.fromObject({options:e})}constrain(e){const t=this.values.get("options");return t.length===0||t.filter(s=>s.value===e).length>0?e:t[0].value}};function Vd(n){var e;const t=fv;if(Array.isArray(n))return(e=Be({items:n},i=>({items:i.required.array(i.required.object({text:i.required.string,value:i.required.raw}))})))===null||e===void 0?void 0:e.items;if(typeof n=="object")return t.required.raw(n).value}function a$(n){if(Array.isArray(n))return n;const e=[];return Object.keys(n).forEach(t=>{e.push({text:t,value:n[t]})}),e}function Ff(n){return $e(n)?null:new $d(a$(n))}const Up=N("lst");let KD=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add(Up()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("select");i.classList.add(Up("s")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.selectElement=i;const s=e.createElement("div");s.classList.add(Up("m")),s.appendChild(Pd(e,"dropdown")),this.element.appendChild(s),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,Qn(this.props_,"options",r=>{e$(this.selectElement),r.forEach(o=>{const l=e.createElement("option");l.textContent=o.text,this.selectElement.appendChild(l)}),this.update_()})}update_(){const e=this.props_.get("options").map(t=>t.value);this.selectElement.selectedIndex=e.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}},zl=class{constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new KD(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const t=e.currentTarget;this.value.rawValue=this.props.get("options")[t.selectedIndex].value}importProps(e){return ri(e,null,t=>({options:t.required.custom(Vd)}),t=>(this.props.set("options",a$(t.options)),!0))}exportProps(){return oi(null,{options:this.props.get("options")})}};const FC=N("pop");let UD=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(FC()),t.viewProps.bindClassModifiers(this.element),Wn(t.shows,Nr(this.element,FC(void 0,"v")))}},Kf=class{constructor(e,t){this.shows=Ne(!1),this.viewProps=t.viewProps,this.view=new UD(e,{shows:this.shows,viewProps:this.viewProps})}};const KC=N("txt");let HD=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(KC()),t.viewProps.bindClassModifiers(this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);const i=e.createElement("input");i.classList.add(KC("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}},kd=class{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new HD(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const i=e.currentTarget.value,s=this.parser_(i);$e(s)||(this.value.rawValue=s),this.view.refresh()}};function zD(n){return String(n)}function Uf(n){return n==="false"?!1:!!n}function UC(n){return zD(n)}function qD(n){return e=>n.reduce((t,i)=>t!==null?t:i(e),null)}const GD=vt(0);function Hc(n){return GD(n)+"%"}function Hf(n){return String(n)}function bv(n){return n}function jo({primary:n,secondary:e,forward:t,backward:i}){let s=!1;function r(o){s||(s=!0,o(),s=!1)}n.emitter.on("change",o=>{r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),e.emitter.on("change",o=>{r(()=>{n.setRawValue(i(n.rawValue,e.rawValue),o.options)}),r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),{forceEmit:!1,last:!0})})}function st(n,e){const t=n*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+t:e.downKey?-t:0}function uo(n){return{altKey:n.altKey,downKey:n.key==="ArrowDown",shiftKey:n.shiftKey,upKey:n.key==="ArrowUp"}}function ti(n){return{altKey:n.altKey,downKey:n.key==="ArrowLeft",shiftKey:n.shiftKey,upKey:n.key==="ArrowRight"}}function YD(n){return n==="ArrowUp"||n==="ArrowDown"}function zc(n){return YD(n)||n==="ArrowLeft"||n==="ArrowRight"}function Hp(n,e){var t,i;const s=e.ownerDocument.defaultView,r=e.getBoundingClientRect();return{x:n.pageX-(((t=s&&s.scrollX)!==null&&t!==void 0?t:0)+r.left),y:n.pageY-(((i=s&&s.scrollY)!==null&&i!==void 0?i:0)+r.top)}}let Ts=class{constructor(e){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new $t,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault(),(t=e.currentTarget)===null||t===void 0||t.focus();const i=this.elem_.ownerDocument;i.addEventListener("mousemove",this.onDocumentMouseMove_),i.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(Hp(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(Hp(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(Hp(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchMove_(e){const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchEnd_(e){var t;const i=(t=e.targetTouches.item(0))!==null&&t!==void 0?t:this.lastTouch_,s=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(i?{x:i.clientX-s.left,y:i.clientY-s.top}:void 0),sender:this,shiftKey:e.shiftKey})}};const Ln=N("txt");let XD=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(Ln(),Ln(void 0,"num")),t.arrayPosition&&this.element.classList.add(Ln(void 0,t.arrayPosition)),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(Ln("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Ln()),this.inputElement.classList.add(Ln("i"));const s=e.createElement("div");s.classList.add(Ln("k")),this.element.appendChild(s),this.knobElement=s;const r=e.createElementNS(it,"svg");r.classList.add(Ln("g")),this.knobElement.appendChild(r);const o=e.createElementNS(it,"path");o.classList.add(Ln("gb")),r.appendChild(o),this.guideBodyElem_=o;const l=e.createElementNS(it,"path");l.classList.add(Ln("gh")),r.appendChild(l),this.guideHeadElem_=l;const a=e.createElement("div");a.classList.add(N("tt")()),this.knobElement.appendChild(a),this.tooltipElem_=a,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.refresh()}onDraggingChange_(e){if(e.rawValue===null){this.element.classList.remove(Ln(void 0,"drg"));return}this.element.classList.add(Ln(void 0,"drg"));const t=e.rawValue/this.props_.get("pointerScale"),i=t+(t>0?-1:t<0?1:0),s=Se(-i,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${i+s},0 L${i},4 L${i+s},8`,`M ${t},-1 L${t},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${t},4`);const r=this.props_.get("formatter");this.tooltipElem_.textContent=r(this.value.rawValue),this.tooltipElem_.style.left=`${t}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}},hh=class{constructor(e,t){var i;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=t.parser,this.props=t.props,this.sliderProps_=(i=t.sliderProps)!==null&&i!==void 0?i:null,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=Ne(null),this.view=new XD(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const s=new Ts(this.view.knobElement);s.emitter.on("down",this.onPointerDown_),s.emitter.on("move",this.onPointerMove_),s.emitter.on("up",this.onPointerUp_)}constrainValue_(e){var t,i;const s=(t=this.sliderProps_)===null||t===void 0?void 0:t.get("min"),r=(i=this.sliderProps_)===null||i===void 0?void 0:i.get("max");let o=e;return s!==void 0&&(o=Math.max(o,s)),r!==void 0&&(o=Math.min(o,r)),o}onInputChange_(e){const i=e.currentTarget.value,s=this.parser_(i);$e(s)||(this.value.rawValue=this.constrainValue_(s)),this.view.refresh()}onInputKeyDown_(e){const t=st(this.props.get("keyScale"),uo(e));t!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+t),{forceEmit:!1,last:!1})}onInputKeyUp_(e){st(this.props.get("keyScale"),uo(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;const t=e.point.x-e.bounds.width/2;return this.constrainValue_(this.originRawValue_+t*this.props.get("pointerScale"))}onPointerMove_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}};const zp=N("sld");let WD=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(zp()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(zp("t")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.trackElement=i;const s=e.createElement("div");s.classList.add(zp("k")),this.trackElement.appendChild(s),this.knobElement=s,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}update_(){const e=Se(L(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${e}%`}onChange_(){this.update_()}},ZD=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.props=t.props,this.view=new WD(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ts(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){e.point&&this.value.setRawValue(L(Se(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("min"),this.props.get("max")),t)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=st(this.props.get("keyScale"),ti(e));t!==0&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onKeyUp_(e){st(this.props.get("keyScale"),ti(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const qp=N("sldtxt");let QD=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(qp());const i=e.createElement("div");i.classList.add(qp("s")),this.sliderView_=t.sliderView,i.appendChild(this.sliderView_.element),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(qp("t")),this.textView_=t.textView,s.appendChild(this.textView_.element),this.element.appendChild(s)}},HC=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sliderC_=new ZD(e,{props:t.sliderProps,value:t.value,viewProps:this.viewProps}),this.textC_=new hh(e,{parser:t.parser,props:t.textProps,sliderProps:t.sliderProps,value:t.value,viewProps:t.viewProps}),this.view=new QD(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(e){return ri(e,null,t=>({max:t.required.number,min:t.required.number}),t=>{const i=this.sliderC_.props;return i.set("max",t.max),i.set("min",t.min),!0})}exportProps(){const e=this.sliderC_.props;return oi(null,{max:e.get("max"),min:e.get("min")})}};function JD(n){return{sliderProps:new j({keyScale:n.keyScale,max:n.max,min:n.min}),textProps:new j({formatter:Ne(n.formatter),keyScale:n.keyScale,pointerScale:Ne(n.pointerScale)})}}const eR={containerUnitSize:"cnt-usz"};function u$(n){return`--${eR[n]}`}class h${constructor(e,t){const i=N(t.viewName);this.element=e.createElement("div"),this.element.classList.add(i()),t.viewProps.bindClassModifiers(this.element)}}function $u(n){return Af(n)}function cr(n){if(vv(n))return Be(n,$u)}function ss(n,e){if(!n)return;const t=[],i=kf(n,e);i&&t.push(i);const s=Sf(n);return s&&t.push(s),new pa(t)}function c$(n){if(n==="inline"||n==="popup")return n}function Br(n,e){n.write(e)}const tc=N("ckb");let tR=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(tc()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("label");i.classList.add(tc("l")),this.element.appendChild(i);const s=e.createElement("input");s.classList.add(tc("i")),s.type="checkbox",i.appendChild(s),this.inputElement=s,t.viewProps.bindDisabled(this.inputElement);const r=e.createElement("div");r.classList.add(tc("w")),i.appendChild(r);const o=Pd(e,"check");r.appendChild(o),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}},nR=class{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new tR(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const t=e.currentTarget;this.value.rawValue=t.checked}};function iR(n){const e=[],t=Ff(n.options);return t&&e.push(t),new pa(e)}Ie({id:"input-bool",type:"input",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=Be(e,i=>({options:i.optional.custom(Vd),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>Uf,constraint:n=>iR(n.params),writer:n=>Br},controller:n=>{const e=n.document,t=n.value,i=n.constraint,s=i&&xu(i,$d);return s?new zl(e,{props:new j({options:s.values.value("options")}),value:t,viewProps:n.viewProps}):new nR(e,{value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="boolean"?null:n.controller.valueController instanceof zl?new If(n.controller):null}});const Ur=N("col");let sR=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Ur()),t.foldable.bindExpandedClass(this.element,Ur(void 0,"expanded")),Qn(t.foldable,"completed",Nr(this.element,Ur(void 0,"cpl")));const i=e.createElement("div");i.classList.add(Ur("h")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Ur("s")),i.appendChild(s),this.swatchElement=s;const r=e.createElement("div");if(r.classList.add(Ur("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(Ur("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}};function rR(n,e,t){const i=Se(n/255,0,1),s=Se(e/255,0,1),r=Se(t/255,0,1),o=Math.max(i,s,r),l=Math.min(i,s,r),a=o-l;let u=0,h=0;const c=(l+o)/2;return a!==0&&(h=a/(1-Math.abs(o+l-1)),i===o?u=(s-r)/a:s===o?u=2+(r-i)/a:u=4+(i-s)/a,u=u/6+(u<0?1:0)),[u*360,h*100,c*100]}function oR(n,e,t){const i=(n%360+360)%360,s=Se(e/100,0,1),r=Se(t/100,0,1),o=(1-Math.abs(2*r-1))*s,l=o*(1-Math.abs(i/60%2-1)),a=r-o/2;let u,h,c;return i>=0&&i<60?[u,h,c]=[o,l,0]:i>=60&&i<120?[u,h,c]=[l,o,0]:i>=120&&i<180?[u,h,c]=[0,o,l]:i>=180&&i<240?[u,h,c]=[0,l,o]:i>=240&&i<300?[u,h,c]=[l,0,o]:[u,h,c]=[o,0,l],[(u+a)*255,(h+a)*255,(c+a)*255]}function lR(n,e,t){const i=Se(n/255,0,1),s=Se(e/255,0,1),r=Se(t/255,0,1),o=Math.max(i,s,r),l=Math.min(i,s,r),a=o-l;let u;a===0?u=0:o===i?u=60*(((s-r)/a%6+6)%6):o===s?u=60*((r-i)/a+2):u=60*((i-s)/a+4);const h=o===0?0:a/o,c=o;return[u,h*100,c*100]}function d$(n,e,t){const i=Zx(n,360),s=Se(e/100,0,1),r=Se(t/100,0,1),o=r*s,l=o*(1-Math.abs(i/60%2-1)),a=r-o;let u,h,c;return i>=0&&i<60?[u,h,c]=[o,l,0]:i>=60&&i<120?[u,h,c]=[l,o,0]:i>=120&&i<180?[u,h,c]=[0,o,l]:i>=180&&i<240?[u,h,c]=[0,l,o]:i>=240&&i<300?[u,h,c]=[l,0,o]:[u,h,c]=[o,0,l],[(u+a)*255,(h+a)*255,(c+a)*255]}function aR(n,e,t){const i=t+e*(100-Math.abs(2*t-100))/200;return[n,i!==0?e*(100-Math.abs(2*t-100))/i:0,t+e*(100-Math.abs(2*t-100))/(2*100)]}function uR(n,e,t){const i=100-Math.abs(t*(200-e)/100-100);return[n,i!==0?e*t/i:0,t*(200-e)/(2*100)]}function vi(n){return[n[0],n[1],n[2]]}function Sd(n,e){return[n[0],n[1],n[2],e]}const hR={hsl:{hsl:(n,e,t)=>[n,e,t],hsv:aR,rgb:oR},hsv:{hsl:uR,hsv:(n,e,t)=>[n,e,t],rgb:d$},rgb:{hsl:rR,hsv:lR,rgb:(n,e,t)=>[n,e,t]}};function ql(n,e){return[e==="float"?1:n==="rgb"?255:360,e==="float"?1:n==="rgb"?255:100,e==="float"?1:n==="rgb"?255:100]}function cR(n,e){return n===e?e:Zx(n,e)}function p$(n,e,t){var i;const s=ql(e,t);return[e==="rgb"?Se(n[0],0,s[0]):cR(n[0],s[0]),Se(n[1],0,s[1]),Se(n[2],0,s[2]),Se((i=n[3])!==null&&i!==void 0?i:1,0,1)]}function zC(n,e,t,i){const s=ql(e,t),r=ql(e,i);return n.map((o,l)=>o/s[l]*r[l])}function m$(n,e,t){const i=zC(n,e.mode,e.type,"int"),s=hR[e.mode][t.mode](...i);return zC(s,t.mode,"int",t.type)}let ue=class v${static black(){return new v$([0,0,0],"rgb")}constructor(e,t){this.type="int",this.mode=t,this.comps_=p$(e,t,this.type)}getComponents(e){return Sd(m$(vi(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}};const Rs=N("colp");let dR=class{constructor(e,t){this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(Rs()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Rs("hsv"));const s=e.createElement("div");s.classList.add(Rs("sv")),this.svPaletteView_=t.svPaletteView,s.appendChild(this.svPaletteView_.element),i.appendChild(s);const r=e.createElement("div");r.classList.add(Rs("h")),this.hPaletteView_=t.hPaletteView,r.appendChild(this.hPaletteView_.element),i.appendChild(r),this.element.appendChild(i);const o=e.createElement("div");if(o.classList.add(Rs("rgb")),this.textsView_=t.textsView,o.appendChild(this.textsView_.element),this.element.appendChild(o),t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};const l=e.createElement("div");l.classList.add(Rs("a"));const a=e.createElement("div");a.classList.add(Rs("ap")),a.appendChild(this.alphaViews_.palette.element),l.appendChild(a);const u=e.createElement("div");u.classList.add(Rs("at")),u.appendChild(this.alphaViews_.text.element),l.appendChild(u),this.element.appendChild(l)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map(t=>t.inputElement)];return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}};function pR(n){return n==="int"?"int":n==="float"?"float":void 0}function zf(n){return Be(n,e=>({color:e.optional.object({alpha:e.optional.boolean,type:e.optional.custom(pR)}),expanded:e.optional.boolean,picker:e.optional.custom(c$),readonly:e.optional.constant(!1)}))}function ho(n){return n?.1:1}function f$(n){var e;return(e=n.color)===null||e===void 0?void 0:e.type}let qf=class{constructor(e,t){this.type="float",this.mode=t,this.comps_=p$(e,t,this.type)}getComponents(e){return Sd(m$(vi(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}};const mR={int:(n,e)=>new ue(n,e),float:(n,e)=>new qf(n,e)};function Gf(n,e,t){return mR[t](n,e)}function vR(n){return n.type==="float"}function fR(n){return n.type==="int"}function _R(n){const e=n.getComponents(),t=ql(n.mode,"int");return new ue([Math.round(L(e[0],0,1,0,t[0])),Math.round(L(e[1],0,1,0,t[1])),Math.round(L(e[2],0,1,0,t[2])),e[3]],n.mode)}function wR(n){const e=n.getComponents(),t=ql(n.mode,"int");return new qf([L(e[0],0,t[0],0,1),L(e[1],0,t[1],0,1),L(e[2],0,t[2],0,1),e[3]],n.mode)}function Rt(n,e){if(n.type===e)return n;if(fR(n)&&e==="float")return wR(n);if(vR(n)&&e==="int")return _R(n);throw ys.shouldNeverHappen()}function bR(n,e){return n.alpha===e.alpha&&n.mode===e.mode&&n.notation===e.notation&&n.type===e.type}function In(n,e){const t=n.match(/^(.+)%$/);return Math.min(t?parseFloat(t[1])*.01*e:parseFloat(n),e)}const gR={deg:n=>n,grad:n=>n*360/400,rad:n=>n*360/(2*Math.PI),turn:n=>n*360};function _$(n){const e=n.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(n);const t=parseFloat(e[1]),i=e[2];return gR[i](t)}function w$(n){const e=n.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[In(e[1],255),In(e[2],255),In(e[3],255)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function CR(n){const e=w$(n);return e?new ue(e,"rgb"):null}function b$(n){const e=n.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[In(e[1],255),In(e[2],255),In(e[3],255),In(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function PR(n){const e=b$(n);return e?new ue(e,"rgb"):null}function g$(n){const e=n.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[_$(e[1]),In(e[2],100),In(e[3],100)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function yR(n){const e=g$(n);return e?new ue(e,"hsl"):null}function C$(n){const e=n.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[_$(e[1]),In(e[2],100),In(e[3],100),In(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function ER(n){const e=C$(n);return e?new ue(e,"hsl"):null}function P$(n){const e=n.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];const t=n.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}function xR(n){const e=P$(n);return e?new ue(e,"rgb"):null}function y$(n){const e=n.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),L(parseInt(e[4]+e[4],16),0,255,0,1)];const t=n.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),L(parseInt(t[4],16),0,255,0,1)]:null}function $R(n){const e=y$(n);return e?new ue(e,"rgb"):null}function E$(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function qC(n){return e=>{const t=E$(e);return t?Gf(t,"rgb",n):null}}function x$(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function GC(n){return e=>{const t=x$(e);return t?Gf(t,"rgb",n):null}}const VR=[{parser:P$,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:y$,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:w$,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:b$,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:g$,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:C$,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:E$,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:x$,result:{alpha:!0,mode:"rgb",notation:"object"}}];function kR(n){return VR.reduce((e,{parser:t,result:i})=>e||(t(n)?i:null),null)}function SR(n,e="int"){const t=kR(n);return t?t.notation==="hex"&&e!=="float"?Object.assign(Object.assign({},t),{type:"int"}):t.notation==="func"?Object.assign(Object.assign({},t),{type:e}):null:null}function ch(n){const e=[xR,$R,CR,PR,yR,ER];n==="int"&&e.push(qC("int"),GC("int")),n==="float"&&e.push(qC("float"),GC("float"));const t=qD(e);return i=>{const s=t(i);return s?Rt(s,n):null}}function LR(n){const e=ch("int");if(typeof n!="string")return ue.black();const t=e(n);return t??ue.black()}function $$(n){const e=Se(Math.floor(n),0,255).toString(16);return e.length===1?`0${e}`:e}function Yf(n,e="#"){const t=vi(n.getComponents("rgb")).map($$).join("");return`${e}${t}`}function Xf(n,e="#"){const t=n.getComponents("rgb"),i=[t[0],t[1],t[2],t[3]*255].map($$).join("");return`${e}${i}`}function V$(n){const e=vt(0),t=Rt(n,"int");return`rgb(${vi(t.getComponents("rgb")).map(s=>e(s)).join(", ")})`}function fc(n){const e=vt(2),t=vt(0);return`rgba(${Rt(n,"int").getComponents("rgb").map((r,o)=>(o===3?e:t)(r)).join(", ")})`}function AR(n){const e=[vt(0),Hc,Hc],t=Rt(n,"int");return`hsl(${vi(t.getComponents("hsl")).map((s,r)=>e[r](s)).join(", ")})`}function MR(n){const e=[vt(0),Hc,Hc,vt(2)];return`hsla(${Rt(n,"int").getComponents("hsl").map((s,r)=>e[r](s)).join(", ")})`}function k$(n,e){const t=vt(e==="float"?2:0),i=["r","g","b"],s=Rt(n,e);return`{${vi(s.getComponents("rgb")).map((o,l)=>`${i[l]}: ${t(o)}`).join(", ")}}`}function TR(n){return e=>k$(e,n)}function S$(n,e){const t=vt(2),i=vt(e==="float"?2:0),s=["r","g","b","a"];return`{${Rt(n,e).getComponents("rgb").map((l,a)=>{const u=a===3?t:i;return`${s[a]}: ${u(l)}`}).join(", ")}}`}function DR(n){return e=>S$(e,n)}const RR=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:Yf},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:Xf},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:V$},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:fc},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:AR},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:MR},...["int","float"].reduce((n,e)=>[...n,{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:TR(e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:DR(e)}],[])];function L$(n){return RR.reduce((e,t)=>e||(bR(t.format,n)?t.stringifier:null),null)}const Ia=N("apl");let OR=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Ia()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(Ia("b")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Ia("c")),i.appendChild(s),this.colorElem_=s;const r=e.createElement("div");r.classList.add(Ia("m")),this.element.appendChild(r),this.markerElem_=r;const o=e.createElement("div");o.classList.add(Ia("p")),this.markerElem_.appendChild(o),this.previewElem_=o,this.update_()}update_(){const e=this.value.rawValue,t=e.getComponents("rgb"),i=new ue([t[0],t[1],t[2],0],"rgb"),s=new ue([t[0],t[1],t[2],255],"rgb"),r=["to right",fc(i),fc(s)];this.colorElem_.style.background=`linear-gradient(${r.join(",")})`,this.previewElem_.style.backgroundColor=fc(e);const o=L(t[3],0,1,0,100);this.markerElem_.style.left=`${o}%`}onValueChange_(){this.update_()}},jR=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new OR(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ts(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=e.point.x/e.bounds.width,s=this.value.rawValue,[r,o,l]=s.getComponents("hsv");this.value.setRawValue(new ue([r,o,l,i],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=st(ho(!0),ti(e));if(t===0)return;const i=this.value.rawValue,[s,r,o,l]=i.getComponents("hsv");this.value.setRawValue(new ue([s,r,o,l+t],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){st(ho(!0),ti(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const Xo=N("coltxt");function NR(n){const e=n.createElement("select"),t=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}];return e.appendChild(t.reduce((i,s)=>{const r=n.createElement("option");return r.textContent=s.text,r.value=s.value,i.appendChild(r),i},n.createDocumentFragment())),e}let BR=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Xo()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Xo("m")),this.modeElem_=NR(e),this.modeElem_.classList.add(Xo("ms")),i.appendChild(this.modeSelectElement),t.viewProps.bindDisabled(this.modeElem_);const s=e.createElement("div");s.classList.add(Xo("mm")),s.appendChild(Pd(e,"dropdown")),i.appendChild(s),this.element.appendChild(i);const r=e.createElement("div");r.classList.add(Xo("w")),this.element.appendChild(r),this.inputsElem_=r,this.inputViews_=t.inputViews,this.applyInputViews_(),Wn(t.mode,o=>{this.modeElem_.value=o})}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(e){this.inputViews_=e,this.applyInputViews_()}applyInputViews_(){e$(this.inputsElem_);const e=this.element.ownerDocument;this.inputViews_.forEach(t=>{const i=e.createElement("div");i.classList.add(Xo("c")),i.appendChild(t.element),this.inputsElem_.appendChild(i)})}};function IR(n){return vt(n==="float"?2:0)}function FR(n,e,t){const i=ql(n,e)[t];return new ah({min:0,max:i})}function KR(n,e,t){return new hh(n,{arrayPosition:t===0?"fst":t===2?"lst":"mid",parser:e.parser,props:j.fromObject({formatter:IR(e.colorType),keyScale:ho(!1),pointerScale:e.colorType==="float"?.01:1}),value:Ne(0,{constraint:FR(e.colorMode,e.colorType,t)}),viewProps:e.viewProps})}function UR(n,e){const t={colorMode:e.colorMode,colorType:e.colorType,parser:ei,viewProps:e.viewProps};return[0,1,2].map(i=>{const s=KR(n,t,i);return jo({primary:e.value,secondary:s.value,forward(r){return Rt(r,e.colorType).getComponents(e.colorMode)[i]},backward(r,o){const l=e.colorMode,u=Rt(r,e.colorType).getComponents(l);u[i]=o;const h=Gf(Sd(vi(u),u[3]),l,e.colorType);return Rt(h,"int")}}),s})}function HR(n,e){const t=new kd(n,{parser:ch("int"),props:j.fromObject({formatter:Yf}),value:Ne(ue.black()),viewProps:e.viewProps});return jo({primary:e.value,secondary:t.value,forward:i=>new ue(vi(i.getComponents()),i.mode),backward:(i,s)=>new ue(Sd(vi(s.getComponents(i.mode)),i.getComponents()[3]),i.mode)}),[t]}function zR(n){return n!=="hex"}let qR=class{constructor(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=t.colorType,this.value=t.value,this.viewProps=t.viewProps,this.colorMode=Ne(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new BR(e,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const t=this.colorMode.rawValue;return zR(t)?UR(e,{colorMode:t,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):HR(e,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(e){const t=e.currentTarget;this.colorMode.rawValue=t.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map(i=>i.view)}};const Gp=N("hpl");let GR=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Gp()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(Gp("c")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Gp("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=this.value.rawValue,[t]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=V$(new ue([t,100,100],"hsv"));const i=L(t,0,360,0,100);this.markerElem_.style.left=`${i}%`}onValueChange_(){this.update_()}},YR=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new GR(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ts(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=L(Se(e.point.x,0,e.bounds.width),0,e.bounds.width,0,360),s=this.value.rawValue,[,r,o,l]=s.getComponents("hsv");this.value.setRawValue(new ue([i,r,o,l],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=st(ho(!1),ti(e));if(t===0)return;const i=this.value.rawValue,[s,r,o,l]=i.getComponents("hsv");this.value.setRawValue(new ue([s+t,r,o,l],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){st(ho(!1),ti(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const Yp=N("svp"),YC=64;let XR=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Yp()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("canvas");i.height=YC,i.width=YC,i.classList.add(Yp("c")),this.element.appendChild(i),this.canvasElement=i;const s=e.createElement("div");s.classList.add(Yp("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=rD(this.canvasElement);if(!e)return;const i=this.value.rawValue.getComponents("hsv"),s=this.canvasElement.width,r=this.canvasElement.height,o=e.getImageData(0,0,s,r),l=o.data;for(let h=0;h<r;h++)for(let c=0;c<s;c++){const p=L(c,0,s,0,100),d=L(h,0,r,100,0),m=d$(i[0],p,d),f=(h*s+c)*4;l[f]=m[0],l[f+1]=m[1],l[f+2]=m[2],l[f+3]=255}e.putImageData(o,0,0);const a=L(i[1],0,100,0,100);this.markerElem_.style.left=`${a}%`;const u=L(i[2],0,100,100,0);this.markerElem_.style.top=`${u}%`}onValueChange_(){this.update_()}},WR=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new XR(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ts(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=L(e.point.x,0,e.bounds.width,0,100),s=L(e.point.y,0,e.bounds.height,100,0),[r,,,o]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new ue([r,i,s,o],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){zc(e.key)&&e.preventDefault();const[t,i,s,r]=this.value.rawValue.getComponents("hsv"),o=ho(!1),l=st(o,ti(e)),a=st(o,uo(e));l===0&&a===0||this.value.setRawValue(new ue([t,i+l,s+a,r],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){const t=ho(!1),i=st(t,ti(e)),s=st(t,uo(e));i===0&&s===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},ZR=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.hPaletteC_=new YR(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new WR(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=t.supportsAlpha?{palette:new jR(e,{value:this.value,viewProps:this.viewProps}),text:new hh(e,{parser:ei,props:j.fromObject({pointerScale:.01,keyScale:.1,formatter:vt(2)}),value:Ne(0,{constraint:new ah({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&jo({primary:this.value,secondary:this.alphaIcs_.text.value,forward:i=>i.getComponents()[3],backward:(i,s)=>{const r=i.getComponents();return r[3]=s,new ue(r,i.mode)}}),this.textsC_=new qR(e,{colorType:t.colorType,value:this.value,viewProps:this.viewProps}),this.view=new dR(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}};const Xp=N("colsw");let QR=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(Xp()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Xp("sw")),this.element.appendChild(i),this.swatchElem_=i;const s=e.createElement("button");s.classList.add(Xp("b")),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s,this.update_()}update_(){const e=this.value.rawValue;this.swatchElem_.style.backgroundColor=Xf(e)}onValueChange_(){this.update_()}},JR=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new QR(e,{value:this.value,viewProps:this.viewProps})}},Wf=class{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=Ed.create(t.expanded),this.swatchC_=new JR(e,{value:this.value,viewProps:this.viewProps});const i=this.swatchC_.view.buttonElement;i.addEventListener("blur",this.onButtonBlur_),i.addEventListener("click",this.onButtonClick_),this.textC_=new kd(e,{parser:t.parser,props:j.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new sR(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=t.pickerLayout==="popup"?new Kf(e,{viewProps:this.viewProps}):null;const s=new ZR(e,{colorType:t.colorType,supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});s.view.allFocusableElements.forEach(r=>{r.addEventListener("blur",this.onPopupChildBlur_),r.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=s,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(s.view.element),jo({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:r=>r,backward:(r,o)=>o})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),xd(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=Rf(e);i&&t.contains(i)||i&&i===this.swatchC_.view.buttonElement&&!Cd(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}};function eO(n){return vi(n.getComponents("rgb")).reduce((e,t)=>e<<8|Math.floor(t)&255,0)}function tO(n){return n.getComponents("rgb").reduce((e,t,i)=>{const s=Math.floor(i===3?t*255:t)&255;return e<<8|s},0)>>>0}function nO(n){return new ue([n>>16&255,n>>8&255,n&255],"rgb")}function iO(n){return new ue([n>>24&255,n>>16&255,n>>8&255,L(n&255,0,255,0,1)],"rgb")}function sO(n){return typeof n!="number"?ue.black():nO(n)}function rO(n){return typeof n!="number"?ue.black():iO(n)}function _c(n,e){return typeof n!="object"||$e(n)?!1:e in n&&typeof n[e]=="number"}function A$(n){return _c(n,"r")&&_c(n,"g")&&_c(n,"b")}function M$(n){return A$(n)&&_c(n,"a")}function T$(n){return A$(n)}function Zf(n,e){if(n.mode!==e.mode||n.type!==e.type)return!1;const t=n.getComponents(),i=e.getComponents();for(let s=0;s<t.length;s++)if(t[s]!==i[s])return!1;return!0}function XC(n){return"a"in n?[n.r,n.g,n.b,n.a]:[n.r,n.g,n.b]}function oO(n){const e=L$(n);return e?(t,i)=>{Br(t,e(i))}:null}function lO(n){const e=n?tO:eO;return(t,i)=>{Br(t,e(i))}}function aO(n,e,t){const s=Rt(e,t).toRgbaObject();n.writeProperty("r",s.r),n.writeProperty("g",s.g),n.writeProperty("b",s.b),n.writeProperty("a",s.a)}function uO(n,e,t){const s=Rt(e,t).toRgbaObject();n.writeProperty("r",s.r),n.writeProperty("g",s.g),n.writeProperty("b",s.b)}function hO(n,e){return(t,i)=>{n?aO(t,i,e):uO(t,i,e)}}function cO(n){var e;return!!(!((e=n?.color)===null||e===void 0)&&e.alpha)}function dO(n){return n?e=>Xf(e,"0x"):e=>Yf(e,"0x")}function pO(n){return"color"in n||n.view==="color"}Ie({id:"input-color-number",type:"input",accept:(n,e)=>{if(typeof n!="number"||!pO(e))return null;const t=zf(e);return t?{initialValue:n,params:Object.assign(Object.assign({},t),{supportsAlpha:cO(e)})}:null},binding:{reader:n=>n.params.supportsAlpha?rO:sO,equals:Zf,writer:n=>lO(n.params.supportsAlpha)},controller:n=>{var e,t;return new Wf(n.document,{colorType:"int",expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:dO(n.params.supportsAlpha),parser:ch("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.supportsAlpha,value:n.value,viewProps:n.viewProps})}});function mO(n,e){if(!T$(n))return Rt(ue.black(),e);if(e==="int"){const t=XC(n);return new ue(t,"rgb")}if(e==="float"){const t=XC(n);return new qf(t,"rgb")}return Rt(ue.black(),"int")}function vO(n){return M$(n)}function fO(n){return e=>{const t=mO(e,n);return Rt(t,"int")}}function _O(n,e){return t=>n?S$(t,e):k$(t,e)}Ie({id:"input-color-object",type:"input",accept:(n,e)=>{var t;if(!T$(n))return null;const i=zf(e);return i?{initialValue:n,params:Object.assign(Object.assign({},i),{colorType:(t=f$(e))!==null&&t!==void 0?t:"int"})}:null},binding:{reader:n=>fO(n.params.colorType),equals:Zf,writer:n=>hO(vO(n.initialValue),n.params.colorType)},controller:n=>{var e,t;const i=M$(n.initialValue);return new Wf(n.document,{colorType:n.params.colorType,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:_O(i,n.params.colorType),parser:ch("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:i,value:n.value,viewProps:n.viewProps})}});Ie({id:"input-color-string",type:"input",accept:(n,e)=>{if(typeof n!="string"||e.view==="text")return null;const t=SR(n,f$(e));if(!t)return null;const i=L$(t);if(!i)return null;const s=zf(e);return s?{initialValue:n,params:Object.assign(Object.assign({},s),{format:t,stringifier:i})}:null},binding:{reader:()=>LR,equals:Zf,writer:n=>{const e=oO(n.params.format);if(!e)throw ys.notBindable();return e}},controller:n=>{var e,t;return new Wf(n.document,{colorType:n.params.format.type,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:n.params.stringifier,parser:ch("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.format.alpha,value:n.value,viewProps:n.viewProps})}});let Ld=class{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map((i,s)=>{var r,o;return(o=(r=this.components[s])===null||r===void 0?void 0:r.constrain(i))!==null&&o!==void 0?o:i});return this.asm_.fromComponents(t)}};const WC=N("pndtxt");let wO=class{constructor(e,t){this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add(WC()),this.textViews.forEach(i=>{const s=e.createElement("div");s.classList.add(WC("a")),s.appendChild(i.element),this.element.appendChild(s)})}};function bO(n,e,t){return new hh(n,{arrayPosition:t===0?"fst":t===e.axes.length-1?"lst":"mid",parser:e.parser,props:e.axes[t].textProps,value:Ne(0,{constraint:e.axes[t].constraint}),viewProps:e.viewProps})}let ma=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map((i,s)=>bO(e,t,s)),this.acs_.forEach((i,s)=>{jo({primary:this.value,secondary:i.value,forward:r=>t.assembly.toComponents(r)[s],backward:(r,o)=>{const l=t.assembly.toComponents(r);return l[s]=o,t.assembly.fromComponents(l)}})}),this.view=new wO(e,{textViews:this.acs_.map(i=>i.view)})}get textControllers(){return this.acs_}},gO=class extends Tf{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(e){this.controller.valueController.sliderController.props.set("max",e)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(e){this.controller.valueController.sliderController.props.set("min",e)}};function CO(n,e){const t=[],i=kf(n,e);i&&t.push(i);const s=Sf(n);s&&t.push(s);const r=Ff(n.options);return r&&t.push(r),new pa(t)}Ie({id:"input-number",type:"input",accept:(n,e)=>{if(typeof n!="number")return null;const t=Be(e,i=>Object.assign(Object.assign({},Af(i)),{options:i.optional.custom(Vd),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>Vf,constraint:n=>CO(n.params,n.initialValue),writer:n=>Br},controller:n=>{const e=n.value,t=n.constraint,i=t&&xu(t,$d);if(i)return new zl(n.document,{props:new j({options:i.values.value("options")}),value:e,viewProps:n.viewProps});const s=Lf(n.params,e.rawValue),r=t&&xu(t,ah);return r?new HC(n.document,Object.assign(Object.assign({},JD(Object.assign(Object.assign({},s),{keyScale:Ne(s.keyScale),max:r.values.value("max"),min:r.values.value("min")}))),{parser:ei,value:e,viewProps:n.viewProps})):new hh(n.document,{parser:ei,props:j.fromObject(s),value:e,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="number"?null:n.controller.valueController instanceof HC?new gO(n.controller):n.controller.valueController instanceof zl?new If(n.controller):null}});let br=class{constructor(e=0,t=0){this.x=e,this.y=t}getComponents(){return[this.x,this.y]}static isObject(e){if($e(e))return!1;const t=e.x,i=e.y;return!(typeof t!="number"||typeof i!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y}toObject(){return{x:this.x,y:this.y}}};const D$={toComponents:n=>n.getComponents(),fromComponents:n=>new br(...n)},Wo=N("p2d");let PO=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Wo()),t.viewProps.bindClassModifiers(this.element),Wn(t.expanded,Nr(this.element,Wo(void 0,"expanded")));const i=e.createElement("div");i.classList.add(Wo("h")),this.element.appendChild(i);const s=e.createElement("button");s.classList.add(Wo("b")),s.appendChild(Pd(e,"p2dpad")),t.viewProps.bindDisabled(s),i.appendChild(s),this.buttonElement=s;const r=e.createElement("div");if(r.classList.add(Wo("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(Wo("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}};const Os=N("p2dp");let yO=class{constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=e.createElement("div"),this.element.classList.add(Os()),t.layout==="popup"&&this.element.classList.add(Os(void 0,"p")),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Os("p")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.padElement=i;const s=e.createElementNS(it,"svg");s.classList.add(Os("g")),this.padElement.appendChild(s),this.svgElem_=s;const r=e.createElementNS(it,"line");r.classList.add(Os("ax")),r.setAttributeNS(null,"x1","0"),r.setAttributeNS(null,"y1","50%"),r.setAttributeNS(null,"x2","100%"),r.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(r);const o=e.createElementNS(it,"line");o.classList.add(Os("ax")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","0"),o.setAttributeNS(null,"x2","50%"),o.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(o);const l=e.createElementNS(it,"line");l.classList.add(Os("l")),l.setAttributeNS(null,"x1","50%"),l.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(l),this.lineElem_=l;const a=e.createElement("div");a.classList.add(Os("m")),this.padElement.appendChild(a),this.markerElem_=a,t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,t]=this.value.rawValue.getComponents(),i=this.props_.get("max"),s=L(e,-i,+i,0,100),r=L(t,-i,+i,0,100),o=this.props_.get("invertsY")?100-r:r;this.lineElem_.setAttributeNS(null,"x2",`${s}%`),this.lineElem_.setAttributeNS(null,"y2",`${o}%`),this.markerElem_.style.left=`${s}%`,this.markerElem_.style.top=`${o}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}};function ZC(n,e,t){return[st(e[0],ti(n)),st(e[1],uo(n))*(t?1:-1)]}let EO=class{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new yO(e,{layout:t.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ts(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=this.props.get("max"),s=L(e.point.x,0,e.bounds.width,-i,+i),r=L(this.props.get("invertsY")?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-i,+i);this.value.setRawValue(new br(s,r),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onPadKeyDown_(e){zc(e.key)&&e.preventDefault();const[t,i]=ZC(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(new br(this.value.rawValue.x+t,this.value.rawValue.y+i),{forceEmit:!1,last:!1})}onPadKeyUp_(e){const[t,i]=ZC(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},xO=class{constructor(e,t){var i,s;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=Ed.create(t.expanded),this.popC_=t.pickerLayout==="popup"?new Kf(e,{viewProps:this.viewProps}):null;const r=new EO(e,{layout:t.pickerLayout,props:new j({invertsY:Ne(t.invertsY),max:Ne(t.max),xKeyScale:t.axes[0].textProps.value("keyScale"),yKeyScale:t.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});r.view.allFocusableElements.forEach(o=>{o.addEventListener("blur",this.onPopupChildBlur_),o.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=r,this.textC_=new ma(e,{assembly:D$,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new PO(e,{expanded:this.foldable_.value("expanded"),pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(i=this.view.buttonElement)===null||i===void 0||i.addEventListener("blur",this.onPadButtonBlur_),(s=this.view.buttonElement)===null||s===void 0||s.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),jo({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:o=>o,backward:(o,l)=>l})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),xd(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=Rf(e);i&&t.contains(i)||i&&i===this.view.buttonElement&&!Cd(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.view.buttonElement.focus()}};function $O(n){return br.isObject(n)?new br(n.x,n.y):new br}function VO(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y)}function kO(n,e){return new Ld({assembly:D$,components:[ss(Object.assign(Object.assign({},n),n.x),e.x),ss(Object.assign(Object.assign({},n),n.y),e.y)]})}function QC(n,e){var t,i;if(!$e(n.min)||!$e(n.max))return Math.max(Math.abs((t=n.min)!==null&&t!==void 0?t:0),Math.abs((i=n.max)!==null&&i!==void 0?i:0));const s=Qx(n);return Math.max(Math.abs(s)*10,Math.abs(e)*10)}function SO(n,e){var t,i;const s=QC(lo(n,(t=n.x)!==null&&t!==void 0?t:{}),e.x),r=QC(lo(n,(i=n.y)!==null&&i!==void 0?i:{}),e.y);return Math.max(s,r)}function LO(n){if(!("y"in n))return!1;const e=n.y;return e&&"inverted"in e?!!e.inverted:!1}Ie({id:"input-point2d",type:"input",accept:(n,e)=>{if(!br.isObject(n))return null;const t=Be(e,i=>Object.assign(Object.assign({},$u(i)),{expanded:i.optional.boolean,picker:i.optional.custom(c$),readonly:i.optional.constant(!1),x:i.optional.custom(cr),y:i.optional.object(Object.assign(Object.assign({},$u(i)),{inverted:i.optional.boolean}))}));return t?{initialValue:n,params:t}:null},binding:{reader:()=>$O,constraint:n=>kO(n.params,n.initialValue),equals:br.equals,writer:()=>VO},controller:n=>{var e,t;const i=n.document,s=n.value,r=n.constraint,o=[n.params.x,n.params.y];return new xO(i,{axes:s.rawValue.getComponents().map((l,a)=>{var u;return Mf({constraint:r.components[a],initialValue:l,params:lo(n.params,(u=o[a])!==null&&u!==void 0?u:{})})}),expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,invertsY:LO(n.params),max:SO(n.params,s.rawValue),parser:ei,pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",value:s,viewProps:n.viewProps})}});let kl=class{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if($e(e))return!1;const t=e.x,i=e.y,s=e.z;return!(typeof t!="number"||typeof i!="number"||typeof s!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}};const R$={toComponents:n=>n.getComponents(),fromComponents:n=>new kl(...n)};function AO(n){return kl.isObject(n)?new kl(n.x,n.y,n.z):new kl}function MO(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z)}function TO(n,e){return new Ld({assembly:R$,components:[ss(Object.assign(Object.assign({},n),n.x),e.x),ss(Object.assign(Object.assign({},n),n.y),e.y),ss(Object.assign(Object.assign({},n),n.z),e.z)]})}Ie({id:"input-point3d",type:"input",accept:(n,e)=>{if(!kl.isObject(n))return null;const t=Be(e,i=>Object.assign(Object.assign({},$u(i)),{readonly:i.optional.constant(!1),x:i.optional.custom(cr),y:i.optional.custom(cr),z:i.optional.custom(cr)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>AO,constraint:n=>TO(n.params,n.initialValue),equals:kl.equals,writer:n=>MO},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z];return new ma(n.document,{assembly:R$,axes:e.rawValue.getComponents().map((s,r)=>{var o;return Mf({constraint:t.components[r],initialValue:s,params:lo(n.params,(o=i[r])!==null&&o!==void 0?o:{})})}),parser:ei,value:e,viewProps:n.viewProps})}});let Sl=class{constructor(e=0,t=0,i=0,s=0){this.x=e,this.y=t,this.z=i,this.w=s}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if($e(e))return!1;const t=e.x,i=e.y,s=e.z,r=e.w;return!(typeof t!="number"||typeof i!="number"||typeof s!="number"||typeof r!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}};const O$={toComponents:n=>n.getComponents(),fromComponents:n=>new Sl(...n)};function DO(n){return Sl.isObject(n)?new Sl(n.x,n.y,n.z,n.w):new Sl}function RO(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z),n.writeProperty("w",e.w)}function OO(n,e){return new Ld({assembly:O$,components:[ss(Object.assign(Object.assign({},n),n.x),e.x),ss(Object.assign(Object.assign({},n),n.y),e.y),ss(Object.assign(Object.assign({},n),n.z),e.z),ss(Object.assign(Object.assign({},n),n.w),e.w)]})}Ie({id:"input-point4d",type:"input",accept:(n,e)=>{if(!Sl.isObject(n))return null;const t=Be(e,i=>Object.assign(Object.assign({},$u(i)),{readonly:i.optional.constant(!1),w:i.optional.custom(cr),x:i.optional.custom(cr),y:i.optional.custom(cr),z:i.optional.custom(cr)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>DO,constraint:n=>OO(n.params,n.initialValue),equals:Sl.equals,writer:n=>RO},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z,n.params.w];return new ma(n.document,{assembly:O$,axes:e.rawValue.getComponents().map((s,r)=>{var o;return Mf({constraint:t.components[r],initialValue:s,params:lo(n.params,(o=i[r])!==null&&o!==void 0?o:{})})}),parser:ei,value:e,viewProps:n.viewProps})}});function jO(n){const e=[],t=Ff(n.options);return t&&e.push(t),new pa(e)}Ie({id:"input-string",type:"input",accept:(n,e)=>{if(typeof n!="string")return null;const t=Be(e,i=>({readonly:i.optional.constant(!1),options:i.optional.custom(Vd)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>Hf,constraint:n=>jO(n.params),writer:n=>Br},controller:n=>{const e=n.document,t=n.value,i=n.constraint,s=i&&xu(i,$d);return s?new zl(e,{props:new j({options:s.values.value("options")}),value:t,viewProps:n.viewProps}):new kd(e,{parser:r=>r,props:j.fromObject({formatter:bv}),value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="string"?null:n.controller.valueController instanceof zl?new If(n.controller):null}});const dh={monitor:{defaultInterval:200,defaultRows:3}},JC=N("mll");let NO=class{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(JC()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("textarea");i.classList.add(JC("i")),i.style.height=`calc(var(${u$("containerUnitSize")}) * ${t.rows})`,i.readOnly=!0,t.viewProps.bindDisabled(i),this.element.appendChild(i),this.textareaElem_=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.textareaElem_,t=e.scrollTop===e.scrollHeight-e.clientHeight,i=[];this.value.rawValue.forEach(s=>{s!==void 0&&i.push(this.formatter_(s))}),e.textContent=i.join(`
`),t&&(e.scrollTop=e.scrollHeight)}onValueUpdate_(){this.update_()}},Qf=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new NO(e,{formatter:t.formatter,rows:t.rows,value:this.value,viewProps:this.viewProps})}};const e0=N("sgl");let BO=class{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(e0()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(e0("i")),i.readOnly=!0,i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.value.rawValue,t=e[e.length-1];this.inputElement.value=t!==void 0?this.formatter_(t):""}onValueUpdate_(){this.update_()}},Jf=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new BO(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}};Ie({id:"monitor-bool",type:"monitor",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=Be(e,i=>({readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>Uf},controller:n=>{var e;return n.value.rawValue.length===1?new Jf(n.document,{formatter:UC,value:n.value,viewProps:n.viewProps}):new Qf(n.document,{formatter:UC,rows:(e=n.params.rows)!==null&&e!==void 0?e:dh.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}});let IO=class extends Tf{get max(){return this.controller.valueController.props.get("max")}set max(e){this.controller.valueController.props.set("max",e)}get min(){return this.controller.valueController.props.get("min")}set min(e){this.controller.valueController.props.set("min",e)}};const js=N("grl");let FO=class{constructor(e,t){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(js()),t.viewProps.bindClassModifiers(this.element),this.formatter_=t.formatter,this.props_=t.props,this.cursor_=t.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const i=e.createElementNS(it,"svg");i.classList.add(js("g")),i.style.height=`calc(var(${u$("containerUnitSize")}) * ${t.rows})`,this.element.appendChild(i),this.svgElem_=i;const s=e.createElementNS(it,"polyline");this.svgElem_.appendChild(s),this.lineElem_=s;const r=e.createElement("div");r.classList.add(js("t"),N("tt")()),this.element.appendChild(r),this.tooltipElem_=r,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const e=this.svgElem_.getBoundingClientRect(),t=this.value.rawValue.length-1,i=this.props_.get("min"),s=this.props_.get("max"),r=[];this.value.rawValue.forEach((h,c)=>{if(h===void 0)return;const p=L(c,0,t,0,e.width),d=L(h,i,s,e.height,0);r.push([p,d].join(","))}),this.lineElem_.setAttributeNS(null,"points",r.join(" "));const o=this.tooltipElem_,l=this.value.rawValue[this.cursor_.rawValue];if(l===void 0){o.classList.remove(js("t","a"));return}const a=L(this.cursor_.rawValue,0,t,0,e.width),u=L(l,i,s,e.height,0);o.style.left=`${a}px`,o.style.top=`${u}px`,o.textContent=`${this.formatter_(l)}`,o.classList.contains(js("t","a"))||(o.classList.add(js("t","a"),js("t","in")),Kc(o),o.classList.remove(js("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}},e_=class{constructor(e,t){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.cursor_=Ne(-1),this.view=new FO(e,{cursor:this.cursor_,formatter:t.formatter,rows:t.rows,props:this.props,value:this.value,viewProps:this.viewProps}),!Cd(e))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const i=new Ts(this.view.element);i.emitter.on("down",this.onGraphPointerDown_),i.emitter.on("move",this.onGraphPointerMove_),i.emitter.on("up",this.onGraphPointerUp_)}}importProps(e){return ri(e,null,t=>({max:t.required.number,min:t.required.number}),t=>(this.props.set("max",t.max),this.props.set("min",t.min),!0))}exportProps(){return oi(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(e){const t=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(L(e.offsetX,0,t.width,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){if(!e.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(L(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}};function gv(n){return $e(n.format)?vt(2):n.format}function KO(n){var e;return n.value.rawValue.length===1?new Jf(n.document,{formatter:gv(n.params),value:n.value,viewProps:n.viewProps}):new Qf(n.document,{formatter:gv(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:dh.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}function UO(n){var e,t,i;return new e_(n.document,{formatter:gv(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:dh.monitor.defaultRows,props:j.fromObject({max:(t=n.params.max)!==null&&t!==void 0?t:100,min:(i=n.params.min)!==null&&i!==void 0?i:0}),value:n.value,viewProps:n.viewProps})}function t0(n){return n.view==="graph"}Ie({id:"monitor-number",type:"monitor",accept:(n,e)=>{if(typeof n!="number")return null;const t=Be(e,i=>({format:i.optional.function,max:i.optional.number,min:i.optional.number,readonly:i.required.constant(!0),rows:i.optional.number,view:i.optional.string}));return t?{initialValue:n,params:t}:null},binding:{defaultBufferSize:n=>t0(n)?64:1,reader:n=>Vf},controller:n=>t0(n.params)?UO(n):KO(n),api:n=>n.controller.valueController instanceof e_?new IO(n.controller):null});Ie({id:"monitor-string",type:"monitor",accept:(n,e)=>{if(typeof n!="string")return null;const t=Be(e,i=>({multiline:i.optional.boolean,readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>Hf},controller:n=>{var e;const t=n.value;return t.rawValue.length>1||n.params.multiline?new Qf(n.document,{formatter:bv,rows:(e=n.params.rows)!==null&&e!==void 0?e:dh.monitor.defaultRows,value:t,viewProps:n.viewProps}):new Jf(n.document,{formatter:bv,value:t,viewProps:n.viewProps})}});class HO{constructor(e){this.controller_=e}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(e){this.controller_.viewProps.set("disabled",e)}get title(){var e;return(e=this.controller_.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller_.props.set("title",e)}on(e,t){const i=t.bind(this);return this.controller_.emitter.on(e,()=>{i(new da(this))}),this}}class zO extends da{constructor(e,t,i){super(e),this.cell=t,this.index=i}}class qO extends Oo{constructor(e){super(e),this.cellToApiMap_=new Map,this.emitter_=new $t;const t=this.controller.valueController;t.cellControllers.forEach((i,s)=>{const r=new HO(i);this.cellToApiMap_.set(i,r),i.emitter.on("click",()=>{const o=s%t.size[0],l=Math.floor(s/t.size[0]);this.emitter_.emit("click",{event:new zO(this,r,[o,l])})})})}cell(e,t){const i=this.controller.valueController,s=i.cellControllers[t*i.size[0]+e];return this.cellToApiMap_.get(s)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s.event)}),this}}class GO{constructor(e,t){this.size=t.size;const[i,s]=this.size,r=[];for(let o=0;o<s;o++)for(let l=0;l<i;l++){const a=new i$(e,{props:j.fromObject(Object.assign({},t.cellConfig(l,o))),viewProps:ao.create()});r.push(a)}this.cellCs_=r,this.viewProps=ao.create(),this.viewProps.handleDispose(()=>{this.cellCs_.forEach(o=>{o.viewProps.set("disposed",!0)})}),this.view=new h$(e,{viewProps:this.viewProps,viewName:"btngrid"}),this.view.element.style.gridTemplateColumns=`repeat(${i}, 1fr)`,this.cellCs_.forEach(o=>{this.view.element.appendChild(o.view.element)})}get cellControllers(){return this.cellCs_}}class n0 extends uh{constructor(e,t){const i=t.valueController,s=new yd(e,{blade:t.blade,props:t.labelProps,valueController:i});super({blade:t.blade,view:s.view,viewProps:i.viewProps}),this.valueController=i,this.labelController=s}}Ie({id:"buttongrid",type:"blade",accept(n){const e=Be(n,t=>({cells:t.required.function,size:t.required.array(t.required.number),view:t.required.constant("buttongrid"),label:t.optional.string}));return e?{params:e}:null},controller(n){return new n0(n.document,{blade:n.blade,labelProps:j.fromObject({label:n.params.label}),valueController:new GO(n.document,{cellConfig:n.params.cells,size:n.params.size})})},api(n){return n.controller instanceof n0?new qO(n.controller):null}});class YO extends Oo{get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get value(){return this.controller.valueController.value.rawValue}set value(e){this.controller.valueController.value.rawValue=e}on(e,t){const i=t.bind(this);return this.controller.valueController.value.emitter.on(e,s=>{i(new gd(this,s.rawValue,s.options.last))}),this}}function An(n,e,t){return n*(1-t)+e*t}const XO=20,WO=.001,Wp=100;function ZO(n,e){let t=.25,i=.5,s=-1;for(let r=0;r<XO;r++){const[o,l]=n.curve(i);if(i+=t*(o<e?1:-1),s=l,t*=.5,Math.abs(e-o)<WO)break}return s}class co{constructor(e=0,t=0,i=1,s=1){this.cache_=[],this.comps_=[e,t,i,s]}get x1(){return this.comps_[0]}get y1(){return this.comps_[1]}get x2(){return this.comps_[2]}get y2(){return this.comps_[3]}static isObject(e){return $e(e)||!Array.isArray(e)?!1:typeof e[0]=="number"&&typeof e[1]=="number"&&typeof e[2]=="number"&&typeof e[3]=="number"}static equals(e,t){return e.x1===t.x1&&e.y1===t.y1&&e.x2===t.x2&&e.y2===t.y2}curve(e){const t=An(0,this.x1,e),i=An(0,this.y1,e),s=An(this.x1,this.x2,e),r=An(this.y1,this.y2,e),o=An(this.x2,1,e),l=An(this.y2,1,e),a=An(t,s,e),u=An(i,r,e),h=An(s,o,e),c=An(r,l,e);return[An(a,h,e),An(u,c,e)]}y(e){if(this.cache_.length===0){const t=[];for(let i=0;i<Wp;i++)t.push(ZO(this,L(i,0,Wp-1,0,1)));this.cache_=t}return this.cache_[Math.round(L(Se(e,0,1),0,1,0,Wp-1))]}toObject(){return[this.comps_[0],this.comps_[1],this.comps_[2],this.comps_[3]]}}const j$={toComponents:n=>n.toObject(),fromComponents:n=>new co(...n)};function QO(n){const e=vt(2);return`cubic-bezier(${n.toObject().map(i=>e(i)).join(", ")})`}const i0=[0,.5,.5,1];function JO(n){const e=n.match(/^cubic-bezier\s*\(\s*([0-9.]+)\s*,\s*([0-9.]+)\s*,\s*([0-9.]+)\s*,\s*([0-9.]+)\s*\)$/);if(!e)return new co(...i0);const t=[e[1],e[2],e[3],e[4]].reduce((i,s)=>{if(!i)return null;const r=Number(s);return isNaN(r)?null:[...i,r]},[]);return new co(...t??i0)}const Hr=N("cbz");class ej{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Hr()),t.viewProps.bindClassModifiers(this.element),t.foldable.bindExpandedClass(this.element,Hr(void 0,"expanded")),Qn(t.foldable,"completed",Nr(this.element,Hr(void 0,"cpl")));const i=e.createElement("div");i.classList.add(Hr("h")),this.element.appendChild(i);const s=e.createElement("button");s.classList.add(Hr("b")),t.viewProps.bindDisabled(s);const r=e.createElementNS(it,"svg");r.innerHTML='<path d="M2 13C8 13 8 3 14 3"/>',s.appendChild(r),i.appendChild(s),this.buttonElement=s;const o=e.createElement("div");if(o.classList.add(Hr("t")),i.appendChild(o),this.textElement=o,t.pickerLayout==="inline"){const l=e.createElement("div");l.classList.add(Hr("p")),this.element.appendChild(l),this.pickerElement=l}else this.pickerElement=null}}const Zp=N("cbzp");class tj{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Zp()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Zp("g")),this.element.appendChild(i),this.graphElement=i;const s=e.createElement("div");s.classList.add(Zp("t")),this.element.appendChild(s),this.textElement=s}}function N$(n,e){const t=new MutationObserver(s=>{for(const r of s)r.type==="childList"&&r.addedNodes.forEach(o=>{o.contains(o)&&(e(),t.disconnect())})}),i=n.ownerDocument;t.observe(i.body,{attributes:!0,childList:!0,subtree:!0})}const Ns=N("cbzg");function nj(n,e){return t=>e(n(t))}class ij{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Ns()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(Ns("p")),this.element.appendChild(i),this.previewElement=i;const s=e.createElementNS(it,"svg");s.classList.add(Ns("g")),this.element.appendChild(s),this.svgElem_=s;const r=e.createElementNS(it,"path");r.classList.add(Ns("u")),this.svgElem_.appendChild(r),this.guideElem_=r;const o=e.createElementNS(it,"polyline");o.classList.add(Ns("l")),this.svgElem_.appendChild(o),this.lineElem_=o,this.handleElems_=[e.createElement("div"),e.createElement("div")],this.handleElems_.forEach(l=>{l.classList.add(Ns("h")),this.element.appendChild(l)}),this.vectorElems_=[e.createElementNS(it,"line"),e.createElementNS(it,"line")],this.vectorElems_.forEach(l=>{l.classList.add(Ns("v")),this.svgElem_.appendChild(l)}),this.value_=t.value,this.value_.emitter.on("change",this.onValueChange_.bind(this)),this.sel_=t.selection,this.handleElems_.forEach((l,a)=>{Wn(this.sel_,nj(u=>u===a,Nr(l,Ns("h","sel"))))}),N$(this.element,()=>{this.refresh()})}getVertMargin_(e){return e*.25}valueToPosition(e,t){const i=this.element.getBoundingClientRect(),s=i.width,r=i.height,o=this.getVertMargin_(r);return{x:L(e,0,1,0,s),y:L(t,0,1,r-o,o)}}positionToValue(e,t){const i=this.element.getBoundingClientRect(),s=i.width,r=i.height,o=this.getVertMargin_(r);return{x:Se(L(e,0,s,0,1),0,1),y:L(t,r-o,o,0,1)}}refresh(){this.guideElem_.setAttributeNS(null,"d",[0,1].map(r=>{const o=this.valueToPosition(0,r),l=this.valueToPosition(1,r);return[`M ${o.x},${o.y}`,`L ${l.x},${l.y}`].join(" ")}).join(" "));const e=this.value_.rawValue,t=[];let i=0;for(;;){const r=this.valueToPosition(...e.curve(i));if(t.push([r.x,r.y].join(",")),i>=1)break;i=Math.min(i+.05,1)}this.lineElem_.setAttributeNS(null,"points",t.join(" "));const s=e.toObject();[0,1].forEach(r=>{const o=this.valueToPosition(r,r),l=this.valueToPosition(s[r*2],s[r*2+1]),a=this.vectorElems_[r];a.setAttributeNS(null,"x1",String(o.x)),a.setAttributeNS(null,"y1",String(o.y)),a.setAttributeNS(null,"x2",String(l.x)),a.setAttributeNS(null,"y2",String(l.y));const u=this.handleElems_[r];u.style.left=`${l.x}px`,u.style.top=`${l.y}px`})}onValueChange_(){this.refresh()}}const s0=24,r0=400,o0=1e3,Zo=N("cbzprv");class sj{constructor(e,t){this.stopped_=!0,this.startTime_=-1,this.onDispose_=this.onDispose_.bind(this),this.onTimer_=this.onTimer_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Zo()),t.viewProps.bindClassModifiers(this.element);const i=e.createElementNS(it,"svg");i.classList.add(Zo("g")),this.element.appendChild(i),this.svgElem_=i;const s=e.createElementNS(it,"path");s.classList.add(Zo("t")),this.svgElem_.appendChild(s),this.ticksElem_=s;const r=e.createElement("div");r.classList.add(Zo("m")),this.element.appendChild(r),this.markerElem_=r,this.value_=t.value,this.value_.emitter.on("change",this.onValueChange_),t.viewProps.handleDispose(this.onDispose_),N$(this.element,()=>{this.refresh()})}play(){this.stop(),this.updateMarker_(0),this.markerElem_.classList.add(Zo("m","a")),this.startTime_=new Date().getTime()+r0,this.stopped_=!1,requestAnimationFrame(this.onTimer_)}stop(){this.stopped_=!0,this.markerElem_.classList.remove(Zo("m","a"))}onDispose_(){this.stop()}updateMarker_(e){const t=this.value_.rawValue.y(Se(e,0,1));this.markerElem_.style.left=`${t*100}%`}refresh(){const e=this.svgElem_.getBoundingClientRect(),t=e.width,i=e.height,s=[],r=this.value_.rawValue;for(let o=0;o<s0;o++){const l=L(o,0,s0-1,0,1),a=L(r.y(l),0,1,0,t);s.push(`M ${a},0 v${i}`)}this.ticksElem_.setAttributeNS(null,"d",s.join(" "))}onTimer_(){if(this.startTime_===null)return;const e=new Date().getTime()-this.startTime_,t=e/o0;this.updateMarker_(t),e>o0+r0&&this.stop(),this.stopped_||requestAnimationFrame(this.onTimer_)}onValueChange_(){this.refresh(),this.play()}}function Cv(n,e,t,i){const s=t-n,r=i-e;return Math.sqrt(s*s+r*r)}function rj(n,e,t,i){const s=Cv(n,e,t,i),r=Math.atan2(i-e,t-n),o=Math.round(r/(Math.PI/4))*Math.PI/4;return{x:n+Math.cos(o)*s,y:e+Math.sin(o)*s}}class oj{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.keyScale_=t.keyScale,this.value=t.value,this.sel_=Ne(0),this.viewProps=t.viewProps,this.view=new ij(e,{selection:this.sel_,value:this.value,viewProps:this.viewProps}),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_),this.prevView_=new sj(e,{value:this.value,viewProps:this.viewProps}),this.prevView_.element.addEventListener("mousedown",s=>{s.stopImmediatePropagation(),s.preventDefault(),this.prevView_.play()}),this.view.previewElement.appendChild(this.prevView_.element);const i=new Ts(this.view.element);i.emitter.on("down",this.onPointerDown_),i.emitter.on("move",this.onPointerMove_),i.emitter.on("up",this.onPointerUp_)}refresh(){this.view.refresh(),this.prevView_.refresh(),this.prevView_.play()}updateValue_(e,t,i){const s=this.sel_.rawValue,r=this.value.rawValue.toObject(),o=this.view.positionToValue(e.x,e.y),l=t?rj(s,s,o.x,o.y):o;r[s*2]=l.x,r[s*2+1]=l.y,this.value.setRawValue(new co(...r),i)}onPointerDown_(e){const t=e.data;if(!t.point)return;const i=this.value.rawValue,s=this.view.valueToPosition(i.x1,i.y1),r=Cv(t.point.x,t.point.y,s.x,s.y),o=this.view.valueToPosition(i.x2,i.y2),l=Cv(t.point.x,t.point.y,o.x,o.y);this.sel_.rawValue=r<=l?0:1,this.updateValue_(t.point,e.shiftKey,{forceEmit:!1,last:!1})}onPointerMove_(e){const t=e.data;t.point&&this.updateValue_(t.point,e.shiftKey,{forceEmit:!1,last:!1})}onPointerUp_(e){const t=e.data;t.point&&this.updateValue_(t.point,e.shiftKey,{forceEmit:!0,last:!0})}onKeyDown_(e){zc(e.key)&&e.preventDefault();const t=this.sel_.rawValue,i=this.value.rawValue.toObject(),s=this.keyScale_.rawValue;i[t*2]+=st(s,ti(e)),i[t*2+1]+=st(s,uo(e)),this.value.setRawValue(new co(...i),{forceEmit:!1,last:!1})}onKeyUp_(e){zc(e.key)&&e.preventDefault();const t=this.keyScale_.rawValue,i=st(t,ti(e)),s=st(t,uo(e));i===0&&s===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class lj{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new tj(e,{viewProps:this.viewProps}),this.gc_=new oj(e,{keyScale:t.axis.textProps.value("keyScale"),value:this.value,viewProps:this.viewProps}),this.view.graphElement.appendChild(this.gc_.view.element);const i=Object.assign(Object.assign({},t.axis),{constraint:new Ef({max:1,min:0})}),s=Object.assign(Object.assign({},t.axis),{constraint:void 0});this.tc_=new ma(e,{assembly:j$,axes:[i,s,i,s],parser:ei,value:this.value,viewProps:this.viewProps}),this.view.textElement.appendChild(this.tc_.view.element)}get allFocusableElements(){return[this.gc_.view.element,...this.tc_.view.textViews.map(e=>e.inputElement)]}refresh(){this.gc_.refresh()}}class l0{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=Ed.create(t.expanded),this.view=new ej(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("blur",this.onButtonBlur_),this.view.buttonElement.addEventListener("click",this.onButtonClick_),this.tc_=new kd(e,{parser:JO,props:j.fromObject({formatter:QO}),value:this.value,viewProps:this.viewProps}),this.view.textElement.appendChild(this.tc_.view.element),this.popC_=t.pickerLayout==="popup"?new Kf(e,{viewProps:this.viewProps}):null;const i=new lj(e,{axis:t.axis,value:this.value,viewProps:this.viewProps});i.allFocusableElements.forEach(s=>{s.addEventListener("blur",this.onPopupChildBlur_),s.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=i,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Wn(this.popC_.shows,s=>{s&&i.refresh()}),jo({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:s=>s,backward:(s,r)=>r})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),xd(this.foldable_,this.view.pickerElement))}onButtonBlur_(e){if(!this.popC_)return;const t=e.relatedTarget;(!t||!this.popC_.view.element.contains(t))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=Rf(e);i&&t.contains(i)||i&&i===this.view.buttonElement&&!Cd(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_&&e.key==="Escape"&&(this.popC_.shows.rawValue=!1)}}function aj(){return new Ld({assembly:j$,components:[0,1,2,3].map(n=>n%2===0?new Ef({min:0,max:1}):void 0)})}Ie({id:"cubicbezier",type:"blade",accept(n){const e=Be(n,t=>({value:t.required.array(t.required.number),view:t.required.constant("cubicbezier"),expanded:t.optional.boolean,label:t.optional.string,picker:t.optional.custom(i=>i==="inline"||i==="popup"?i:void 0)}));return e?{params:e}:null},controller(n){var e,t;const i=new co(...n.params.value),s=Ne(i,{constraint:aj(),equals:co.equals}),r=new l0(n.document,{axis:{textProps:j.fromObject({keyScale:.1,pointerScale:.01,formatter:vt(2)})},expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",value:s,viewProps:n.viewProps});return new Uc(n.document,{blade:n.blade,props:j.fromObject({label:n.params.label}),value:s,valueController:r})},api(n){return!(n.controller instanceof Uc)||!(n.controller.valueController instanceof l0)?null:new YO(n.controller)}});class uj extends Oo{begin(){this.controller.valueController.begin()}end(){this.controller.valueController.end()}}const a0=20;class hj{constructor(){this.start_=null,this.duration_=0,this.fps_=null,this.frameCount_=0,this.timestamps_=[]}get duration(){return this.duration_}get fps(){return this.fps_}begin(e){this.start_=e.getTime()}calculateFps_(e){if(this.timestamps_.length===0)return null;const t=this.timestamps_[0];return 1e3*(this.frameCount_-t.frameCount)/(e-t.time)}compactTimestamps_(){if(this.timestamps_.length<=a0)return;const e=this.timestamps_.length-a0;this.timestamps_.splice(0,e);const t=this.timestamps_[0].frameCount;this.timestamps_.forEach(i=>{i.frameCount-=t}),this.frameCount_-=t}end(e){if(this.start_===null)return;const t=e.getTime();this.duration_=t-this.start_,this.start_=null,this.fps_=this.calculateFps_(t),this.timestamps_.push({frameCount:this.frameCount_,time:t}),++this.frameCount_,this.compactTimestamps_()}}const Fa=N("fps");class cj{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Fa()),t.viewProps.bindClassModifiers(this.element),this.graphElement=e.createElement("div"),this.graphElement.classList.add(Fa("g")),this.element.appendChild(this.graphElement);const i=e.createElement("div");i.classList.add(Fa("l")),this.element.appendChild(i);const s=e.createElement("span");s.classList.add(Fa("v")),s.textContent="--",i.appendChild(s),this.valueElement=s;const r=e.createElement("span");r.classList.add(Fa("u")),r.textContent="FPS",i.appendChild(r)}}class dj{constructor(e,t){this.stopwatch_=new hj,this.onTick_=this.onTick_.bind(this),this.ticker_=t.ticker,this.ticker_.emitter.on("tick",this.onTick_),this.value_=t.value,this.viewProps=t.viewProps,this.view=new cj(e,{viewProps:this.viewProps}),this.graphC_=new e_(e,{formatter:vt(0),props:j.fromObject({max:t.maxValue,min:t.minValue}),rows:t.rows,value:this.value_,viewProps:this.viewProps}),this.view.graphElement.appendChild(this.graphC_.view.element),this.viewProps.handleDispose(()=>{this.graphC_.viewProps.set("disposed",!0),this.ticker_.dispose()})}begin(){this.stopwatch_.begin(new Date)}end(){this.stopwatch_.end(new Date)}onTick_(){const e=this.stopwatch_.fps;if(e!==null){const t=this.value_.rawValue;this.value_.rawValue=pD(t,e),this.view.valueElement.textContent=e.toFixed(0)}}}class u0 extends uh{constructor(e,t){const i=t.valueController,s=new yd(e,{blade:t.blade,props:t.labelProps,valueController:i});super({blade:t.blade,view:s.view,viewProps:i.viewProps}),this.valueController=i,this.labelController=s}}function pj(n,e){return e===0?new ID:new FD(n,e??dh.monitor.defaultInterval)}Ie({id:"fpsgraph",type:"blade",accept(n){const e=Be(n,t=>({view:t.required.constant("fpsgraph"),interval:t.optional.number,label:t.optional.string,rows:t.optional.number,max:t.optional.number,min:t.optional.number}));return e?{params:e}:null},controller(n){var e,t,i,s;const r=(e=n.params.interval)!==null&&e!==void 0?e:500;return new u0(n.document,{blade:n.blade,labelProps:j.fromObject({label:n.params.label}),valueController:new dj(n.document,{rows:(t=n.params.rows)!==null&&t!==void 0?t:2,maxValue:(i=n.params.max)!==null&&i!==void 0?i:90,minValue:(s=n.params.min)!==null&&s!==void 0?s:0,ticker:pj(n.document,r),value:Ne(cD(80)),viewProps:n.viewProps})})},api(n){return n.controller instanceof u0?new uj(n.controller):null}});class Zn{constructor(e,t){this.min=e,this.max=t}static isObject(e){if(typeof e!="object"||e===null)return!1;const t=e.min,i=e.max;return!(typeof t!="number"||typeof i!="number")}static equals(e,t){return e.min===t.min&&e.max===t.max}get length(){return this.max-this.min}toObject(){return{min:this.min,max:this.max}}}const B$={fromComponents:n=>new Zn(n[0],n[1]),toComponents:n=>[n.min,n.max]};class I${constructor(e){this.edge=e}constrain(e){var t,i,s,r,o,l,a,u;if(e.min<=e.max)return new Zn((i=(t=this.edge)===null||t===void 0?void 0:t.constrain(e.min))!==null&&i!==void 0?i:e.min,(r=(s=this.edge)===null||s===void 0?void 0:s.constrain(e.max))!==null&&r!==void 0?r:e.max);const h=(e.min+e.max)/2;return new Zn((l=(o=this.edge)===null||o===void 0?void 0:o.constrain(h))!==null&&l!==void 0?l:h,(u=(a=this.edge)===null||a===void 0?void 0:a.constrain(h))!==null&&u!==void 0?u:h)}}const Qp=N("rsltxt");class mj{constructor(e,t){this.sliderView_=t.sliderView,this.textView_=t.textView,this.element=e.createElement("div"),this.element.classList.add(Qp());const i=e.createElement("div");i.classList.add(Qp("s")),i.appendChild(this.sliderView_.element),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Qp("t")),s.appendChild(this.textView_.element),this.element.appendChild(s)}}const zr=N("rsl");class vj{constructor(e,t){this.onSliderPropsChange_=this.onSliderPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.sliderProps_=t.sliderProps,this.sliderProps_.emitter.on("change",this.onSliderPropsChange_),this.element=e.createElement("div"),this.element.classList.add(zr()),t.viewProps.bindClassModifiers(this.element),this.value_=t.value,this.value_.emitter.on("change",this.onValueChange_);const i=e.createElement("div");i.classList.add(zr("t")),this.element.appendChild(i),this.trackElement=i;const s=e.createElement("div");s.classList.add(zr("b")),i.appendChild(s),this.barElement=s;const r=["min","max"].map(o=>{const l=e.createElement("div");return l.classList.add(zr("k"),zr("k",o)),i.appendChild(l),l});this.knobElements=[r[0],r[1]],this.update_()}valueToX_(e){const t=this.sliderProps_.get("min"),i=this.sliderProps_.get("max");return Se(L(e,t,i,0,1),0,1)*100}update_(){const e=this.value_.rawValue;e.length===0?this.element.classList.add(zr(void 0,"zero")):this.element.classList.remove(zr(void 0,"zero"));const t=[this.valueToX_(e.min),this.valueToX_(e.max)];this.barElement.style.left=`${t[0]}%`,this.barElement.style.right=`${100-t[1]}%`,this.knobElements.forEach((i,s)=>{i.style.left=`${t[s]}%`})}onSliderPropsChange_(){this.update_()}onValueChange_(){this.update_()}}class fj{constructor(e,t){this.grabbing_=null,this.grabOffset_=0,this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.sliderProps=t.sliderProps,this.viewProps=t.viewProps,this.value=t.value,this.view=new vj(e,{sliderProps:this.sliderProps,value:this.value,viewProps:t.viewProps});const i=new Ts(this.view.trackElement);i.emitter.on("down",this.onPointerDown_),i.emitter.on("move",this.onPointerMove_),i.emitter.on("up",this.onPointerUp_)}ofs_(){return this.grabbing_==="min"?this.view.knobElements[0].getBoundingClientRect().width/2:this.grabbing_==="max"?-this.view.knobElements[1].getBoundingClientRect().width/2:0}valueFromData_(e){if(!e.point)return null;const t=(e.point.x+this.ofs_())/e.bounds.width,i=this.sliderProps.get("min"),s=this.sliderProps.get("max");return L(t,0,1,i,s)}onPointerDown_(e){if(!e.data.point)return;const t=e.data.point.x/e.data.bounds.width,i=this.value.rawValue,s=this.sliderProps.get("min"),r=this.sliderProps.get("max"),o=L(i.min,s,r,0,1),l=L(i.max,s,r,0,1);Math.abs(l-t)<=.025?this.grabbing_="max":Math.abs(o-t)<=.025?this.grabbing_="min":t>=o&&t<=l?(this.grabbing_="length",this.grabOffset_=L(t-o,0,1,0,r-s)):t<o?(this.grabbing_="min",this.onPointerMove_(e)):t>l&&(this.grabbing_="max",this.onPointerMove_(e))}applyPointToValue_(e,t){const i=this.valueFromData_(e);if(i===null)return;const s=this.sliderProps.get("min"),r=this.sliderProps.get("max");if(this.grabbing_==="min")this.value.setRawValue(new Zn(i,this.value.rawValue.max),t);else if(this.grabbing_==="max")this.value.setRawValue(new Zn(this.value.rawValue.min,i),t);else if(this.grabbing_==="length"){const o=this.value.rawValue.length;let l=i-this.grabOffset_,a=l+o;l<s?(l=s,a=s+o):a>r&&(l=r-o,a=r),this.value.setRawValue(new Zn(l,a),t)}}onPointerMove_(e){this.applyPointToValue_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.applyPointToValue_(e.data,{forceEmit:!0,last:!0}),this.grabbing_=null}}class _j{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sc_=new fj(e,t);const i={constraint:t.constraint,textProps:t.textProps};this.tc_=new ma(e,{assembly:B$,axes:[i,i],parser:t.parser,value:this.value,viewProps:t.viewProps}),this.view=new mj(e,{sliderView:this.sc_.view,textView:this.tc_.view})}get textController(){return this.tc_}}function wj(n){return Zn.isObject(n)?new Zn(n.min,n.max):new Zn(0,0)}function bj(n,e){n.writeProperty("max",e.max),n.writeProperty("min",e.min)}function gj(n){const e=[],t=Sf(n);t&&e.push(t);const i=kf(n);return i&&e.push(i),new I$(new pa(e))}Ie({id:"input-interval",type:"input",accept:(n,e)=>{if(!Zn.isObject(n))return null;const t=Be(e,i=>Object.assign(Object.assign({},Af(i)),{readonly:i.optional.constant(!1)}));return t?{initialValue:new Zn(n.min,n.max),params:t}:null},binding:{reader:n=>wj,constraint:n=>gj(n.params),equals:Zn.equals,writer:n=>bj},controller(n){const e=n.value,t=n.constraint;if(!(t instanceof I$))throw ys.shouldNeverHappen();const i=(e.rawValue.min+e.rawValue.max)/2,s=j.fromObject(Lf(n.params,i)),r=t.edge&&xu(t.edge,ah);if(r)return new _j(n.document,{constraint:t.edge,parser:ei,sliderProps:new j({keyScale:s.value("keyScale"),max:r.values.value("max"),min:r.values.value("min")}),textProps:s,value:e,viewProps:n.viewProps});const o={constraint:t.edge,textProps:s};return new ma(n.document,{assembly:B$,axes:[o,o],parser:ei,value:e,viewProps:n.viewProps})}});class Cj{constructor(e){this.controller_=e}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(e){this.controller_.viewProps.set("disabled",e)}get title(){var e;return(e=this.controller_.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller_.props.set("title",e)}}class Pj extends gd{constructor(e,t,i,s,r){super(e,s,r),this.cell=t,this.index=i}}class yj extends Oo{constructor(e){super(e),this.cellToApiMap_=new Map,this.controller.valueController.cellControllers.forEach(i=>{const s=new Cj(i);this.cellToApiMap_.set(i,s)})}get value(){return this.controller.value}cell(e,t){const i=this.controller.valueController,s=i.cellControllers[t*i.size[0]+e];return this.cellToApiMap_.get(s)}on(e,t){const i=t.bind(this);this.controller.value.emitter.on(e,s=>{const r=this.controller.valueController,o=r.findCellByValue(s.rawValue);if(!o)return;const l=this.cellToApiMap_.get(o);if(!l)return;const a=r.cellControllers.indexOf(o);i(new Pj(this,l,[a%r.size[0],Math.floor(a/r.size[0])],s.rawValue))})}}const Ka=N("rad");class Ej{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Ka()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("label");i.classList.add(Ka("l")),this.element.appendChild(i);const s=e.createElement("input");s.classList.add(Ka("i")),s.name=t.name,s.type="radio",t.viewProps.bindDisabled(s),i.appendChild(s),this.inputElement=s;const r=e.createElement("div");r.classList.add(Ka("b")),i.appendChild(r);const o=e.createElement("div");o.classList.add(Ka("t")),r.appendChild(o),Qn(t.props,"title",l=>{o.textContent=l})}}class xj{constructor(e,t){this.props=t.props,this.viewProps=t.viewProps,this.view=new Ej(e,{name:t.name,props:this.props,viewProps:this.viewProps})}}class Pv{constructor(e,t){this.cellCs_=[],this.cellValues_=[],this.onCellInputChange_=this.onCellInputChange_.bind(this),this.size=t.size;const[i,s]=this.size;for(let r=0;r<s;r++)for(let o=0;o<i;o++){const l=new xj(e,{name:t.groupName,props:j.fromObject(Object.assign({},t.cellConfig(o,r))),viewProps:ao.create()});this.cellCs_.push(l),this.cellValues_.push(t.cellConfig(o,r).value)}this.value=t.value,Wn(this.value,r=>{const o=this.findCellByValue(r);o&&(o.view.inputElement.checked=!0)}),this.viewProps=ao.create(),this.view=new h$(e,{viewProps:this.viewProps,viewName:"radgrid"}),this.view.element.style.gridTemplateColumns=`repeat(${i}, 1fr)`,this.cellCs_.forEach(r=>{r.view.inputElement.addEventListener("change",this.onCellInputChange_),this.view.element.appendChild(r.view.element)})}get cellControllers(){return this.cellCs_}findCellByValue(e){const t=this.cellValues_.findIndex(i=>i===e);return t<0?null:this.cellCs_[t]}onCellInputChange_(e){const t=e.currentTarget,i=this.cellCs_.findIndex(s=>s.view.inputElement===t);i<0||(this.value.rawValue=this.cellValues_[i])}}(function(){return Ie({id:"radiogrid",type:"blade",accept(n){const e=Be(n,t=>({cells:t.required.function,groupName:t.required.string,size:t.required.array(t.required.number),value:t.required.raw,view:t.required.constant("radiogrid"),label:t.optional.string}));return e?{params:e}:null},controller(n){const e=Ne(n.params.value);return new Uc(n.document,{blade:n.blade,props:j.fromObject({label:n.params.label}),value:e,valueController:new Pv(n.document,{groupName:n.params.groupName,cellConfig:n.params.cells,size:n.params.size,value:e})})},api(n){return!(n.controller instanceof Uc)||!(n.controller.valueController instanceof Pv)?null:new yj(n.controller)}})})();function t_(n){return Ie({id:"input-radiogrid",type:"input",accept(e,t){if(!n.isType(e))return null;const i=Be(t,s=>({cells:s.required.function,groupName:s.required.string,size:s.required.array(s.required.number),view:s.required.constant("radiogrid")}));return i?{initialValue:e,params:i}:null},binding:n.binding,controller:e=>new Pv(e.document,{cellConfig:e.params.cells,groupName:e.params.groupName,size:e.params.size,value:e.value})})}t_({isType:n=>typeof n=="number",binding:{reader:n=>Vf,writer:n=>Br}});t_({isType:n=>typeof n=="string",binding:{reader:n=>Hf,writer:n=>Br}});t_({isType:n=>typeof n=="boolean",binding:{reader:n=>Uf,writer:n=>Br}});function Le(n){return n==null}function n_(n){return n!==null&&typeof n=="object"}function yv(n){return n!==null&&typeof n=="object"}function $j(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function po(n,e){return Array.from(new Set([...Object.keys(n),...Object.keys(e)])).reduce((i,s)=>{const r=n[s],o=e[s];return yv(r)&&yv(o)?Object.assign(Object.assign({},i),{[s]:po(r,o)}):Object.assign(Object.assign({},i),{[s]:s in e?o:r})},{})}function Vj(n){return n_(n)?"target"in n:!1}const kj={alreadydisposed:()=>"View has been already disposed",invalidparams:n=>`Invalid parameters for '${n.name}'`,nomatchingcontroller:n=>`No matching controller for '${n.key}'`,nomatchingview:n=>`No matching view for '${JSON.stringify(n.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:n=>`Not compatible with  plugin '${n.id}'`,propertynotfound:n=>`Property '${n.name}' not found`,shouldneverhappen:()=>"This error should never happen"};let mo=class gl{static alreadyDisposed(){return new gl({type:"alreadydisposed"})}static notBindable(){return new gl({type:"notbindable"})}static notCompatible(e,t){return new gl({type:"notcompatible",context:{id:`${e}.${t}`}})}static propertyNotFound(e){return new gl({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new gl({type:"shouldneverhappen"})}constructor(e){var t;this.message=(t=kj[e.type](e.context))!==null&&t!==void 0?t:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}toString(){return this.message}},h0=class F${constructor(e,t){this.obj_=e,this.key=t}static isBindable(e){return!(e===null||typeof e!="object"&&typeof e!="function")}read(){return this.obj_[this.key]}write(e){this.obj_[this.key]=e}writeProperty(e,t){const i=this.read();if(!F$.isBindable(i))throw mo.notBindable();if(!(e in i))throw mo.propertyNotFound(e);i[e]=t}},Pn=class{constructor(){this.observers_={}}on(e,t){let i=this.observers_[e];return i||(i=this.observers_[e]=[]),i.push({handler:t}),this}off(e,t){const i=this.observers_[e];return i&&(this.observers_[e]=i.filter(s=>s.handler!==t)),this}emit(e,t){const i=this.observers_[e];i&&i.forEach(s=>{s.handler(t)})}},Sj=class{constructor(e,t){var i;this.constraint_=t?.constraint,this.equals_=(i=t?.equals)!==null&&i!==void 0?i:(s,r)=>s===r,this.emitter=new Pn,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},s=this.constraint_?this.constraint_.constrain(e):e,r=this.rawValue_;this.equals_(r,s)&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=s,this.emitter.emit("change",{options:i,previousRawValue:r,rawValue:s,sender:this}))}},Lj=class{constructor(e){this.emitter=new Pn,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},s=this.value_;s===e&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:i,previousRawValue:s,rawValue:this.value_,sender:this}))}},Aj=class{constructor(e){this.emitter=new Pn,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}};function ot(n,e){const t=e?.constraint,i=e?.equals;return!t&&!i?new Lj(n):new Sj(n,e)}function Mj(n){return[new Aj(n),(e,t)=>{n.setRawValue(e,t)}]}let we=class K${constructor(e){this.emitter=new Pn,this.valMap_=e;for(const t in this.valMap_)this.valMap_[t].emitter.on("change",()=>{this.emitter.emit("change",{key:t,sender:this})})}static createCore(e){return Object.keys(e).reduce((i,s)=>Object.assign(i,{[s]:ot(e[s])}),{})}static fromObject(e){const t=this.createCore(e);return new K$(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}},Ad=class{constructor(e){this.values=we.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");return Math.min(Math.max(e,i),t)}},Tj=class{constructor(e){this.values=we.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");let s=e;return Le(i)||(s=Math.max(s,i)),Le(t)||(s=Math.min(s,t)),s}},Dj=class{constructor(e,t=0){this.step=e,this.origin=t}constrain(e){const t=this.origin%this.step,i=Math.round((e-t)/this.step);return t+i*this.step}},Rj=class{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}};const Oj={"**":(n,e)=>Math.pow(n,e),"*":(n,e)=>n*e,"/":(n,e)=>n/e,"%":(n,e)=>n%e,"+":(n,e)=>n+e,"-":(n,e)=>n-e,"<<":(n,e)=>n<<e,">>":(n,e)=>n>>e,">>>":(n,e)=>n>>>e,"&":(n,e)=>n&e,"^":(n,e)=>n^e,"|":(n,e)=>n|e};let jj=class{constructor(e,t,i){this.left=t,this.operator=e,this.right=i}evaluate(){const e=Oj[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}};const Nj={"+":n=>n,"-":n=>-n,"~":n=>~n};let Bj=class{constructor(e,t){this.operator=e,this.expression=t}evaluate(){const e=Nj[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}};function i_(n){return(e,t)=>{for(let i=0;i<n.length;i++){const s=n[i](e,t);if(s!=="")return s}return""}}function Vu(n,e){var t;const i=n.substr(e).match(/^\s+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function Ij(n,e){const t=n.substr(e,1);return t.match(/^[1-9]$/)?t:""}function ku(n,e){var t;const i=n.substr(e).match(/^[0-9]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function Fj(n,e){const t=ku(n,e);if(t!=="")return t;const i=n.substr(e,1);if(e+=1,i!=="-"&&i!=="+")return"";const s=ku(n,e);return s===""?"":i+s}function s_(n,e){const t=n.substr(e,1);if(e+=1,t.toLowerCase()!=="e")return"";const i=Fj(n,e);return i===""?"":t+i}function U$(n,e){const t=n.substr(e,1);if(t==="0")return t;const i=Ij(n,e);return e+=i.length,i===""?"":i+ku(n,e)}function Kj(n,e){const t=U$(n,e);if(e+=t.length,t==="")return"";const i=n.substr(e,1);if(e+=i.length,i!==".")return"";const s=ku(n,e);return e+=s.length,t+i+s+s_(n,e)}function Uj(n,e){const t=n.substr(e,1);if(e+=t.length,t!==".")return"";const i=ku(n,e);return e+=i.length,i===""?"":t+i+s_(n,e)}function Hj(n,e){const t=U$(n,e);return e+=t.length,t===""?"":t+s_(n,e)}const zj=i_([Kj,Uj,Hj]);function qj(n,e){var t;const i=n.substr(e).match(/^[01]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function Gj(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0b")return"";const i=qj(n,e);return i===""?"":t+i}function Yj(n,e){var t;const i=n.substr(e).match(/^[0-7]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function Xj(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0o")return"";const i=Yj(n,e);return i===""?"":t+i}function Wj(n,e){var t;const i=n.substr(e).match(/^[0-9a-f]+/i);return(t=i&&i[0])!==null&&t!==void 0?t:""}function Zj(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0x")return"";const i=Wj(n,e);return i===""?"":t+i}const Qj=i_([Gj,Xj,Zj]),Jj=i_([Qj,zj]);function eN(n,e){const t=Jj(n,e);return e+=t.length,t===""?null:{evaluable:new Rj(t),cursor:e}}function tN(n,e){const t=n.substr(e,1);if(e+=t.length,t!=="(")return null;const i=z$(n,e);if(!i)return null;e=i.cursor,e+=Vu(n,e).length;const s=n.substr(e,1);return e+=s.length,s!==")"?null:{evaluable:i.evaluable,cursor:e}}function nN(n,e){var t;return(t=eN(n,e))!==null&&t!==void 0?t:tN(n,e)}function H$(n,e){const t=nN(n,e);if(t)return t;const i=n.substr(e,1);if(e+=i.length,i!=="+"&&i!=="-"&&i!=="~")return null;const s=H$(n,e);return s?(e=s.cursor,{cursor:e,evaluable:new Bj(i,s.evaluable)}):null}function iN(n,e,t){t+=Vu(e,t).length;const i=n.filter(s=>e.startsWith(s,t))[0];return i?(t+=i.length,t+=Vu(e,t).length,{cursor:t,operator:i}):null}function sN(n,e){return(t,i)=>{const s=n(t,i);if(!s)return null;i=s.cursor;let r=s.evaluable;for(;;){const o=iN(e,t,i);if(!o)break;i=o.cursor;const l=n(t,i);if(!l)return null;i=l.cursor,r=new jj(o.operator,r,l.evaluable)}return r?{cursor:i,evaluable:r}:null}}const rN=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((n,e)=>sN(n,e),H$);function z$(n,e){return e+=Vu(n,e).length,rN(n,e)}function oN(n){const e=z$(n,0);return!e||e.cursor+Vu(n,e.cursor).length!==n.length?null:e.evaluable}function Lr(n){var e;const t=oN(n);return(e=t?.evaluate())!==null&&e!==void 0?e:null}function q$(n){if(typeof n=="number")return n;if(typeof n=="string"){const e=Lr(n);if(!Le(e))return e}return 0}function an(n){return e=>e.toFixed(Math.max(Math.min(n,20),0))}function ne(n,e,t,i,s){const r=(n-e)/(t-e);return i+r*(s-i)}function c0(n){return String(n.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Ue(n,e,t){return Math.min(Math.max(n,e),t)}function G$(n,e){return(n%e+e)%e}function lN(n,e){return Le(n.step)?Math.max(c0(e),2):c0(n.step)}function Y$(n){var e;return(e=n.step)!==null&&e!==void 0?e:1}function aN(n,e){var t;const i=Math.abs((t=n.step)!==null&&t!==void 0?t:e);return i===0?.1:Math.pow(10,Math.floor(Math.log10(i))-1)}function X$(n,e){return Le(n.step)?null:new Dj(n.step,e)}function W$(n){return!Le(n.max)&&!Le(n.min)?new Ad({max:n.max,min:n.min}):!Le(n.max)||!Le(n.min)?new Tj({max:n.max,min:n.min}):null}function Z$(n,e){var t,i,s;return{formatter:(t=n.format)!==null&&t!==void 0?t:an(lN(n,e)),keyScale:(i=n.keyScale)!==null&&i!==void 0?i:Y$(n),pointerScale:(s=n.pointerScale)!==null&&s!==void 0?s:aN(n,e)}}function Q$(n){return{format:n.optional.function,keyScale:n.optional.number,max:n.optional.number,min:n.optional.number,pointerScale:n.optional.number,step:n.optional.number}}function r_(n){return{constraint:n.constraint,textProps:we.fromObject(Z$(n.params,n.initialValue))}}let o_=class{constructor(e){this.controller=e}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(e){this.controller.viewProps.set("disabled",e)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(e){this.controller.viewProps.set("hidden",e)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(e){return this.controller.importState(e)}exportState(){return this.controller.exportState()}},Md=class{constructor(e){this.target=e}},J$=class extends Md{constructor(e,t,i){super(e),this.value=t,this.last=i??!0}},uN=class extends Md{constructor(e,t){super(e),this.expanded=t}},hN=class extends Md{constructor(e,t){super(e),this.index=t}},l_=class extends o_{constructor(e){super(e),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new Pn,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(e){this.controller.tag=e}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}refresh(){this.controller.value.fetch()}onValueChange_(e){const t=this.controller.value;this.emitter_.emit("change",new J$(this,t.binding.target.read(),e.options.last))}};function cN(n,e){const i=Object.keys(e).reduce((s,r)=>{if(s===void 0)return;const o=e[r],l=o(n[r]);return l.succeeded?Object.assign(Object.assign({},s),{[r]:l.value}):void 0},{});return i}function dN(n,e){return n.reduce((t,i)=>{if(t===void 0)return;const s=e(i);if(!(!s.succeeded||s.value===void 0))return[...t,s.value]},[])}function pN(n){return n===null?!1:typeof n=="object"}function Wi(n){return e=>t=>{if(!e&&t===void 0)return{succeeded:!1,value:void 0};if(e&&t===void 0)return{succeeded:!0,value:void 0};const i=n(t);return i!==void 0?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}function d0(n){return{custom:e=>Wi(e)(n),boolean:Wi(e=>typeof e=="boolean"?e:void 0)(n),number:Wi(e=>typeof e=="number"?e:void 0)(n),string:Wi(e=>typeof e=="string"?e:void 0)(n),function:Wi(e=>typeof e=="function"?e:void 0)(n),constant:e=>Wi(t=>t===e?e:void 0)(n),raw:Wi(e=>e)(n),object:e=>Wi(t=>{if(pN(t))return cN(t,e)})(n),array:e=>Wi(t=>{if(Array.isArray(t))return dN(t,e)})(n)}}const Ev={optional:d0(!0),required:d0(!1)};function Vt(n,e){const t=e(Ev),i=Ev.required.object(t)(n);return i.succeeded?i.value:void 0}function Di(n,e,t,i){if(e&&!e(n))return!1;const s=Vt(n,t);return s?i(s):!1}function Ri(n,e){var t;return po((t=n?.())!==null&&t!==void 0?t:{},e)}function wc(n){return"value"in n}function mN(n){if(!n_(n)||!("binding"in n))return!1;const e=n.binding;return Vj(e)}const ui="http://www.w3.org/2000/svg";function qc(n){n.offsetHeight}function vN(n,e){const t=n.style.transition;n.style.transition="none",e(),n.style.transition=t}function a_(n){return n.ontouchstart!==void 0}function fN(){return globalThis}function _N(){return fN().document}function wN(n){const e=n.ownerDocument.defaultView;return e&&"document"in e?n.getContext("2d",{willReadFrequently:!0}):null}const bN={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Td(n,e){const t=n.createElementNS(ui,"svg");return t.innerHTML=bN[e],t}function eV(n,e,t){n.insertBefore(e,n.children[t])}function u_(n){n.parentElement&&n.parentElement.removeChild(n)}function tV(n){for(;n.children.length>0;)n.removeChild(n.children[0])}function gN(n){for(;n.childNodes.length>0;)n.removeChild(n.childNodes[0])}function nV(n){return n.relatedTarget?n.relatedTarget:"explicitOriginalTarget"in n?n.explicitOriginalTarget:null}function ps(n,e){n.emitter.on("change",t=>{e(t.rawValue)}),e(n.rawValue)}function fi(n,e,t){ps(n.value(e),t)}const CN="tp";function te(n){return(t,i)=>[CN,"-",n,"v",t?`_${t}`:"",i?`-${i}`:""].join("")}const Ua=te("lbl");function PN(n,e){const t=n.createDocumentFragment();return e.split(`
`).map(s=>n.createTextNode(s)).forEach((s,r)=>{r>0&&t.appendChild(n.createElement("br")),t.appendChild(s)}),t}let yN=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Ua()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Ua("l")),fi(t.props,"label",r=>{Le(r)?this.element.classList.add(Ua(void 0,"nol")):(this.element.classList.remove(Ua(void 0,"nol")),gN(i),i.appendChild(PN(e,r)))}),this.element.appendChild(i),this.labelElement=i;const s=e.createElement("div");s.classList.add(Ua("v")),this.element.appendChild(s),this.valueElement=s}},EN=class{constructor(e,t){this.props=t.props,this.valueController=t.valueController,this.viewProps=t.valueController.viewProps,this.view=new yN(e,{props:t.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(e){return Di(e,null,t=>({label:t.optional.string}),t=>(this.props.set("label",t.label),!0))}exportProps(){return Ri(null,{label:this.props.get("label")})}};function xN(){return["veryfirst","first","last","verylast"]}const p0=te(""),m0={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};let iV=class{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",()=>{xN().forEach(i=>{t.classList.remove(p0(void 0,m0[i]))}),this.blade.get("positions").forEach(i=>{t.classList.add(p0(void 0,m0[i]))})}),this.viewProps.handleDispose(()=>{u_(t)})}get parent(){return this.parent_}set parent(e){this.parent_=e,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(e){return Di(e,null,t=>({disabled:t.required.boolean,hidden:t.required.boolean}),t=>(this.viewProps.importState(t),!0))}exportState(){return Ri(null,Object.assign({},this.viewProps.exportState()))}},$N=class extends o_{get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get title(){var e;return(e=this.controller.buttonController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.buttonController.props.set("title",e)}on(e,t){const i=t.bind(this);return this.controller.buttonController.emitter.on(e,()=>{i(new Md(this))}),this}};function VN(n,e,t){t?n.classList.add(e):n.classList.remove(e)}function va(n,e){return t=>{VN(n,e,t)}}function h_(n,e){ps(n,t=>{e.textContent=t??""})}const Jp=te("btn");let kN=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Jp()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("button");i.classList.add(Jp("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(Jp("t")),h_(t.props.value("title"),s),this.buttonElement.appendChild(s)}},SN=class{constructor(e,t){this.emitter=new Pn,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new kN(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(e){return Di(e,null,t=>({title:t.optional.string}),t=>(this.props.set("title",t.title),!0))}exportProps(){return Ri(null,{title:this.props.get("title")})}onClick_(){this.emitter.emit("click",{sender:this})}},v0=class extends iV{constructor(e,t){const i=new SN(e,{props:t.buttonProps,viewProps:t.viewProps}),s=new EN(e,{blade:t.blade,props:t.labelProps,valueController:i});super({blade:t.blade,view:s.view,viewProps:t.viewProps}),this.buttonController=i,this.labelController=s}importState(e){return Di(e,t=>super.importState(t)&&this.buttonController.importProps(t)&&this.labelController.importProps(t),()=>({}),()=>!0)}exportState(){return Ri(()=>super.exportState(),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}},LN=class{constructor(e){const[t,i]=e.split("-"),s=t.split(".");this.major=parseInt(s[0],10),this.minor=parseInt(s[1],10),this.patch=parseInt(s[2],10),this.prerelease=i??null}toString(){const e=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[e,this.prerelease].join("-"):e}};const AN=new LN("2.0.1");function Gt(n){return Object.assign({core:AN},n)}Gt({id:"button",type:"blade",accept(n){const e=Vt(n,t=>({title:t.required.string,view:t.required.constant("button"),label:t.optional.string}));return e?{params:e}:null},controller(n){return new v0(n.document,{blade:n.blade,buttonProps:we.fromObject({title:n.params.title}),labelProps:we.fromObject({label:n.params.label}),viewProps:n.viewProps})},api(n){return n.controller instanceof v0?new $N(n.controller):null}});function MN(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}function TN(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}function DN(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}function RN(n){return n_(n)?"refresh"in n&&typeof n.refresh=="function":!1}function ON(n,e){if(!h0.isBindable(n))throw mo.notBindable();return new h0(n,e)}let jN=class{constructor(e,t){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=e,this.emitter_=new Pn,this.pool_=t,this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map(e=>this.pool_.createApi(e))}addBinding(e,t,i){const s=i??{},r=this.controller_.element.ownerDocument,o=this.pool_.createBinding(r,ON(e,t),s),l=this.pool_.createBindingApi(o);return this.add(l,s.index)}addFolder(e){return TN(this,e)}addButton(e){return MN(this,e)}addTab(e){return DN(this,e)}add(e,t){const i=e.controller;return this.controller_.rack.add(i,t),e}remove(e){this.controller_.rack.remove(e.controller)}addBlade(e){const t=this.controller_.element.ownerDocument,i=this.pool_.createBlade(t,e),s=this.pool_.createApi(i);return this.add(s,e.index)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}refresh(){this.children.forEach(e=>{RN(e)&&e.refresh()})}onRackValueChange_(e){const t=e.bladeController,i=this.pool_.createApi(t),s=mN(t.value)?t.value.binding:null;this.emitter_.emit("change",new J$(i,s?s.target.read():t.value.rawValue,e.options.last))}},c_=class extends o_{constructor(e,t){super(e),this.rackApi_=new jN(e.rackController,t)}refresh(){this.rackApi_.refresh()}},d_=class extends iV{constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps}),this.rackController=e.rackController}importState(e){return Di(e,t=>super.importState(t),t=>({children:t.required.array(t.required.raw)}),t=>this.rackController.rack.children.every((i,s)=>i.importState(t.children[s])))}exportState(){return Ri(()=>super.exportState(),{children:this.rackController.rack.children.map(e=>e.exportState())})}};function xv(n){return"rackController"in n}let NN=class{constructor(e){this.emitter=new Pn,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const t of this.allItems())if(e(t))return t;return null}includes(e){return this.cache_.has(e)}add(e,t){if(this.includes(e))throw mo.shouldNeverHappen();const i=t!==void 0?t:this.items_.length;this.items_.splice(i,0,e),this.cache_.add(e);const s=this.extract_(e);s&&(s.emitter.on("add",this.onSubListAdd_),s.emitter.on("remove",this.onSubListRemove_),s.allItems().forEach(r=>{this.cache_.add(r)})),this.emitter.emit("add",{index:i,item:e,root:this,target:this})}remove(e){const t=this.items_.indexOf(e);if(t<0)return;this.items_.splice(t,1),this.cache_.delete(e);const i=this.extract_(e);i&&(i.allItems().forEach(s=>{this.cache_.delete(s)}),i.emitter.off("add",this.onSubListAdd_),i.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}};function BN(n,e){for(let t=0;t<n.length;t++){const i=n[t];if(wc(i)&&i.value===e)return i}return null}function IN(n){return xv(n)?n.rackController.rack.bcSet_:null}let FN=class{constructor(e){var t,i;this.emitter=new Pn,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=(t=e.blade)!==null&&t!==void 0?t:null,(i=this.blade_)===null||i===void 0||i.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=e.viewProps,this.bcSet_=new NN(IN),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,t){var i;(i=e.parent)===null||i===void 0||i.remove(e),e.parent=this,this.bcSet_.add(e,t)}remove(e){e.parent=null,this.bcSet_.remove(e)}find(e){return this.bcSet_.allItems().filter(e)}onSetAdd_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,root:t,sender:this}),!t)return;const i=e.item;if(i.viewProps.emitter.on("change",this.onChildViewPropsChange_),i.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),i.viewProps.handleDispose(this.onChildDispose_),wc(i))i.value.emitter.on("change",this.onChildValueChange_);else if(xv(i)){const s=i.rackController.rack;if(s){const r=s.emitter;r.on("layout",this.onRackLayout_),r.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,root:t,sender:this}),!t)return;const i=e.item;if(wc(i))i.value.emitter.off("change",this.onChildValueChange_);else if(xv(i)){const s=i.rackController.rack;if(s){const r=s.emitter;r.off("layout",this.onRackLayout_),r.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){const e=this.bcSet_.items.filter(s=>!s.viewProps.get("hidden")),t=e[0],i=e[e.length-1];this.bcSet_.items.forEach(s=>{const r=[];s===t&&(r.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&r.push("veryfirst")),s===i&&(r.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&r.push("verylast")),s.blade.set("positions",r)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(t=>t.viewProps.get("disposed")).forEach(t=>{this.bcSet_.remove(t)})}onChildValueChange_(e){const t=BN(this.find(wc),e.sender);if(!t)throw mo.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:t,options:e.options,sender:this})}onRackLayout_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(e){this.emitter.emit("valuechange",{bladeController:e.bladeController,options:e.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}},p_=class{constructor(e){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=e.element,this.viewProps=e.viewProps;const t=new FN({blade:e.root?void 0:e.blade,viewProps:e.viewProps});t.emitter.on("add",this.onRackAdd_),t.emitter.on("remove",this.onRackRemove_),this.rack=t,this.viewProps.handleDispose(()=>{for(let i=this.rack.children.length-1;i>=0;i--)this.rack.children[i].viewProps.set("disposed",!0)})}onRackAdd_(e){e.root&&eV(this.element,e.bladeController.view.element,e.index)}onRackRemove_(e){e.root&&u_(e.bladeController.view.element)}};function sV(){return new we({positions:ot([],{equals:$j})})}let m_=class rV extends we{constructor(e){super(e)}static create(e){const t={completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},i=we.createCore(t);return new rV(i)}get styleExpanded(){var e;return(e=this.get("temporaryExpanded"))!==null&&e!==void 0?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!Le(e)?`${e}px`:"auto"}bindExpandedClass(e,t){const i=()=>{this.styleExpanded?e.classList.add(t):e.classList.remove(t)};fi(this,"expanded",i),fi(this,"temporaryExpanded",i)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}};function KN(n,e){let t=0;return vN(e,()=>{n.set("expandedHeight",null),n.set("temporaryExpanded",!0),qc(e),t=e.clientHeight,n.set("temporaryExpanded",null),qc(e)}),t}function f0(n,e){e.style.height=n.styleHeight}function v_(n,e){n.value("expanded").emitter.on("beforechange",()=>{if(n.set("completed",!1),Le(n.get("expandedHeight"))){const t=KN(n,e);t>0&&n.set("expandedHeight",t)}n.set("shouldFixHeight",!0),qc(e)}),n.emitter.on("change",()=>{f0(n,e)}),f0(n,e),e.addEventListener("transitionend",t=>{t.propertyName==="height"&&n.cleanUpTransition()})}let UN=class extends c_{constructor(e,t){super(e,t),this.emitter_=new Pn,this.controller.foldable.value("expanded").emitter.on("change",i=>{this.emitter_.emit("fold",new uN(this,i.sender.rawValue))}),this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)})}get expanded(){return this.controller.foldable.get("expanded")}set expanded(e){this.controller.foldable.set("expanded",e)}get title(){return this.controller.props.get("title")}set title(e){this.controller.props.set("title",e)}get children(){return this.rackApi_.children}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){return this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}};const oV=te("cnt");let HN=class{constructor(e,t){var i;this.className_=te((i=t.viewName)!==null&&i!==void 0?i:"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),oV()),t.viewProps.bindClassModifiers(this.element),this.foldable_=t.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),fi(this.foldable_,"completed",va(this.element,this.className_(void 0,"cpl")));const s=e.createElement("button");s.classList.add(this.className_("b")),fi(t.props,"title",u=>{Le(u)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s;const r=e.createElement("div");r.classList.add(this.className_("i")),this.element.appendChild(r);const o=e.createElement("div");o.classList.add(this.className_("t")),h_(t.props.value("title"),o),this.buttonElement.appendChild(o),this.titleElement=o;const l=e.createElement("div");l.classList.add(this.className_("m")),this.buttonElement.appendChild(l);const a=e.createElement("div");a.classList.add(this.className_("c")),this.element.appendChild(a),this.containerElement=a}},_0=class extends d_{constructor(e,t){var i;const s=m_.create((i=t.expanded)!==null&&i!==void 0?i:!0),r=new HN(e,{foldable:s,props:t.props,viewName:t.root?"rot":void 0,viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new p_({blade:t.blade,element:r.containerElement,root:t.root,viewProps:t.viewProps}),view:r})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=t.props,this.foldable=s,v_(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(e){return Di(e,t=>super.importState(t),t=>({expanded:t.required.boolean,title:t.optional.string}),t=>(this.foldable.set("expanded",t.expanded),this.props.set("title",t.title),!0))}exportState(){return Ri(()=>super.exportState(),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}};Gt({id:"folder",type:"blade",accept(n){const e=Vt(n,t=>({title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean}));return e?{params:e}:null},controller(n){return new _0(n.document,{blade:n.blade,expanded:n.params.expanded,props:we.fromObject({title:n.params.title}),viewProps:n.viewProps})},api(n){return n.controller instanceof _0?new UN(n.controller,n.pool):null}});const zN=te("");function w0(n,e){return va(n,zN(void 0,e))}let f_=class lV extends we{constructor(e){var t;super(e),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=Mj(ot(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(e){var t,i,s;const r=e??{};return new lV(we.createCore({disabled:(t=r.disabled)!==null&&t!==void 0?t:!1,disposed:!1,hidden:(i=r.hidden)!==null&&i!==void 0?i:!1,parent:(s=r.parent)!==null&&s!==void 0?s:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(e){ps(this.globalDisabled_,w0(e,"disabled")),fi(this,"hidden",w0(e,"hidden"))}bindDisabled(e){ps(this.globalDisabled_,t=>{e.disabled=t})}bindTabIndex(e){ps(this.globalDisabled_,t=>{e.tabIndex=t?-1:0})}handleDispose(e){this.value("disposed").emitter.on("change",t=>{t&&e()})}importState(e){this.set("disabled",e.disabled),this.set("hidden",e.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){const e=this.get("parent");return(e?e.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(e){var t;const i=e.previousRawValue;i?.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}};const b0=te("tbp");let qN=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(b0()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(b0("c")),this.element.appendChild(i),this.containerElement=i}};const Ha=te("tbi");let GN=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Ha()),t.viewProps.bindClassModifiers(this.element),fi(t.props,"selected",r=>{r?this.element.classList.add(Ha(void 0,"sel")):this.element.classList.remove(Ha(void 0,"sel"))});const i=e.createElement("button");i.classList.add(Ha("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(Ha("t")),h_(t.props.value("title"),s),this.buttonElement.appendChild(s),this.titleElement=s}},YN=class{constructor(e,t){this.emitter=new Pn,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new GN(e,{props:t.props,viewProps:t.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}},$v=class extends d_{constructor(e,t){const i=new qN(e,{viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new p_({blade:t.blade,element:i.containerElement,viewProps:t.viewProps}),view:i})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new YN(e,{props:t.itemProps,viewProps:f_.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=t.props,fi(this.props,"selected",s=>{this.itemController.props.set("selected",s),this.viewProps.set("hidden",!s)})}get itemController(){return this.ic_}importState(e){return Di(e,t=>super.importState(t),t=>({selected:t.required.boolean,title:t.required.string}),t=>(this.ic_.props.set("selected",t.selected),this.ic_.props.set("title",t.title),!0))}exportState(){return Ri(()=>super.exportState(),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}},XN=class extends c_{constructor(e,t){super(e,t),this.emitter_=new Pn,this.onSelect_=this.onSelect_.bind(this),this.pool_=t,this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)}),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(e){const t=this.controller.view.element.ownerDocument,i=new $v(t,{blade:sV(),itemProps:we.fromObject({selected:!1,title:e.title}),props:we.fromObject({selected:!1}),viewProps:f_.create()}),s=this.pool_.createApi(i);return this.rackApi_.add(s,e.index)}removePage(e){this.rackApi_.remove(this.rackApi_.children[e])}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}onSelect_(e){this.emitter_.emit("select",new hN(this,e.rawValue))}},WN=class extends c_{get title(){var e;return(e=this.controller.itemController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.itemController.props.set("title",e)}get selected(){return this.controller.props.get("selected")}set selected(e){this.controller.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addBlade(e){return this.rackApi_.addBlade(e)}};const g0=-1;let ZN=class{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=ot(!0),this.selectedIndex=ot(g0),this.items_=[]}add(e,t){const i=t??this.items_.length;this.items_.splice(i,0,e),e.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(e){const t=this.items_.indexOf(e);t<0||(this.items_.splice(t,1),e.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=g0,this.empty.rawValue=!0;return}const e=this.items_.findIndex(t=>t.rawValue);e<0?(this.items_.forEach((t,i)=>{t.rawValue=i===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((t,i)=>{t.rawValue=i===e}),this.selectedIndex.rawValue=e),this.empty.rawValue=!1}onItemSelectedChange_(e){if(e.rawValue){const t=this.items_.findIndex(i=>i===e.sender);this.items_.forEach((i,s)=>{i.rawValue=s===t}),this.selectedIndex.rawValue=t}else this.keepSelection_()}};const za=te("tab");let QN=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(za(),oV()),t.viewProps.bindClassModifiers(this.element),ps(t.empty,va(this.element,za(void 0,"nop")));const i=e.createElement("div");i.classList.add(za("t")),this.element.appendChild(i),this.itemsElement=i;const s=e.createElement("div");s.classList.add(za("i")),this.element.appendChild(s);const r=e.createElement("div");r.classList.add(za("c")),this.element.appendChild(r),this.contentsElement=r}},C0=class extends d_{constructor(e,t){const i=new ZN,s=new QN(e,{empty:i.empty,viewProps:t.viewProps});super({blade:t.blade,rackController:new p_({blade:t.blade,element:s.contentsElement,viewProps:t.viewProps}),view:s}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const r=this.rackController.rack;r.emitter.on("add",this.onRackAdd_),r.emitter.on("remove",this.onRackRemove_),this.tab=i}add(e,t){this.rackController.rack.add(e,t)}remove(e){this.rackController.rack.remove(this.rackController.rack.children[e])}onRackAdd_(e){if(!e.root)return;const t=e.bladeController;eV(this.view.itemsElement,t.itemController.view.element,e.index),t.itemController.viewProps.set("parent",this.viewProps),this.tab.add(t.props.value("selected"))}onRackRemove_(e){if(!e.root)return;const t=e.bladeController;u_(t.itemController.view.element),t.itemController.viewProps.set("parent",null),this.tab.remove(t.props.value("selected"))}};Gt({id:"tab",type:"blade",accept(n){const e=Vt(n,t=>({pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")}));return!e||e.pages.length===0?null:{params:e}},controller(n){const e=new C0(n.document,{blade:n.blade,viewProps:n.viewProps});return n.params.pages.forEach(t=>{const i=new $v(n.document,{blade:sV(),itemProps:we.fromObject({selected:!1,title:t.title}),props:we.fromObject({selected:!1}),viewProps:f_.create()});e.add(i)}),e},api(n){return n.controller instanceof C0?new XN(n.controller,n.pool):n.controller instanceof $v?new WN(n.controller,n.pool):null}});let __=class extends l_{get options(){return this.controller.valueController.props.get("options")}set options(e){this.controller.valueController.props.set("options",e)}},ph=class{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce((t,i)=>i.constrain(t),e)}};function Gc(n,e){if(n instanceof e)return n;if(n instanceof ph){const t=n.constraints.reduce((i,s)=>i||(s instanceof e?s:null),null);if(t)return t}return null}let Dd=class{constructor(e){this.values=we.fromObject({options:e})}constrain(e){const t=this.values.get("options");return t.length===0||t.filter(s=>s.value===e).length>0?e:t[0].value}};function Rd(n){var e;const t=Ev;if(Array.isArray(n))return(e=Vt({items:n},i=>({items:i.required.array(i.required.object({text:i.required.string,value:i.required.raw}))})))===null||e===void 0?void 0:e.items;if(typeof n=="object")return t.required.raw(n).value}function aV(n){if(Array.isArray(n))return n;const e=[];return Object.keys(n).forEach(t=>{e.push({text:t,value:n[t]})}),e}function w_(n){return Le(n)?null:new Dd(aV(n))}const em=te("lst");let JN=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add(em()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("select");i.classList.add(em("s")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.selectElement=i;const s=e.createElement("div");s.classList.add(em("m")),s.appendChild(Td(e,"dropdown")),this.element.appendChild(s),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,fi(this.props_,"options",r=>{tV(this.selectElement),r.forEach(o=>{const l=e.createElement("option");l.textContent=o.text,this.selectElement.appendChild(l)}),this.update_()})}update_(){const e=this.props_.get("options").map(t=>t.value);this.selectElement.selectedIndex=e.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}},Gl=class{constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new JN(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const t=e.currentTarget;this.value.rawValue=this.props.get("options")[t.selectedIndex].value}importProps(e){return Di(e,null,t=>({options:t.required.custom(Rd)}),t=>(this.props.set("options",aV(t.options)),!0))}exportProps(){return Ri(null,{options:this.props.get("options")})}};const P0=te("pop");let eB=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(P0()),t.viewProps.bindClassModifiers(this.element),ps(t.shows,va(this.element,P0(void 0,"v")))}},uV=class{constructor(e,t){this.shows=ot(!1),this.viewProps=t.viewProps,this.view=new eB(e,{shows:this.shows,viewProps:this.viewProps})}};const y0=te("txt");let tB=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(y0()),t.viewProps.bindClassModifiers(this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);const i=e.createElement("input");i.classList.add(y0("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}},b_=class{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new tB(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const i=e.currentTarget.value,s=this.parser_(i);Le(s)||(this.value.rawValue=s),this.view.refresh()}};function nB(n){return String(n)}function hV(n){return n==="false"?!1:!!n}function E0(n){return nB(n)}function iB(n){return e=>n.reduce((t,i)=>t!==null?t:i(e),null)}const sB=an(0);function Yc(n){return sB(n)+"%"}function cV(n){return String(n)}function Vv(n){return n}function fa({primary:n,secondary:e,forward:t,backward:i}){let s=!1;function r(o){s||(s=!0,o(),s=!1)}n.emitter.on("change",o=>{r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),e.emitter.on("change",o=>{r(()=>{n.setRawValue(i(n.rawValue,e.rawValue),o.options)}),r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),{forceEmit:!1,last:!0})})}function Zt(n,e){const t=n*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+t:e.downKey?-t:0}function Su(n){return{altKey:n.altKey,downKey:n.key==="ArrowDown",shiftKey:n.shiftKey,upKey:n.key==="ArrowUp"}}function Es(n){return{altKey:n.altKey,downKey:n.key==="ArrowLeft",shiftKey:n.shiftKey,upKey:n.key==="ArrowRight"}}function rB(n){return n==="ArrowUp"||n==="ArrowDown"}function dV(n){return rB(n)||n==="ArrowLeft"||n==="ArrowRight"}function tm(n,e){var t,i;const s=e.ownerDocument.defaultView,r=e.getBoundingClientRect();return{x:n.pageX-(((t=s&&s.scrollX)!==null&&t!==void 0?t:0)+r.left),y:n.pageY-(((i=s&&s.scrollY)!==null&&i!==void 0?i:0)+r.top)}}let No=class{constructor(e){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new Pn,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault(),(t=e.currentTarget)===null||t===void 0||t.focus();const i=this.elem_.ownerDocument;i.addEventListener("mousemove",this.onDocumentMouseMove_),i.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(tm(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(tm(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(tm(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchMove_(e){const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchEnd_(e){var t;const i=(t=e.targetTouches.item(0))!==null&&t!==void 0?t:this.lastTouch_,s=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(i?{x:i.clientX-s.left,y:i.clientY-s.top}:void 0),sender:this,shiftKey:e.shiftKey})}};const Mn=te("txt");let oB=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(Mn(),Mn(void 0,"num")),t.arrayPosition&&this.element.classList.add(Mn(void 0,t.arrayPosition)),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(Mn("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Mn()),this.inputElement.classList.add(Mn("i"));const s=e.createElement("div");s.classList.add(Mn("k")),this.element.appendChild(s),this.knobElement=s;const r=e.createElementNS(ui,"svg");r.classList.add(Mn("g")),this.knobElement.appendChild(r);const o=e.createElementNS(ui,"path");o.classList.add(Mn("gb")),r.appendChild(o),this.guideBodyElem_=o;const l=e.createElementNS(ui,"path");l.classList.add(Mn("gh")),r.appendChild(l),this.guideHeadElem_=l;const a=e.createElement("div");a.classList.add(te("tt")()),this.knobElement.appendChild(a),this.tooltipElem_=a,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.refresh()}onDraggingChange_(e){if(e.rawValue===null){this.element.classList.remove(Mn(void 0,"drg"));return}this.element.classList.add(Mn(void 0,"drg"));const t=e.rawValue/this.props_.get("pointerScale"),i=t+(t>0?-1:t<0?1:0),s=Ue(-i,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${i+s},0 L${i},4 L${i+s},8`,`M ${t},-1 L${t},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${t},4`);const r=this.props_.get("formatter");this.tooltipElem_.textContent=r(this.value.rawValue),this.tooltipElem_.style.left=`${t}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}},mh=class{constructor(e,t){var i;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=t.parser,this.props=t.props,this.sliderProps_=(i=t.sliderProps)!==null&&i!==void 0?i:null,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=ot(null),this.view=new oB(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const s=new No(this.view.knobElement);s.emitter.on("down",this.onPointerDown_),s.emitter.on("move",this.onPointerMove_),s.emitter.on("up",this.onPointerUp_)}constrainValue_(e){var t,i;const s=(t=this.sliderProps_)===null||t===void 0?void 0:t.get("min"),r=(i=this.sliderProps_)===null||i===void 0?void 0:i.get("max");let o=e;return s!==void 0&&(o=Math.max(o,s)),r!==void 0&&(o=Math.min(o,r)),o}onInputChange_(e){const i=e.currentTarget.value,s=this.parser_(i);Le(s)||(this.value.rawValue=this.constrainValue_(s)),this.view.refresh()}onInputKeyDown_(e){const t=Zt(this.props.get("keyScale"),Su(e));t!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+t),{forceEmit:!1,last:!1})}onInputKeyUp_(e){Zt(this.props.get("keyScale"),Su(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;const t=e.point.x-e.bounds.width/2;return this.constrainValue_(this.originRawValue_+t*this.props.get("pointerScale"))}onPointerMove_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}};const nm=te("sld");let lB=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(nm()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(nm("t")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.trackElement=i;const s=e.createElement("div");s.classList.add(nm("k")),this.trackElement.appendChild(s),this.knobElement=s,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}update_(){const e=Ue(ne(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${e}%`}onChange_(){this.update_()}},aB=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.props=t.props,this.view=new lB(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new No(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){e.point&&this.value.setRawValue(ne(Ue(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("min"),this.props.get("max")),t)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Zt(this.props.get("keyScale"),Es(e));t!==0&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onKeyUp_(e){Zt(this.props.get("keyScale"),Es(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const im=te("sldtxt");let uB=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(im());const i=e.createElement("div");i.classList.add(im("s")),this.sliderView_=t.sliderView,i.appendChild(this.sliderView_.element),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(im("t")),this.textView_=t.textView,s.appendChild(this.textView_.element),this.element.appendChild(s)}},x0=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sliderC_=new aB(e,{props:t.sliderProps,value:t.value,viewProps:this.viewProps}),this.textC_=new mh(e,{parser:t.parser,props:t.textProps,sliderProps:t.sliderProps,value:t.value,viewProps:t.viewProps}),this.view=new uB(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(e){return Di(e,null,t=>({max:t.required.number,min:t.required.number}),t=>{const i=this.sliderC_.props;return i.set("max",t.max),i.set("min",t.min),!0})}exportProps(){const e=this.sliderC_.props;return Ri(null,{max:e.get("max"),min:e.get("min")})}};function hB(n){return{sliderProps:new we({keyScale:n.keyScale,max:n.max,min:n.min}),textProps:new we({formatter:ot(n.formatter),keyScale:n.keyScale,pointerScale:ot(n.pointerScale)})}}const cB={containerUnitSize:"cnt-usz"};function pV(n){return`--${cB[n]}`}function Lu(n){return Q$(n)}function dr(n){if(yv(n))return Vt(n,Lu)}function rs(n,e){if(!n)return;const t=[],i=X$(n,e);i&&t.push(i);const s=W$(n);return s&&t.push(s),new ph(t)}function mV(n){if(n==="inline"||n==="popup")return n}function vh(n,e){n.write(e)}const nc=te("ckb");let dB=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(nc()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("label");i.classList.add(nc("l")),this.element.appendChild(i);const s=e.createElement("input");s.classList.add(nc("i")),s.type="checkbox",i.appendChild(s),this.inputElement=s,t.viewProps.bindDisabled(this.inputElement);const r=e.createElement("div");r.classList.add(nc("w")),i.appendChild(r);const o=Td(e,"check");r.appendChild(o),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}},pB=class{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new dB(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const t=e.currentTarget;this.value.rawValue=t.checked}};function mB(n){const e=[],t=w_(n.options);return t&&e.push(t),new ph(e)}Gt({id:"input-bool",type:"input",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=Vt(e,i=>({options:i.optional.custom(Rd),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>hV,constraint:n=>mB(n.params),writer:n=>vh},controller:n=>{const e=n.document,t=n.value,i=n.constraint,s=i&&Gc(i,Dd);return s?new Gl(e,{props:new we({options:s.values.value("options")}),value:t,viewProps:n.viewProps}):new pB(e,{value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="boolean"?null:n.controller.valueController instanceof Gl?new __(n.controller):null}});const qr=te("col");let vB=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(qr()),t.foldable.bindExpandedClass(this.element,qr(void 0,"expanded")),fi(t.foldable,"completed",va(this.element,qr(void 0,"cpl")));const i=e.createElement("div");i.classList.add(qr("h")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(qr("s")),i.appendChild(s),this.swatchElement=s;const r=e.createElement("div");if(r.classList.add(qr("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(qr("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}};function fB(n,e,t){const i=Ue(n/255,0,1),s=Ue(e/255,0,1),r=Ue(t/255,0,1),o=Math.max(i,s,r),l=Math.min(i,s,r),a=o-l;let u=0,h=0;const c=(l+o)/2;return a!==0&&(h=a/(1-Math.abs(o+l-1)),i===o?u=(s-r)/a:s===o?u=2+(r-i)/a:u=4+(i-s)/a,u=u/6+(u<0?1:0)),[u*360,h*100,c*100]}function _B(n,e,t){const i=(n%360+360)%360,s=Ue(e/100,0,1),r=Ue(t/100,0,1),o=(1-Math.abs(2*r-1))*s,l=o*(1-Math.abs(i/60%2-1)),a=r-o/2;let u,h,c;return i>=0&&i<60?[u,h,c]=[o,l,0]:i>=60&&i<120?[u,h,c]=[l,o,0]:i>=120&&i<180?[u,h,c]=[0,o,l]:i>=180&&i<240?[u,h,c]=[0,l,o]:i>=240&&i<300?[u,h,c]=[l,0,o]:[u,h,c]=[o,0,l],[(u+a)*255,(h+a)*255,(c+a)*255]}function wB(n,e,t){const i=Ue(n/255,0,1),s=Ue(e/255,0,1),r=Ue(t/255,0,1),o=Math.max(i,s,r),l=Math.min(i,s,r),a=o-l;let u;a===0?u=0:o===i?u=60*(((s-r)/a%6+6)%6):o===s?u=60*((r-i)/a+2):u=60*((i-s)/a+4);const h=o===0?0:a/o,c=o;return[u,h*100,c*100]}function vV(n,e,t){const i=G$(n,360),s=Ue(e/100,0,1),r=Ue(t/100,0,1),o=r*s,l=o*(1-Math.abs(i/60%2-1)),a=r-o;let u,h,c;return i>=0&&i<60?[u,h,c]=[o,l,0]:i>=60&&i<120?[u,h,c]=[l,o,0]:i>=120&&i<180?[u,h,c]=[0,o,l]:i>=180&&i<240?[u,h,c]=[0,l,o]:i>=240&&i<300?[u,h,c]=[l,0,o]:[u,h,c]=[o,0,l],[(u+a)*255,(h+a)*255,(c+a)*255]}function bB(n,e,t){const i=t+e*(100-Math.abs(2*t-100))/200;return[n,i!==0?e*(100-Math.abs(2*t-100))/i:0,t+e*(100-Math.abs(2*t-100))/(2*100)]}function gB(n,e,t){const i=100-Math.abs(t*(200-e)/100-100);return[n,i!==0?e*t/i:0,t*(200-e)/(2*100)]}function _i(n){return[n[0],n[1],n[2]]}function Od(n,e){return[n[0],n[1],n[2],e]}const CB={hsl:{hsl:(n,e,t)=>[n,e,t],hsv:bB,rgb:_B},hsv:{hsl:gB,hsv:(n,e,t)=>[n,e,t],rgb:vV},rgb:{hsl:fB,hsv:wB,rgb:(n,e,t)=>[n,e,t]}};function Yl(n,e){return[e==="float"?1:n==="rgb"?255:360,e==="float"?1:n==="rgb"?255:100,e==="float"?1:n==="rgb"?255:100]}function PB(n,e){return n===e?e:G$(n,e)}function fV(n,e,t){var i;const s=Yl(e,t);return[e==="rgb"?Ue(n[0],0,s[0]):PB(n[0],s[0]),Ue(n[1],0,s[1]),Ue(n[2],0,s[2]),Ue((i=n[3])!==null&&i!==void 0?i:1,0,1)]}function $0(n,e,t,i){const s=Yl(e,t),r=Yl(e,i);return n.map((o,l)=>o/s[l]*r[l])}function _V(n,e,t){const i=$0(n,e.mode,e.type,"int"),s=CB[e.mode][t.mode](...i);return $0(s,t.mode,"int",t.type)}let he=class wV{static black(){return new wV([0,0,0],"rgb")}constructor(e,t){this.type="int",this.mode=t,this.comps_=fV(e,t,this.type)}getComponents(e){return Od(_V(_i(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}};const Bs=te("colp");let yB=class{constructor(e,t){this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(Bs()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Bs("hsv"));const s=e.createElement("div");s.classList.add(Bs("sv")),this.svPaletteView_=t.svPaletteView,s.appendChild(this.svPaletteView_.element),i.appendChild(s);const r=e.createElement("div");r.classList.add(Bs("h")),this.hPaletteView_=t.hPaletteView,r.appendChild(this.hPaletteView_.element),i.appendChild(r),this.element.appendChild(i);const o=e.createElement("div");if(o.classList.add(Bs("rgb")),this.textsView_=t.textsView,o.appendChild(this.textsView_.element),this.element.appendChild(o),t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};const l=e.createElement("div");l.classList.add(Bs("a"));const a=e.createElement("div");a.classList.add(Bs("ap")),a.appendChild(this.alphaViews_.palette.element),l.appendChild(a);const u=e.createElement("div");u.classList.add(Bs("at")),u.appendChild(this.alphaViews_.text.element),l.appendChild(u),this.element.appendChild(l)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map(t=>t.inputElement)];return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}};function EB(n){return n==="int"?"int":n==="float"?"float":void 0}function g_(n){return Vt(n,e=>({color:e.optional.object({alpha:e.optional.boolean,type:e.optional.custom(EB)}),expanded:e.optional.boolean,picker:e.optional.custom(mV),readonly:e.optional.constant(!1)}))}function vo(n){return n?.1:1}function bV(n){var e;return(e=n.color)===null||e===void 0?void 0:e.type}let C_=class{constructor(e,t){this.type="float",this.mode=t,this.comps_=fV(e,t,this.type)}getComponents(e){return Od(_V(_i(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}};const xB={int:(n,e)=>new he(n,e),float:(n,e)=>new C_(n,e)};function P_(n,e,t){return xB[t](n,e)}function $B(n){return n.type==="float"}function VB(n){return n.type==="int"}function kB(n){const e=n.getComponents(),t=Yl(n.mode,"int");return new he([Math.round(ne(e[0],0,1,0,t[0])),Math.round(ne(e[1],0,1,0,t[1])),Math.round(ne(e[2],0,1,0,t[2])),e[3]],n.mode)}function SB(n){const e=n.getComponents(),t=Yl(n.mode,"int");return new C_([ne(e[0],0,t[0],0,1),ne(e[1],0,t[1],0,1),ne(e[2],0,t[2],0,1),e[3]],n.mode)}function Ot(n,e){if(n.type===e)return n;if(VB(n)&&e==="float")return SB(n);if($B(n)&&e==="int")return kB(n);throw mo.shouldNeverHappen()}function LB(n,e){return n.alpha===e.alpha&&n.mode===e.mode&&n.notation===e.notation&&n.type===e.type}function Fn(n,e){const t=n.match(/^(.+)%$/);return Math.min(t?parseFloat(t[1])*.01*e:parseFloat(n),e)}const AB={deg:n=>n,grad:n=>n*360/400,rad:n=>n*360/(2*Math.PI),turn:n=>n*360};function gV(n){const e=n.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(n);const t=parseFloat(e[1]),i=e[2];return AB[i](t)}function CV(n){const e=n.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Fn(e[1],255),Fn(e[2],255),Fn(e[3],255)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function MB(n){const e=CV(n);return e?new he(e,"rgb"):null}function PV(n){const e=n.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Fn(e[1],255),Fn(e[2],255),Fn(e[3],255),Fn(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function TB(n){const e=PV(n);return e?new he(e,"rgb"):null}function yV(n){const e=n.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[gV(e[1]),Fn(e[2],100),Fn(e[3],100)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function DB(n){const e=yV(n);return e?new he(e,"hsl"):null}function EV(n){const e=n.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[gV(e[1]),Fn(e[2],100),Fn(e[3],100),Fn(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function RB(n){const e=EV(n);return e?new he(e,"hsl"):null}function xV(n){const e=n.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];const t=n.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}function OB(n){const e=xV(n);return e?new he(e,"rgb"):null}function $V(n){const e=n.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),ne(parseInt(e[4]+e[4],16),0,255,0,1)];const t=n.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),ne(parseInt(t[4],16),0,255,0,1)]:null}function jB(n){const e=$V(n);return e?new he(e,"rgb"):null}function VV(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function V0(n){return e=>{const t=VV(e);return t?P_(t,"rgb",n):null}}function kV(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function k0(n){return e=>{const t=kV(e);return t?P_(t,"rgb",n):null}}const NB=[{parser:xV,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:$V,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:CV,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:PV,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:yV,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:EV,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:VV,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:kV,result:{alpha:!0,mode:"rgb",notation:"object"}}];function BB(n){return NB.reduce((e,{parser:t,result:i})=>e||(t(n)?i:null),null)}function IB(n,e="int"){const t=BB(n);return t?t.notation==="hex"&&e!=="float"?Object.assign(Object.assign({},t),{type:"int"}):t.notation==="func"?Object.assign(Object.assign({},t),{type:e}):null:null}function fh(n){const e=[OB,jB,MB,TB,DB,RB];n==="int"&&e.push(V0("int"),k0("int")),n==="float"&&e.push(V0("float"),k0("float"));const t=iB(e);return i=>{const s=t(i);return s?Ot(s,n):null}}function FB(n){const e=fh("int");if(typeof n!="string")return he.black();const t=e(n);return t??he.black()}function SV(n){const e=Ue(Math.floor(n),0,255).toString(16);return e.length===1?`0${e}`:e}function y_(n,e="#"){const t=_i(n.getComponents("rgb")).map(SV).join("");return`${e}${t}`}function E_(n,e="#"){const t=n.getComponents("rgb"),i=[t[0],t[1],t[2],t[3]*255].map(SV).join("");return`${e}${i}`}function LV(n){const e=an(0),t=Ot(n,"int");return`rgb(${_i(t.getComponents("rgb")).map(s=>e(s)).join(", ")})`}function bc(n){const e=an(2),t=an(0);return`rgba(${Ot(n,"int").getComponents("rgb").map((r,o)=>(o===3?e:t)(r)).join(", ")})`}function KB(n){const e=[an(0),Yc,Yc],t=Ot(n,"int");return`hsl(${_i(t.getComponents("hsl")).map((s,r)=>e[r](s)).join(", ")})`}function UB(n){const e=[an(0),Yc,Yc,an(2)];return`hsla(${Ot(n,"int").getComponents("hsl").map((s,r)=>e[r](s)).join(", ")})`}function AV(n,e){const t=an(e==="float"?2:0),i=["r","g","b"],s=Ot(n,e);return`{${_i(s.getComponents("rgb")).map((o,l)=>`${i[l]}: ${t(o)}`).join(", ")}}`}function HB(n){return e=>AV(e,n)}function MV(n,e){const t=an(2),i=an(e==="float"?2:0),s=["r","g","b","a"];return`{${Ot(n,e).getComponents("rgb").map((l,a)=>{const u=a===3?t:i;return`${s[a]}: ${u(l)}`}).join(", ")}}`}function zB(n){return e=>MV(e,n)}const qB=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:y_},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:E_},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:LV},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:bc},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:KB},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:UB},...["int","float"].reduce((n,e)=>[...n,{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:HB(e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:zB(e)}],[])];function TV(n){return qB.reduce((e,t)=>e||(LB(t.format,n)?t.stringifier:null),null)}const qa=te("apl");let GB=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(qa()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(qa("b")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(qa("c")),i.appendChild(s),this.colorElem_=s;const r=e.createElement("div");r.classList.add(qa("m")),this.element.appendChild(r),this.markerElem_=r;const o=e.createElement("div");o.classList.add(qa("p")),this.markerElem_.appendChild(o),this.previewElem_=o,this.update_()}update_(){const e=this.value.rawValue,t=e.getComponents("rgb"),i=new he([t[0],t[1],t[2],0],"rgb"),s=new he([t[0],t[1],t[2],255],"rgb"),r=["to right",bc(i),bc(s)];this.colorElem_.style.background=`linear-gradient(${r.join(",")})`,this.previewElem_.style.backgroundColor=bc(e);const o=ne(t[3],0,1,0,100);this.markerElem_.style.left=`${o}%`}onValueChange_(){this.update_()}},YB=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new GB(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new No(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=e.point.x/e.bounds.width,s=this.value.rawValue,[r,o,l]=s.getComponents("hsv");this.value.setRawValue(new he([r,o,l,i],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Zt(vo(!0),Es(e));if(t===0)return;const i=this.value.rawValue,[s,r,o,l]=i.getComponents("hsv");this.value.setRawValue(new he([s,r,o,l+t],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){Zt(vo(!0),Es(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const Qo=te("coltxt");function XB(n){const e=n.createElement("select"),t=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}];return e.appendChild(t.reduce((i,s)=>{const r=n.createElement("option");return r.textContent=s.text,r.value=s.value,i.appendChild(r),i},n.createDocumentFragment())),e}let WB=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Qo()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Qo("m")),this.modeElem_=XB(e),this.modeElem_.classList.add(Qo("ms")),i.appendChild(this.modeSelectElement),t.viewProps.bindDisabled(this.modeElem_);const s=e.createElement("div");s.classList.add(Qo("mm")),s.appendChild(Td(e,"dropdown")),i.appendChild(s),this.element.appendChild(i);const r=e.createElement("div");r.classList.add(Qo("w")),this.element.appendChild(r),this.inputsElem_=r,this.inputViews_=t.inputViews,this.applyInputViews_(),ps(t.mode,o=>{this.modeElem_.value=o})}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(e){this.inputViews_=e,this.applyInputViews_()}applyInputViews_(){tV(this.inputsElem_);const e=this.element.ownerDocument;this.inputViews_.forEach(t=>{const i=e.createElement("div");i.classList.add(Qo("c")),i.appendChild(t.element),this.inputsElem_.appendChild(i)})}};function ZB(n){return an(n==="float"?2:0)}function QB(n,e,t){const i=Yl(n,e)[t];return new Ad({min:0,max:i})}function JB(n,e,t){return new mh(n,{arrayPosition:t===0?"fst":t===2?"lst":"mid",parser:e.parser,props:we.fromObject({formatter:ZB(e.colorType),keyScale:vo(!1),pointerScale:e.colorType==="float"?.01:1}),value:ot(0,{constraint:QB(e.colorMode,e.colorType,t)}),viewProps:e.viewProps})}function eI(n,e){const t={colorMode:e.colorMode,colorType:e.colorType,parser:Lr,viewProps:e.viewProps};return[0,1,2].map(i=>{const s=JB(n,t,i);return fa({primary:e.value,secondary:s.value,forward(r){return Ot(r,e.colorType).getComponents(e.colorMode)[i]},backward(r,o){const l=e.colorMode,u=Ot(r,e.colorType).getComponents(l);u[i]=o;const h=P_(Od(_i(u),u[3]),l,e.colorType);return Ot(h,"int")}}),s})}function tI(n,e){const t=new b_(n,{parser:fh("int"),props:we.fromObject({formatter:y_}),value:ot(he.black()),viewProps:e.viewProps});return fa({primary:e.value,secondary:t.value,forward:i=>new he(_i(i.getComponents()),i.mode),backward:(i,s)=>new he(Od(_i(s.getComponents(i.mode)),i.getComponents()[3]),i.mode)}),[t]}function nI(n){return n!=="hex"}let iI=class{constructor(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=t.colorType,this.value=t.value,this.viewProps=t.viewProps,this.colorMode=ot(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new WB(e,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const t=this.colorMode.rawValue;return nI(t)?eI(e,{colorMode:t,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):tI(e,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(e){const t=e.currentTarget;this.colorMode.rawValue=t.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map(i=>i.view)}};const sm=te("hpl");let sI=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(sm()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(sm("c")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(sm("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=this.value.rawValue,[t]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=LV(new he([t,100,100],"hsv"));const i=ne(t,0,360,0,100);this.markerElem_.style.left=`${i}%`}onValueChange_(){this.update_()}},rI=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new sI(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new No(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=ne(Ue(e.point.x,0,e.bounds.width),0,e.bounds.width,0,360),s=this.value.rawValue,[,r,o,l]=s.getComponents("hsv");this.value.setRawValue(new he([i,r,o,l],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Zt(vo(!1),Es(e));if(t===0)return;const i=this.value.rawValue,[s,r,o,l]=i.getComponents("hsv");this.value.setRawValue(new he([s+t,r,o,l],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){Zt(vo(!1),Es(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const rm=te("svp"),S0=64;let oI=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(rm()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("canvas");i.height=S0,i.width=S0,i.classList.add(rm("c")),this.element.appendChild(i),this.canvasElement=i;const s=e.createElement("div");s.classList.add(rm("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=wN(this.canvasElement);if(!e)return;const i=this.value.rawValue.getComponents("hsv"),s=this.canvasElement.width,r=this.canvasElement.height,o=e.getImageData(0,0,s,r),l=o.data;for(let h=0;h<r;h++)for(let c=0;c<s;c++){const p=ne(c,0,s,0,100),d=ne(h,0,r,100,0),m=vV(i[0],p,d),f=(h*s+c)*4;l[f]=m[0],l[f+1]=m[1],l[f+2]=m[2],l[f+3]=255}e.putImageData(o,0,0);const a=ne(i[1],0,100,0,100);this.markerElem_.style.left=`${a}%`;const u=ne(i[2],0,100,100,0);this.markerElem_.style.top=`${u}%`}onValueChange_(){this.update_()}},lI=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new oI(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new No(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=ne(e.point.x,0,e.bounds.width,0,100),s=ne(e.point.y,0,e.bounds.height,100,0),[r,,,o]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new he([r,i,s,o],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){dV(e.key)&&e.preventDefault();const[t,i,s,r]=this.value.rawValue.getComponents("hsv"),o=vo(!1),l=Zt(o,Es(e)),a=Zt(o,Su(e));l===0&&a===0||this.value.setRawValue(new he([t,i+l,s+a,r],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){const t=vo(!1),i=Zt(t,Es(e)),s=Zt(t,Su(e));i===0&&s===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},aI=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.hPaletteC_=new rI(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new lI(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=t.supportsAlpha?{palette:new YB(e,{value:this.value,viewProps:this.viewProps}),text:new mh(e,{parser:Lr,props:we.fromObject({pointerScale:.01,keyScale:.1,formatter:an(2)}),value:ot(0,{constraint:new Ad({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&fa({primary:this.value,secondary:this.alphaIcs_.text.value,forward:i=>i.getComponents()[3],backward:(i,s)=>{const r=i.getComponents();return r[3]=s,new he(r,i.mode)}}),this.textsC_=new iI(e,{colorType:t.colorType,value:this.value,viewProps:this.viewProps}),this.view=new yB(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}};const om=te("colsw");let uI=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(om()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(om("sw")),this.element.appendChild(i),this.swatchElem_=i;const s=e.createElement("button");s.classList.add(om("b")),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s,this.update_()}update_(){const e=this.value.rawValue;this.swatchElem_.style.backgroundColor=E_(e)}onValueChange_(){this.update_()}},hI=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new uI(e,{value:this.value,viewProps:this.viewProps})}},x_=class{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=m_.create(t.expanded),this.swatchC_=new hI(e,{value:this.value,viewProps:this.viewProps});const i=this.swatchC_.view.buttonElement;i.addEventListener("blur",this.onButtonBlur_),i.addEventListener("click",this.onButtonClick_),this.textC_=new b_(e,{parser:t.parser,props:we.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new vB(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=t.pickerLayout==="popup"?new uV(e,{viewProps:this.viewProps}):null;const s=new aI(e,{colorType:t.colorType,supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});s.view.allFocusableElements.forEach(r=>{r.addEventListener("blur",this.onPopupChildBlur_),r.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=s,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(s.view.element),fa({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:r=>r,backward:(r,o)=>o})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),v_(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=nV(e);i&&t.contains(i)||i&&i===this.swatchC_.view.buttonElement&&!a_(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}};function cI(n){return _i(n.getComponents("rgb")).reduce((e,t)=>e<<8|Math.floor(t)&255,0)}function dI(n){return n.getComponents("rgb").reduce((e,t,i)=>{const s=Math.floor(i===3?t*255:t)&255;return e<<8|s},0)>>>0}function pI(n){return new he([n>>16&255,n>>8&255,n&255],"rgb")}function mI(n){return new he([n>>24&255,n>>16&255,n>>8&255,ne(n&255,0,255,0,1)],"rgb")}function vI(n){return typeof n!="number"?he.black():pI(n)}function fI(n){return typeof n!="number"?he.black():mI(n)}function gc(n,e){return typeof n!="object"||Le(n)?!1:e in n&&typeof n[e]=="number"}function $_(n){return gc(n,"r")&&gc(n,"g")&&gc(n,"b")}function V_(n){return $_(n)&&gc(n,"a")}function k_(n){return $_(n)}function S_(n,e){if(n.mode!==e.mode||n.type!==e.type)return!1;const t=n.getComponents(),i=e.getComponents();for(let s=0;s<t.length;s++)if(t[s]!==i[s])return!1;return!0}function L0(n){return"a"in n?[n.r,n.g,n.b,n.a]:[n.r,n.g,n.b]}function _I(n){const e=TV(n);return e?(t,i)=>{vh(t,e(i))}:null}function wI(n){const e=n?dI:cI;return(t,i)=>{vh(t,e(i))}}function bI(n,e,t){const s=Ot(e,t).toRgbaObject();n.writeProperty("r",s.r),n.writeProperty("g",s.g),n.writeProperty("b",s.b),n.writeProperty("a",s.a)}function gI(n,e,t){const s=Ot(e,t).toRgbaObject();n.writeProperty("r",s.r),n.writeProperty("g",s.g),n.writeProperty("b",s.b)}function CI(n,e){return(t,i)=>{n?bI(t,i,e):gI(t,i,e)}}function PI(n){var e;return!!(!((e=n?.color)===null||e===void 0)&&e.alpha)}function yI(n){return n?e=>E_(e,"0x"):e=>y_(e,"0x")}function EI(n){return"color"in n||n.view==="color"}Gt({id:"input-color-number",type:"input",accept:(n,e)=>{if(typeof n!="number"||!EI(e))return null;const t=g_(e);return t?{initialValue:n,params:Object.assign(Object.assign({},t),{supportsAlpha:PI(e)})}:null},binding:{reader:n=>n.params.supportsAlpha?fI:vI,equals:S_,writer:n=>wI(n.params.supportsAlpha)},controller:n=>{var e,t;return new x_(n.document,{colorType:"int",expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:yI(n.params.supportsAlpha),parser:fh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.supportsAlpha,value:n.value,viewProps:n.viewProps})}});function xI(n,e){if(!k_(n))return Ot(he.black(),e);if(e==="int"){const t=L0(n);return new he(t,"rgb")}if(e==="float"){const t=L0(n);return new C_(t,"rgb")}return Ot(he.black(),"int")}function $I(n){return V_(n)}function VI(n){return e=>{const t=xI(e,n);return Ot(t,"int")}}function kI(n,e){return t=>n?MV(t,e):AV(t,e)}Gt({id:"input-color-object",type:"input",accept:(n,e)=>{var t;if(!k_(n))return null;const i=g_(e);return i?{initialValue:n,params:Object.assign(Object.assign({},i),{colorType:(t=bV(e))!==null&&t!==void 0?t:"int"})}:null},binding:{reader:n=>VI(n.params.colorType),equals:S_,writer:n=>CI($I(n.initialValue),n.params.colorType)},controller:n=>{var e,t;const i=V_(n.initialValue);return new x_(n.document,{colorType:n.params.colorType,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:kI(i,n.params.colorType),parser:fh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:i,value:n.value,viewProps:n.viewProps})}});Gt({id:"input-color-string",type:"input",accept:(n,e)=>{if(typeof n!="string"||e.view==="text")return null;const t=IB(n,bV(e));if(!t)return null;const i=TV(t);if(!i)return null;const s=g_(e);return s?{initialValue:n,params:Object.assign(Object.assign({},s),{format:t,stringifier:i})}:null},binding:{reader:()=>FB,equals:S_,writer:n=>{const e=_I(n.params.format);if(!e)throw mo.notBindable();return e}},controller:n=>{var e,t;return new x_(n.document,{colorType:n.params.format.type,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:n.params.stringifier,parser:fh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.format.alpha,value:n.value,viewProps:n.viewProps})}});let L_=class{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map((i,s)=>{var r,o;return(o=(r=this.components[s])===null||r===void 0?void 0:r.constrain(i))!==null&&o!==void 0?o:i});return this.asm_.fromComponents(t)}};const A0=te("pndtxt");let SI=class{constructor(e,t){this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add(A0()),this.textViews.forEach(i=>{const s=e.createElement("div");s.classList.add(A0("a")),s.appendChild(i.element),this.element.appendChild(s)})}};function LI(n,e,t){return new mh(n,{arrayPosition:t===0?"fst":t===e.axes.length-1?"lst":"mid",parser:e.parser,props:e.axes[t].textProps,value:ot(0,{constraint:e.axes[t].constraint}),viewProps:e.viewProps})}let A_=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map((i,s)=>LI(e,t,s)),this.acs_.forEach((i,s)=>{fa({primary:this.value,secondary:i.value,forward:r=>t.assembly.toComponents(r)[s],backward:(r,o)=>{const l=t.assembly.toComponents(r);return l[s]=o,t.assembly.fromComponents(l)}})}),this.view=new SI(e,{textViews:this.acs_.map(i=>i.view)})}get textControllers(){return this.acs_}},AI=class extends l_{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(e){this.controller.valueController.sliderController.props.set("max",e)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(e){this.controller.valueController.sliderController.props.set("min",e)}};function MI(n,e){const t=[],i=X$(n,e);i&&t.push(i);const s=W$(n);s&&t.push(s);const r=w_(n.options);return r&&t.push(r),new ph(t)}Gt({id:"input-number",type:"input",accept:(n,e)=>{if(typeof n!="number")return null;const t=Vt(e,i=>Object.assign(Object.assign({},Q$(i)),{options:i.optional.custom(Rd),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>q$,constraint:n=>MI(n.params,n.initialValue),writer:n=>vh},controller:n=>{const e=n.value,t=n.constraint,i=t&&Gc(t,Dd);if(i)return new Gl(n.document,{props:new we({options:i.values.value("options")}),value:e,viewProps:n.viewProps});const s=Z$(n.params,e.rawValue),r=t&&Gc(t,Ad);return r?new x0(n.document,Object.assign(Object.assign({},hB(Object.assign(Object.assign({},s),{keyScale:ot(s.keyScale),max:r.values.value("max"),min:r.values.value("min")}))),{parser:Lr,value:e,viewProps:n.viewProps})):new mh(n.document,{parser:Lr,props:we.fromObject(s),value:e,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="number"?null:n.controller.valueController instanceof x0?new AI(n.controller):n.controller.valueController instanceof Gl?new __(n.controller):null}});let ms=class{constructor(e=0,t=0){this.x=e,this.y=t}getComponents(){return[this.x,this.y]}static isObject(e){if(Le(e))return!1;const t=e.x,i=e.y;return!(typeof t!="number"||typeof i!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y}toObject(){return{x:this.x,y:this.y}}};const DV={toComponents:n=>n.getComponents(),fromComponents:n=>new ms(...n)},Jo=te("p2d");let TI=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Jo()),t.viewProps.bindClassModifiers(this.element),ps(t.expanded,va(this.element,Jo(void 0,"expanded")));const i=e.createElement("div");i.classList.add(Jo("h")),this.element.appendChild(i);const s=e.createElement("button");s.classList.add(Jo("b")),s.appendChild(Td(e,"p2dpad")),t.viewProps.bindDisabled(s),i.appendChild(s),this.buttonElement=s;const r=e.createElement("div");if(r.classList.add(Jo("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(Jo("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}};const Is=te("p2dp");let DI=class{constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=e.createElement("div"),this.element.classList.add(Is()),t.layout==="popup"&&this.element.classList.add(Is(void 0,"p")),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Is("p")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.padElement=i;const s=e.createElementNS(ui,"svg");s.classList.add(Is("g")),this.padElement.appendChild(s),this.svgElem_=s;const r=e.createElementNS(ui,"line");r.classList.add(Is("ax")),r.setAttributeNS(null,"x1","0"),r.setAttributeNS(null,"y1","50%"),r.setAttributeNS(null,"x2","100%"),r.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(r);const o=e.createElementNS(ui,"line");o.classList.add(Is("ax")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","0"),o.setAttributeNS(null,"x2","50%"),o.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(o);const l=e.createElementNS(ui,"line");l.classList.add(Is("l")),l.setAttributeNS(null,"x1","50%"),l.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(l),this.lineElem_=l;const a=e.createElement("div");a.classList.add(Is("m")),this.padElement.appendChild(a),this.markerElem_=a,t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,t]=this.value.rawValue.getComponents(),i=this.props_.get("max"),s=ne(e,-i,+i,0,100),r=ne(t,-i,+i,0,100),o=this.props_.get("invertsY")?100-r:r;this.lineElem_.setAttributeNS(null,"x2",`${s}%`),this.lineElem_.setAttributeNS(null,"y2",`${o}%`),this.markerElem_.style.left=`${s}%`,this.markerElem_.style.top=`${o}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}};function M0(n,e,t){return[Zt(e[0],Es(n)),Zt(e[1],Su(n))*(t?1:-1)]}let RI=class{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new DI(e,{layout:t.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new No(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=this.props.get("max"),s=ne(e.point.x,0,e.bounds.width,-i,+i),r=ne(this.props.get("invertsY")?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-i,+i);this.value.setRawValue(new ms(s,r),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onPadKeyDown_(e){dV(e.key)&&e.preventDefault();const[t,i]=M0(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(new ms(this.value.rawValue.x+t,this.value.rawValue.y+i),{forceEmit:!1,last:!1})}onPadKeyUp_(e){const[t,i]=M0(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},OI=class{constructor(e,t){var i,s;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=m_.create(t.expanded),this.popC_=t.pickerLayout==="popup"?new uV(e,{viewProps:this.viewProps}):null;const r=new RI(e,{layout:t.pickerLayout,props:new we({invertsY:ot(t.invertsY),max:ot(t.max),xKeyScale:t.axes[0].textProps.value("keyScale"),yKeyScale:t.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});r.view.allFocusableElements.forEach(o=>{o.addEventListener("blur",this.onPopupChildBlur_),o.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=r,this.textC_=new A_(e,{assembly:DV,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new TI(e,{expanded:this.foldable_.value("expanded"),pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(i=this.view.buttonElement)===null||i===void 0||i.addEventListener("blur",this.onPadButtonBlur_),(s=this.view.buttonElement)===null||s===void 0||s.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),fa({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:o=>o,backward:(o,l)=>l})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),v_(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=nV(e);i&&t.contains(i)||i&&i===this.view.buttonElement&&!a_(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.view.buttonElement.focus()}};function jI(n){return ms.isObject(n)?new ms(n.x,n.y):new ms}function NI(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y)}function BI(n,e){return new L_({assembly:DV,components:[rs(Object.assign(Object.assign({},n),n.x),e.x),rs(Object.assign(Object.assign({},n),n.y),e.y)]})}function T0(n,e){var t,i;if(!Le(n.min)||!Le(n.max))return Math.max(Math.abs((t=n.min)!==null&&t!==void 0?t:0),Math.abs((i=n.max)!==null&&i!==void 0?i:0));const s=Y$(n);return Math.max(Math.abs(s)*10,Math.abs(e)*10)}function II(n,e){var t,i;const s=T0(po(n,(t=n.x)!==null&&t!==void 0?t:{}),e.x),r=T0(po(n,(i=n.y)!==null&&i!==void 0?i:{}),e.y);return Math.max(s,r)}function FI(n){if(!("y"in n))return!1;const e=n.y;return e&&"inverted"in e?!!e.inverted:!1}Gt({id:"input-point2d",type:"input",accept:(n,e)=>{if(!ms.isObject(n))return null;const t=Vt(e,i=>Object.assign(Object.assign({},Lu(i)),{expanded:i.optional.boolean,picker:i.optional.custom(mV),readonly:i.optional.constant(!1),x:i.optional.custom(dr),y:i.optional.object(Object.assign(Object.assign({},Lu(i)),{inverted:i.optional.boolean}))}));return t?{initialValue:n,params:t}:null},binding:{reader:()=>jI,constraint:n=>BI(n.params,n.initialValue),equals:ms.equals,writer:()=>NI},controller:n=>{var e,t;const i=n.document,s=n.value,r=n.constraint,o=[n.params.x,n.params.y];return new OI(i,{axes:s.rawValue.getComponents().map((l,a)=>{var u;return r_({constraint:r.components[a],initialValue:l,params:po(n.params,(u=o[a])!==null&&u!==void 0?u:{})})}),expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,invertsY:FI(n.params),max:II(n.params,s.rawValue),parser:Lr,pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",value:s,viewProps:n.viewProps})}});let so=class{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if(Le(e))return!1;const t=e.x,i=e.y,s=e.z;return!(typeof t!="number"||typeof i!="number"||typeof s!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}};const RV={toComponents:n=>n.getComponents(),fromComponents:n=>new so(...n)};function KI(n){return so.isObject(n)?new so(n.x,n.y,n.z):new so}function UI(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z)}function HI(n,e){return new L_({assembly:RV,components:[rs(Object.assign(Object.assign({},n),n.x),e.x),rs(Object.assign(Object.assign({},n),n.y),e.y),rs(Object.assign(Object.assign({},n),n.z),e.z)]})}Gt({id:"input-point3d",type:"input",accept:(n,e)=>{if(!so.isObject(n))return null;const t=Vt(e,i=>Object.assign(Object.assign({},Lu(i)),{readonly:i.optional.constant(!1),x:i.optional.custom(dr),y:i.optional.custom(dr),z:i.optional.custom(dr)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>KI,constraint:n=>HI(n.params,n.initialValue),equals:so.equals,writer:n=>UI},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z];return new A_(n.document,{assembly:RV,axes:e.rawValue.getComponents().map((s,r)=>{var o;return r_({constraint:t.components[r],initialValue:s,params:po(n.params,(o=i[r])!==null&&o!==void 0?o:{})})}),parser:Lr,value:e,viewProps:n.viewProps})}});let ro=class{constructor(e=0,t=0,i=0,s=0){this.x=e,this.y=t,this.z=i,this.w=s}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if(Le(e))return!1;const t=e.x,i=e.y,s=e.z,r=e.w;return!(typeof t!="number"||typeof i!="number"||typeof s!="number"||typeof r!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}};const OV={toComponents:n=>n.getComponents(),fromComponents:n=>new ro(...n)};function zI(n){return ro.isObject(n)?new ro(n.x,n.y,n.z,n.w):new ro}function qI(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z),n.writeProperty("w",e.w)}function GI(n,e){return new L_({assembly:OV,components:[rs(Object.assign(Object.assign({},n),n.x),e.x),rs(Object.assign(Object.assign({},n),n.y),e.y),rs(Object.assign(Object.assign({},n),n.z),e.z),rs(Object.assign(Object.assign({},n),n.w),e.w)]})}Gt({id:"input-point4d",type:"input",accept:(n,e)=>{if(!ro.isObject(n))return null;const t=Vt(e,i=>Object.assign(Object.assign({},Lu(i)),{readonly:i.optional.constant(!1),w:i.optional.custom(dr),x:i.optional.custom(dr),y:i.optional.custom(dr),z:i.optional.custom(dr)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>zI,constraint:n=>GI(n.params,n.initialValue),equals:ro.equals,writer:n=>qI},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z,n.params.w];return new A_(n.document,{assembly:OV,axes:e.rawValue.getComponents().map((s,r)=>{var o;return r_({constraint:t.components[r],initialValue:s,params:po(n.params,(o=i[r])!==null&&o!==void 0?o:{})})}),parser:Lr,value:e,viewProps:n.viewProps})}});function YI(n){const e=[],t=w_(n.options);return t&&e.push(t),new ph(e)}Gt({id:"input-string",type:"input",accept:(n,e)=>{if(typeof n!="string")return null;const t=Vt(e,i=>({readonly:i.optional.constant(!1),options:i.optional.custom(Rd)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>cV,constraint:n=>YI(n.params),writer:n=>vh},controller:n=>{const e=n.document,t=n.value,i=n.constraint,s=i&&Gc(i,Dd);return s?new Gl(e,{props:new we({options:s.values.value("options")}),value:t,viewProps:n.viewProps}):new b_(e,{parser:r=>r,props:we.fromObject({formatter:Vv}),value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="string"?null:n.controller.valueController instanceof Gl?new __(n.controller):null}});const jd={monitor:{defaultInterval:200,defaultRows:3}},D0=te("mll");let XI=class{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(D0()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("textarea");i.classList.add(D0("i")),i.style.height=`calc(var(${pV("containerUnitSize")}) * ${t.rows})`,i.readOnly=!0,t.viewProps.bindDisabled(i),this.element.appendChild(i),this.textareaElem_=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.textareaElem_,t=e.scrollTop===e.scrollHeight-e.clientHeight,i=[];this.value.rawValue.forEach(s=>{s!==void 0&&i.push(this.formatter_(s))}),e.textContent=i.join(`
`),t&&(e.scrollTop=e.scrollHeight)}onValueUpdate_(){this.update_()}},M_=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new XI(e,{formatter:t.formatter,rows:t.rows,value:this.value,viewProps:this.viewProps})}};const R0=te("sgl");let WI=class{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(R0()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(R0("i")),i.readOnly=!0,i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.value.rawValue,t=e[e.length-1];this.inputElement.value=t!==void 0?this.formatter_(t):""}onValueUpdate_(){this.update_()}},T_=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new WI(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}};Gt({id:"monitor-bool",type:"monitor",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=Vt(e,i=>({readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>hV},controller:n=>{var e;return n.value.rawValue.length===1?new T_(n.document,{formatter:E0,value:n.value,viewProps:n.viewProps}):new M_(n.document,{formatter:E0,rows:(e=n.params.rows)!==null&&e!==void 0?e:jd.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}});let ZI=class extends l_{get max(){return this.controller.valueController.props.get("max")}set max(e){this.controller.valueController.props.set("max",e)}get min(){return this.controller.valueController.props.get("min")}set min(e){this.controller.valueController.props.set("min",e)}};const Fs=te("grl");let QI=class{constructor(e,t){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Fs()),t.viewProps.bindClassModifiers(this.element),this.formatter_=t.formatter,this.props_=t.props,this.cursor_=t.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const i=e.createElementNS(ui,"svg");i.classList.add(Fs("g")),i.style.height=`calc(var(${pV("containerUnitSize")}) * ${t.rows})`,this.element.appendChild(i),this.svgElem_=i;const s=e.createElementNS(ui,"polyline");this.svgElem_.appendChild(s),this.lineElem_=s;const r=e.createElement("div");r.classList.add(Fs("t"),te("tt")()),this.element.appendChild(r),this.tooltipElem_=r,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const e=this.svgElem_.getBoundingClientRect(),t=this.value.rawValue.length-1,i=this.props_.get("min"),s=this.props_.get("max"),r=[];this.value.rawValue.forEach((h,c)=>{if(h===void 0)return;const p=ne(c,0,t,0,e.width),d=ne(h,i,s,e.height,0);r.push([p,d].join(","))}),this.lineElem_.setAttributeNS(null,"points",r.join(" "));const o=this.tooltipElem_,l=this.value.rawValue[this.cursor_.rawValue];if(l===void 0){o.classList.remove(Fs("t","a"));return}const a=ne(this.cursor_.rawValue,0,t,0,e.width),u=ne(l,i,s,e.height,0);o.style.left=`${a}px`,o.style.top=`${u}px`,o.textContent=`${this.formatter_(l)}`,o.classList.contains(Fs("t","a"))||(o.classList.add(Fs("t","a"),Fs("t","in")),qc(o),o.classList.remove(Fs("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}},jV=class{constructor(e,t){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.cursor_=ot(-1),this.view=new QI(e,{cursor:this.cursor_,formatter:t.formatter,rows:t.rows,props:this.props,value:this.value,viewProps:this.viewProps}),!a_(e))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const i=new No(this.view.element);i.emitter.on("down",this.onGraphPointerDown_),i.emitter.on("move",this.onGraphPointerMove_),i.emitter.on("up",this.onGraphPointerUp_)}}importProps(e){return Di(e,null,t=>({max:t.required.number,min:t.required.number}),t=>(this.props.set("max",t.max),this.props.set("min",t.min),!0))}exportProps(){return Ri(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(e){const t=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(ne(e.offsetX,0,t.width,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){if(!e.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(ne(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}};function kv(n){return Le(n.format)?an(2):n.format}function JI(n){var e;return n.value.rawValue.length===1?new T_(n.document,{formatter:kv(n.params),value:n.value,viewProps:n.viewProps}):new M_(n.document,{formatter:kv(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:jd.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}function eF(n){var e,t,i;return new jV(n.document,{formatter:kv(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:jd.monitor.defaultRows,props:we.fromObject({max:(t=n.params.max)!==null&&t!==void 0?t:100,min:(i=n.params.min)!==null&&i!==void 0?i:0}),value:n.value,viewProps:n.viewProps})}function O0(n){return n.view==="graph"}Gt({id:"monitor-number",type:"monitor",accept:(n,e)=>{if(typeof n!="number")return null;const t=Vt(e,i=>({format:i.optional.function,max:i.optional.number,min:i.optional.number,readonly:i.required.constant(!0),rows:i.optional.number,view:i.optional.string}));return t?{initialValue:n,params:t}:null},binding:{defaultBufferSize:n=>O0(n)?64:1,reader:n=>q$},controller:n=>O0(n.params)?eF(n):JI(n),api:n=>n.controller.valueController instanceof jV?new ZI(n.controller):null});Gt({id:"monitor-string",type:"monitor",accept:(n,e)=>{if(typeof n!="string")return null;const t=Vt(e,i=>({multiline:i.optional.boolean,readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>cV},controller:n=>{var e;const t=n.value;return t.rawValue.length>1||n.params.multiline?new M_(n.document,{formatter:Vv,rows:(e=n.params.rows)!==null&&e!==void 0?e:jd.monitor.defaultRows,value:t,viewProps:n.viewProps}):new T_(n.document,{formatter:Vv,value:t,viewProps:n.viewProps})}});const Xc={baseBackgroundColor:"hsl(230, 7%, 17%)",baseBorderRadius:"6px",baseFontFamily:"Roboto Mono, Source Code Pro, Menlo, Courier, monospace",baseShadowColor:"rgba(0, 0, 0, 0.2)",bladeBorderRadius:"2px",bladeHorizontalPadding:"4px",bladeValueWidth:"160px",buttonBackgroundColor:"hsl(230, 7%, 70%)",buttonBackgroundColorActive:"#d6d7db",buttonBackgroundColorFocus:"#c8cad0",buttonBackgroundColorHover:"#bbbcc4",buttonForegroundColor:"hsl(230, 7%, 17%)",containerBackgroundColor:"rgba(187, 188, 196, 0.1)",containerBackgroundColorActive:"rgba(187, 188, 196, 0.25)",containerBackgroundColorFocus:"rgba(187, 188, 196, 0.2)",containerBackgroundColorHover:"rgba(187, 188, 196, 0.15)",containerForegroundColor:"hsl(230, 7%, 75%)",containerHorizontalPadding:"4px",containerUnitSize:"20px",containerUnitSpacing:"4px",containerVerticalPadding:"4px",grooveForegroundColor:"rgba(187, 188, 196, 0.1)",inputBackgroundColor:"rgba(187, 188, 196, 0.1)",inputBackgroundColorActive:"rgba(187, 188, 196, 0.25)",inputBackgroundColorFocus:"rgba(187, 188, 196, 0.2)",inputBackgroundColorHover:"rgba(187, 188, 196, 0.15)",inputForegroundColor:"hsl(230, 7%, 75%)",labelForegroundColor:"rgba(187, 188, 196, 0.7)",monitorBackgroundColor:"rgba(0, 0, 0, 0.2)",monitorForegroundColor:"rgba(187, 188, 196, 0.7)",pluginImageDraggingColor:"hsla(230, 100%, 66%, 1)"};Object.keys(Xc).reduce((n,e)=>(n[e]=e,n),{});const tF=new Map([["baseBackgroundColor","--tp-base-background-color"],["baseBorderRadius","--tp-base-border-radius"],["baseFontFamily","--tp-base-font-family"],["baseShadowColor","--tp-base-shadow-color"],["bladeBorderRadius","--tp-blade-border-radius"],["bladeHorizontalPadding","--tp-blade-horizontal-padding"],["bladeValueWidth","--tp-blade-value-width"],["buttonBackgroundColor","--tp-button-background-color"],["buttonBackgroundColorActive","--tp-button-background-color-active"],["buttonBackgroundColorFocus","--tp-button-background-color-focus"],["buttonBackgroundColorHover","--tp-button-background-color-hover"],["buttonForegroundColor","--tp-button-foreground-color"],["containerBackgroundColor","--tp-container-background-color"],["containerBackgroundColorActive","--tp-container-background-color-active"],["containerBackgroundColorFocus","--tp-container-background-color-focus"],["containerBackgroundColorHover","--tp-container-background-color-hover"],["containerForegroundColor","--tp-container-foreground-color"],["containerHorizontalPadding","--tp-container-horizontal-padding"],["containerUnitSize","--tp-container-unit-size"],["containerUnitSpacing","--tp-container-unit-spacing"],["containerVerticalPadding","--tp-container-vertical-padding"],["grooveForegroundColor","--tp-groove-foreground-color"],["inputBackgroundColor","--tp-input-background-color"],["inputBackgroundColorActive","--tp-input-background-color-active"],["inputBackgroundColorFocus","--tp-input-background-color-focus"],["inputBackgroundColorHover","--tp-input-background-color-hover"],["inputForegroundColor","--tp-input-foreground-color"],["labelForegroundColor","--tp-label-foreground-color"],["monitorBackgroundColor","--tp-monitor-background-color"],["monitorForegroundColor","--tp-monitor-foreground-color"],["pluginImageDraggingColor","--tp-plugin-image-dragging-color"]]);function Sv(n){if(n!==void 0){if(typeof n=="string")return n;if(V_(n))return`rgba(${n.r}, ${n.g}, ${n.b}, ${n.a})`;if($_(n))return`rgb(${n.r}, ${n.g}, ${n.b})`;throw new Error(`Unknown CSS theme value object: ${n}`)}}function j0(n){if(n.startsWith("--tp-"))return n;{const e=tF.get(n);if(e)return e;throw new Error(`Unknown Tweakpane CSS theme map variable key: "${n}"`)}}function N0(n,e){return n===void 0||n[e]===void 0?Sv(Xc[e]):Sv(n[e])}function nF(n,e){const t=_N().documentElement;if(e===void 0)for(const i of Object.keys(Xc)){const s=j0(i);n.style.getPropertyValue(s).length>0&&n.style.removeProperty(s)}else for(const[i,s]of Object.entries(e)){const r=j0(i),o=Sv(s),l=Xc[i]||void 0,a=t.style.getPropertyValue(r)||void 0;e!==void 0&&o!==void 0&&(a&&o!==a||!1||!a&&(l&&o!==l||!1))?n.style.setProperty(r,o):n.style.getPropertyValue(r).length>0&&n.style.removeProperty(r)}}function B0(n){let e,t=`${n[0]}px`;return{c(){e=rn("div"),this.h()},l(i){e=on(i,"DIV",{}),ln(e).forEach(E),this.h()},h(){Pe(e,"background",null),Pe(e,"height",t)},m(i,s){O(i,e,s)},p(i,s){s&1&&t!==(t=`${i[0]}px`)&&Pe(e,"height",t)},d(i){i&&E(e)}}}function iF(n){let e,t=n[0]>0&&B0(n);return{c(){t&&t.c(),e=R()},l(i){t&&t.l(i),e=R()},m(i,s){t&&t.m(i,s),O(i,e,s)},p(i,[s]){i[0]>0?t?t.p(i,s):(t=B0(i),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:nt,o:nt,d(i){i&&E(e),t&&t.d(i)}}}function I0(n){return Number.parseFloat(n.replace("px",""))}function sF(n,e,t){let i,{theme:s=void 0}=e,{keysAdd:r=[]}=e,{keysSubtract:o=[]}=e,{extra:l=void 0}=e;function a(u,h,c=0){return u.reduce((p,d)=>p+=I0(N0(s,d)),0)-h.reduce((p,d)=>p+=I0(N0(s,d)),0)+c}return n.$$set=u=>{"theme"in u&&t(1,s=u.theme),"keysAdd"in u&&t(2,r=u.keysAdd),"keysSubtract"in u&&t(3,o=u.keysSubtract),"extra"in u&&t(4,l=u.extra)},n.$$.update=()=>{n.$$.dirty&28&&t(0,i=a(r,o,l))},[i,s,r,o,l]}class Ir extends Je{constructor(e){super(),et(this,e,sF,iF,Qe,{theme:1,keysAdd:2,keysSubtract:3,extra:4})}}function D_(n){return n.constructor.name==="Pane"}function lm(n,e,t){return Math.min(Math.max(n,e),t)}function R_(n){let e=0,t=n;for(;(t=t.previousElementSibling)!==null;)e++;return e}function Ar(n,...e){for(const t of e)t in n&&delete n[t];return n}function F0(n){console.log(n.detail),n.isTrusted&&n.stopPropagation()}function NV(n,e,t,i){if(e){const s=e.querySelector(`.${t}`);if(s!==void 0){const r=i?e.querySelector(`.${i}`):void 0;n?(s.removeEventListener("click",F0,{capture:!0}),s.style.cursor="pointer",r&&(r.style.display="block")):(s.addEventListener("click",F0,{capture:!0}),s.style.cursor="default",r&&(r.style.display="none"))}}else console.warn(`Title bar element not found with class "${t}"`)}function rF(n){return n.controller.valueController?.foldable_?.valMap_?.expanded?.value_}function oF(n){return n.controller?.valueController?.view?.swatchElement?.querySelector("button")??n.controller?.valueController?.view?.buttonElement}/*! Tweakpane 4.0.2 (c) 2016 cocopon, licensed under the MIT license. */function ye(n){return n==null}function O_(n){return n!==null&&typeof n=="object"}function Lv(n){return n!==null&&typeof n=="object"}function lF(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function fo(n,e){return Array.from(new Set([...Object.keys(n),...Object.keys(e)])).reduce((i,s)=>{const r=n[s],o=e[s];return Lv(r)&&Lv(o)?Object.assign(Object.assign({},i),{[s]:fo(r,o)}):Object.assign(Object.assign({},i),{[s]:s in e?o:r})},{})}function j_(n){return O_(n)?"target"in n:!1}const aF={alreadydisposed:()=>"View has been already disposed",invalidparams:n=>`Invalid parameters for '${n.name}'`,nomatchingcontroller:n=>`No matching controller for '${n.key}'`,nomatchingview:n=>`No matching view for '${JSON.stringify(n.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:n=>`Not compatible with  plugin '${n.id}'`,propertynotfound:n=>`Property '${n.name}' not found`,shouldneverhappen:()=>"This error should never happen"};let yt=class Cl{static alreadyDisposed(){return new Cl({type:"alreadydisposed"})}static notBindable(){return new Cl({type:"notbindable"})}static notCompatible(e,t){return new Cl({type:"notcompatible",context:{id:`${e}.${t}`}})}static propertyNotFound(e){return new Cl({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new Cl({type:"shouldneverhappen"})}constructor(e){var t;this.message=(t=aF[e.type](e.context))!==null&&t!==void 0?t:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}toString(){return this.message}},K0=class BV{constructor(e,t){this.obj_=e,this.key=t}static isBindable(e){return!(e===null||typeof e!="object"&&typeof e!="function")}read(){return this.obj_[this.key]}write(e){this.obj_[this.key]=e}writeProperty(e,t){const i=this.read();if(!BV.isBindable(i))throw yt.notBindable();if(!(e in i))throw yt.propertyNotFound(e);i[e]=t}},Ke=class{constructor(){this.observers_={}}on(e,t){let i=this.observers_[e];return i||(i=this.observers_[e]=[]),i.push({handler:t}),this}off(e,t){const i=this.observers_[e];return i&&(this.observers_[e]=i.filter(s=>s.handler!==t)),this}emit(e,t){const i=this.observers_[e];i&&i.forEach(s=>{s.handler(t)})}},uF=class{constructor(e,t){var i;this.constraint_=t?.constraint,this.equals_=(i=t?.equals)!==null&&i!==void 0?i:(s,r)=>s===r,this.emitter=new Ke,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},s=this.constraint_?this.constraint_.constrain(e):e,r=this.rawValue_;this.equals_(r,s)&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=s,this.emitter.emit("change",{options:i,previousRawValue:r,rawValue:s,sender:this}))}},hF=class{constructor(e){this.emitter=new Ke,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},s=this.value_;s===e&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:i,previousRawValue:s,rawValue:this.value_,sender:this}))}},cF=class{constructor(e){this.emitter=new Ke,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}};function Ve(n,e){const t=e?.constraint,i=e?.equals;return!t&&!i?new hF(n):new uF(n,e)}function dF(n){return[new cF(n),(e,t)=>{n.setRawValue(e,t)}]}let I=class IV{constructor(e){this.emitter=new Ke,this.valMap_=e;for(const t in this.valMap_)this.valMap_[t].emitter.on("change",()=>{this.emitter.emit("change",{key:t,sender:this})})}static createCore(e){return Object.keys(e).reduce((i,s)=>Object.assign(i,{[s]:Ve(e[s])}),{})}static fromObject(e){const t=this.createCore(e);return new IV(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}},_h=class{constructor(e){this.values=I.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");return Math.min(Math.max(e,i),t)}},pF=class{constructor(e){this.values=I.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");let s=e;return ye(i)||(s=Math.max(s,i)),ye(t)||(s=Math.min(s,t)),s}},mF=class{constructor(e,t=0){this.step=e,this.origin=t}constrain(e){const t=this.origin%this.step,i=Math.round((e-t)/this.step);return t+i*this.step}},vF=class{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}};const fF={"**":(n,e)=>Math.pow(n,e),"*":(n,e)=>n*e,"/":(n,e)=>n/e,"%":(n,e)=>n%e,"+":(n,e)=>n+e,"-":(n,e)=>n-e,"<<":(n,e)=>n<<e,">>":(n,e)=>n>>e,">>>":(n,e)=>n>>>e,"&":(n,e)=>n&e,"^":(n,e)=>n^e,"|":(n,e)=>n|e};let _F=class{constructor(e,t,i){this.left=t,this.operator=e,this.right=i}evaluate(){const e=fF[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}};const wF={"+":n=>n,"-":n=>-n,"~":n=>~n};let bF=class{constructor(e,t){this.operator=e,this.expression=t}evaluate(){const e=wF[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}};function N_(n){return(e,t)=>{for(let i=0;i<n.length;i++){const s=n[i](e,t);if(s!=="")return s}return""}}function Au(n,e){var t;const i=n.substr(e).match(/^\s+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function gF(n,e){const t=n.substr(e,1);return t.match(/^[1-9]$/)?t:""}function Mu(n,e){var t;const i=n.substr(e).match(/^[0-9]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function CF(n,e){const t=Mu(n,e);if(t!=="")return t;const i=n.substr(e,1);if(e+=1,i!=="-"&&i!=="+")return"";const s=Mu(n,e);return s===""?"":i+s}function B_(n,e){const t=n.substr(e,1);if(e+=1,t.toLowerCase()!=="e")return"";const i=CF(n,e);return i===""?"":t+i}function FV(n,e){const t=n.substr(e,1);if(t==="0")return t;const i=gF(n,e);return e+=i.length,i===""?"":i+Mu(n,e)}function PF(n,e){const t=FV(n,e);if(e+=t.length,t==="")return"";const i=n.substr(e,1);if(e+=i.length,i!==".")return"";const s=Mu(n,e);return e+=s.length,t+i+s+B_(n,e)}function yF(n,e){const t=n.substr(e,1);if(e+=t.length,t!==".")return"";const i=Mu(n,e);return e+=i.length,i===""?"":t+i+B_(n,e)}function EF(n,e){const t=FV(n,e);return e+=t.length,t===""?"":t+B_(n,e)}const xF=N_([PF,yF,EF]);function $F(n,e){var t;const i=n.substr(e).match(/^[01]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function VF(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0b")return"";const i=$F(n,e);return i===""?"":t+i}function kF(n,e){var t;const i=n.substr(e).match(/^[0-7]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function SF(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0o")return"";const i=kF(n,e);return i===""?"":t+i}function LF(n,e){var t;const i=n.substr(e).match(/^[0-9a-f]+/i);return(t=i&&i[0])!==null&&t!==void 0?t:""}function AF(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0x")return"";const i=LF(n,e);return i===""?"":t+i}const MF=N_([VF,SF,AF]),TF=N_([MF,xF]);function DF(n,e){const t=TF(n,e);return e+=t.length,t===""?null:{evaluable:new vF(t),cursor:e}}function RF(n,e){const t=n.substr(e,1);if(e+=t.length,t!=="(")return null;const i=UV(n,e);if(!i)return null;e=i.cursor,e+=Au(n,e).length;const s=n.substr(e,1);return e+=s.length,s!==")"?null:{evaluable:i.evaluable,cursor:e}}function OF(n,e){var t;return(t=DF(n,e))!==null&&t!==void 0?t:RF(n,e)}function KV(n,e){const t=OF(n,e);if(t)return t;const i=n.substr(e,1);if(e+=i.length,i!=="+"&&i!=="-"&&i!=="~")return null;const s=KV(n,e);return s?(e=s.cursor,{cursor:e,evaluable:new bF(i,s.evaluable)}):null}function jF(n,e,t){t+=Au(e,t).length;const i=n.filter(s=>e.startsWith(s,t))[0];return i?(t+=i.length,t+=Au(e,t).length,{cursor:t,operator:i}):null}function NF(n,e){return(t,i)=>{const s=n(t,i);if(!s)return null;i=s.cursor;let r=s.evaluable;for(;;){const o=jF(e,t,i);if(!o)break;i=o.cursor;const l=n(t,i);if(!l)return null;i=l.cursor,r=new _F(o.operator,r,l.evaluable)}return r?{cursor:i,evaluable:r}:null}}const BF=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((n,e)=>NF(n,e),KV);function UV(n,e){return e+=Au(n,e).length,BF(n,e)}function IF(n){const e=UV(n,0);return!e||e.cursor+Au(n,e.cursor).length!==n.length?null:e.evaluable}function xs(n){var e;const t=IF(n);return(e=t?.evaluate())!==null&&e!==void 0?e:null}function HV(n){if(typeof n=="number")return n;if(typeof n=="string"){const e=xs(n);if(!ye(e))return e}return 0}function FF(n){return String(n)}function un(n){return e=>e.toFixed(Math.max(Math.min(n,20),0))}function ie(n,e,t,i,s){const r=(n-e)/(t-e);return i+r*(s-i)}function U0(n){return String(n.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function He(n,e,t){return Math.min(Math.max(n,e),t)}function zV(n,e){return(n%e+e)%e}function KF(n,e){return ye(n.step)?Math.max(U0(e),2):U0(n.step)}function qV(n){var e;return(e=n.step)!==null&&e!==void 0?e:1}function GV(n,e){var t;const i=Math.abs((t=n.step)!==null&&t!==void 0?t:e);return i===0?.1:Math.pow(10,Math.floor(Math.log10(i))-1)}function YV(n,e){return ye(n.step)?null:new mF(n.step,e)}function XV(n){return!ye(n.max)&&!ye(n.min)?new _h({max:n.max,min:n.min}):!ye(n.max)||!ye(n.min)?new pF({max:n.max,min:n.min}):null}function WV(n,e){var t,i,s;return{formatter:(t=n.format)!==null&&t!==void 0?t:un(KF(n,e)),keyScale:(i=n.keyScale)!==null&&i!==void 0?i:qV(n),pointerScale:(s=n.pointerScale)!==null&&s!==void 0?s:GV(n,e)}}function ZV(n){return{format:n.optional.function,keyScale:n.optional.number,max:n.optional.number,min:n.optional.number,pointerScale:n.optional.number,step:n.optional.number}}function I_(n){return{constraint:n.constraint,textProps:I.fromObject(WV(n.params,n.initialValue))}}let Bo=class{constructor(e){this.controller=e}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(e){this.controller.viewProps.set("disabled",e)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(e){this.controller.viewProps.set("hidden",e)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(e){return this.controller.importState(e)}exportState(){return this.controller.exportState()}},Nd=class{constructor(e){this.target=e}},wh=class extends Nd{constructor(e,t,i){super(e),this.value=t,this.last=i??!0}},UF=class extends Nd{constructor(e,t){super(e),this.expanded=t}},HF=class extends Nd{constructor(e,t){super(e),this.index=t}},Tu=class extends Bo{constructor(e){super(e),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new Ke,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(e){this.controller.tag=e}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}refresh(){this.controller.value.fetch()}onValueChange_(e){const t=this.controller.value;this.emitter_.emit("change",new wh(this,t.binding.target.read(),e.options.last))}};class zF{constructor(e,t){this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.binding=t,this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_),this.emitter=new Ke}get rawValue(){return this.value_.rawValue}set rawValue(e){this.value_.rawValue=e}setRawValue(e,t){this.value_.setRawValue(e,t)}fetch(){this.value_.rawValue=this.binding.read()}push(){this.binding.write(this.value_.rawValue)}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.push(),this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}}function qF(n){if(!("binding"in n))return!1;const e=n.binding;return j_(e)&&"read"in e&&"write"in e}function GF(n,e){const i=Object.keys(e).reduce((s,r)=>{if(s===void 0)return;const o=e[r],l=o(n[r]);return l.succeeded?Object.assign(Object.assign({},s),{[r]:l.value}):void 0},{});return i}function YF(n,e){return n.reduce((t,i)=>{if(t===void 0)return;const s=e(i);if(!(!s.succeeded||s.value===void 0))return[...t,s.value]},[])}function XF(n){return n===null?!1:typeof n=="object"}function Zi(n){return e=>t=>{if(!e&&t===void 0)return{succeeded:!1,value:void 0};if(e&&t===void 0)return{succeeded:!0,value:void 0};const i=n(t);return i!==void 0?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}function H0(n){return{custom:e=>Zi(e)(n),boolean:Zi(e=>typeof e=="boolean"?e:void 0)(n),number:Zi(e=>typeof e=="number"?e:void 0)(n),string:Zi(e=>typeof e=="string"?e:void 0)(n),function:Zi(e=>typeof e=="function"?e:void 0)(n),constant:e=>Zi(t=>t===e?e:void 0)(n),raw:Zi(e=>e)(n),object:e=>Zi(t=>{if(XF(t))return GF(t,e)})(n),array:e=>Zi(t=>{if(Array.isArray(t))return YF(t,e)})(n)}}const Av={optional:H0(!0),required:H0(!1)};function Oe(n,e){const t=e(Av),i=Av.required.object(t)(n);return i.succeeded?i.value:void 0}function yn(n,e,t,i){if(e&&!e(n))return!1;const s=Oe(n,t);return s?i(s):!1}function En(n,e){var t;return fo((t=n?.())!==null&&t!==void 0?t:{},e)}function oo(n){return"value"in n}function QV(n){if(!O_(n)||!("binding"in n))return!1;const e=n.binding;return j_(e)}const hi="http://www.w3.org/2000/svg";function Wc(n){n.offsetHeight}function WF(n,e){const t=n.style.transition;n.style.transition="none",e(),n.style.transition=t}function F_(n){return n.ontouchstart!==void 0}function ZF(){return globalThis}function QF(){return ZF().document}function JF(n){const e=n.ownerDocument.defaultView;return e&&"document"in e?n.getContext("2d",{willReadFrequently:!0}):null}const e5={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Bd(n,e){const t=n.createElementNS(hi,"svg");return t.innerHTML=e5[e],t}function JV(n,e,t){n.insertBefore(e,n.children[t])}function K_(n){n.parentElement&&n.parentElement.removeChild(n)}function ek(n){for(;n.children.length>0;)n.removeChild(n.children[0])}function t5(n){for(;n.childNodes.length>0;)n.removeChild(n.childNodes[0])}function tk(n){return n.relatedTarget?n.relatedTarget:"explicitOriginalTarget"in n?n.explicitOriginalTarget:null}function vs(n,e){n.emitter.on("change",t=>{e(t.rawValue)}),e(n.rawValue)}function wi(n,e,t){vs(n.value(e),t)}const n5="tp";function U(n){return(t,i)=>[n5,"-",n,"v",t?`_${t}`:"",i?`-${i}`:""].join("")}const Ga=U("lbl");function i5(n,e){const t=n.createDocumentFragment();return e.split(`
`).map(s=>n.createTextNode(s)).forEach((s,r)=>{r>0&&t.appendChild(n.createElement("br")),t.appendChild(s)}),t}let nk=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Ga()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Ga("l")),wi(t.props,"label",r=>{ye(r)?this.element.classList.add(Ga(void 0,"nol")):(this.element.classList.remove(Ga(void 0,"nol")),t5(i),i.appendChild(i5(e,r)))}),this.element.appendChild(i),this.labelElement=i;const s=e.createElement("div");s.classList.add(Ga("v")),this.element.appendChild(s),this.valueElement=s}},ik=class{constructor(e,t){this.props=t.props,this.valueController=t.valueController,this.viewProps=t.valueController.viewProps,this.view=new nk(e,{props:t.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(e){return yn(e,null,t=>({label:t.optional.string}),t=>(this.props.set("label",t.label),!0))}exportProps(){return En(null,{label:this.props.get("label")})}};function s5(){return["veryfirst","first","last","verylast"]}const z0=U(""),q0={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};let Id=class{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",()=>{s5().forEach(i=>{t.classList.remove(z0(void 0,q0[i]))}),this.blade.get("positions").forEach(i=>{t.classList.add(z0(void 0,q0[i]))})}),this.viewProps.handleDispose(()=>{K_(t)})}get parent(){return this.parent_}set parent(e){this.parent_=e,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(e){return yn(e,null,t=>({disabled:t.required.boolean,hidden:t.required.boolean}),t=>(this.viewProps.importState(t),!0))}exportState(){return En(null,Object.assign({},this.viewProps.exportState()))}};class _o extends Id{constructor(e,t){if(t.value!==t.valueController.value)throw yt.shouldNeverHappen();const i=t.valueController.viewProps,s=new ik(e,{blade:t.blade,props:t.props,valueController:t.valueController});super(Object.assign(Object.assign({},t),{view:new nk(e,{props:t.props,viewProps:i}),viewProps:i})),this.labelController=s,this.value=t.value,this.valueController=t.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}importState(e){return yn(e,t=>{var i,s,r;return super.importState(t)&&this.labelController.importProps(t)&&((r=(s=(i=this.valueController).importProps)===null||s===void 0?void 0:s.call(i,e))!==null&&r!==void 0?r:!0)},t=>({value:t.optional.raw}),t=>(t.value&&(this.value.rawValue=t.value),!0))}exportState(){var e,t,i;return En(()=>super.exportState(),Object.assign(Object.assign({value:this.value.rawValue},this.labelController.exportProps()),(i=(t=(e=this.valueController).exportProps)===null||t===void 0?void 0:t.call(e))!==null&&i!==void 0?i:{}))}}function G0(n){const e=Object.assign({},n);return delete e.value,e}class sk extends _o{constructor(e,t){super(e,t),this.tag=t.tag}importState(e){return yn(e,t=>super.importState(G0(e)),t=>({tag:t.optional.string}),t=>(this.tag=t.tag,!0))}exportState(){return En(()=>G0(super.exportState()),{binding:{key:this.value.binding.target.key,value:this.value.binding.target.read()},tag:this.tag})}}function r5(n){return oo(n)&&QV(n.value)}class o5 extends sk{importState(e){return yn(e,t=>super.importState(t),t=>({binding:t.required.object({value:t.required.raw})}),t=>(this.value.binding.inject(t.binding.value),this.value.fetch(),!0))}}function l5(n){return oo(n)&&qF(n.value)}function rk(n,e){for(;n.length<e;)n.push(void 0)}function a5(n){const e=[];return rk(e,n),e}function u5(n){const e=n.indexOf(void 0);return e<0?n:n.slice(0,e)}function h5(n,e){const t=[...u5(n),e];return t.length>n.length?t.splice(0,t.length-n.length):rk(t,n.length),t}class c5{constructor(e){this.emitter=new Ke,this.onTick_=this.onTick_.bind(this),this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.binding=e.binding,this.value_=Ve(a5(e.bufferSize)),this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_),this.ticker=e.ticker,this.ticker.emitter.on("tick",this.onTick_),this.fetch()}get rawValue(){return this.value_.rawValue}set rawValue(e){this.value_.rawValue=e}setRawValue(e,t){this.value_.setRawValue(e,t)}fetch(){this.value_.rawValue=h5(this.value_.rawValue,this.binding.read())}onTick_(){this.fetch()}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}}function d5(n){if(!("binding"in n))return!1;const e=n.binding;return j_(e)&&"read"in e&&!("write"in e)}class p5 extends sk{exportState(){return En(()=>super.exportState(),{binding:{readonly:!0}})}}function m5(n){return oo(n)&&d5(n.value)}let v5=class extends Bo{get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get title(){var e;return(e=this.controller.buttonController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.buttonController.props.set("title",e)}on(e,t){const i=t.bind(this);return this.controller.buttonController.emitter.on(e,()=>{i(new Nd(this))}),this}};function f5(n,e,t){t?n.classList.add(e):n.classList.remove(e)}function _a(n,e){return t=>{f5(n,e,t)}}function U_(n,e){vs(n,t=>{e.textContent=t??""})}const am=U("btn");let _5=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(am()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("button");i.classList.add(am("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(am("t")),U_(t.props.value("title"),s),this.buttonElement.appendChild(s)}},w5=class{constructor(e,t){this.emitter=new Ke,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new _5(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(e){return yn(e,null,t=>({title:t.optional.string}),t=>(this.props.set("title",t.title),!0))}exportProps(){return En(null,{title:this.props.get("title")})}onClick_(){this.emitter.emit("click",{sender:this})}},Y0=class extends Id{constructor(e,t){const i=new w5(e,{props:t.buttonProps,viewProps:t.viewProps}),s=new ik(e,{blade:t.blade,props:t.labelProps,valueController:i});super({blade:t.blade,view:s.view,viewProps:t.viewProps}),this.buttonController=i,this.labelController=s}importState(e){return yn(e,t=>super.importState(t)&&this.buttonController.importProps(t)&&this.labelController.importProps(t),()=>({}),()=>!0)}exportState(){return En(()=>super.exportState(),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}},ok=class{constructor(e){const[t,i]=e.split("-"),s=t.split(".");this.major=parseInt(s[0],10),this.minor=parseInt(s[1],10),this.patch=parseInt(s[2],10),this.prerelease=i??null}toString(){const e=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[e,this.prerelease].join("-"):e}};const wa=new ok("2.0.2");function Yt(n){return Object.assign({core:wa},n)}const b5=Yt({id:"button",type:"blade",accept(n){const e=Oe(n,t=>({title:t.required.string,view:t.required.constant("button"),label:t.optional.string}));return e?{params:e}:null},controller(n){return new Y0(n.document,{blade:n.blade,buttonProps:I.fromObject({title:n.params.title}),labelProps:I.fromObject({label:n.params.label}),viewProps:n.viewProps})},api(n){return n.controller instanceof Y0?new v5(n.controller):null}});function g5(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}function C5(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}function P5(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}function y5(n){return O_(n)?"refresh"in n&&typeof n.refresh=="function":!1}function E5(n,e){if(!K0.isBindable(n))throw yt.notBindable();return new K0(n,e)}let x5=class{constructor(e,t){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=e,this.emitter_=new Ke,this.pool_=t,this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map(e=>this.pool_.createApi(e))}addBinding(e,t,i){const s=i??{},r=this.controller_.element.ownerDocument,o=this.pool_.createBinding(r,E5(e,t),s),l=this.pool_.createBindingApi(o);return this.add(l,s.index)}addFolder(e){return C5(this,e)}addButton(e){return g5(this,e)}addTab(e){return P5(this,e)}add(e,t){const i=e.controller;return this.controller_.rack.add(i,t),e}remove(e){this.controller_.rack.remove(e.controller)}addBlade(e){const t=this.controller_.element.ownerDocument,i=this.pool_.createBlade(t,e),s=this.pool_.createApi(i);return this.add(s,e.index)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}refresh(){this.children.forEach(e=>{y5(e)&&e.refresh()})}onRackValueChange_(e){const t=e.bladeController,i=this.pool_.createApi(t),s=QV(t.value)?t.value.binding:null;this.emitter_.emit("change",new wh(i,s?s.target.read():t.value.rawValue,e.options.last))}},H_=class extends Bo{constructor(e,t){super(e),this.rackApi_=new x5(e.rackController,t)}refresh(){this.rackApi_.refresh()}},z_=class extends Id{constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps}),this.rackController=e.rackController}importState(e){return yn(e,t=>super.importState(t),t=>({children:t.required.array(t.required.raw)}),t=>this.rackController.rack.children.every((i,s)=>i.importState(t.children[s])))}exportState(){return En(()=>super.exportState(),{children:this.rackController.rack.children.map(e=>e.exportState())})}};function Mv(n){return"rackController"in n}let $5=class{constructor(e){this.emitter=new Ke,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const t of this.allItems())if(e(t))return t;return null}includes(e){return this.cache_.has(e)}add(e,t){if(this.includes(e))throw yt.shouldNeverHappen();const i=t!==void 0?t:this.items_.length;this.items_.splice(i,0,e),this.cache_.add(e);const s=this.extract_(e);s&&(s.emitter.on("add",this.onSubListAdd_),s.emitter.on("remove",this.onSubListRemove_),s.allItems().forEach(r=>{this.cache_.add(r)})),this.emitter.emit("add",{index:i,item:e,root:this,target:this})}remove(e){const t=this.items_.indexOf(e);if(t<0)return;this.items_.splice(t,1),this.cache_.delete(e);const i=this.extract_(e);i&&(i.allItems().forEach(s=>{this.cache_.delete(s)}),i.emitter.off("add",this.onSubListAdd_),i.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}};function V5(n,e){for(let t=0;t<n.length;t++){const i=n[t];if(oo(i)&&i.value===e)return i}return null}function k5(n){return Mv(n)?n.rackController.rack.bcSet_:null}let S5=class{constructor(e){var t,i;this.emitter=new Ke,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=(t=e.blade)!==null&&t!==void 0?t:null,(i=this.blade_)===null||i===void 0||i.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=e.viewProps,this.bcSet_=new $5(k5),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,t){var i;(i=e.parent)===null||i===void 0||i.remove(e),e.parent=this,this.bcSet_.add(e,t)}remove(e){e.parent=null,this.bcSet_.remove(e)}find(e){return this.bcSet_.allItems().filter(e)}onSetAdd_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,root:t,sender:this}),!t)return;const i=e.item;if(i.viewProps.emitter.on("change",this.onChildViewPropsChange_),i.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),i.viewProps.handleDispose(this.onChildDispose_),oo(i))i.value.emitter.on("change",this.onChildValueChange_);else if(Mv(i)){const s=i.rackController.rack;if(s){const r=s.emitter;r.on("layout",this.onRackLayout_),r.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,root:t,sender:this}),!t)return;const i=e.item;if(oo(i))i.value.emitter.off("change",this.onChildValueChange_);else if(Mv(i)){const s=i.rackController.rack;if(s){const r=s.emitter;r.off("layout",this.onRackLayout_),r.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){const e=this.bcSet_.items.filter(s=>!s.viewProps.get("hidden")),t=e[0],i=e[e.length-1];this.bcSet_.items.forEach(s=>{const r=[];s===t&&(r.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&r.push("veryfirst")),s===i&&(r.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&r.push("verylast")),s.blade.set("positions",r)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(t=>t.viewProps.get("disposed")).forEach(t=>{this.bcSet_.remove(t)})}onChildValueChange_(e){const t=V5(this.find(oo),e.sender);if(!t)throw yt.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:t,options:e.options,sender:this})}onRackLayout_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(e){this.emitter.emit("valuechange",{bladeController:e.bladeController,options:e.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}},q_=class{constructor(e){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=e.element,this.viewProps=e.viewProps;const t=new S5({blade:e.root?void 0:e.blade,viewProps:e.viewProps});t.emitter.on("add",this.onRackAdd_),t.emitter.on("remove",this.onRackRemove_),this.rack=t,this.viewProps.handleDispose(()=>{for(let i=this.rack.children.length-1;i>=0;i--)this.rack.children[i].viewProps.set("disposed",!0)})}onRackAdd_(e){e.root&&JV(this.element,e.bladeController.view.element,e.index)}onRackRemove_(e){e.root&&K_(e.bladeController.view.element)}};function ba(){return new I({positions:Ve([],{equals:lF})})}let G_=class lk extends I{constructor(e){super(e)}static create(e){const t={completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},i=I.createCore(t);return new lk(i)}get styleExpanded(){var e;return(e=this.get("temporaryExpanded"))!==null&&e!==void 0?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!ye(e)?`${e}px`:"auto"}bindExpandedClass(e,t){const i=()=>{this.styleExpanded?e.classList.add(t):e.classList.remove(t)};wi(this,"expanded",i),wi(this,"temporaryExpanded",i)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}};function L5(n,e){let t=0;return WF(e,()=>{n.set("expandedHeight",null),n.set("temporaryExpanded",!0),Wc(e),t=e.clientHeight,n.set("temporaryExpanded",null),Wc(e)}),t}function X0(n,e){e.style.height=n.styleHeight}function Y_(n,e){n.value("expanded").emitter.on("beforechange",()=>{if(n.set("completed",!1),ye(n.get("expandedHeight"))){const t=L5(n,e);t>0&&n.set("expandedHeight",t)}n.set("shouldFixHeight",!0),Wc(e)}),n.emitter.on("change",()=>{X0(n,e)}),X0(n,e),e.addEventListener("transitionend",t=>{t.propertyName==="height"&&n.cleanUpTransition()})}let ak=class extends H_{constructor(e,t){super(e,t),this.emitter_=new Ke,this.controller.foldable.value("expanded").emitter.on("change",i=>{this.emitter_.emit("fold",new UF(this,i.sender.rawValue))}),this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)})}get expanded(){return this.controller.foldable.get("expanded")}set expanded(e){this.controller.foldable.set("expanded",e)}get title(){return this.controller.props.get("title")}set title(e){this.controller.props.set("title",e)}get children(){return this.rackApi_.children}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){return this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}};const uk=U("cnt");let A5=class{constructor(e,t){var i;this.className_=U((i=t.viewName)!==null&&i!==void 0?i:"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),uk()),t.viewProps.bindClassModifiers(this.element),this.foldable_=t.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),wi(this.foldable_,"completed",_a(this.element,this.className_(void 0,"cpl")));const s=e.createElement("button");s.classList.add(this.className_("b")),wi(t.props,"title",u=>{ye(u)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s;const r=e.createElement("div");r.classList.add(this.className_("i")),this.element.appendChild(r);const o=e.createElement("div");o.classList.add(this.className_("t")),U_(t.props.value("title"),o),this.buttonElement.appendChild(o),this.titleElement=o;const l=e.createElement("div");l.classList.add(this.className_("m")),this.buttonElement.appendChild(l);const a=e.createElement("div");a.classList.add(this.className_("c")),this.element.appendChild(a),this.containerElement=a}},Tv=class extends z_{constructor(e,t){var i;const s=G_.create((i=t.expanded)!==null&&i!==void 0?i:!0),r=new A5(e,{foldable:s,props:t.props,viewName:t.root?"rot":void 0,viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new q_({blade:t.blade,element:r.containerElement,root:t.root,viewProps:t.viewProps}),view:r})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=t.props,this.foldable=s,Y_(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(e){return yn(e,t=>super.importState(t),t=>({expanded:t.required.boolean,title:t.optional.string}),t=>(this.foldable.set("expanded",t.expanded),this.props.set("title",t.title),!0))}exportState(){return En(()=>super.exportState(),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}};const M5=Yt({id:"folder",type:"blade",accept(n){const e=Oe(n,t=>({title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean}));return e?{params:e}:null},controller(n){return new Tv(n.document,{blade:n.blade,expanded:n.params.expanded,props:I.fromObject({title:n.params.title}),viewProps:n.viewProps})},api(n){return n.controller instanceof Tv?new ak(n.controller,n.pool):null}}),T5=U("");function W0(n,e){return _a(n,T5(void 0,e))}let Io=class hk extends I{constructor(e){var t;super(e),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=dF(Ve(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(e){var t,i,s;const r=e??{};return new hk(I.createCore({disabled:(t=r.disabled)!==null&&t!==void 0?t:!1,disposed:!1,hidden:(i=r.hidden)!==null&&i!==void 0?i:!1,parent:(s=r.parent)!==null&&s!==void 0?s:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(e){vs(this.globalDisabled_,W0(e,"disabled")),wi(this,"hidden",W0(e,"hidden"))}bindDisabled(e){vs(this.globalDisabled_,t=>{e.disabled=t})}bindTabIndex(e){vs(this.globalDisabled_,t=>{e.tabIndex=t?-1:0})}handleDispose(e){this.value("disposed").emitter.on("change",t=>{t&&e()})}importState(e){this.set("disabled",e.disabled),this.set("hidden",e.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){const e=this.get("parent");return(e?e.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(e){var t;const i=e.previousRawValue;i?.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}};const Z0=U("tbp");let D5=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Z0()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Z0("c")),this.element.appendChild(i),this.containerElement=i}};const Ya=U("tbi");let R5=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Ya()),t.viewProps.bindClassModifiers(this.element),wi(t.props,"selected",r=>{r?this.element.classList.add(Ya(void 0,"sel")):this.element.classList.remove(Ya(void 0,"sel"))});const i=e.createElement("button");i.classList.add(Ya("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(Ya("t")),U_(t.props.value("title"),s),this.buttonElement.appendChild(s),this.titleElement=s}},O5=class{constructor(e,t){this.emitter=new Ke,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new R5(e,{props:t.props,viewProps:t.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}},Dv=class extends z_{constructor(e,t){const i=new D5(e,{viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new q_({blade:t.blade,element:i.containerElement,viewProps:t.viewProps}),view:i})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new O5(e,{props:t.itemProps,viewProps:Io.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=t.props,wi(this.props,"selected",s=>{this.itemController.props.set("selected",s),this.viewProps.set("hidden",!s)})}get itemController(){return this.ic_}importState(e){return yn(e,t=>super.importState(t),t=>({selected:t.required.boolean,title:t.required.string}),t=>(this.ic_.props.set("selected",t.selected),this.ic_.props.set("title",t.title),!0))}exportState(){return En(()=>super.exportState(),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}},j5=class extends H_{constructor(e,t){super(e,t),this.emitter_=new Ke,this.onSelect_=this.onSelect_.bind(this),this.pool_=t,this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)}),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(e){const t=this.controller.view.element.ownerDocument,i=new Dv(t,{blade:ba(),itemProps:I.fromObject({selected:!1,title:e.title}),props:I.fromObject({selected:!1}),viewProps:Io.create()}),s=this.pool_.createApi(i);return this.rackApi_.add(s,e.index)}removePage(e){this.rackApi_.remove(this.rackApi_.children[e])}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}onSelect_(e){this.emitter_.emit("select",new HF(this,e.rawValue))}},N5=class extends H_{get title(){var e;return(e=this.controller.itemController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.itemController.props.set("title",e)}get selected(){return this.controller.props.get("selected")}set selected(e){this.controller.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addBlade(e){return this.rackApi_.addBlade(e)}};const Q0=-1;let B5=class{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=Ve(!0),this.selectedIndex=Ve(Q0),this.items_=[]}add(e,t){const i=t??this.items_.length;this.items_.splice(i,0,e),e.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(e){const t=this.items_.indexOf(e);t<0||(this.items_.splice(t,1),e.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=Q0,this.empty.rawValue=!0;return}const e=this.items_.findIndex(t=>t.rawValue);e<0?(this.items_.forEach((t,i)=>{t.rawValue=i===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((t,i)=>{t.rawValue=i===e}),this.selectedIndex.rawValue=e),this.empty.rawValue=!1}onItemSelectedChange_(e){if(e.rawValue){const t=this.items_.findIndex(i=>i===e.sender);this.items_.forEach((i,s)=>{i.rawValue=s===t}),this.selectedIndex.rawValue=t}else this.keepSelection_()}};const Xa=U("tab");let I5=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Xa(),uk()),t.viewProps.bindClassModifiers(this.element),vs(t.empty,_a(this.element,Xa(void 0,"nop")));const i=e.createElement("div");i.classList.add(Xa("t")),this.element.appendChild(i),this.itemsElement=i;const s=e.createElement("div");s.classList.add(Xa("i")),this.element.appendChild(s);const r=e.createElement("div");r.classList.add(Xa("c")),this.element.appendChild(r),this.contentsElement=r}},J0=class extends z_{constructor(e,t){const i=new B5,s=new I5(e,{empty:i.empty,viewProps:t.viewProps});super({blade:t.blade,rackController:new q_({blade:t.blade,element:s.contentsElement,viewProps:t.viewProps}),view:s}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const r=this.rackController.rack;r.emitter.on("add",this.onRackAdd_),r.emitter.on("remove",this.onRackRemove_),this.tab=i}add(e,t){this.rackController.rack.add(e,t)}remove(e){this.rackController.rack.remove(this.rackController.rack.children[e])}onRackAdd_(e){if(!e.root)return;const t=e.bladeController;JV(this.view.itemsElement,t.itemController.view.element,e.index),t.itemController.viewProps.set("parent",this.viewProps),this.tab.add(t.props.value("selected"))}onRackRemove_(e){if(!e.root)return;const t=e.bladeController;K_(t.itemController.view.element),t.itemController.viewProps.set("parent",null),this.tab.remove(t.props.value("selected"))}};const ck=Yt({id:"tab",type:"blade",accept(n){const e=Oe(n,t=>({pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")}));return!e||e.pages.length===0?null:{params:e}},controller(n){const e=new J0(n.document,{blade:n.blade,viewProps:n.viewProps});return n.params.pages.forEach(t=>{const i=new Dv(n.document,{blade:ba(),itemProps:I.fromObject({selected:!1,title:t.title}),props:I.fromObject({selected:!1}),viewProps:Io.create()});e.add(i)}),e},api(n){return n.controller instanceof J0?new j5(n.controller,n.pool):n.controller instanceof Dv?new N5(n.controller,n.pool):null}});function F5(n,e){const t=n.accept(e.params);if(!t)return null;const i=Oe(e.params,s=>({disabled:s.optional.boolean,hidden:s.optional.boolean}));return n.controller({blade:ba(),document:e.document,params:Object.assign(Object.assign({},t.params),{disabled:i?.disabled,hidden:i?.hidden}),viewProps:Io.create({disabled:i?.disabled,hidden:i?.hidden})})}let X_=class extends Tu{get options(){return this.controller.valueController.props.get("options")}set options(e){this.controller.valueController.props.set("options",e)}},K5=class{constructor(){this.disabled=!1,this.emitter=new Ke}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}},U5=class{constructor(e,t){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=e,this.emitter=new Ke,this.interval_=t,this.setTimer_()}get disabled(){return this.disabled_}set disabled(e){this.disabled_=e,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const e=this.doc_.defaultView;e&&e.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const e=this.doc_.defaultView;e&&(this.timerId_=e.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}},bh=class{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce((t,i)=>i.constrain(t),e)}};function Zc(n,e){if(n instanceof e)return n;if(n instanceof bh){const t=n.constraints.reduce((i,s)=>i||(s instanceof e?s:null),null);if(t)return t}return null}let gh=class{constructor(e){this.values=I.fromObject({options:e})}constrain(e){const t=this.values.get("options");return t.length===0||t.filter(s=>s.value===e).length>0?e:t[0].value}};function Ch(n){var e;const t=Av;if(Array.isArray(n))return(e=Oe({items:n},i=>({items:i.required.array(i.required.object({text:i.required.string,value:i.required.raw}))})))===null||e===void 0?void 0:e.items;if(typeof n=="object")return t.required.raw(n).value}function W_(n){if(Array.isArray(n))return n;const e=[];return Object.keys(n).forEach(t=>{e.push({text:t,value:n[t]})}),e}function Z_(n){return ye(n)?null:new gh(W_(n))}const um=U("lst");let H5=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add(um()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("select");i.classList.add(um("s")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.selectElement=i;const s=e.createElement("div");s.classList.add(um("m")),s.appendChild(Bd(e,"dropdown")),this.element.appendChild(s),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,wi(this.props_,"options",r=>{ek(this.selectElement),r.forEach(o=>{const l=e.createElement("option");l.textContent=o.text,this.selectElement.appendChild(l)}),this.update_()})}update_(){const e=this.props_.get("options").map(t=>t.value);this.selectElement.selectedIndex=e.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}},Mr=class{constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new H5(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const t=e.currentTarget;this.value.rawValue=this.props.get("options")[t.selectedIndex].value}importProps(e){return yn(e,null,t=>({options:t.required.custom(Ch)}),t=>(this.props.set("options",W_(t.options)),!0))}exportProps(){return En(null,{options:this.props.get("options")})}};const eP=U("pop");let z5=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(eP()),t.viewProps.bindClassModifiers(this.element),vs(t.shows,_a(this.element,eP(void 0,"v")))}},dk=class{constructor(e,t){this.shows=Ve(!1),this.viewProps=t.viewProps,this.view=new z5(e,{shows:this.shows,viewProps:this.viewProps})}};const tP=U("txt");let q5=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(tP()),t.viewProps.bindClassModifiers(this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);const i=e.createElement("input");i.classList.add(tP("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}},Du=class{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new q5(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const i=e.currentTarget.value,s=this.parser_(i);ye(s)||(this.value.rawValue=s),this.view.refresh()}};function G5(n){return String(n)}function pk(n){return n==="false"?!1:!!n}function nP(n){return G5(n)}function Y5(n){return e=>n.reduce((t,i)=>t!==null?t:i(e),null)}const X5=un(0);function Qc(n){return X5(n)+"%"}function mk(n){return String(n)}function Rv(n){return n}function ga({primary:n,secondary:e,forward:t,backward:i}){let s=!1;function r(o){s||(s=!0,o(),s=!1)}n.emitter.on("change",o=>{r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),e.emitter.on("change",o=>{r(()=>{n.setRawValue(i(n.rawValue,e.rawValue),o.options)}),r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),{forceEmit:!1,last:!0})})}function Qt(n,e){const t=n*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+t:e.downKey?-t:0}function Ru(n){return{altKey:n.altKey,downKey:n.key==="ArrowDown",shiftKey:n.shiftKey,upKey:n.key==="ArrowUp"}}function $s(n){return{altKey:n.altKey,downKey:n.key==="ArrowLeft",shiftKey:n.shiftKey,upKey:n.key==="ArrowRight"}}function W5(n){return n==="ArrowUp"||n==="ArrowDown"}function vk(n){return W5(n)||n==="ArrowLeft"||n==="ArrowRight"}function hm(n,e){var t,i;const s=e.ownerDocument.defaultView,r=e.getBoundingClientRect();return{x:n.pageX-(((t=s&&s.scrollX)!==null&&t!==void 0?t:0)+r.left),y:n.pageY-(((i=s&&s.scrollY)!==null&&i!==void 0?i:0)+r.top)}}let Fo=class{constructor(e){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new Ke,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault(),(t=e.currentTarget)===null||t===void 0||t.focus();const i=this.elem_.ownerDocument;i.addEventListener("mousemove",this.onDocumentMouseMove_),i.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(hm(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(hm(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(hm(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchMove_(e){const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchEnd_(e){var t;const i=(t=e.targetTouches.item(0))!==null&&t!==void 0?t:this.lastTouch_,s=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(i?{x:i.clientX-s.left,y:i.clientY-s.top}:void 0),sender:this,shiftKey:e.shiftKey})}};const Tn=U("txt");let Z5=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(Tn(),Tn(void 0,"num")),t.arrayPosition&&this.element.classList.add(Tn(void 0,t.arrayPosition)),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(Tn("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Tn()),this.inputElement.classList.add(Tn("i"));const s=e.createElement("div");s.classList.add(Tn("k")),this.element.appendChild(s),this.knobElement=s;const r=e.createElementNS(hi,"svg");r.classList.add(Tn("g")),this.knobElement.appendChild(r);const o=e.createElementNS(hi,"path");o.classList.add(Tn("gb")),r.appendChild(o),this.guideBodyElem_=o;const l=e.createElementNS(hi,"path");l.classList.add(Tn("gh")),r.appendChild(l),this.guideHeadElem_=l;const a=e.createElement("div");a.classList.add(U("tt")()),this.knobElement.appendChild(a),this.tooltipElem_=a,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.refresh()}onDraggingChange_(e){if(e.rawValue===null){this.element.classList.remove(Tn(void 0,"drg"));return}this.element.classList.add(Tn(void 0,"drg"));const t=e.rawValue/this.props_.get("pointerScale"),i=t+(t>0?-1:t<0?1:0),s=He(-i,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${i+s},0 L${i},4 L${i+s},8`,`M ${t},-1 L${t},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${t},4`);const r=this.props_.get("formatter");this.tooltipElem_.textContent=r(this.value.rawValue),this.tooltipElem_.style.left=`${t}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}},Ph=class{constructor(e,t){var i;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=t.parser,this.props=t.props,this.sliderProps_=(i=t.sliderProps)!==null&&i!==void 0?i:null,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=Ve(null),this.view=new Z5(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const s=new Fo(this.view.knobElement);s.emitter.on("down",this.onPointerDown_),s.emitter.on("move",this.onPointerMove_),s.emitter.on("up",this.onPointerUp_)}constrainValue_(e){var t,i;const s=(t=this.sliderProps_)===null||t===void 0?void 0:t.get("min"),r=(i=this.sliderProps_)===null||i===void 0?void 0:i.get("max");let o=e;return s!==void 0&&(o=Math.max(o,s)),r!==void 0&&(o=Math.min(o,r)),o}onInputChange_(e){const i=e.currentTarget.value,s=this.parser_(i);ye(s)||(this.value.rawValue=this.constrainValue_(s)),this.view.refresh()}onInputKeyDown_(e){const t=Qt(this.props.get("keyScale"),Ru(e));t!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+t),{forceEmit:!1,last:!1})}onInputKeyUp_(e){Qt(this.props.get("keyScale"),Ru(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;const t=e.point.x-e.bounds.width/2;return this.constrainValue_(this.originRawValue_+t*this.props.get("pointerScale"))}onPointerMove_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}};const cm=U("sld");let Q5=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(cm()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(cm("t")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.trackElement=i;const s=e.createElement("div");s.classList.add(cm("k")),this.trackElement.appendChild(s),this.knobElement=s,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}update_(){const e=He(ie(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${e}%`}onChange_(){this.update_()}},J5=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.props=t.props,this.view=new Q5(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Fo(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){e.point&&this.value.setRawValue(ie(He(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("min"),this.props.get("max")),t)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Qt(this.props.get("keyScale"),$s(e));t!==0&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onKeyUp_(e){Qt(this.props.get("keyScale"),$s(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const dm=U("sldtxt");let e3=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(dm());const i=e.createElement("div");i.classList.add(dm("s")),this.sliderView_=t.sliderView,i.appendChild(this.sliderView_.element),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(dm("t")),this.textView_=t.textView,s.appendChild(this.textView_.element),this.element.appendChild(s)}},Jc=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sliderC_=new J5(e,{props:t.sliderProps,value:t.value,viewProps:this.viewProps}),this.textC_=new Ph(e,{parser:t.parser,props:t.textProps,sliderProps:t.sliderProps,value:t.value,viewProps:t.viewProps}),this.view=new e3(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(e){return yn(e,null,t=>({max:t.required.number,min:t.required.number}),t=>{const i=this.sliderC_.props;return i.set("max",t.max),i.set("min",t.min),!0})}exportProps(){const e=this.sliderC_.props;return En(null,{max:e.get("max"),min:e.get("min")})}};function fk(n){return{sliderProps:new I({keyScale:n.keyScale,max:n.max,min:n.min}),textProps:new I({formatter:Ve(n.formatter),keyScale:n.keyScale,pointerScale:Ve(n.pointerScale)})}}const t3={containerUnitSize:"cnt-usz"};function _k(n){return`--${t3[n]}`}function Ou(n){return ZV(n)}function pr(n){if(Lv(n))return Oe(n,Ou)}function os(n,e){if(!n)return;const t=[],i=YV(n,e);i&&t.push(i);const s=XV(n);return s&&t.push(s),new bh(t)}function n3(n){return n?n.major===wa.major:!1}function wk(n){if(n==="inline"||n==="popup")return n}function yh(n,e){n.write(e)}const ic=U("ckb");let i3=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(ic()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("label");i.classList.add(ic("l")),this.element.appendChild(i);const s=e.createElement("input");s.classList.add(ic("i")),s.type="checkbox",i.appendChild(s),this.inputElement=s,t.viewProps.bindDisabled(this.inputElement);const r=e.createElement("div");r.classList.add(ic("w")),i.appendChild(r);const o=Bd(e,"check");r.appendChild(o),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}},s3=class{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new i3(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const t=e.currentTarget;this.value.rawValue=t.checked}};function r3(n){const e=[],t=Z_(n.options);return t&&e.push(t),new bh(e)}const o3=Yt({id:"input-bool",type:"input",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=Oe(e,i=>({options:i.optional.custom(Ch),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>pk,constraint:n=>r3(n.params),writer:n=>yh},controller:n=>{const e=n.document,t=n.value,i=n.constraint,s=i&&Zc(i,gh);return s?new Mr(e,{props:new I({options:s.values.value("options")}),value:t,viewProps:n.viewProps}):new s3(e,{value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="boolean"?null:n.controller.valueController instanceof Mr?new X_(n.controller):null}}),Gr=U("col");let l3=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Gr()),t.foldable.bindExpandedClass(this.element,Gr(void 0,"expanded")),wi(t.foldable,"completed",_a(this.element,Gr(void 0,"cpl")));const i=e.createElement("div");i.classList.add(Gr("h")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Gr("s")),i.appendChild(s),this.swatchElement=s;const r=e.createElement("div");if(r.classList.add(Gr("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(Gr("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}};function a3(n,e,t){const i=He(n/255,0,1),s=He(e/255,0,1),r=He(t/255,0,1),o=Math.max(i,s,r),l=Math.min(i,s,r),a=o-l;let u=0,h=0;const c=(l+o)/2;return a!==0&&(h=a/(1-Math.abs(o+l-1)),i===o?u=(s-r)/a:s===o?u=2+(r-i)/a:u=4+(i-s)/a,u=u/6+(u<0?1:0)),[u*360,h*100,c*100]}function u3(n,e,t){const i=(n%360+360)%360,s=He(e/100,0,1),r=He(t/100,0,1),o=(1-Math.abs(2*r-1))*s,l=o*(1-Math.abs(i/60%2-1)),a=r-o/2;let u,h,c;return i>=0&&i<60?[u,h,c]=[o,l,0]:i>=60&&i<120?[u,h,c]=[l,o,0]:i>=120&&i<180?[u,h,c]=[0,o,l]:i>=180&&i<240?[u,h,c]=[0,l,o]:i>=240&&i<300?[u,h,c]=[l,0,o]:[u,h,c]=[o,0,l],[(u+a)*255,(h+a)*255,(c+a)*255]}function h3(n,e,t){const i=He(n/255,0,1),s=He(e/255,0,1),r=He(t/255,0,1),o=Math.max(i,s,r),l=Math.min(i,s,r),a=o-l;let u;a===0?u=0:o===i?u=60*(((s-r)/a%6+6)%6):o===s?u=60*((r-i)/a+2):u=60*((i-s)/a+4);const h=o===0?0:a/o,c=o;return[u,h*100,c*100]}function bk(n,e,t){const i=zV(n,360),s=He(e/100,0,1),r=He(t/100,0,1),o=r*s,l=o*(1-Math.abs(i/60%2-1)),a=r-o;let u,h,c;return i>=0&&i<60?[u,h,c]=[o,l,0]:i>=60&&i<120?[u,h,c]=[l,o,0]:i>=120&&i<180?[u,h,c]=[0,o,l]:i>=180&&i<240?[u,h,c]=[0,l,o]:i>=240&&i<300?[u,h,c]=[l,0,o]:[u,h,c]=[o,0,l],[(u+a)*255,(h+a)*255,(c+a)*255]}function c3(n,e,t){const i=t+e*(100-Math.abs(2*t-100))/200;return[n,i!==0?e*(100-Math.abs(2*t-100))/i:0,t+e*(100-Math.abs(2*t-100))/(2*100)]}function d3(n,e,t){const i=100-Math.abs(t*(200-e)/100-100);return[n,i!==0?e*t/i:0,t*(200-e)/(2*100)]}function bi(n){return[n[0],n[1],n[2]]}function Fd(n,e){return[n[0],n[1],n[2],e]}const p3={hsl:{hsl:(n,e,t)=>[n,e,t],hsv:c3,rgb:u3},hsv:{hsl:d3,hsv:(n,e,t)=>[n,e,t],rgb:bk},rgb:{hsl:a3,hsv:h3,rgb:(n,e,t)=>[n,e,t]}};function Xl(n,e){return[e==="float"?1:n==="rgb"?255:360,e==="float"?1:n==="rgb"?255:100,e==="float"?1:n==="rgb"?255:100]}function m3(n,e){return n===e?e:zV(n,e)}function gk(n,e,t){var i;const s=Xl(e,t);return[e==="rgb"?He(n[0],0,s[0]):m3(n[0],s[0]),He(n[1],0,s[1]),He(n[2],0,s[2]),He((i=n[3])!==null&&i!==void 0?i:1,0,1)]}function iP(n,e,t,i){const s=Xl(e,t),r=Xl(e,i);return n.map((o,l)=>o/s[l]*r[l])}function Ck(n,e,t){const i=iP(n,e.mode,e.type,"int"),s=p3[e.mode][t.mode](...i);return iP(s,t.mode,"int",t.type)}let ce=class Pk{static black(){return new Pk([0,0,0],"rgb")}constructor(e,t){this.type="int",this.mode=t,this.comps_=gk(e,t,this.type)}getComponents(e){return Fd(Ck(bi(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}};const Ks=U("colp");let v3=class{constructor(e,t){this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(Ks()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Ks("hsv"));const s=e.createElement("div");s.classList.add(Ks("sv")),this.svPaletteView_=t.svPaletteView,s.appendChild(this.svPaletteView_.element),i.appendChild(s);const r=e.createElement("div");r.classList.add(Ks("h")),this.hPaletteView_=t.hPaletteView,r.appendChild(this.hPaletteView_.element),i.appendChild(r),this.element.appendChild(i);const o=e.createElement("div");if(o.classList.add(Ks("rgb")),this.textsView_=t.textsView,o.appendChild(this.textsView_.element),this.element.appendChild(o),t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};const l=e.createElement("div");l.classList.add(Ks("a"));const a=e.createElement("div");a.classList.add(Ks("ap")),a.appendChild(this.alphaViews_.palette.element),l.appendChild(a);const u=e.createElement("div");u.classList.add(Ks("at")),u.appendChild(this.alphaViews_.text.element),l.appendChild(u),this.element.appendChild(l)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map(t=>t.inputElement)];return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}};function f3(n){return n==="int"?"int":n==="float"?"float":void 0}function Q_(n){return Oe(n,e=>({color:e.optional.object({alpha:e.optional.boolean,type:e.optional.custom(f3)}),expanded:e.optional.boolean,picker:e.optional.custom(wk),readonly:e.optional.constant(!1)}))}function wo(n){return n?.1:1}function yk(n){var e;return(e=n.color)===null||e===void 0?void 0:e.type}let J_=class{constructor(e,t){this.type="float",this.mode=t,this.comps_=gk(e,t,this.type)}getComponents(e){return Fd(Ck(bi(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}};const _3={int:(n,e)=>new ce(n,e),float:(n,e)=>new J_(n,e)};function ew(n,e,t){return _3[t](n,e)}function w3(n){return n.type==="float"}function b3(n){return n.type==="int"}function g3(n){const e=n.getComponents(),t=Xl(n.mode,"int");return new ce([Math.round(ie(e[0],0,1,0,t[0])),Math.round(ie(e[1],0,1,0,t[1])),Math.round(ie(e[2],0,1,0,t[2])),e[3]],n.mode)}function C3(n){const e=n.getComponents(),t=Xl(n.mode,"int");return new J_([ie(e[0],0,t[0],0,1),ie(e[1],0,t[1],0,1),ie(e[2],0,t[2],0,1),e[3]],n.mode)}function jt(n,e){if(n.type===e)return n;if(b3(n)&&e==="float")return C3(n);if(w3(n)&&e==="int")return g3(n);throw yt.shouldNeverHappen()}function P3(n,e){return n.alpha===e.alpha&&n.mode===e.mode&&n.notation===e.notation&&n.type===e.type}function Kn(n,e){const t=n.match(/^(.+)%$/);return Math.min(t?parseFloat(t[1])*.01*e:parseFloat(n),e)}const y3={deg:n=>n,grad:n=>n*360/400,rad:n=>n*360/(2*Math.PI),turn:n=>n*360};function Ek(n){const e=n.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(n);const t=parseFloat(e[1]),i=e[2];return y3[i](t)}function xk(n){const e=n.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Kn(e[1],255),Kn(e[2],255),Kn(e[3],255)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function E3(n){const e=xk(n);return e?new ce(e,"rgb"):null}function $k(n){const e=n.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Kn(e[1],255),Kn(e[2],255),Kn(e[3],255),Kn(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function x3(n){const e=$k(n);return e?new ce(e,"rgb"):null}function Vk(n){const e=n.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Ek(e[1]),Kn(e[2],100),Kn(e[3],100)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function $3(n){const e=Vk(n);return e?new ce(e,"hsl"):null}function kk(n){const e=n.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Ek(e[1]),Kn(e[2],100),Kn(e[3],100),Kn(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function V3(n){const e=kk(n);return e?new ce(e,"hsl"):null}function Sk(n){const e=n.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];const t=n.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}function k3(n){const e=Sk(n);return e?new ce(e,"rgb"):null}function Lk(n){const e=n.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),ie(parseInt(e[4]+e[4],16),0,255,0,1)];const t=n.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),ie(parseInt(t[4],16),0,255,0,1)]:null}function S3(n){const e=Lk(n);return e?new ce(e,"rgb"):null}function Ak(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function sP(n){return e=>{const t=Ak(e);return t?ew(t,"rgb",n):null}}function Mk(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function rP(n){return e=>{const t=Mk(e);return t?ew(t,"rgb",n):null}}const L3=[{parser:Sk,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:Lk,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:xk,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:$k,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:Vk,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:kk,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:Ak,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:Mk,result:{alpha:!0,mode:"rgb",notation:"object"}}];function A3(n){return L3.reduce((e,{parser:t,result:i})=>e||(t(n)?i:null),null)}function M3(n,e="int"){const t=A3(n);return t?t.notation==="hex"&&e!=="float"?Object.assign(Object.assign({},t),{type:"int"}):t.notation==="func"?Object.assign(Object.assign({},t),{type:e}):null:null}function Eh(n){const e=[k3,S3,E3,x3,$3,V3];n==="int"&&e.push(sP("int"),rP("int")),n==="float"&&e.push(sP("float"),rP("float"));const t=Y5(e);return i=>{const s=t(i);return s?jt(s,n):null}}function T3(n){const e=Eh("int");if(typeof n!="string")return ce.black();const t=e(n);return t??ce.black()}function Tk(n){const e=He(Math.floor(n),0,255).toString(16);return e.length===1?`0${e}`:e}function tw(n,e="#"){const t=bi(n.getComponents("rgb")).map(Tk).join("");return`${e}${t}`}function nw(n,e="#"){const t=n.getComponents("rgb"),i=[t[0],t[1],t[2],t[3]*255].map(Tk).join("");return`${e}${i}`}function Dk(n){const e=un(0),t=jt(n,"int");return`rgb(${bi(t.getComponents("rgb")).map(s=>e(s)).join(", ")})`}function Cc(n){const e=un(2),t=un(0);return`rgba(${jt(n,"int").getComponents("rgb").map((r,o)=>(o===3?e:t)(r)).join(", ")})`}function D3(n){const e=[un(0),Qc,Qc],t=jt(n,"int");return`hsl(${bi(t.getComponents("hsl")).map((s,r)=>e[r](s)).join(", ")})`}function R3(n){const e=[un(0),Qc,Qc,un(2)];return`hsla(${jt(n,"int").getComponents("hsl").map((s,r)=>e[r](s)).join(", ")})`}function Rk(n,e){const t=un(e==="float"?2:0),i=["r","g","b"],s=jt(n,e);return`{${bi(s.getComponents("rgb")).map((o,l)=>`${i[l]}: ${t(o)}`).join(", ")}}`}function O3(n){return e=>Rk(e,n)}function Ok(n,e){const t=un(2),i=un(e==="float"?2:0),s=["r","g","b","a"];return`{${jt(n,e).getComponents("rgb").map((l,a)=>{const u=a===3?t:i;return`${s[a]}: ${u(l)}`}).join(", ")}}`}function j3(n){return e=>Ok(e,n)}const N3=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:tw},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:nw},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:Dk},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:Cc},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:D3},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:R3},...["int","float"].reduce((n,e)=>[...n,{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:O3(e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:j3(e)}],[])];function jk(n){return N3.reduce((e,t)=>e||(P3(t.format,n)?t.stringifier:null),null)}const Wa=U("apl");let B3=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Wa()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(Wa("b")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Wa("c")),i.appendChild(s),this.colorElem_=s;const r=e.createElement("div");r.classList.add(Wa("m")),this.element.appendChild(r),this.markerElem_=r;const o=e.createElement("div");o.classList.add(Wa("p")),this.markerElem_.appendChild(o),this.previewElem_=o,this.update_()}update_(){const e=this.value.rawValue,t=e.getComponents("rgb"),i=new ce([t[0],t[1],t[2],0],"rgb"),s=new ce([t[0],t[1],t[2],255],"rgb"),r=["to right",Cc(i),Cc(s)];this.colorElem_.style.background=`linear-gradient(${r.join(",")})`,this.previewElem_.style.backgroundColor=Cc(e);const o=ie(t[3],0,1,0,100);this.markerElem_.style.left=`${o}%`}onValueChange_(){this.update_()}},I3=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new B3(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Fo(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=e.point.x/e.bounds.width,s=this.value.rawValue,[r,o,l]=s.getComponents("hsv");this.value.setRawValue(new ce([r,o,l,i],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Qt(wo(!0),$s(e));if(t===0)return;const i=this.value.rawValue,[s,r,o,l]=i.getComponents("hsv");this.value.setRawValue(new ce([s,r,o,l+t],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){Qt(wo(!0),$s(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const el=U("coltxt");function F3(n){const e=n.createElement("select"),t=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}];return e.appendChild(t.reduce((i,s)=>{const r=n.createElement("option");return r.textContent=s.text,r.value=s.value,i.appendChild(r),i},n.createDocumentFragment())),e}let K3=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(el()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(el("m")),this.modeElem_=F3(e),this.modeElem_.classList.add(el("ms")),i.appendChild(this.modeSelectElement),t.viewProps.bindDisabled(this.modeElem_);const s=e.createElement("div");s.classList.add(el("mm")),s.appendChild(Bd(e,"dropdown")),i.appendChild(s),this.element.appendChild(i);const r=e.createElement("div");r.classList.add(el("w")),this.element.appendChild(r),this.inputsElem_=r,this.inputViews_=t.inputViews,this.applyInputViews_(),vs(t.mode,o=>{this.modeElem_.value=o})}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(e){this.inputViews_=e,this.applyInputViews_()}applyInputViews_(){ek(this.inputsElem_);const e=this.element.ownerDocument;this.inputViews_.forEach(t=>{const i=e.createElement("div");i.classList.add(el("c")),i.appendChild(t.element),this.inputsElem_.appendChild(i)})}};function U3(n){return un(n==="float"?2:0)}function H3(n,e,t){const i=Xl(n,e)[t];return new _h({min:0,max:i})}function z3(n,e,t){return new Ph(n,{arrayPosition:t===0?"fst":t===2?"lst":"mid",parser:e.parser,props:I.fromObject({formatter:U3(e.colorType),keyScale:wo(!1),pointerScale:e.colorType==="float"?.01:1}),value:Ve(0,{constraint:H3(e.colorMode,e.colorType,t)}),viewProps:e.viewProps})}function q3(n,e){const t={colorMode:e.colorMode,colorType:e.colorType,parser:xs,viewProps:e.viewProps};return[0,1,2].map(i=>{const s=z3(n,t,i);return ga({primary:e.value,secondary:s.value,forward(r){return jt(r,e.colorType).getComponents(e.colorMode)[i]},backward(r,o){const l=e.colorMode,u=jt(r,e.colorType).getComponents(l);u[i]=o;const h=ew(Fd(bi(u),u[3]),l,e.colorType);return jt(h,"int")}}),s})}function G3(n,e){const t=new Du(n,{parser:Eh("int"),props:I.fromObject({formatter:tw}),value:Ve(ce.black()),viewProps:e.viewProps});return ga({primary:e.value,secondary:t.value,forward:i=>new ce(bi(i.getComponents()),i.mode),backward:(i,s)=>new ce(Fd(bi(s.getComponents(i.mode)),i.getComponents()[3]),i.mode)}),[t]}function Y3(n){return n!=="hex"}let X3=class{constructor(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=t.colorType,this.value=t.value,this.viewProps=t.viewProps,this.colorMode=Ve(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new K3(e,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const t=this.colorMode.rawValue;return Y3(t)?q3(e,{colorMode:t,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):G3(e,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(e){const t=e.currentTarget;this.colorMode.rawValue=t.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map(i=>i.view)}};const pm=U("hpl");let W3=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(pm()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(pm("c")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(pm("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=this.value.rawValue,[t]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=Dk(new ce([t,100,100],"hsv"));const i=ie(t,0,360,0,100);this.markerElem_.style.left=`${i}%`}onValueChange_(){this.update_()}},Z3=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new W3(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Fo(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=ie(He(e.point.x,0,e.bounds.width),0,e.bounds.width,0,360),s=this.value.rawValue,[,r,o,l]=s.getComponents("hsv");this.value.setRawValue(new ce([i,r,o,l],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Qt(wo(!1),$s(e));if(t===0)return;const i=this.value.rawValue,[s,r,o,l]=i.getComponents("hsv");this.value.setRawValue(new ce([s+t,r,o,l],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){Qt(wo(!1),$s(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const mm=U("svp"),oP=64;let Q3=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(mm()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("canvas");i.height=oP,i.width=oP,i.classList.add(mm("c")),this.element.appendChild(i),this.canvasElement=i;const s=e.createElement("div");s.classList.add(mm("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=JF(this.canvasElement);if(!e)return;const i=this.value.rawValue.getComponents("hsv"),s=this.canvasElement.width,r=this.canvasElement.height,o=e.getImageData(0,0,s,r),l=o.data;for(let h=0;h<r;h++)for(let c=0;c<s;c++){const p=ie(c,0,s,0,100),d=ie(h,0,r,100,0),m=bk(i[0],p,d),f=(h*s+c)*4;l[f]=m[0],l[f+1]=m[1],l[f+2]=m[2],l[f+3]=255}e.putImageData(o,0,0);const a=ie(i[1],0,100,0,100);this.markerElem_.style.left=`${a}%`;const u=ie(i[2],0,100,100,0);this.markerElem_.style.top=`${u}%`}onValueChange_(){this.update_()}},J3=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new Q3(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Fo(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=ie(e.point.x,0,e.bounds.width,0,100),s=ie(e.point.y,0,e.bounds.height,100,0),[r,,,o]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new ce([r,i,s,o],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){vk(e.key)&&e.preventDefault();const[t,i,s,r]=this.value.rawValue.getComponents("hsv"),o=wo(!1),l=Qt(o,$s(e)),a=Qt(o,Ru(e));l===0&&a===0||this.value.setRawValue(new ce([t,i+l,s+a,r],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){const t=wo(!1),i=Qt(t,$s(e)),s=Qt(t,Ru(e));i===0&&s===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},eK=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.hPaletteC_=new Z3(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new J3(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=t.supportsAlpha?{palette:new I3(e,{value:this.value,viewProps:this.viewProps}),text:new Ph(e,{parser:xs,props:I.fromObject({pointerScale:.01,keyScale:.1,formatter:un(2)}),value:Ve(0,{constraint:new _h({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&ga({primary:this.value,secondary:this.alphaIcs_.text.value,forward:i=>i.getComponents()[3],backward:(i,s)=>{const r=i.getComponents();return r[3]=s,new ce(r,i.mode)}}),this.textsC_=new X3(e,{colorType:t.colorType,value:this.value,viewProps:this.viewProps}),this.view=new v3(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}};const vm=U("colsw");let tK=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(vm()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(vm("sw")),this.element.appendChild(i),this.swatchElem_=i;const s=e.createElement("button");s.classList.add(vm("b")),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s,this.update_()}update_(){const e=this.value.rawValue;this.swatchElem_.style.backgroundColor=nw(e)}onValueChange_(){this.update_()}},nK=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new tK(e,{value:this.value,viewProps:this.viewProps})}},iw=class{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=G_.create(t.expanded),this.swatchC_=new nK(e,{value:this.value,viewProps:this.viewProps});const i=this.swatchC_.view.buttonElement;i.addEventListener("blur",this.onButtonBlur_),i.addEventListener("click",this.onButtonClick_),this.textC_=new Du(e,{parser:t.parser,props:I.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new l3(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=t.pickerLayout==="popup"?new dk(e,{viewProps:this.viewProps}):null;const s=new eK(e,{colorType:t.colorType,supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});s.view.allFocusableElements.forEach(r=>{r.addEventListener("blur",this.onPopupChildBlur_),r.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=s,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(s.view.element),ga({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:r=>r,backward:(r,o)=>o})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Y_(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=tk(e);i&&t.contains(i)||i&&i===this.swatchC_.view.buttonElement&&!F_(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}};function iK(n){return bi(n.getComponents("rgb")).reduce((e,t)=>e<<8|Math.floor(t)&255,0)}function sK(n){return n.getComponents("rgb").reduce((e,t,i)=>{const s=Math.floor(i===3?t*255:t)&255;return e<<8|s},0)>>>0}function rK(n){return new ce([n>>16&255,n>>8&255,n&255],"rgb")}function oK(n){return new ce([n>>24&255,n>>16&255,n>>8&255,ie(n&255,0,255,0,1)],"rgb")}function lK(n){return typeof n!="number"?ce.black():rK(n)}function aK(n){return typeof n!="number"?ce.black():oK(n)}function Pc(n,e){return typeof n!="object"||ye(n)?!1:e in n&&typeof n[e]=="number"}function Nk(n){return Pc(n,"r")&&Pc(n,"g")&&Pc(n,"b")}function Bk(n){return Nk(n)&&Pc(n,"a")}function Ik(n){return Nk(n)}function sw(n,e){if(n.mode!==e.mode||n.type!==e.type)return!1;const t=n.getComponents(),i=e.getComponents();for(let s=0;s<t.length;s++)if(t[s]!==i[s])return!1;return!0}function lP(n){return"a"in n?[n.r,n.g,n.b,n.a]:[n.r,n.g,n.b]}function uK(n){const e=jk(n);return e?(t,i)=>{yh(t,e(i))}:null}function hK(n){const e=n?sK:iK;return(t,i)=>{yh(t,e(i))}}function cK(n,e,t){const s=jt(e,t).toRgbaObject();n.writeProperty("r",s.r),n.writeProperty("g",s.g),n.writeProperty("b",s.b),n.writeProperty("a",s.a)}function dK(n,e,t){const s=jt(e,t).toRgbaObject();n.writeProperty("r",s.r),n.writeProperty("g",s.g),n.writeProperty("b",s.b)}function pK(n,e){return(t,i)=>{n?cK(t,i,e):dK(t,i,e)}}function mK(n){var e;return!!(!((e=n?.color)===null||e===void 0)&&e.alpha)}function vK(n){return n?e=>nw(e,"0x"):e=>tw(e,"0x")}function fK(n){return"color"in n||n.view==="color"}const _K=Yt({id:"input-color-number",type:"input",accept:(n,e)=>{if(typeof n!="number"||!fK(e))return null;const t=Q_(e);return t?{initialValue:n,params:Object.assign(Object.assign({},t),{supportsAlpha:mK(e)})}:null},binding:{reader:n=>n.params.supportsAlpha?aK:lK,equals:sw,writer:n=>hK(n.params.supportsAlpha)},controller:n=>{var e,t;return new iw(n.document,{colorType:"int",expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:vK(n.params.supportsAlpha),parser:Eh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.supportsAlpha,value:n.value,viewProps:n.viewProps})}});function wK(n,e){if(!Ik(n))return jt(ce.black(),e);if(e==="int"){const t=lP(n);return new ce(t,"rgb")}if(e==="float"){const t=lP(n);return new J_(t,"rgb")}return jt(ce.black(),"int")}function bK(n){return Bk(n)}function gK(n){return e=>{const t=wK(e,n);return jt(t,"int")}}function CK(n,e){return t=>n?Ok(t,e):Rk(t,e)}const PK=Yt({id:"input-color-object",type:"input",accept:(n,e)=>{var t;if(!Ik(n))return null;const i=Q_(e);return i?{initialValue:n,params:Object.assign(Object.assign({},i),{colorType:(t=yk(e))!==null&&t!==void 0?t:"int"})}:null},binding:{reader:n=>gK(n.params.colorType),equals:sw,writer:n=>pK(bK(n.initialValue),n.params.colorType)},controller:n=>{var e,t;const i=Bk(n.initialValue);return new iw(n.document,{colorType:n.params.colorType,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:CK(i,n.params.colorType),parser:Eh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:i,value:n.value,viewProps:n.viewProps})}}),yK=Yt({id:"input-color-string",type:"input",accept:(n,e)=>{if(typeof n!="string"||e.view==="text")return null;const t=M3(n,yk(e));if(!t)return null;const i=jk(t);if(!i)return null;const s=Q_(e);return s?{initialValue:n,params:Object.assign(Object.assign({},s),{format:t,stringifier:i})}:null},binding:{reader:()=>T3,equals:sw,writer:n=>{const e=uK(n.params.format);if(!e)throw yt.notBindable();return e}},controller:n=>{var e,t;return new iw(n.document,{colorType:n.params.format.type,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:n.params.stringifier,parser:Eh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.format.alpha,value:n.value,viewProps:n.viewProps})}});let rw=class{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map((i,s)=>{var r,o;return(o=(r=this.components[s])===null||r===void 0?void 0:r.constrain(i))!==null&&o!==void 0?o:i});return this.asm_.fromComponents(t)}};const aP=U("pndtxt");let EK=class{constructor(e,t){this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add(aP()),this.textViews.forEach(i=>{const s=e.createElement("div");s.classList.add(aP("a")),s.appendChild(i.element),this.element.appendChild(s)})}};function xK(n,e,t){return new Ph(n,{arrayPosition:t===0?"fst":t===e.axes.length-1?"lst":"mid",parser:e.parser,props:e.axes[t].textProps,value:Ve(0,{constraint:e.axes[t].constraint}),viewProps:e.viewProps})}let ow=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map((i,s)=>xK(e,t,s)),this.acs_.forEach((i,s)=>{ga({primary:this.value,secondary:i.value,forward:r=>t.assembly.toComponents(r)[s],backward:(r,o)=>{const l=t.assembly.toComponents(r);return l[s]=o,t.assembly.fromComponents(l)}})}),this.view=new EK(e,{textViews:this.acs_.map(i=>i.view)})}get textControllers(){return this.acs_}},$K=class extends Tu{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(e){this.controller.valueController.sliderController.props.set("max",e)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(e){this.controller.valueController.sliderController.props.set("min",e)}};function VK(n,e){const t=[],i=YV(n,e);i&&t.push(i);const s=XV(n);s&&t.push(s);const r=Z_(n.options);return r&&t.push(r),new bh(t)}const kK=Yt({id:"input-number",type:"input",accept:(n,e)=>{if(typeof n!="number")return null;const t=Oe(e,i=>Object.assign(Object.assign({},ZV(i)),{options:i.optional.custom(Ch),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>HV,constraint:n=>VK(n.params,n.initialValue),writer:n=>yh},controller:n=>{const e=n.value,t=n.constraint,i=t&&Zc(t,gh);if(i)return new Mr(n.document,{props:new I({options:i.values.value("options")}),value:e,viewProps:n.viewProps});const s=WV(n.params,e.rawValue),r=t&&Zc(t,_h);return r?new Jc(n.document,Object.assign(Object.assign({},fk(Object.assign(Object.assign({},s),{keyScale:Ve(s.keyScale),max:r.values.value("max"),min:r.values.value("min")}))),{parser:xs,value:e,viewProps:n.viewProps})):new Ph(n.document,{parser:xs,props:I.fromObject(s),value:e,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="number"?null:n.controller.valueController instanceof Jc?new $K(n.controller):n.controller.valueController instanceof Mr?new X_(n.controller):null}});let gr=class{constructor(e=0,t=0){this.x=e,this.y=t}getComponents(){return[this.x,this.y]}static isObject(e){if(ye(e))return!1;const t=e.x,i=e.y;return!(typeof t!="number"||typeof i!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y}toObject(){return{x:this.x,y:this.y}}};const Fk={toComponents:n=>n.getComponents(),fromComponents:n=>new gr(...n)},tl=U("p2d");let SK=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(tl()),t.viewProps.bindClassModifiers(this.element),vs(t.expanded,_a(this.element,tl(void 0,"expanded")));const i=e.createElement("div");i.classList.add(tl("h")),this.element.appendChild(i);const s=e.createElement("button");s.classList.add(tl("b")),s.appendChild(Bd(e,"p2dpad")),t.viewProps.bindDisabled(s),i.appendChild(s),this.buttonElement=s;const r=e.createElement("div");if(r.classList.add(tl("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(tl("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}};const Us=U("p2dp");let LK=class{constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=e.createElement("div"),this.element.classList.add(Us()),t.layout==="popup"&&this.element.classList.add(Us(void 0,"p")),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Us("p")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.padElement=i;const s=e.createElementNS(hi,"svg");s.classList.add(Us("g")),this.padElement.appendChild(s),this.svgElem_=s;const r=e.createElementNS(hi,"line");r.classList.add(Us("ax")),r.setAttributeNS(null,"x1","0"),r.setAttributeNS(null,"y1","50%"),r.setAttributeNS(null,"x2","100%"),r.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(r);const o=e.createElementNS(hi,"line");o.classList.add(Us("ax")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","0"),o.setAttributeNS(null,"x2","50%"),o.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(o);const l=e.createElementNS(hi,"line");l.classList.add(Us("l")),l.setAttributeNS(null,"x1","50%"),l.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(l),this.lineElem_=l;const a=e.createElement("div");a.classList.add(Us("m")),this.padElement.appendChild(a),this.markerElem_=a,t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,t]=this.value.rawValue.getComponents(),i=this.props_.get("max"),s=ie(e,-i,+i,0,100),r=ie(t,-i,+i,0,100),o=this.props_.get("invertsY")?100-r:r;this.lineElem_.setAttributeNS(null,"x2",`${s}%`),this.lineElem_.setAttributeNS(null,"y2",`${o}%`),this.markerElem_.style.left=`${s}%`,this.markerElem_.style.top=`${o}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}};function uP(n,e,t){return[Qt(e[0],$s(n)),Qt(e[1],Ru(n))*(t?1:-1)]}let AK=class{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new LK(e,{layout:t.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Fo(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=this.props.get("max"),s=ie(e.point.x,0,e.bounds.width,-i,+i),r=ie(this.props.get("invertsY")?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-i,+i);this.value.setRawValue(new gr(s,r),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onPadKeyDown_(e){vk(e.key)&&e.preventDefault();const[t,i]=uP(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(new gr(this.value.rawValue.x+t,this.value.rawValue.y+i),{forceEmit:!1,last:!1})}onPadKeyUp_(e){const[t,i]=uP(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},MK=class{constructor(e,t){var i,s;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=G_.create(t.expanded),this.popC_=t.pickerLayout==="popup"?new dk(e,{viewProps:this.viewProps}):null;const r=new AK(e,{layout:t.pickerLayout,props:new I({invertsY:Ve(t.invertsY),max:Ve(t.max),xKeyScale:t.axes[0].textProps.value("keyScale"),yKeyScale:t.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});r.view.allFocusableElements.forEach(o=>{o.addEventListener("blur",this.onPopupChildBlur_),o.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=r,this.textC_=new ow(e,{assembly:Fk,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new SK(e,{expanded:this.foldable_.value("expanded"),pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(i=this.view.buttonElement)===null||i===void 0||i.addEventListener("blur",this.onPadButtonBlur_),(s=this.view.buttonElement)===null||s===void 0||s.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),ga({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:o=>o,backward:(o,l)=>l})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Y_(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=tk(e);i&&t.contains(i)||i&&i===this.view.buttonElement&&!F_(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.view.buttonElement.focus()}};function TK(n){return gr.isObject(n)?new gr(n.x,n.y):new gr}function DK(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y)}function RK(n,e){return new rw({assembly:Fk,components:[os(Object.assign(Object.assign({},n),n.x),e.x),os(Object.assign(Object.assign({},n),n.y),e.y)]})}function hP(n,e){var t,i;if(!ye(n.min)||!ye(n.max))return Math.max(Math.abs((t=n.min)!==null&&t!==void 0?t:0),Math.abs((i=n.max)!==null&&i!==void 0?i:0));const s=qV(n);return Math.max(Math.abs(s)*10,Math.abs(e)*10)}function OK(n,e){var t,i;const s=hP(fo(n,(t=n.x)!==null&&t!==void 0?t:{}),e.x),r=hP(fo(n,(i=n.y)!==null&&i!==void 0?i:{}),e.y);return Math.max(s,r)}function jK(n){if(!("y"in n))return!1;const e=n.y;return e&&"inverted"in e?!!e.inverted:!1}const NK=Yt({id:"input-point2d",type:"input",accept:(n,e)=>{if(!gr.isObject(n))return null;const t=Oe(e,i=>Object.assign(Object.assign({},Ou(i)),{expanded:i.optional.boolean,picker:i.optional.custom(wk),readonly:i.optional.constant(!1),x:i.optional.custom(pr),y:i.optional.object(Object.assign(Object.assign({},Ou(i)),{inverted:i.optional.boolean}))}));return t?{initialValue:n,params:t}:null},binding:{reader:()=>TK,constraint:n=>RK(n.params,n.initialValue),equals:gr.equals,writer:()=>DK},controller:n=>{var e,t;const i=n.document,s=n.value,r=n.constraint,o=[n.params.x,n.params.y];return new MK(i,{axes:s.rawValue.getComponents().map((l,a)=>{var u;return I_({constraint:r.components[a],initialValue:l,params:fo(n.params,(u=o[a])!==null&&u!==void 0?u:{})})}),expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,invertsY:jK(n.params),max:OK(n.params,s.rawValue),parser:xs,pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",value:s,viewProps:n.viewProps})}});let Ll=class{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if(ye(e))return!1;const t=e.x,i=e.y,s=e.z;return!(typeof t!="number"||typeof i!="number"||typeof s!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}};const Kk={toComponents:n=>n.getComponents(),fromComponents:n=>new Ll(...n)};function BK(n){return Ll.isObject(n)?new Ll(n.x,n.y,n.z):new Ll}function IK(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z)}function FK(n,e){return new rw({assembly:Kk,components:[os(Object.assign(Object.assign({},n),n.x),e.x),os(Object.assign(Object.assign({},n),n.y),e.y),os(Object.assign(Object.assign({},n),n.z),e.z)]})}const KK=Yt({id:"input-point3d",type:"input",accept:(n,e)=>{if(!Ll.isObject(n))return null;const t=Oe(e,i=>Object.assign(Object.assign({},Ou(i)),{readonly:i.optional.constant(!1),x:i.optional.custom(pr),y:i.optional.custom(pr),z:i.optional.custom(pr)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>BK,constraint:n=>FK(n.params,n.initialValue),equals:Ll.equals,writer:n=>IK},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z];return new ow(n.document,{assembly:Kk,axes:e.rawValue.getComponents().map((s,r)=>{var o;return I_({constraint:t.components[r],initialValue:s,params:fo(n.params,(o=i[r])!==null&&o!==void 0?o:{})})}),parser:xs,value:e,viewProps:n.viewProps})}});let Al=class{constructor(e=0,t=0,i=0,s=0){this.x=e,this.y=t,this.z=i,this.w=s}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if(ye(e))return!1;const t=e.x,i=e.y,s=e.z,r=e.w;return!(typeof t!="number"||typeof i!="number"||typeof s!="number"||typeof r!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}};const Uk={toComponents:n=>n.getComponents(),fromComponents:n=>new Al(...n)};function UK(n){return Al.isObject(n)?new Al(n.x,n.y,n.z,n.w):new Al}function HK(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z),n.writeProperty("w",e.w)}function zK(n,e){return new rw({assembly:Uk,components:[os(Object.assign(Object.assign({},n),n.x),e.x),os(Object.assign(Object.assign({},n),n.y),e.y),os(Object.assign(Object.assign({},n),n.z),e.z),os(Object.assign(Object.assign({},n),n.w),e.w)]})}const qK=Yt({id:"input-point4d",type:"input",accept:(n,e)=>{if(!Al.isObject(n))return null;const t=Oe(e,i=>Object.assign(Object.assign({},Ou(i)),{readonly:i.optional.constant(!1),w:i.optional.custom(pr),x:i.optional.custom(pr),y:i.optional.custom(pr),z:i.optional.custom(pr)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>UK,constraint:n=>zK(n.params,n.initialValue),equals:Al.equals,writer:n=>HK},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z,n.params.w];return new ow(n.document,{assembly:Uk,axes:e.rawValue.getComponents().map((s,r)=>{var o;return I_({constraint:t.components[r],initialValue:s,params:fo(n.params,(o=i[r])!==null&&o!==void 0?o:{})})}),parser:xs,value:e,viewProps:n.viewProps})}});function GK(n){const e=[],t=Z_(n.options);return t&&e.push(t),new bh(e)}const YK=Yt({id:"input-string",type:"input",accept:(n,e)=>{if(typeof n!="string")return null;const t=Oe(e,i=>({readonly:i.optional.constant(!1),options:i.optional.custom(Ch)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>mk,constraint:n=>GK(n.params),writer:n=>yh},controller:n=>{const e=n.document,t=n.value,i=n.constraint,s=i&&Zc(i,gh);return s?new Mr(e,{props:new I({options:s.values.value("options")}),value:t,viewProps:n.viewProps}):new Du(e,{parser:r=>r,props:I.fromObject({formatter:Rv}),value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="string"?null:n.controller.valueController instanceof Mr?new X_(n.controller):null}}),xh={monitor:{defaultInterval:200,defaultRows:3}},cP=U("mll");let XK=class{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(cP()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("textarea");i.classList.add(cP("i")),i.style.height=`calc(var(${_k("containerUnitSize")}) * ${t.rows})`,i.readOnly=!0,t.viewProps.bindDisabled(i),this.element.appendChild(i),this.textareaElem_=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.textareaElem_,t=e.scrollTop===e.scrollHeight-e.clientHeight,i=[];this.value.rawValue.forEach(s=>{s!==void 0&&i.push(this.formatter_(s))}),e.textContent=i.join(`
`),t&&(e.scrollTop=e.scrollHeight)}onValueUpdate_(){this.update_()}},lw=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new XK(e,{formatter:t.formatter,rows:t.rows,value:this.value,viewProps:this.viewProps})}};const dP=U("sgl");let WK=class{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(dP()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(dP("i")),i.readOnly=!0,i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.value.rawValue,t=e[e.length-1];this.inputElement.value=t!==void 0?this.formatter_(t):""}onValueUpdate_(){this.update_()}},aw=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new WK(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}};const ZK=Yt({id:"monitor-bool",type:"monitor",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=Oe(e,i=>({readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>pk},controller:n=>{var e;return n.value.rawValue.length===1?new aw(n.document,{formatter:nP,value:n.value,viewProps:n.viewProps}):new lw(n.document,{formatter:nP,rows:(e=n.params.rows)!==null&&e!==void 0?e:xh.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}});let QK=class extends Tu{get max(){return this.controller.valueController.props.get("max")}set max(e){this.controller.valueController.props.set("max",e)}get min(){return this.controller.valueController.props.get("min")}set min(e){this.controller.valueController.props.set("min",e)}};const Hs=U("grl");let JK=class{constructor(e,t){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Hs()),t.viewProps.bindClassModifiers(this.element),this.formatter_=t.formatter,this.props_=t.props,this.cursor_=t.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const i=e.createElementNS(hi,"svg");i.classList.add(Hs("g")),i.style.height=`calc(var(${_k("containerUnitSize")}) * ${t.rows})`,this.element.appendChild(i),this.svgElem_=i;const s=e.createElementNS(hi,"polyline");this.svgElem_.appendChild(s),this.lineElem_=s;const r=e.createElement("div");r.classList.add(Hs("t"),U("tt")()),this.element.appendChild(r),this.tooltipElem_=r,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const{clientWidth:e,clientHeight:t}=this.element,i=this.value.rawValue.length-1,s=this.props_.get("min"),r=this.props_.get("max"),o=[];this.value.rawValue.forEach((c,p)=>{if(c===void 0)return;const d=ie(p,0,i,0,e),m=ie(c,s,r,t,0);o.push([d,m].join(","))}),this.lineElem_.setAttributeNS(null,"points",o.join(" "));const l=this.tooltipElem_,a=this.value.rawValue[this.cursor_.rawValue];if(a===void 0){l.classList.remove(Hs("t","a"));return}const u=ie(this.cursor_.rawValue,0,i,0,e),h=ie(a,s,r,t,0);l.style.left=`${u}px`,l.style.top=`${h}px`,l.textContent=`${this.formatter_(a)}`,l.classList.contains(Hs("t","a"))||(l.classList.add(Hs("t","a"),Hs("t","in")),Wc(l),l.classList.remove(Hs("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}},Hk=class{constructor(e,t){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.cursor_=Ve(-1),this.view=new JK(e,{cursor:this.cursor_,formatter:t.formatter,rows:t.rows,props:this.props,value:this.value,viewProps:this.viewProps}),!F_(e))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const i=new Fo(this.view.element);i.emitter.on("down",this.onGraphPointerDown_),i.emitter.on("move",this.onGraphPointerMove_),i.emitter.on("up",this.onGraphPointerUp_)}}importProps(e){return yn(e,null,t=>({max:t.required.number,min:t.required.number}),t=>(this.props.set("max",t.max),this.props.set("min",t.min),!0))}exportProps(){return En(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(e){const{clientWidth:t}=this.view.element;this.cursor_.rawValue=Math.floor(ie(e.offsetX,0,t,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){if(!e.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(ie(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}};function Ov(n){return ye(n.format)?un(2):n.format}function e6(n){var e;return n.value.rawValue.length===1?new aw(n.document,{formatter:Ov(n.params),value:n.value,viewProps:n.viewProps}):new lw(n.document,{formatter:Ov(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:xh.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}function t6(n){var e,t,i;return new Hk(n.document,{formatter:Ov(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:xh.monitor.defaultRows,props:I.fromObject({max:(t=n.params.max)!==null&&t!==void 0?t:100,min:(i=n.params.min)!==null&&i!==void 0?i:0}),value:n.value,viewProps:n.viewProps})}function pP(n){return n.view==="graph"}const n6=Yt({id:"monitor-number",type:"monitor",accept:(n,e)=>{if(typeof n!="number")return null;const t=Oe(e,i=>({format:i.optional.function,max:i.optional.number,min:i.optional.number,readonly:i.required.constant(!0),rows:i.optional.number,view:i.optional.string}));return t?{initialValue:n,params:t}:null},binding:{defaultBufferSize:n=>pP(n)?64:1,reader:n=>HV},controller:n=>pP(n.params)?t6(n):e6(n),api:n=>n.controller.valueController instanceof Hk?new QK(n.controller):null}),i6=Yt({id:"monitor-string",type:"monitor",accept:(n,e)=>{if(typeof n!="string")return null;const t=Oe(e,i=>({multiline:i.optional.boolean,readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>mk},controller:n=>{var e;const t=n.value;return t.rawValue.length>1||n.params.multiline?new lw(n.document,{formatter:Rv,rows:(e=n.params.rows)!==null&&e!==void 0?e:xh.monitor.defaultRows,value:t,viewProps:n.viewProps}):new aw(n.document,{formatter:Rv,value:t,viewProps:n.viewProps})}});class s6{constructor(){this.map_=new Map}get(e){var t;return(t=this.map_.get(e))!==null&&t!==void 0?t:null}has(e){return this.map_.has(e)}add(e,t){return this.map_.set(e,t),e.viewProps.handleDispose(()=>{this.map_.delete(e)}),t}}class r6{constructor(e){this.target=e.target,this.reader_=e.reader,this.writer_=e.writer}read(){return this.reader_(this.target.read())}write(e){this.writer_(this.target,e)}inject(e){this.write(this.reader_(e))}}function o6(n,e){var t;const i=n.accept(e.target.read(),e.params);if(ye(i))return null;const s={target:e.target,initialValue:i.initialValue,params:i.params},r=Oe(e.params,c=>({disabled:c.optional.boolean,hidden:c.optional.boolean,label:c.optional.string,tag:c.optional.string})),o=n.binding.reader(s),l=n.binding.constraint?n.binding.constraint(s):void 0,a=new r6({reader:o,target:e.target,writer:n.binding.writer(s)}),u=new zF(Ve(o(i.initialValue),{constraint:l,equals:n.binding.equals}),a),h=n.controller({constraint:l,document:e.document,initialValue:i.initialValue,params:i.params,value:u,viewProps:Io.create({disabled:r?.disabled,hidden:r?.hidden})});return new o5(e.document,{blade:ba(),props:I.fromObject({label:"label"in e.params?(t=r?.label)!==null&&t!==void 0?t:null:e.target.key}),tag:r?.tag,value:u,valueController:h})}class l6{constructor(e){this.target=e.target,this.reader_=e.reader}read(){return this.reader_(this.target.read())}}function a6(n,e){return e===0?new K5:new U5(n,e??xh.monitor.defaultInterval)}function u6(n,e){var t,i,s;const r=n.accept(e.target.read(),e.params);if(ye(r))return null;const o={target:e.target,initialValue:r.initialValue,params:r.params},l=Oe(e.params,p=>({bufferSize:p.optional.number,disabled:p.optional.boolean,hidden:p.optional.boolean,interval:p.optional.number,label:p.optional.string})),a=n.binding.reader(o),u=(i=(t=l?.bufferSize)!==null&&t!==void 0?t:n.binding.defaultBufferSize&&n.binding.defaultBufferSize(r.params))!==null&&i!==void 0?i:1,h=new c5({binding:new l6({reader:a,target:e.target}),bufferSize:u,ticker:a6(e.document,l?.interval)}),c=n.controller({document:e.document,params:r.params,value:h,viewProps:Io.create({disabled:l?.disabled,hidden:l?.hidden})});return c.viewProps.bindDisabled(h.ticker),c.viewProps.handleDispose(()=>{h.ticker.dispose()}),new p5(e.document,{blade:ba(),props:I.fromObject({label:"label"in e.params?(s=l?.label)!==null&&s!==void 0?s:null:e.target.key}),value:h,valueController:c})}class h6{constructor(e){this.pluginsMap_={blades:[],inputs:[],monitors:[]},this.apiCache_=e}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(e,t){if(!n3(t.core))throw yt.notCompatible(e,t.id);t.type==="blade"?this.pluginsMap_.blades.unshift(t):t.type==="input"?this.pluginsMap_.inputs.unshift(t):t.type==="monitor"&&this.pluginsMap_.monitors.unshift(t)}createInput_(e,t,i){return this.pluginsMap_.inputs.reduce((s,r)=>s??o6(r,{document:e,target:t,params:i}),null)}createMonitor_(e,t,i){return this.pluginsMap_.monitors.reduce((s,r)=>s??u6(r,{document:e,params:i,target:t}),null)}createBinding(e,t,i){const s=t.read();if(ye(s))throw new yt({context:{key:t.key},type:"nomatchingcontroller"});const r=this.createInput_(e,t,i);if(r)return r;const o=this.createMonitor_(e,t,i);if(o)return o;throw new yt({context:{key:t.key},type:"nomatchingcontroller"})}createBlade(e,t){const i=this.pluginsMap_.blades.reduce((s,r)=>s??F5(r,{document:e,params:t}),null);if(!i)throw new yt({type:"nomatchingview",context:{params:t}});return i}createInputBindingApi_(e){const t=this.pluginsMap_.inputs.reduce((i,s)=>{var r,o;return i||((o=(r=s.api)===null||r===void 0?void 0:r.call(s,{controller:e}))!==null&&o!==void 0?o:null)},null);return this.apiCache_.add(e,t??new Tu(e))}createMonitorBindingApi_(e){const t=this.pluginsMap_.monitors.reduce((i,s)=>{var r,o;return i||((o=(r=s.api)===null||r===void 0?void 0:r.call(s,{controller:e}))!==null&&o!==void 0?o:null)},null);return this.apiCache_.add(e,t??new Tu(e))}createBindingApi(e){if(this.apiCache_.has(e))return this.apiCache_.get(e);if(l5(e))return this.createInputBindingApi_(e);if(m5(e))return this.createMonitorBindingApi_(e);throw yt.shouldNeverHappen()}createApi(e){if(this.apiCache_.has(e))return this.apiCache_.get(e);if(r5(e))return this.createBindingApi(e);const t=this.pluginsMap_.blades.reduce((i,s)=>i??s.api({controller:e,pool:this}),null);if(!t)throw yt.shouldNeverHappen();return this.apiCache_.add(e,t)}}const c6=new s6;function d6(){const n=new h6(c6);return[NK,KK,qK,YK,kK,yK,PK,_K,o3,ZK,i6,n6,b5,M5,ck].forEach(e=>{n.register("core",e)}),n}class p6 extends Bo{constructor(e){super(e),this.emitter_=new Ke,this.controller.value.emitter.on("change",t=>{this.emitter_.emit("change",new wh(this,t.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get options(){return this.controller.valueController.props.get("options")}set options(e){this.controller.valueController.props.set("options",e)}get value(){return this.controller.value.rawValue}set value(e){this.controller.value.rawValue=e}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}}class m6 extends Bo{}class v6 extends Bo{constructor(e){super(e),this.emitter_=new Ke,this.controller.value.emitter.on("change",t=>{this.emitter_.emit("change",new wh(this,t.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get max(){return this.controller.valueController.sliderController.props.get("max")}set max(e){this.controller.valueController.sliderController.props.set("max",e)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(e){this.controller.valueController.sliderController.props.set("min",e)}get value(){return this.controller.value.rawValue}set value(e){this.controller.value.rawValue=e}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}}class f6 extends Bo{constructor(e){super(e),this.emitter_=new Ke,this.controller.value.emitter.on("change",t=>{this.emitter_.emit("change",new wh(this,t.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get formatter(){return this.controller.valueController.props.get("formatter")}set formatter(e){this.controller.valueController.props.set("formatter",e)}get value(){return this.controller.value.rawValue}set value(e){this.controller.value.rawValue=e}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}}const _6=function(){return{id:"list",type:"blade",core:wa,accept(n){const e=Oe(n,t=>({options:t.required.custom(Ch),value:t.required.raw,view:t.required.constant("list"),label:t.optional.string}));return e?{params:e}:null},controller(n){const e=new gh(W_(n.params.options)),t=Ve(n.params.value,{constraint:e}),i=new Mr(n.document,{props:new I({options:e.values.value("options")}),value:t,viewProps:n.viewProps});return new _o(n.document,{blade:n.blade,props:I.fromObject({label:n.params.label}),value:t,valueController:i})},api(n){return!(n.controller instanceof _o)||!(n.controller.valueController instanceof Mr)?null:new p6(n.controller)}}}();class w6 extends ak{constructor(e,t){super(e,t)}get element(){return this.controller.view.element}}class b6 extends Tv{constructor(e,t){super(e,{expanded:t.expanded,blade:t.blade,props:t.props,root:!0,viewProps:t.viewProps})}}const mP=U("spr");class g6{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(mP()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("hr");i.classList.add(mP("r")),this.element.appendChild(i)}}class vP extends Id{constructor(e,t){super(Object.assign(Object.assign({},t),{view:new g6(e,{viewProps:t.viewProps})}))}}const C6={id:"separator",type:"blade",core:wa,accept(n){const e=Oe(n,t=>({view:t.required.constant("separator")}));return e?{params:e}:null},controller(n){return new vP(n.document,{blade:n.blade,viewProps:n.viewProps})},api(n){return n.controller instanceof vP?new m6(n.controller):null}},P6={id:"slider",type:"blade",core:wa,accept(n){const e=Oe(n,t=>({max:t.required.number,min:t.required.number,view:t.required.constant("slider"),format:t.optional.function,label:t.optional.string,value:t.optional.number}));return e?{params:e}:null},controller(n){var e,t;const i=(e=n.params.value)!==null&&e!==void 0?e:0,s=new _h({max:n.params.max,min:n.params.min}),r=Ve(i,{constraint:s}),o=new Jc(n.document,Object.assign(Object.assign({},fk({formatter:(t=n.params.format)!==null&&t!==void 0?t:FF,keyScale:Ve(1),max:s.values.value("max"),min:s.values.value("min"),pointerScale:GV(n.params,i)})),{parser:xs,value:r,viewProps:n.viewProps}));return new _o(n.document,{blade:n.blade,props:I.fromObject({label:n.params.label}),value:r,valueController:o})},api(n){return!(n.controller instanceof _o)||!(n.controller.valueController instanceof Jc)?null:new v6(n.controller)}},y6=function(){return{id:"text",type:"blade",core:wa,accept(n){const e=Oe(n,t=>({parse:t.required.function,value:t.required.raw,view:t.required.constant("text"),format:t.optional.function,label:t.optional.string}));return e?{params:e}:null},controller(n){var e;const t=Ve(n.params.value),i=new Du(n.document,{parser:n.params.parse,props:I.fromObject({formatter:(e=n.params.format)!==null&&e!==void 0?e:s=>String(s)}),value:t,viewProps:n.viewProps});return new _o(n.document,{blade:n.blade,props:I.fromObject({label:n.params.label}),value:t,valueController:i})},api(n){return!(n.controller instanceof _o)||!(n.controller.valueController instanceof Du)?null:new f6(n.controller)}}}();function E6(n){const e=n.createElement("div");return e.classList.add(U("dfw")()),n.body&&n.body.appendChild(e),e}function x6(n,e,t){if(n.querySelector(`style[data-tp-style=${e}]`))return;const i=n.createElement("style");i.dataset.tpStyle=e,i.textContent=t,n.head.appendChild(i)}let $6=class extends w6{constructor(e){var t,i;const s=e??{},r=(t=s.document)!==null&&t!==void 0?t:QF(),o=d6(),l=new b6(r,{expanded:s.expanded,blade:ba(),props:I.fromObject({title:s.title}),viewProps:Io.create()});super(l,o),this.pool_=o,this.containerElem_=(i=s.container)!==null&&i!==void 0?i:E6(r),this.containerElem_.appendChild(this.element),this.doc_=r,this.usesDefaultWrapper_=!s.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw yt.alreadyDisposed();return this.doc_}dispose(){const e=this.containerElem_;if(!e)throw yt.alreadyDisposed();if(this.usesDefaultWrapper_){const t=e.parentElement;t&&t.removeChild(e)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(e){e.css&&x6(this.document,`plugin-${e.id}`,e.css),("plugin"in e?[e.plugin]:"plugins"in e?e.plugins:[]).forEach(i=>{this.pool_.register(e.id,i)})}setUpDefaultPlugins_(){this.registerPlugin({id:"default",css:'.tp-tbiv_b,.tp-coltxtv_ms,.tp-colswv_b,.tp-ckbv_i,.tp-sglv_i,.tp-mllv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-rotv_b,.tp-fldv_b,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--bld-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--cnt-usz);line-height:var(--cnt-usz);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tbpv_c>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-vp))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tbpv_c>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--cnt-usp)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tbpv_c>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tbpv_c>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tbpv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tbpv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tbpv_c>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tbpv_c>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--bld-br);border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tbpv_c .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tbpv_c>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tbpv_c>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--bld-br)}.tp-tbpv_c .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--bld-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);overflow:hidden;padding-left:var(--cnt-hp);padding-right:calc(4px + var(--cnt-usz) + var(--cnt-hp));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-hp) + (var(--cnt-usz) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-vp);padding-top:var(--cnt-vp);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--cnt-usz);line-height:var(--cnt-usz);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-sglv_i,.tp-mllv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--mo-fg);height:var(--cnt-usz);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-sglv_i::-webkit-scrollbar,.tp-mllv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-sglv_i::-webkit-scrollbar-corner,.tp-mllv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-sglv_i::-webkit-scrollbar-thumb,.tp-mllv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-rotv{--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-br: var(--tp-base-border-radius, 6px);--bs-ff: var(--tp-base-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--bld-br: var(--tp-blade-border-radius, 2px);--bld-hp: var(--tp-blade-horizontal-padding, 4px);--bld-vw: var(--tp-blade-value-width, 160px);--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--cnt-hp: var(--tp-container-horizontal-padding, 4px);--cnt-vp: var(--tp-container-vertical-padding, 4px);--cnt-usp: var(--tp-container-unit-spacing, 4px);--cnt-usz: var(--tp-container-unit-size, 20px);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--bld-br);cursor:pointer;display:block;height:var(--cnt-usz);position:relative;width:var(--cnt-usz)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--cnt-usz)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-expanded.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--cnt-usp);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-hp));right:calc(-1*var(--cnt-hp));top:var(--cnt-usz)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--cnt-usp)}.tp-colpv_rgb{display:flex;margin-top:var(--cnt-usp);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-vp);padding-top:calc(var(--cnt-vp) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-hp));position:absolute;right:calc(-1*var(--cnt-hp));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--bld-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--cnt-usz)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--bld-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--bld-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{cursor:pointer;display:block;height:var(--cnt-usz);left:0;position:absolute;top:0;width:var(--cnt-usz)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--bld-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--bld-br);color:var(--lbl-fg);cursor:pointer;height:var(--cnt-usz);line-height:var(--cnt-usz);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--cnt-usz)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-hp);padding-right:var(--cnt-hp)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:var(--bld-vw)}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 var(--bld-hp);width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--cnt-usz)*3);line-height:var(--cnt-usz);padding-left:var(--bld-hp);padding-right:var(--bld-hp);resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--cnt-usz);margin-right:4px;position:relative;width:var(--cnt-usz)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--cnt-usp);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-hp));right:calc(-1*var(--cnt-hp));top:var(--cnt-usz)}.tp-p2dpv{padding-left:calc(var(--cnt-usz) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:var(--bld-vw);padding:var(--cnt-vp) var(--cnt-hp);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--cnt-usz);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--bld-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:"";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--cnt-usz) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-hp) + 4px);padding-right:calc(var(--cnt-hp) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);bottom:2px;content:"";left:0;pointer-events:none;position:absolute;right:0;top:0}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);opacity:.5;overflow:hidden;position:relative;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-tbpv_c{padding-bottom:var(--cnt-vp);padding-left:4px;padding-top:var(--cnt-vp)}.tp-txtv{position:relative}.tp-txtv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:calc(var(--bld-hp) - 5px);position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--cnt-usz) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--bld-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--bs-ff);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--cnt-usz) + var(--cnt-hp));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0;transition-delay:0s;transition-duration:0s}.tp-rotv.tp-rotv-not>.tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst.tp-fldv-expanded>.tp-fldv_b{transition-delay:0s;transition-duration:0s}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}',plugins:[_6,C6,P6,ck,y6]})}};new ok("4.0.2");function V6(n){let e,t;return e=new Ir({props:{keysAdd:["containerVerticalPadding","containerUnitSize"],theme:n[2]}}),{c(){A(e.$$.fragment)},l(i){M(e.$$.fragment,i)},m(i,s){T(e,i,s),t=!0},p(i,s){const r={};s&4&&(r.theme=i[2]),e.$set(r)},i(i){t||(_(e.$$.fragment,i),t=!0)},o(i){b(e.$$.fragment,i),t=!1},d(i){D(e,i)}}}function k6(n){return{c:nt,l:nt,m:nt,p:nt,i:nt,o:nt,d:nt}}function S6(n){let e,t,i,s;const r=[M6,A6],o=[];function l(h,c){return h[1]===void 0?0:1}e=l(n),t=o[e]=r[e](n);const a=n[11].default,u=mn(a,n,n[10],null);return{c(){t.c(),i=kr(),u&&u.c()},l(h){t.l(h),i=Sr(h),u&&u.l(h)},m(h,c){o[e].m(h,c),O(h,i,c),u&&u.m(h,c),s=!0},p(h,c){let p=e;e=l(h),e===p?o[e].p(h,c):(ii(),b(o[p],1,1,()=>{o[p]=null}),si(),t=o[e],t?t.p(h,c):(t=o[e]=r[e](h),t.c()),_(t,1),t.m(i.parentNode,i)),u&&u.p&&(!s||c&1024)&&vn(u,a,h,h[10],s?_n(a,h[10],c,null):fn(h[10]),null)},i(h){s||(_(t),_(u,h),s=!0)},o(h){b(t),b(u,h),s=!1},d(h){h&&E(i),o[e].d(h),u&&u.d(h)}}}function L6(n){let e;const t=n[11].default,i=mn(t,n,n[10],null);return{c(){i&&i.c()},l(s){i&&i.l(s)},m(s,r){i&&i.m(s,r),e=!0},p(s,r){i&&i.p&&(!e||r&1024)&&vn(i,t,s,s[10],e?_n(t,s[10],r,null):fn(s[10]),null)},i(s){e||(_(i,s),e=!0)},o(s){b(i,s),e=!1},d(s){i&&i.d(s)}}}function A6(n){let e,t;return e=new Ir({props:{keysAdd:["containerVerticalPadding","containerVerticalPadding","containerVerticalPadding","containerUnitSize"],theme:n[2]}}),{c(){A(e.$$.fragment)},l(i){M(e.$$.fragment,i)},m(i,s){T(e,i,s),t=!0},p(i,s){const r={};s&4&&(r.theme=i[2]),e.$set(r)},i(i){t||(_(e.$$.fragment,i),t=!0)},o(i){b(e.$$.fragment,i),t=!1},d(i){D(e,i)}}}function M6(n){let e,t;return e=new Ir({props:{keysAdd:["containerVerticalPadding"],theme:n[2]}}),{c(){A(e.$$.fragment)},l(i){M(e.$$.fragment,i)},m(i,s){T(e,i,s),t=!0},p(i,s){const r={};s&4&&(r.theme=i[2]),e.$set(r)},i(i){t||(_(e.$$.fragment,i),t=!0)},o(i){b(e.$$.fragment,i),t=!1},d(i){D(e,i)}}}function T6(n){let e,t,i,s;const r=[L6,S6,k6,V6],o=[];function l(a,u){return 0}return e=l(),t=o[e]=r[e](n),{c(){t.c(),i=R()},l(a){t.l(a),i=R()},m(a,u){o[e].m(a,u),O(a,i,u),s=!0},p(a,[u]){let h=e;e=l(),e===h?o[e].p(a,u):(ii(),b(o[h],1,1,()=>{o[h]=null}),si(),t=o[e],t?t.p(a,u):(t=o[e]=r[e](a),t.c()),_(t,1),t.m(i.parentNode,i))},i(a){s||(_(t),s=!0)},o(a){b(t),s=!1},d(a){a&&E(i),o[e].d(a)}}}function D6(n,e,t){let i,s,{$$slots:r={},$$scope:o}=e,{title:l=void 0}=e,{userExpandable:a=!0}=e,{expanded:u=!0}=e,{theme:h=void 0}=e,{scale:c=1}=e,{userCreatedPane:p=!0}=e,{paneRef:d=void 0}=e;const m=Pf();Ps(n,m,g=>t(12,i=g));const f=mi("parentStore");Ps(n,f,g=>t(13,s=g));let v=[];mc("registerPlugin",g=>{d===void 0?console.warn('`paneRef is undefined, failed to register plugin "${plugin.id}"'):v.includes(g.id)||(d?.registerPlugin(g),v.push(g.id))}),mc("userCreatedPane",p),s!==void 0&&console.warn("<Panes> must not be nested");let P=u;Hx(m,i=new $6({expanded:u,title:l}),i),i.on("fold",()=>{t(9,P=i.expanded)}),d=i,mc("parentStore",m),ha(()=>{i.dispose()});function Ce(g){if(d)if(g===1)d.element.style.removeProperty("transform-origin"),d.element.style.removeProperty("transform"),d.element.style.removeProperty("width");else{const Wt=Math.max(0,g);t(5,d.element.style.transformOrigin="0 0",d),t(5,d.element.style.transform=`scale(${Wt})`,d),t(5,d.element.style.width=`${100/Wt}%`,d)}}function x(){d&&t(5,d.expanded=P,d),t(0,u=P)}return n.$$set=g=>{"title"in g&&t(1,l=g.title),"userExpandable"in g&&t(6,a=g.userExpandable),"expanded"in g&&t(0,u=g.expanded),"theme"in g&&t(2,h=g.theme),"scale"in g&&t(7,c=g.scale),"userCreatedPane"in g&&t(8,p=g.userCreatedPane),"paneRef"in g&&t(5,d=g.paneRef),"$$scope"in g&&t(10,o=g.$$scope)},n.$$.update=()=>{n.$$.dirty&34&&d&&l&&t(5,d.title=l,d),n.$$.dirty&160&&d&&Ce(c),n.$$.dirty&96&&d&&NV(a,d.element,"tp-rotv_b","tp-rotv_m"),n.$$.dirty&36&&d&&nF(d.element,h),n.$$.dirty&33&&d&&t(9,P=u),n.$$.dirty&544&&d&&x()},[u,l,h,m,f,d,a,c,p,P,o,r]}class uw extends Je{constructor(e){super(),et(this,e,D6,T6,Qe,{title:1,userExpandable:6,expanded:0,theme:2,scale:7,userCreatedPane:8,paneRef:5})}}function R6(n){let e;const t=n[6].default,i=mn(t,n,n[10],null);return{c(){i&&i.c()},l(s){i&&i.l(s)},m(s,r){i&&i.m(s,r),e=!0},p(s,r){i&&i.p&&(!e||r&1024)&&vn(i,t,s,s[10],e?_n(t,s[10],r,null):fn(s[10]),null)},i(s){e||(_(i,s),e=!0)},o(s){b(i,s),e=!1},d(s){i&&i.d(s)}}}function O6(n){let e,t,i,s,r;const o=[{theme:n[2]},Ar(n[5],"position")];function l(h){n[7](h)}function a(h){n[8](h)}let u={$$slots:{default:[R6]},$$scope:{ctx:n}};for(let h=0;h<o.length;h+=1)u=B(u,o[h]);return n[0]!==void 0&&(u.expanded=n[0]),n[3]!==void 0&&(u.paneRef=n[3]),t=new uw({props:u}),y.push(()=>k(t,"expanded",l)),y.push(()=>k(t,"paneRef",a)),{c(){e=rn("div"),A(t.$$.fragment),this.h()},l(h){e=on(h,"DIV",{});var c=ln(e);M(t.$$.fragment,c),c.forEach(E),this.h()},h(){Pe(e,"width",n[1]===void 0?null:`${n[1]}px`)},m(h,c){O(h,e,c),T(t,e,null),n[9](e),r=!0},p(h,[c]){const p=c&36?zt(o,[c&4&&{theme:h[2]},c&32&&qt(Ar(h[5],"position"))]):{};c&1024&&(p.$$scope={dirty:c,ctx:h}),!i&&c&1&&(i=!0,p.expanded=h[0],V(()=>i=!1)),!s&&c&8&&(s=!0,p.paneRef=h[3],V(()=>s=!1)),t.$set(p),c&2&&Pe(e,"width",h[1]===void 0?null:`${h[1]}px`)},i(h){r||(_(t.$$.fragment,h),r=!0)},o(h){b(t.$$.fragment,h),r=!1},d(h){h&&E(e),D(t),n[9](null)}}}function j6(n,e,t){const i=["expanded","width","theme"];let s=je(e,i),{$$slots:r={},$$scope:o}=e,{expanded:l=void 0}=e,{width:a=void 0}=e,{theme:u={baseBorderRadius:"0px",baseShadowColor:"hsla(0, 0%, 0%, 0)"}}=e,h,c;ca(()=>{if(h){const f=h.element.parentElement;c.append(h.element),f?.remove()}else console.warn("paneRef is undefined")});function p(f){l=f,t(0,l)}function d(f){h=f,t(3,h)}function m(f){y[f?"unshift":"push"](()=>{c=f,t(4,c)})}return n.$$set=f=>{e=B(B({},e),Cn(f)),t(5,s=je(e,i)),"expanded"in f&&t(0,l=f.expanded),"width"in f&&t(1,a=f.width),"theme"in f&&t(2,u=f.theme),"$$scope"in f&&t(10,o=f.$$scope)},[l,a,u,h,c,s,r,p,d,m,o]}class $h extends Je{constructor(e){super(),et(this,e,j6,O6,Qe,{expanded:0,width:1,theme:2})}}function N6(n){let e,t;return e=new $h({props:{theme:n[4],userCreatedPane:!1,$$slots:{default:[I6]},$$scope:{ctx:n}}}),{c(){A(e.$$.fragment)},l(i){M(e.$$.fragment,i)},m(i,s){T(e,i,s),t=!0},p(i,s){const r={};s&16&&(r.theme=i[4]),s&262159&&(r.$$scope={dirty:s,ctx:i}),e.$set(r)},i(i){t||(_(e.$$.fragment,i),t=!0)},o(i){b(e.$$.fragment,i),t=!1},d(i){D(e,i)}}}function B6(n){let e,t,i,s;const r=[K6,F6],o=[];function l(a,u){return 0}return e=l(),t=o[e]=r[e](n),{c(){t.c(),i=R()},l(a){t.l(a),i=R()},m(a,u){o[e].m(a,u),O(a,i,u),s=!0},p(a,u){t.p(a,u)},i(a){s||(_(t),s=!0)},o(a){b(t),s=!1},d(a){a&&E(i),o[e].d(a)}}}function I6(n){let e,t,i,s,r,o;function l(p){n[11](p)}function a(p){n[12](p)}function u(p){n[13](p)}function h(p){n[14](p)}let c={};return n[1]!==void 0&&(c.disabled=n[1]),n[0]!==void 0&&(c.options=n[0]),n[3]!==void 0&&(c.plugin=n[3]),n[2]!==void 0&&(c.ref=n[2]),e=new zk({props:c}),y.push(()=>k(e,"disabled",l)),y.push(()=>k(e,"options",a)),y.push(()=>k(e,"plugin",u)),y.push(()=>k(e,"ref",h)),{c(){A(e.$$.fragment)},l(p){M(e.$$.fragment,p)},m(p,d){T(e,p,d),o=!0},p(p,d){const m={};!t&&d&2&&(t=!0,m.disabled=p[1],V(()=>t=!1)),!i&&d&1&&(i=!0,m.options=p[0],V(()=>i=!1)),!s&&d&8&&(s=!0,m.plugin=p[3],V(()=>s=!1)),!r&&d&4&&(r=!0,m.ref=p[2],V(()=>r=!1)),e.$set(m)},i(p){o||(_(e.$$.fragment,p),o=!0)},o(p){b(e.$$.fragment,p),o=!1},d(p){D(e,p)}}}function F6(n){let e,t;return e=new Ir({props:{keysAdd:["containerVerticalPadding"],theme:n[4]}}),{c(){A(e.$$.fragment)},l(i){M(e.$$.fragment,i)},m(i,s){T(e,i,s),t=!0},p(i,s){const r={};s&16&&(r.theme=i[4]),e.$set(r)},i(i){t||(_(e.$$.fragment,i),t=!0)},o(i){b(e.$$.fragment,i),t=!1},d(i){D(e,i)}}}function K6(n){let e;return{c(){e=rn("div"),this.h()},l(t){e=on(t,"DIV",{style:!0}),ln(e).forEach(E),this.h()},h(){Pe(e,"display","none")},m(t,i){O(t,e,i),n[10](e)},p:nt,i:nt,o:nt,d(t){t&&E(e),n[10](null)}}}function U6(n){let e,t,i,s;const r=[B6,N6],o=[];function l(a,u){return a[6]?0:1}return e=l(n),t=o[e]=r[e](n),{c(){t.c(),i=R()},l(a){t.l(a),i=R()},m(a,u){o[e].m(a,u),O(a,i,u),s=!0},p(a,[u]){t.p(a,u)},i(a){s||(_(t),s=!0)},o(a){b(t),s=!1},d(a){a&&E(i),o[e].d(a)}}}function H6(n,e,t){let i,{options:s}=e,{disabled:r=!1}=e,{theme:o=void 0}=e,{ref:l=void 0}=e,{plugin:a=void 0}=e;const u=mi("registerPlugin"),h=mi("parentStore");Ps(n,h,g=>t(9,i=g));const c=mi("userCreatedPane");let p,d,m;function f(){m&&m.dispose(),a!==void 0&&u(a),t(8,m=i.addBlade({index:d,...s,disabled:r})),t(2,l=m)}ca(()=>{t(7,d=p?R_(p):0)}),ha(()=>{m?.dispose()});function v(g){y[g?"unshift":"push"](()=>{p=g,t(5,p)})}function w(g){r=g,t(1,r)}function P(g){s=g,t(0,s)}function Ce(g){a=g,t(3,a)}function x(g){l=g,t(2,l)}return n.$$set=g=>{"options"in g&&t(0,s=g.options),"disabled"in g&&t(1,r=g.disabled),"theme"in g&&t(4,o=g.theme),"ref"in g&&t(2,l=g.ref),"plugin"in g&&t(3,a=g.plugin)},n.$$.update=()=>{n.$$.dirty&258&&m&&t(8,m.disabled=r,m),n.$$.dirty&260,n.$$.dirty&641&&i&&d!==void 0&&f(),n.$$.dirty&528&&o&&i&&(c||!D_(i))&&console.warn("Set theme on the <Pane> component, not on its children! (Check nested <Blade> components for a theme prop.)")},[s,r,l,a,o,p,h,d,m,i,v,w,P,Ce,x]}class zk extends Je{constructor(e){super(),et(this,e,H6,U6,Qe,{options:0,disabled:1,theme:4,ref:2,plugin:3})}}function z6(n){let e,t;return e=new $h({props:{theme:n[7],userCreatedPane:!1,$$slots:{default:[G6]},$$scope:{ctx:n}}}),{c(){A(e.$$.fragment)},l(i){M(e.$$.fragment,i)},m(i,s){T(e,i,s),t=!0},p(i,s){const r={};s&128&&(r.theme=i[7]),s&16777343&&(r.$$scope={dirty:s,ctx:i}),e.$set(r)},i(i){t||(_(e.$$.fragment,i),t=!0)},o(i){b(e.$$.fragment,i),t=!1},d(i){D(e,i)}}}function q6(n){let e,t,i,s;const r=[X6,Y6],o=[];function l(a,u){return 0}return e=l(),t=o[e]=r[e](n),{c(){t.c(),i=R()},l(a){t.l(a),i=R()},m(a,u){o[e].m(a,u),O(a,i,u),s=!0},p(a,u){t.p(a,u)},i(a){s||(_(t),s=!0)},o(a){b(t),s=!1},d(a){a&&E(i),o[e].d(a)}}}function G6(n){let e,t,i,s,r,o,l,a,u;function h(P){n[14](P)}function c(P){n[15](P)}function p(P){n[16](P)}function d(P){n[17](P)}function m(P){n[18](P)}function f(P){n[19](P)}function v(P){n[20](P)}let w={};return n[1]!==void 0&&(w.disabled=n[1]),n[5]!==void 0&&(w.key=n[5]),n[2]!==void 0&&(w.label=n[2]),n[0]!==void 0&&(w.object=n[0]),n[3]!==void 0&&(w.options=n[3]),n[6]!==void 0&&(w.plugin=n[6]),n[4]!==void 0&&(w.ref=n[4]),e=new hw({props:w}),y.push(()=>k(e,"disabled",h)),y.push(()=>k(e,"key",c)),y.push(()=>k(e,"label",p)),y.push(()=>k(e,"object",d)),y.push(()=>k(e,"options",m)),y.push(()=>k(e,"plugin",f)),y.push(()=>k(e,"ref",v)),{c(){A(e.$$.fragment)},l(P){M(e.$$.fragment,P)},m(P,Ce){T(e,P,Ce),u=!0},p(P,Ce){const x={};!t&&Ce&2&&(t=!0,x.disabled=P[1],V(()=>t=!1)),!i&&Ce&32&&(i=!0,x.key=P[5],V(()=>i=!1)),!s&&Ce&4&&(s=!0,x.label=P[2],V(()=>s=!1)),!r&&Ce&1&&(r=!0,x.object=P[0],V(()=>r=!1)),!o&&Ce&8&&(o=!0,x.options=P[3],V(()=>o=!1)),!l&&Ce&64&&(l=!0,x.plugin=P[6],V(()=>l=!1)),!a&&Ce&16&&(a=!0,x.ref=P[4],V(()=>a=!1)),e.$set(x)},i(P){u||(_(e.$$.fragment,P),u=!0)},o(P){b(e.$$.fragment,P),u=!1},d(P){D(e,P)}}}function Y6(n){let e,t;return e=new Ir({props:{keysAdd:["containerVerticalPadding","containerUnitSize"],theme:n[7]}}),{c(){A(e.$$.fragment)},l(i){M(e.$$.fragment,i)},m(i,s){T(e,i,s),t=!0},p(i,s){const r={};s&128&&(r.theme=i[7]),e.$set(r)},i(i){t||(_(e.$$.fragment,i),t=!0)},o(i){b(e.$$.fragment,i),t=!1},d(i){D(e,i)}}}function X6(n){let e;return{c(){e=rn("div"),this.h()},l(t){e=on(t,"DIV",{style:!0}),ln(e).forEach(E),this.h()},h(){Pe(e,"display","none")},m(t,i){O(t,e,i),n[13](e)},p:nt,i:nt,o:nt,d(t){t&&E(e),n[13](null)}}}function W6(n){let e,t,i,s;const r=[q6,z6],o=[];function l(a,u){return a[9]?0:1}return e=l(n),t=o[e]=r[e](n),{c(){t.c(),i=R()},l(a){t.l(a),i=R()},m(a,u){o[e].m(a,u),O(a,i,u),s=!0},p(a,[u]){t.p(a,u)},i(a){s||(_(t),s=!0)},o(a){b(t),s=!1},d(a){a&&E(i),o[e].d(a)}}}function Z6(n,e,t){let i,{object:s}=e,{key:r}=e,{disabled:o=!1}=e,{label:l=void 0}=e,{options:a=void 0}=e,{theme:u=void 0}=e,{ref:h=void 0}=e,{plugin:c=void 0}=e;const p=mi("registerPlugin"),d=mi("parentStore");Ps(n,d,S=>t(12,i=S));const m=mi("userCreatedPane");let f,v,w;function P(){f&&f.dispose(),c!==void 0&&p(c),t(10,f=i.addBinding(s,r,{index:w,label:l,...a,disabled:o})),t(4,h=f),f.on("change",()=>{t(0,s)})}ca(()=>{t(11,w=v?R_(v):0)}),ha(()=>{f?.dispose()});function Ce(S){y[S?"unshift":"push"](()=>{v=S,t(8,v)})}function x(S){o=S,t(1,o)}function g(S){r=S,t(5,r)}function Wt(S){l=S,t(2,l)}function ke(S){s=S,t(0,s)}function tt(S){a=S,t(3,a)}function Mt(S){c=S,t(6,c)}function pt(S){h=S,t(4,h)}return n.$$set=S=>{"object"in S&&t(0,s=S.object),"key"in S&&t(5,r=S.key),"disabled"in S&&t(1,o=S.disabled),"label"in S&&t(2,l=S.label),"options"in S&&t(3,a=S.options),"theme"in S&&t(7,u=S.theme),"ref"in S&&t(4,h=S.ref),"plugin"in S&&t(6,c=S.plugin)},n.$$.update=()=>{n.$$.dirty&1026&&f!==void 0&&t(10,f.disabled=o,f),n.$$.dirty&1028&&f!==void 0&&t(10,f.label=l,f),n.$$.dirty&1040,n.$$.dirty&6152&&i!==void 0&&w!==void 0&&P(),n.$$.dirty&1025&&f!==void 0&&f.refresh(),n.$$.dirty&4224&&u&&i&&(m||!D_(i))&&console.warn("Set theme on the <Pane> component, not on its children! (Check nested <Binding> components for a theme prop.)")},[s,o,l,a,h,r,c,u,v,d,f,w,i,Ce,x,g,Wt,ke,tt,Mt,pt]}class hw extends Je{constructor(e){super(),et(this,e,Z6,W6,Qe,{object:0,key:5,disabled:1,label:2,options:3,theme:7,ref:4,plugin:6})}}function Q6(n){let e,t,i,s;const r=[{key:n[3]},{options:n[1]},n[4]];function o(u){n[6](u)}function l(u){n[7](u)}let a={};for(let u=0;u<r.length;u+=1)a=B(a,r[u]);return n[2]!==void 0&&(a.object=n[2]),n[0]!==void 0&&(a.ref=n[0]),e=new hw({props:a}),y.push(()=>k(e,"object",o)),y.push(()=>k(e,"ref",l)),{c(){A(e.$$.fragment)},l(u){M(e.$$.fragment,u)},m(u,h){T(e,u,h),s=!0},p(u,[h]){const c=h&26?zt(r,[h&8&&{key:u[3]},h&2&&{options:u[1]},h&16&&qt(u[4])]):{};!t&&h&4&&(t=!0,c.object=u[2],V(()=>t=!1)),!i&&h&1&&(i=!0,c.ref=u[0],V(()=>i=!1)),e.$set(c)},i(u){s||(_(e.$$.fragment,u),s=!0)},o(u){b(e.$$.fragment,u),s=!1},d(u){D(e,u)}}}function J6(n,e,t){let i;const s=["value","ref","options"];let r=je(e,s),{value:o}=e,{ref:l=void 0}=e,{options:a=void 0}=e;const u=Symbol("key");function h(){return o}function c(){t(2,i[u]=o,i)}function p(m){i=m,t(2,i)}function d(m){l=m,t(0,l)}return n.$$set=m=>{e=B(B({},e),Cn(m)),t(4,r=je(e,s)),"value"in m&&t(5,o=m.value),"ref"in m&&t(0,l=m.ref),"options"in m&&t(1,a=m.options)},n.$$.update=()=>{n.$$.dirty&4&&t(5,o=i[u]),n.$$.dirty&32&&c()},t(2,i={[u]:h()}),[l,a,i,u,r,o,p,d]}class qk extends Je{constructor(e){super(),et(this,e,J6,Q6,Qe,{value:5,ref:0,options:1})}}function e4(n){let e,t,i,s;const r=[{options:n[2]},n[3]];function o(u){n[5](u)}function l(u){n[6](u)}let a={};for(let u=0;u<r.length;u+=1)a=B(a,r[u]);return n[1]!==void 0&&(a.value=n[1]),n[0]!==void 0&&(a.ref=n[0]),e=new qk({props:a}),y.push(()=>k(e,"value",o)),y.push(()=>k(e,"ref",l)),{c(){A(e.$$.fragment)},l(u){M(e.$$.fragment,u)},m(u,h){T(e,u,h),s=!0},p(u,[h]){const c=h&12?zt(r,[h&4&&{options:u[2]},h&8&&qt(u[3])]):{};!t&&h&2&&(t=!0,c.value=u[1],V(()=>t=!1)),!i&&h&1&&(i=!0,c.ref=u[0],V(()=>i=!1)),e.$set(c)},i(u){s||(_(e.$$.fragment,u),s=!0)},o(u){b(e.$$.fragment,u),s=!1},d(u){D(e,u)}}}function t4(n,e,t){const i=["options","ref","value"];let s=je(e,i),{options:r=void 0}=e,{ref:o=void 0}=e,{value:l}=e,a;function u(c){l=c,t(1,l)}function h(c){o=c,t(0,o)}return n.$$set=c=>{e=B(B({},e),Cn(c)),t(3,s=je(e,i)),"options"in c&&t(4,r=c.options),"ref"in c&&t(0,o=c.ref),"value"in c&&t(1,l=c.value)},n.$$.update=()=>{n.$$.dirty&16&&t(2,a={...r,readonly:!1})},[o,l,a,s,r,u,h]}class Gk extends Je{constructor(e){super(),et(this,e,t4,e4,Qe,{options:4,ref:0,value:1})}}function Ae(n){return n==null}function cw(n){return n!==null&&typeof n=="object"}function jv(n){return n!==null&&typeof n=="object"}function n4(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function bo(n,e){return Array.from(new Set([...Object.keys(n),...Object.keys(e)])).reduce((i,s)=>{const r=n[s],o=e[s];return jv(r)&&jv(o)?Object.assign(Object.assign({},i),{[s]:bo(r,o)}):Object.assign(Object.assign({},i),{[s]:s in e?o:r})},{})}function i4(n){return cw(n)?"target"in n:!1}const s4={alreadydisposed:()=>"View has been already disposed",invalidparams:n=>`Invalid parameters for '${n.name}'`,nomatchingcontroller:n=>`No matching controller for '${n.key}'`,nomatchingview:n=>`No matching view for '${JSON.stringify(n.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:n=>`Not compatible with  plugin '${n.id}'`,propertynotfound:n=>`Property '${n.name}' not found`,shouldneverhappen:()=>"This error should never happen"};let go=class Pl{static alreadyDisposed(){return new Pl({type:"alreadydisposed"})}static notBindable(){return new Pl({type:"notbindable"})}static notCompatible(e,t){return new Pl({type:"notcompatible",context:{id:`${e}.${t}`}})}static propertyNotFound(e){return new Pl({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new Pl({type:"shouldneverhappen"})}constructor(e){var t;this.message=(t=s4[e.type](e.context))!==null&&t!==void 0?t:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}toString(){return this.message}},fP=class Yk{constructor(e,t){this.obj_=e,this.key=t}static isBindable(e){return!(e===null||typeof e!="object"&&typeof e!="function")}read(){return this.obj_[this.key]}write(e){this.obj_[this.key]=e}writeProperty(e,t){const i=this.read();if(!Yk.isBindable(i))throw go.notBindable();if(!(e in i))throw go.propertyNotFound(e);i[e]=t}},xn=class{constructor(){this.observers_={}}on(e,t){let i=this.observers_[e];return i||(i=this.observers_[e]=[]),i.push({handler:t}),this}off(e,t){const i=this.observers_[e];return i&&(this.observers_[e]=i.filter(s=>s.handler!==t)),this}emit(e,t){const i=this.observers_[e];i&&i.forEach(s=>{s.handler(t)})}},r4=class{constructor(e,t){var i;this.constraint_=t?.constraint,this.equals_=(i=t?.equals)!==null&&i!==void 0?i:(s,r)=>s===r,this.emitter=new xn,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},s=this.constraint_?this.constraint_.constrain(e):e,r=this.rawValue_;this.equals_(r,s)&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=s,this.emitter.emit("change",{options:i,previousRawValue:r,rawValue:s,sender:this}))}},o4=class{constructor(e){this.emitter=new xn,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},s=this.value_;s===e&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:i,previousRawValue:s,rawValue:this.value_,sender:this}))}},l4=class{constructor(e){this.emitter=new xn,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}};function lt(n,e){const t=e?.constraint,i=e?.equals;return!t&&!i?new o4(n):new r4(n,e)}function a4(n){return[new l4(n),(e,t)=>{n.setRawValue(e,t)}]}let be=class Xk{constructor(e){this.emitter=new xn,this.valMap_=e;for(const t in this.valMap_)this.valMap_[t].emitter.on("change",()=>{this.emitter.emit("change",{key:t,sender:this})})}static createCore(e){return Object.keys(e).reduce((i,s)=>Object.assign(i,{[s]:lt(e[s])}),{})}static fromObject(e){const t=this.createCore(e);return new Xk(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}},Kd=class{constructor(e){this.values=be.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");return Math.min(Math.max(e,i),t)}},u4=class{constructor(e){this.values=be.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");let s=e;return Ae(i)||(s=Math.max(s,i)),Ae(t)||(s=Math.min(s,t)),s}},h4=class{constructor(e,t=0){this.step=e,this.origin=t}constrain(e){const t=this.origin%this.step,i=Math.round((e-t)/this.step);return t+i*this.step}},c4=class{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}};const d4={"**":(n,e)=>Math.pow(n,e),"*":(n,e)=>n*e,"/":(n,e)=>n/e,"%":(n,e)=>n%e,"+":(n,e)=>n+e,"-":(n,e)=>n-e,"<<":(n,e)=>n<<e,">>":(n,e)=>n>>e,">>>":(n,e)=>n>>>e,"&":(n,e)=>n&e,"^":(n,e)=>n^e,"|":(n,e)=>n|e};let p4=class{constructor(e,t,i){this.left=t,this.operator=e,this.right=i}evaluate(){const e=d4[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}};const m4={"+":n=>n,"-":n=>-n,"~":n=>~n};let v4=class{constructor(e,t){this.operator=e,this.expression=t}evaluate(){const e=m4[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}};function dw(n){return(e,t)=>{for(let i=0;i<n.length;i++){const s=n[i](e,t);if(s!=="")return s}return""}}function ju(n,e){var t;const i=n.substr(e).match(/^\s+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function f4(n,e){const t=n.substr(e,1);return t.match(/^[1-9]$/)?t:""}function Nu(n,e){var t;const i=n.substr(e).match(/^[0-9]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function _4(n,e){const t=Nu(n,e);if(t!=="")return t;const i=n.substr(e,1);if(e+=1,i!=="-"&&i!=="+")return"";const s=Nu(n,e);return s===""?"":i+s}function pw(n,e){const t=n.substr(e,1);if(e+=1,t.toLowerCase()!=="e")return"";const i=_4(n,e);return i===""?"":t+i}function Wk(n,e){const t=n.substr(e,1);if(t==="0")return t;const i=f4(n,e);return e+=i.length,i===""?"":i+Nu(n,e)}function w4(n,e){const t=Wk(n,e);if(e+=t.length,t==="")return"";const i=n.substr(e,1);if(e+=i.length,i!==".")return"";const s=Nu(n,e);return e+=s.length,t+i+s+pw(n,e)}function b4(n,e){const t=n.substr(e,1);if(e+=t.length,t!==".")return"";const i=Nu(n,e);return e+=i.length,i===""?"":t+i+pw(n,e)}function g4(n,e){const t=Wk(n,e);return e+=t.length,t===""?"":t+pw(n,e)}const C4=dw([w4,b4,g4]);function P4(n,e){var t;const i=n.substr(e).match(/^[01]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function y4(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0b")return"";const i=P4(n,e);return i===""?"":t+i}function E4(n,e){var t;const i=n.substr(e).match(/^[0-7]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function x4(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0o")return"";const i=E4(n,e);return i===""?"":t+i}function $4(n,e){var t;const i=n.substr(e).match(/^[0-9a-f]+/i);return(t=i&&i[0])!==null&&t!==void 0?t:""}function V4(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0x")return"";const i=$4(n,e);return i===""?"":t+i}const k4=dw([y4,x4,V4]),S4=dw([k4,C4]);function L4(n,e){const t=S4(n,e);return e+=t.length,t===""?null:{evaluable:new c4(t),cursor:e}}function A4(n,e){const t=n.substr(e,1);if(e+=t.length,t!=="(")return null;const i=Qk(n,e);if(!i)return null;e=i.cursor,e+=ju(n,e).length;const s=n.substr(e,1);return e+=s.length,s!==")"?null:{evaluable:i.evaluable,cursor:e}}function M4(n,e){var t;return(t=L4(n,e))!==null&&t!==void 0?t:A4(n,e)}function Zk(n,e){const t=M4(n,e);if(t)return t;const i=n.substr(e,1);if(e+=i.length,i!=="+"&&i!=="-"&&i!=="~")return null;const s=Zk(n,e);return s?(e=s.cursor,{cursor:e,evaluable:new v4(i,s.evaluable)}):null}function T4(n,e,t){t+=ju(e,t).length;const i=n.filter(s=>e.startsWith(s,t))[0];return i?(t+=i.length,t+=ju(e,t).length,{cursor:t,operator:i}):null}function D4(n,e){return(t,i)=>{const s=n(t,i);if(!s)return null;i=s.cursor;let r=s.evaluable;for(;;){const o=T4(e,t,i);if(!o)break;i=o.cursor;const l=n(t,i);if(!l)return null;i=l.cursor,r=new p4(o.operator,r,l.evaluable)}return r?{cursor:i,evaluable:r}:null}}const R4=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((n,e)=>D4(n,e),Zk);function Qk(n,e){return e+=ju(n,e).length,R4(n,e)}function O4(n){const e=Qk(n,0);return!e||e.cursor+ju(n,e.cursor).length!==n.length?null:e.evaluable}function Tr(n){var e;const t=O4(n);return(e=t?.evaluate())!==null&&e!==void 0?e:null}function Jk(n){if(typeof n=="number")return n;if(typeof n=="string"){const e=Tr(n);if(!Ae(e))return e}return 0}function hn(n){return e=>e.toFixed(Math.max(Math.min(n,20),0))}function se(n,e,t,i,s){const r=(n-e)/(t-e);return i+r*(s-i)}function _P(n){return String(n.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function ze(n,e,t){return Math.min(Math.max(n,e),t)}function e1(n,e){return(n%e+e)%e}function j4(n,e){return Ae(n.step)?Math.max(_P(e),2):_P(n.step)}function t1(n){var e;return(e=n.step)!==null&&e!==void 0?e:1}function N4(n,e){var t;const i=Math.abs((t=n.step)!==null&&t!==void 0?t:e);return i===0?.1:Math.pow(10,Math.floor(Math.log10(i))-1)}function n1(n,e){return Ae(n.step)?null:new h4(n.step,e)}function i1(n){return!Ae(n.max)&&!Ae(n.min)?new Kd({max:n.max,min:n.min}):!Ae(n.max)||!Ae(n.min)?new u4({max:n.max,min:n.min}):null}function s1(n,e){var t,i,s;return{formatter:(t=n.format)!==null&&t!==void 0?t:hn(j4(n,e)),keyScale:(i=n.keyScale)!==null&&i!==void 0?i:t1(n),pointerScale:(s=n.pointerScale)!==null&&s!==void 0?s:N4(n,e)}}function r1(n){return{format:n.optional.function,keyScale:n.optional.number,max:n.optional.number,min:n.optional.number,pointerScale:n.optional.number,step:n.optional.number}}function mw(n){return{constraint:n.constraint,textProps:be.fromObject(s1(n.params,n.initialValue))}}let vw=class{constructor(e){this.controller=e}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(e){this.controller.viewProps.set("disabled",e)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(e){this.controller.viewProps.set("hidden",e)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(e){return this.controller.importState(e)}exportState(){return this.controller.exportState()}},Ud=class{constructor(e){this.target=e}},o1=class extends Ud{constructor(e,t,i){super(e),this.value=t,this.last=i??!0}},B4=class extends Ud{constructor(e,t){super(e),this.expanded=t}},I4=class extends Ud{constructor(e,t){super(e),this.index=t}},fw=class extends vw{constructor(e){super(e),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new xn,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(e){this.controller.tag=e}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}refresh(){this.controller.value.fetch()}onValueChange_(e){const t=this.controller.value;this.emitter_.emit("change",new o1(this,t.binding.target.read(),e.options.last))}};function F4(n,e){const i=Object.keys(e).reduce((s,r)=>{if(s===void 0)return;const o=e[r],l=o(n[r]);return l.succeeded?Object.assign(Object.assign({},s),{[r]:l.value}):void 0},{});return i}function K4(n,e){return n.reduce((t,i)=>{if(t===void 0)return;const s=e(i);if(!(!s.succeeded||s.value===void 0))return[...t,s.value]},[])}function U4(n){return n===null?!1:typeof n=="object"}function Qi(n){return e=>t=>{if(!e&&t===void 0)return{succeeded:!1,value:void 0};if(e&&t===void 0)return{succeeded:!0,value:void 0};const i=n(t);return i!==void 0?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}function wP(n){return{custom:e=>Qi(e)(n),boolean:Qi(e=>typeof e=="boolean"?e:void 0)(n),number:Qi(e=>typeof e=="number"?e:void 0)(n),string:Qi(e=>typeof e=="string"?e:void 0)(n),function:Qi(e=>typeof e=="function"?e:void 0)(n),constant:e=>Qi(t=>t===e?e:void 0)(n),raw:Qi(e=>e)(n),object:e=>Qi(t=>{if(U4(t))return F4(t,e)})(n),array:e=>Qi(t=>{if(Array.isArray(t))return K4(t,e)})(n)}}const Nv={optional:wP(!0),required:wP(!1)};function ft(n,e){const t=e(Nv),i=Nv.required.object(t)(n);return i.succeeded?i.value:void 0}function Oi(n,e,t,i){if(e&&!e(n))return!1;const s=ft(n,t);return s?i(s):!1}function ji(n,e){var t;return bo((t=n?.())!==null&&t!==void 0?t:{},e)}function yc(n){return"value"in n}function H4(n){if(!cw(n)||!("binding"in n))return!1;const e=n.binding;return i4(e)}const ci="http://www.w3.org/2000/svg";function ed(n){n.offsetHeight}function z4(n,e){const t=n.style.transition;n.style.transition="none",e(),n.style.transition=t}function _w(n){return n.ontouchstart!==void 0}function q4(n){const e=n.ownerDocument.defaultView;return e&&"document"in e?n.getContext("2d",{willReadFrequently:!0}):null}const G4={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Hd(n,e){const t=n.createElementNS(ci,"svg");return t.innerHTML=G4[e],t}function l1(n,e,t){n.insertBefore(e,n.children[t])}function ww(n){n.parentElement&&n.parentElement.removeChild(n)}function a1(n){for(;n.children.length>0;)n.removeChild(n.children[0])}function Y4(n){for(;n.childNodes.length>0;)n.removeChild(n.childNodes[0])}function u1(n){return n.relatedTarget?n.relatedTarget:"explicitOriginalTarget"in n?n.explicitOriginalTarget:null}function fs(n,e){n.emitter.on("change",t=>{e(t.rawValue)}),e(n.rawValue)}function gi(n,e,t){fs(n.value(e),t)}const X4="tp";function X(n){return(t,i)=>[X4,"-",n,"v",t?`_${t}`:"",i?`-${i}`:""].join("")}const Za=X("lbl");function W4(n,e){const t=n.createDocumentFragment();return e.split(`
`).map(s=>n.createTextNode(s)).forEach((s,r)=>{r>0&&t.appendChild(n.createElement("br")),t.appendChild(s)}),t}let Z4=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Za()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Za("l")),gi(t.props,"label",r=>{Ae(r)?this.element.classList.add(Za(void 0,"nol")):(this.element.classList.remove(Za(void 0,"nol")),Y4(i),i.appendChild(W4(e,r)))}),this.element.appendChild(i),this.labelElement=i;const s=e.createElement("div");s.classList.add(Za("v")),this.element.appendChild(s),this.valueElement=s}},Q4=class{constructor(e,t){this.props=t.props,this.valueController=t.valueController,this.viewProps=t.valueController.viewProps,this.view=new Z4(e,{props:t.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(e){return Oi(e,null,t=>({label:t.optional.string}),t=>(this.props.set("label",t.label),!0))}exportProps(){return ji(null,{label:this.props.get("label")})}};function J4(){return["veryfirst","first","last","verylast"]}const bP=X(""),gP={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};let h1=class{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",()=>{J4().forEach(i=>{t.classList.remove(bP(void 0,gP[i]))}),this.blade.get("positions").forEach(i=>{t.classList.add(bP(void 0,gP[i]))})}),this.viewProps.handleDispose(()=>{ww(t)})}get parent(){return this.parent_}set parent(e){this.parent_=e,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(e){return Oi(e,null,t=>({disabled:t.required.boolean,hidden:t.required.boolean}),t=>(this.viewProps.importState(t),!0))}exportState(){return ji(null,Object.assign({},this.viewProps.exportState()))}},eU=class extends vw{get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get title(){var e;return(e=this.controller.buttonController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.buttonController.props.set("title",e)}on(e,t){const i=t.bind(this);return this.controller.buttonController.emitter.on(e,()=>{i(new Ud(this))}),this}};function tU(n,e,t){t?n.classList.add(e):n.classList.remove(e)}function Ca(n,e){return t=>{tU(n,e,t)}}function bw(n,e){fs(n,t=>{e.textContent=t??""})}const fm=X("btn");let nU=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(fm()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("button");i.classList.add(fm("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(fm("t")),bw(t.props.value("title"),s),this.buttonElement.appendChild(s)}},iU=class{constructor(e,t){this.emitter=new xn,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new nU(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(e){return Oi(e,null,t=>({title:t.optional.string}),t=>(this.props.set("title",t.title),!0))}exportProps(){return ji(null,{title:this.props.get("title")})}onClick_(){this.emitter.emit("click",{sender:this})}},CP=class extends h1{constructor(e,t){const i=new iU(e,{props:t.buttonProps,viewProps:t.viewProps}),s=new Q4(e,{blade:t.blade,props:t.labelProps,valueController:i});super({blade:t.blade,view:s.view,viewProps:t.viewProps}),this.buttonController=i,this.labelController=s}importState(e){return Oi(e,t=>super.importState(t)&&this.buttonController.importProps(t)&&this.labelController.importProps(t),()=>({}),()=>!0)}exportState(){return ji(()=>super.exportState(),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}},sU=class{constructor(e){const[t,i]=e.split("-"),s=t.split(".");this.major=parseInt(s[0],10),this.minor=parseInt(s[1],10),this.patch=parseInt(s[2],10),this.prerelease=i??null}toString(){const e=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[e,this.prerelease].join("-"):e}};const rU=new sU("2.0.1");function kt(n){return Object.assign({core:rU},n)}kt({id:"button",type:"blade",accept(n){const e=ft(n,t=>({title:t.required.string,view:t.required.constant("button"),label:t.optional.string}));return e?{params:e}:null},controller(n){return new CP(n.document,{blade:n.blade,buttonProps:be.fromObject({title:n.params.title}),labelProps:be.fromObject({label:n.params.label}),viewProps:n.viewProps})},api(n){return n.controller instanceof CP?new eU(n.controller):null}});function oU(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}function lU(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}function aU(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}function uU(n){return cw(n)?"refresh"in n&&typeof n.refresh=="function":!1}function hU(n,e){if(!fP.isBindable(n))throw go.notBindable();return new fP(n,e)}let cU=class{constructor(e,t){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=e,this.emitter_=new xn,this.pool_=t,this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map(e=>this.pool_.createApi(e))}addBinding(e,t,i){const s=i??{},r=this.controller_.element.ownerDocument,o=this.pool_.createBinding(r,hU(e,t),s),l=this.pool_.createBindingApi(o);return this.add(l,s.index)}addFolder(e){return lU(this,e)}addButton(e){return oU(this,e)}addTab(e){return aU(this,e)}add(e,t){const i=e.controller;return this.controller_.rack.add(i,t),e}remove(e){this.controller_.rack.remove(e.controller)}addBlade(e){const t=this.controller_.element.ownerDocument,i=this.pool_.createBlade(t,e),s=this.pool_.createApi(i);return this.add(s,e.index)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}refresh(){this.children.forEach(e=>{uU(e)&&e.refresh()})}onRackValueChange_(e){const t=e.bladeController,i=this.pool_.createApi(t),s=H4(t.value)?t.value.binding:null;this.emitter_.emit("change",new o1(i,s?s.target.read():t.value.rawValue,e.options.last))}},gw=class extends vw{constructor(e,t){super(e),this.rackApi_=new cU(e.rackController,t)}refresh(){this.rackApi_.refresh()}},Cw=class extends h1{constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps}),this.rackController=e.rackController}importState(e){return Oi(e,t=>super.importState(t),t=>({children:t.required.array(t.required.raw)}),t=>this.rackController.rack.children.every((i,s)=>i.importState(t.children[s])))}exportState(){return ji(()=>super.exportState(),{children:this.rackController.rack.children.map(e=>e.exportState())})}};function Bv(n){return"rackController"in n}let dU=class{constructor(e){this.emitter=new xn,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const t of this.allItems())if(e(t))return t;return null}includes(e){return this.cache_.has(e)}add(e,t){if(this.includes(e))throw go.shouldNeverHappen();const i=t!==void 0?t:this.items_.length;this.items_.splice(i,0,e),this.cache_.add(e);const s=this.extract_(e);s&&(s.emitter.on("add",this.onSubListAdd_),s.emitter.on("remove",this.onSubListRemove_),s.allItems().forEach(r=>{this.cache_.add(r)})),this.emitter.emit("add",{index:i,item:e,root:this,target:this})}remove(e){const t=this.items_.indexOf(e);if(t<0)return;this.items_.splice(t,1),this.cache_.delete(e);const i=this.extract_(e);i&&(i.allItems().forEach(s=>{this.cache_.delete(s)}),i.emitter.off("add",this.onSubListAdd_),i.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}};function pU(n,e){for(let t=0;t<n.length;t++){const i=n[t];if(yc(i)&&i.value===e)return i}return null}function mU(n){return Bv(n)?n.rackController.rack.bcSet_:null}let vU=class{constructor(e){var t,i;this.emitter=new xn,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=(t=e.blade)!==null&&t!==void 0?t:null,(i=this.blade_)===null||i===void 0||i.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=e.viewProps,this.bcSet_=new dU(mU),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,t){var i;(i=e.parent)===null||i===void 0||i.remove(e),e.parent=this,this.bcSet_.add(e,t)}remove(e){e.parent=null,this.bcSet_.remove(e)}find(e){return this.bcSet_.allItems().filter(e)}onSetAdd_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,root:t,sender:this}),!t)return;const i=e.item;if(i.viewProps.emitter.on("change",this.onChildViewPropsChange_),i.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),i.viewProps.handleDispose(this.onChildDispose_),yc(i))i.value.emitter.on("change",this.onChildValueChange_);else if(Bv(i)){const s=i.rackController.rack;if(s){const r=s.emitter;r.on("layout",this.onRackLayout_),r.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,root:t,sender:this}),!t)return;const i=e.item;if(yc(i))i.value.emitter.off("change",this.onChildValueChange_);else if(Bv(i)){const s=i.rackController.rack;if(s){const r=s.emitter;r.off("layout",this.onRackLayout_),r.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){const e=this.bcSet_.items.filter(s=>!s.viewProps.get("hidden")),t=e[0],i=e[e.length-1];this.bcSet_.items.forEach(s=>{const r=[];s===t&&(r.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&r.push("veryfirst")),s===i&&(r.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&r.push("verylast")),s.blade.set("positions",r)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(t=>t.viewProps.get("disposed")).forEach(t=>{this.bcSet_.remove(t)})}onChildValueChange_(e){const t=pU(this.find(yc),e.sender);if(!t)throw go.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:t,options:e.options,sender:this})}onRackLayout_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(e){this.emitter.emit("valuechange",{bladeController:e.bladeController,options:e.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}},Pw=class{constructor(e){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=e.element,this.viewProps=e.viewProps;const t=new vU({blade:e.root?void 0:e.blade,viewProps:e.viewProps});t.emitter.on("add",this.onRackAdd_),t.emitter.on("remove",this.onRackRemove_),this.rack=t,this.viewProps.handleDispose(()=>{for(let i=this.rack.children.length-1;i>=0;i--)this.rack.children[i].viewProps.set("disposed",!0)})}onRackAdd_(e){e.root&&l1(this.element,e.bladeController.view.element,e.index)}onRackRemove_(e){e.root&&ww(e.bladeController.view.element)}};function c1(){return new be({positions:lt([],{equals:n4})})}let yw=class d1 extends be{constructor(e){super(e)}static create(e){const t={completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},i=be.createCore(t);return new d1(i)}get styleExpanded(){var e;return(e=this.get("temporaryExpanded"))!==null&&e!==void 0?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!Ae(e)?`${e}px`:"auto"}bindExpandedClass(e,t){const i=()=>{this.styleExpanded?e.classList.add(t):e.classList.remove(t)};gi(this,"expanded",i),gi(this,"temporaryExpanded",i)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}};function fU(n,e){let t=0;return z4(e,()=>{n.set("expandedHeight",null),n.set("temporaryExpanded",!0),ed(e),t=e.clientHeight,n.set("temporaryExpanded",null),ed(e)}),t}function PP(n,e){e.style.height=n.styleHeight}function Ew(n,e){n.value("expanded").emitter.on("beforechange",()=>{if(n.set("completed",!1),Ae(n.get("expandedHeight"))){const t=fU(n,e);t>0&&n.set("expandedHeight",t)}n.set("shouldFixHeight",!0),ed(e)}),n.emitter.on("change",()=>{PP(n,e)}),PP(n,e),e.addEventListener("transitionend",t=>{t.propertyName==="height"&&n.cleanUpTransition()})}let _U=class extends gw{constructor(e,t){super(e,t),this.emitter_=new xn,this.controller.foldable.value("expanded").emitter.on("change",i=>{this.emitter_.emit("fold",new B4(this,i.sender.rawValue))}),this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)})}get expanded(){return this.controller.foldable.get("expanded")}set expanded(e){this.controller.foldable.set("expanded",e)}get title(){return this.controller.props.get("title")}set title(e){this.controller.props.set("title",e)}get children(){return this.rackApi_.children}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){return this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}};const p1=X("cnt");let wU=class{constructor(e,t){var i;this.className_=X((i=t.viewName)!==null&&i!==void 0?i:"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),p1()),t.viewProps.bindClassModifiers(this.element),this.foldable_=t.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),gi(this.foldable_,"completed",Ca(this.element,this.className_(void 0,"cpl")));const s=e.createElement("button");s.classList.add(this.className_("b")),gi(t.props,"title",u=>{Ae(u)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s;const r=e.createElement("div");r.classList.add(this.className_("i")),this.element.appendChild(r);const o=e.createElement("div");o.classList.add(this.className_("t")),bw(t.props.value("title"),o),this.buttonElement.appendChild(o),this.titleElement=o;const l=e.createElement("div");l.classList.add(this.className_("m")),this.buttonElement.appendChild(l);const a=e.createElement("div");a.classList.add(this.className_("c")),this.element.appendChild(a),this.containerElement=a}},yP=class extends Cw{constructor(e,t){var i;const s=yw.create((i=t.expanded)!==null&&i!==void 0?i:!0),r=new wU(e,{foldable:s,props:t.props,viewName:t.root?"rot":void 0,viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new Pw({blade:t.blade,element:r.containerElement,root:t.root,viewProps:t.viewProps}),view:r})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=t.props,this.foldable=s,Ew(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(e){return Oi(e,t=>super.importState(t),t=>({expanded:t.required.boolean,title:t.optional.string}),t=>(this.foldable.set("expanded",t.expanded),this.props.set("title",t.title),!0))}exportState(){return ji(()=>super.exportState(),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}};kt({id:"folder",type:"blade",accept(n){const e=ft(n,t=>({title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean}));return e?{params:e}:null},controller(n){return new yP(n.document,{blade:n.blade,expanded:n.params.expanded,props:be.fromObject({title:n.params.title}),viewProps:n.viewProps})},api(n){return n.controller instanceof yP?new _U(n.controller,n.pool):null}});const bU=X("");function EP(n,e){return Ca(n,bU(void 0,e))}let xw=class m1 extends be{constructor(e){var t;super(e),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=a4(lt(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(e){var t,i,s;const r=e??{};return new m1(be.createCore({disabled:(t=r.disabled)!==null&&t!==void 0?t:!1,disposed:!1,hidden:(i=r.hidden)!==null&&i!==void 0?i:!1,parent:(s=r.parent)!==null&&s!==void 0?s:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(e){fs(this.globalDisabled_,EP(e,"disabled")),gi(this,"hidden",EP(e,"hidden"))}bindDisabled(e){fs(this.globalDisabled_,t=>{e.disabled=t})}bindTabIndex(e){fs(this.globalDisabled_,t=>{e.tabIndex=t?-1:0})}handleDispose(e){this.value("disposed").emitter.on("change",t=>{t&&e()})}importState(e){this.set("disabled",e.disabled),this.set("hidden",e.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){const e=this.get("parent");return(e?e.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(e){var t;const i=e.previousRawValue;i?.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}};const xP=X("tbp");let gU=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(xP()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(xP("c")),this.element.appendChild(i),this.containerElement=i}};const Qa=X("tbi");let CU=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Qa()),t.viewProps.bindClassModifiers(this.element),gi(t.props,"selected",r=>{r?this.element.classList.add(Qa(void 0,"sel")):this.element.classList.remove(Qa(void 0,"sel"))});const i=e.createElement("button");i.classList.add(Qa("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(Qa("t")),bw(t.props.value("title"),s),this.buttonElement.appendChild(s),this.titleElement=s}},PU=class{constructor(e,t){this.emitter=new xn,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new CU(e,{props:t.props,viewProps:t.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}},Iv=class extends Cw{constructor(e,t){const i=new gU(e,{viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new Pw({blade:t.blade,element:i.containerElement,viewProps:t.viewProps}),view:i})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new PU(e,{props:t.itemProps,viewProps:xw.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=t.props,gi(this.props,"selected",s=>{this.itemController.props.set("selected",s),this.viewProps.set("hidden",!s)})}get itemController(){return this.ic_}importState(e){return Oi(e,t=>super.importState(t),t=>({selected:t.required.boolean,title:t.required.string}),t=>(this.ic_.props.set("selected",t.selected),this.ic_.props.set("title",t.title),!0))}exportState(){return ji(()=>super.exportState(),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}},yU=class extends gw{constructor(e,t){super(e,t),this.emitter_=new xn,this.onSelect_=this.onSelect_.bind(this),this.pool_=t,this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)}),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(e){const t=this.controller.view.element.ownerDocument,i=new Iv(t,{blade:c1(),itemProps:be.fromObject({selected:!1,title:e.title}),props:be.fromObject({selected:!1}),viewProps:xw.create()}),s=this.pool_.createApi(i);return this.rackApi_.add(s,e.index)}removePage(e){this.rackApi_.remove(this.rackApi_.children[e])}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}onSelect_(e){this.emitter_.emit("select",new I4(this,e.rawValue))}},EU=class extends gw{get title(){var e;return(e=this.controller.itemController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.itemController.props.set("title",e)}get selected(){return this.controller.props.get("selected")}set selected(e){this.controller.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addBlade(e){return this.rackApi_.addBlade(e)}};const $P=-1;let xU=class{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=lt(!0),this.selectedIndex=lt($P),this.items_=[]}add(e,t){const i=t??this.items_.length;this.items_.splice(i,0,e),e.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(e){const t=this.items_.indexOf(e);t<0||(this.items_.splice(t,1),e.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=$P,this.empty.rawValue=!0;return}const e=this.items_.findIndex(t=>t.rawValue);e<0?(this.items_.forEach((t,i)=>{t.rawValue=i===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((t,i)=>{t.rawValue=i===e}),this.selectedIndex.rawValue=e),this.empty.rawValue=!1}onItemSelectedChange_(e){if(e.rawValue){const t=this.items_.findIndex(i=>i===e.sender);this.items_.forEach((i,s)=>{i.rawValue=s===t}),this.selectedIndex.rawValue=t}else this.keepSelection_()}};const Ja=X("tab");let $U=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Ja(),p1()),t.viewProps.bindClassModifiers(this.element),fs(t.empty,Ca(this.element,Ja(void 0,"nop")));const i=e.createElement("div");i.classList.add(Ja("t")),this.element.appendChild(i),this.itemsElement=i;const s=e.createElement("div");s.classList.add(Ja("i")),this.element.appendChild(s);const r=e.createElement("div");r.classList.add(Ja("c")),this.element.appendChild(r),this.contentsElement=r}},VP=class extends Cw{constructor(e,t){const i=new xU,s=new $U(e,{empty:i.empty,viewProps:t.viewProps});super({blade:t.blade,rackController:new Pw({blade:t.blade,element:s.contentsElement,viewProps:t.viewProps}),view:s}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const r=this.rackController.rack;r.emitter.on("add",this.onRackAdd_),r.emitter.on("remove",this.onRackRemove_),this.tab=i}add(e,t){this.rackController.rack.add(e,t)}remove(e){this.rackController.rack.remove(this.rackController.rack.children[e])}onRackAdd_(e){if(!e.root)return;const t=e.bladeController;l1(this.view.itemsElement,t.itemController.view.element,e.index),t.itemController.viewProps.set("parent",this.viewProps),this.tab.add(t.props.value("selected"))}onRackRemove_(e){if(!e.root)return;const t=e.bladeController;ww(t.itemController.view.element),t.itemController.viewProps.set("parent",null),this.tab.remove(t.props.value("selected"))}};kt({id:"tab",type:"blade",accept(n){const e=ft(n,t=>({pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")}));return!e||e.pages.length===0?null:{params:e}},controller(n){const e=new VP(n.document,{blade:n.blade,viewProps:n.viewProps});return n.params.pages.forEach(t=>{const i=new Iv(n.document,{blade:c1(),itemProps:be.fromObject({selected:!1,title:t.title}),props:be.fromObject({selected:!1}),viewProps:xw.create()});e.add(i)}),e},api(n){return n.controller instanceof VP?new yU(n.controller,n.pool):n.controller instanceof Iv?new EU(n.controller,n.pool):null}});let $w=class extends fw{get options(){return this.controller.valueController.props.get("options")}set options(e){this.controller.valueController.props.set("options",e)}},Vh=class{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce((t,i)=>i.constrain(t),e)}};function td(n,e){if(n instanceof e)return n;if(n instanceof Vh){const t=n.constraints.reduce((i,s)=>i||(s instanceof e?s:null),null);if(t)return t}return null}let zd=class{constructor(e){this.values=be.fromObject({options:e})}constrain(e){const t=this.values.get("options");return t.length===0||t.filter(s=>s.value===e).length>0?e:t[0].value}};function qd(n){var e;const t=Nv;if(Array.isArray(n))return(e=ft({items:n},i=>({items:i.required.array(i.required.object({text:i.required.string,value:i.required.raw}))})))===null||e===void 0?void 0:e.items;if(typeof n=="object")return t.required.raw(n).value}function v1(n){if(Array.isArray(n))return n;const e=[];return Object.keys(n).forEach(t=>{e.push({text:t,value:n[t]})}),e}function Vw(n){return Ae(n)?null:new zd(v1(n))}const _m=X("lst");let VU=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add(_m()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("select");i.classList.add(_m("s")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.selectElement=i;const s=e.createElement("div");s.classList.add(_m("m")),s.appendChild(Hd(e,"dropdown")),this.element.appendChild(s),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,gi(this.props_,"options",r=>{a1(this.selectElement),r.forEach(o=>{const l=e.createElement("option");l.textContent=o.text,this.selectElement.appendChild(l)}),this.update_()})}update_(){const e=this.props_.get("options").map(t=>t.value);this.selectElement.selectedIndex=e.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}},Wl=class{constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new VU(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const t=e.currentTarget;this.value.rawValue=this.props.get("options")[t.selectedIndex].value}importProps(e){return Oi(e,null,t=>({options:t.required.custom(qd)}),t=>(this.props.set("options",v1(t.options)),!0))}exportProps(){return ji(null,{options:this.props.get("options")})}};const kP=X("pop");let kU=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(kP()),t.viewProps.bindClassModifiers(this.element),fs(t.shows,Ca(this.element,kP(void 0,"v")))}},f1=class{constructor(e,t){this.shows=lt(!1),this.viewProps=t.viewProps,this.view=new kU(e,{shows:this.shows,viewProps:this.viewProps})}};const SP=X("txt");let SU=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(SP()),t.viewProps.bindClassModifiers(this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);const i=e.createElement("input");i.classList.add(SP("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}},kw=class{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new SU(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const i=e.currentTarget.value,s=this.parser_(i);Ae(s)||(this.value.rawValue=s),this.view.refresh()}};function LU(n){return String(n)}function _1(n){return n==="false"?!1:!!n}function LP(n){return LU(n)}function AU(n){return e=>n.reduce((t,i)=>t!==null?t:i(e),null)}const MU=hn(0);function nd(n){return MU(n)+"%"}function w1(n){return String(n)}function Fv(n){return n}function Pa({primary:n,secondary:e,forward:t,backward:i}){let s=!1;function r(o){s||(s=!0,o(),s=!1)}n.emitter.on("change",o=>{r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),e.emitter.on("change",o=>{r(()=>{n.setRawValue(i(n.rawValue,e.rawValue),o.options)}),r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),{forceEmit:!1,last:!0})})}function Jt(n,e){const t=n*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+t:e.downKey?-t:0}function Bu(n){return{altKey:n.altKey,downKey:n.key==="ArrowDown",shiftKey:n.shiftKey,upKey:n.key==="ArrowUp"}}function Vs(n){return{altKey:n.altKey,downKey:n.key==="ArrowLeft",shiftKey:n.shiftKey,upKey:n.key==="ArrowRight"}}function TU(n){return n==="ArrowUp"||n==="ArrowDown"}function b1(n){return TU(n)||n==="ArrowLeft"||n==="ArrowRight"}function wm(n,e){var t,i;const s=e.ownerDocument.defaultView,r=e.getBoundingClientRect();return{x:n.pageX-(((t=s&&s.scrollX)!==null&&t!==void 0?t:0)+r.left),y:n.pageY-(((i=s&&s.scrollY)!==null&&i!==void 0?i:0)+r.top)}}let Ko=class{constructor(e){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new xn,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault(),(t=e.currentTarget)===null||t===void 0||t.focus();const i=this.elem_.ownerDocument;i.addEventListener("mousemove",this.onDocumentMouseMove_),i.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(wm(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(wm(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(wm(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchMove_(e){const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchEnd_(e){var t;const i=(t=e.targetTouches.item(0))!==null&&t!==void 0?t:this.lastTouch_,s=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(i?{x:i.clientX-s.left,y:i.clientY-s.top}:void 0),sender:this,shiftKey:e.shiftKey})}};const Dn=X("txt");let DU=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(Dn(),Dn(void 0,"num")),t.arrayPosition&&this.element.classList.add(Dn(void 0,t.arrayPosition)),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(Dn("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Dn()),this.inputElement.classList.add(Dn("i"));const s=e.createElement("div");s.classList.add(Dn("k")),this.element.appendChild(s),this.knobElement=s;const r=e.createElementNS(ci,"svg");r.classList.add(Dn("g")),this.knobElement.appendChild(r);const o=e.createElementNS(ci,"path");o.classList.add(Dn("gb")),r.appendChild(o),this.guideBodyElem_=o;const l=e.createElementNS(ci,"path");l.classList.add(Dn("gh")),r.appendChild(l),this.guideHeadElem_=l;const a=e.createElement("div");a.classList.add(X("tt")()),this.knobElement.appendChild(a),this.tooltipElem_=a,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.refresh()}onDraggingChange_(e){if(e.rawValue===null){this.element.classList.remove(Dn(void 0,"drg"));return}this.element.classList.add(Dn(void 0,"drg"));const t=e.rawValue/this.props_.get("pointerScale"),i=t+(t>0?-1:t<0?1:0),s=ze(-i,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${i+s},0 L${i},4 L${i+s},8`,`M ${t},-1 L${t},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${t},4`);const r=this.props_.get("formatter");this.tooltipElem_.textContent=r(this.value.rawValue),this.tooltipElem_.style.left=`${t}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}},kh=class{constructor(e,t){var i;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=t.parser,this.props=t.props,this.sliderProps_=(i=t.sliderProps)!==null&&i!==void 0?i:null,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=lt(null),this.view=new DU(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const s=new Ko(this.view.knobElement);s.emitter.on("down",this.onPointerDown_),s.emitter.on("move",this.onPointerMove_),s.emitter.on("up",this.onPointerUp_)}constrainValue_(e){var t,i;const s=(t=this.sliderProps_)===null||t===void 0?void 0:t.get("min"),r=(i=this.sliderProps_)===null||i===void 0?void 0:i.get("max");let o=e;return s!==void 0&&(o=Math.max(o,s)),r!==void 0&&(o=Math.min(o,r)),o}onInputChange_(e){const i=e.currentTarget.value,s=this.parser_(i);Ae(s)||(this.value.rawValue=this.constrainValue_(s)),this.view.refresh()}onInputKeyDown_(e){const t=Jt(this.props.get("keyScale"),Bu(e));t!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+t),{forceEmit:!1,last:!1})}onInputKeyUp_(e){Jt(this.props.get("keyScale"),Bu(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;const t=e.point.x-e.bounds.width/2;return this.constrainValue_(this.originRawValue_+t*this.props.get("pointerScale"))}onPointerMove_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}};const bm=X("sld");let RU=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(bm()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(bm("t")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.trackElement=i;const s=e.createElement("div");s.classList.add(bm("k")),this.trackElement.appendChild(s),this.knobElement=s,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}update_(){const e=ze(se(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${e}%`}onChange_(){this.update_()}},OU=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.props=t.props,this.view=new RU(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ko(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){e.point&&this.value.setRawValue(se(ze(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("min"),this.props.get("max")),t)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Jt(this.props.get("keyScale"),Vs(e));t!==0&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onKeyUp_(e){Jt(this.props.get("keyScale"),Vs(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const gm=X("sldtxt");let jU=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(gm());const i=e.createElement("div");i.classList.add(gm("s")),this.sliderView_=t.sliderView,i.appendChild(this.sliderView_.element),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(gm("t")),this.textView_=t.textView,s.appendChild(this.textView_.element),this.element.appendChild(s)}},AP=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sliderC_=new OU(e,{props:t.sliderProps,value:t.value,viewProps:this.viewProps}),this.textC_=new kh(e,{parser:t.parser,props:t.textProps,sliderProps:t.sliderProps,value:t.value,viewProps:t.viewProps}),this.view=new jU(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(e){return Oi(e,null,t=>({max:t.required.number,min:t.required.number}),t=>{const i=this.sliderC_.props;return i.set("max",t.max),i.set("min",t.min),!0})}exportProps(){const e=this.sliderC_.props;return ji(null,{max:e.get("max"),min:e.get("min")})}};function NU(n){return{sliderProps:new be({keyScale:n.keyScale,max:n.max,min:n.min}),textProps:new be({formatter:lt(n.formatter),keyScale:n.keyScale,pointerScale:lt(n.pointerScale)})}}const BU={containerUnitSize:"cnt-usz"};function g1(n){return`--${BU[n]}`}function Iu(n){return r1(n)}function mr(n){if(jv(n))return ft(n,Iu)}function ls(n,e){if(!n)return;const t=[],i=n1(n,e);i&&t.push(i);const s=i1(n);return s&&t.push(s),new Vh(t)}function C1(n){if(n==="inline"||n==="popup")return n}function Sh(n,e){n.write(e)}const sc=X("ckb");let IU=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(sc()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("label");i.classList.add(sc("l")),this.element.appendChild(i);const s=e.createElement("input");s.classList.add(sc("i")),s.type="checkbox",i.appendChild(s),this.inputElement=s,t.viewProps.bindDisabled(this.inputElement);const r=e.createElement("div");r.classList.add(sc("w")),i.appendChild(r);const o=Hd(e,"check");r.appendChild(o),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}},FU=class{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new IU(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const t=e.currentTarget;this.value.rawValue=t.checked}};function KU(n){const e=[],t=Vw(n.options);return t&&e.push(t),new Vh(e)}kt({id:"input-bool",type:"input",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=ft(e,i=>({options:i.optional.custom(qd),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>_1,constraint:n=>KU(n.params),writer:n=>Sh},controller:n=>{const e=n.document,t=n.value,i=n.constraint,s=i&&td(i,zd);return s?new Wl(e,{props:new be({options:s.values.value("options")}),value:t,viewProps:n.viewProps}):new FU(e,{value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="boolean"?null:n.controller.valueController instanceof Wl?new $w(n.controller):null}});const Yr=X("col");let UU=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Yr()),t.foldable.bindExpandedClass(this.element,Yr(void 0,"expanded")),gi(t.foldable,"completed",Ca(this.element,Yr(void 0,"cpl")));const i=e.createElement("div");i.classList.add(Yr("h")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Yr("s")),i.appendChild(s),this.swatchElement=s;const r=e.createElement("div");if(r.classList.add(Yr("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(Yr("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}};function HU(n,e,t){const i=ze(n/255,0,1),s=ze(e/255,0,1),r=ze(t/255,0,1),o=Math.max(i,s,r),l=Math.min(i,s,r),a=o-l;let u=0,h=0;const c=(l+o)/2;return a!==0&&(h=a/(1-Math.abs(o+l-1)),i===o?u=(s-r)/a:s===o?u=2+(r-i)/a:u=4+(i-s)/a,u=u/6+(u<0?1:0)),[u*360,h*100,c*100]}function zU(n,e,t){const i=(n%360+360)%360,s=ze(e/100,0,1),r=ze(t/100,0,1),o=(1-Math.abs(2*r-1))*s,l=o*(1-Math.abs(i/60%2-1)),a=r-o/2;let u,h,c;return i>=0&&i<60?[u,h,c]=[o,l,0]:i>=60&&i<120?[u,h,c]=[l,o,0]:i>=120&&i<180?[u,h,c]=[0,o,l]:i>=180&&i<240?[u,h,c]=[0,l,o]:i>=240&&i<300?[u,h,c]=[l,0,o]:[u,h,c]=[o,0,l],[(u+a)*255,(h+a)*255,(c+a)*255]}function qU(n,e,t){const i=ze(n/255,0,1),s=ze(e/255,0,1),r=ze(t/255,0,1),o=Math.max(i,s,r),l=Math.min(i,s,r),a=o-l;let u;a===0?u=0:o===i?u=60*(((s-r)/a%6+6)%6):o===s?u=60*((r-i)/a+2):u=60*((i-s)/a+4);const h=o===0?0:a/o,c=o;return[u,h*100,c*100]}function P1(n,e,t){const i=e1(n,360),s=ze(e/100,0,1),r=ze(t/100,0,1),o=r*s,l=o*(1-Math.abs(i/60%2-1)),a=r-o;let u,h,c;return i>=0&&i<60?[u,h,c]=[o,l,0]:i>=60&&i<120?[u,h,c]=[l,o,0]:i>=120&&i<180?[u,h,c]=[0,o,l]:i>=180&&i<240?[u,h,c]=[0,l,o]:i>=240&&i<300?[u,h,c]=[l,0,o]:[u,h,c]=[o,0,l],[(u+a)*255,(h+a)*255,(c+a)*255]}function GU(n,e,t){const i=t+e*(100-Math.abs(2*t-100))/200;return[n,i!==0?e*(100-Math.abs(2*t-100))/i:0,t+e*(100-Math.abs(2*t-100))/(2*100)]}function YU(n,e,t){const i=100-Math.abs(t*(200-e)/100-100);return[n,i!==0?e*t/i:0,t*(200-e)/(2*100)]}function Ci(n){return[n[0],n[1],n[2]]}function Gd(n,e){return[n[0],n[1],n[2],e]}const XU={hsl:{hsl:(n,e,t)=>[n,e,t],hsv:GU,rgb:zU},hsv:{hsl:YU,hsv:(n,e,t)=>[n,e,t],rgb:P1},rgb:{hsl:HU,hsv:qU,rgb:(n,e,t)=>[n,e,t]}};function Zl(n,e){return[e==="float"?1:n==="rgb"?255:360,e==="float"?1:n==="rgb"?255:100,e==="float"?1:n==="rgb"?255:100]}function WU(n,e){return n===e?e:e1(n,e)}function y1(n,e,t){var i;const s=Zl(e,t);return[e==="rgb"?ze(n[0],0,s[0]):WU(n[0],s[0]),ze(n[1],0,s[1]),ze(n[2],0,s[2]),ze((i=n[3])!==null&&i!==void 0?i:1,0,1)]}function MP(n,e,t,i){const s=Zl(e,t),r=Zl(e,i);return n.map((o,l)=>o/s[l]*r[l])}function E1(n,e,t){const i=MP(n,e.mode,e.type,"int"),s=XU[e.mode][t.mode](...i);return MP(s,t.mode,"int",t.type)}let de=class x1{static black(){return new x1([0,0,0],"rgb")}constructor(e,t){this.type="int",this.mode=t,this.comps_=y1(e,t,this.type)}getComponents(e){return Gd(E1(Ci(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}};const zs=X("colp");let ZU=class{constructor(e,t){this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(zs()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(zs("hsv"));const s=e.createElement("div");s.classList.add(zs("sv")),this.svPaletteView_=t.svPaletteView,s.appendChild(this.svPaletteView_.element),i.appendChild(s);const r=e.createElement("div");r.classList.add(zs("h")),this.hPaletteView_=t.hPaletteView,r.appendChild(this.hPaletteView_.element),i.appendChild(r),this.element.appendChild(i);const o=e.createElement("div");if(o.classList.add(zs("rgb")),this.textsView_=t.textsView,o.appendChild(this.textsView_.element),this.element.appendChild(o),t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};const l=e.createElement("div");l.classList.add(zs("a"));const a=e.createElement("div");a.classList.add(zs("ap")),a.appendChild(this.alphaViews_.palette.element),l.appendChild(a);const u=e.createElement("div");u.classList.add(zs("at")),u.appendChild(this.alphaViews_.text.element),l.appendChild(u),this.element.appendChild(l)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map(t=>t.inputElement)];return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}};function QU(n){return n==="int"?"int":n==="float"?"float":void 0}function Sw(n){return ft(n,e=>({color:e.optional.object({alpha:e.optional.boolean,type:e.optional.custom(QU)}),expanded:e.optional.boolean,picker:e.optional.custom(C1),readonly:e.optional.constant(!1)}))}function Co(n){return n?.1:1}function $1(n){var e;return(e=n.color)===null||e===void 0?void 0:e.type}let Lw=class{constructor(e,t){this.type="float",this.mode=t,this.comps_=y1(e,t,this.type)}getComponents(e){return Gd(E1(Ci(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}};const JU={int:(n,e)=>new de(n,e),float:(n,e)=>new Lw(n,e)};function Aw(n,e,t){return JU[t](n,e)}function eH(n){return n.type==="float"}function tH(n){return n.type==="int"}function nH(n){const e=n.getComponents(),t=Zl(n.mode,"int");return new de([Math.round(se(e[0],0,1,0,t[0])),Math.round(se(e[1],0,1,0,t[1])),Math.round(se(e[2],0,1,0,t[2])),e[3]],n.mode)}function iH(n){const e=n.getComponents(),t=Zl(n.mode,"int");return new Lw([se(e[0],0,t[0],0,1),se(e[1],0,t[1],0,1),se(e[2],0,t[2],0,1),e[3]],n.mode)}function Nt(n,e){if(n.type===e)return n;if(tH(n)&&e==="float")return iH(n);if(eH(n)&&e==="int")return nH(n);throw go.shouldNeverHappen()}function sH(n,e){return n.alpha===e.alpha&&n.mode===e.mode&&n.notation===e.notation&&n.type===e.type}function Un(n,e){const t=n.match(/^(.+)%$/);return Math.min(t?parseFloat(t[1])*.01*e:parseFloat(n),e)}const rH={deg:n=>n,grad:n=>n*360/400,rad:n=>n*360/(2*Math.PI),turn:n=>n*360};function V1(n){const e=n.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(n);const t=parseFloat(e[1]),i=e[2];return rH[i](t)}function k1(n){const e=n.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Un(e[1],255),Un(e[2],255),Un(e[3],255)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function oH(n){const e=k1(n);return e?new de(e,"rgb"):null}function S1(n){const e=n.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Un(e[1],255),Un(e[2],255),Un(e[3],255),Un(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function lH(n){const e=S1(n);return e?new de(e,"rgb"):null}function L1(n){const e=n.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[V1(e[1]),Un(e[2],100),Un(e[3],100)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function aH(n){const e=L1(n);return e?new de(e,"hsl"):null}function A1(n){const e=n.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[V1(e[1]),Un(e[2],100),Un(e[3],100),Un(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function uH(n){const e=A1(n);return e?new de(e,"hsl"):null}function M1(n){const e=n.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];const t=n.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}function hH(n){const e=M1(n);return e?new de(e,"rgb"):null}function T1(n){const e=n.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),se(parseInt(e[4]+e[4],16),0,255,0,1)];const t=n.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),se(parseInt(t[4],16),0,255,0,1)]:null}function cH(n){const e=T1(n);return e?new de(e,"rgb"):null}function D1(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function TP(n){return e=>{const t=D1(e);return t?Aw(t,"rgb",n):null}}function R1(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function DP(n){return e=>{const t=R1(e);return t?Aw(t,"rgb",n):null}}const dH=[{parser:M1,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:T1,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:k1,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:S1,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:L1,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:A1,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:D1,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:R1,result:{alpha:!0,mode:"rgb",notation:"object"}}];function pH(n){return dH.reduce((e,{parser:t,result:i})=>e||(t(n)?i:null),null)}function mH(n,e="int"){const t=pH(n);return t?t.notation==="hex"&&e!=="float"?Object.assign(Object.assign({},t),{type:"int"}):t.notation==="func"?Object.assign(Object.assign({},t),{type:e}):null:null}function Lh(n){const e=[hH,cH,oH,lH,aH,uH];n==="int"&&e.push(TP("int"),DP("int")),n==="float"&&e.push(TP("float"),DP("float"));const t=AU(e);return i=>{const s=t(i);return s?Nt(s,n):null}}function vH(n){const e=Lh("int");if(typeof n!="string")return de.black();const t=e(n);return t??de.black()}function O1(n){const e=ze(Math.floor(n),0,255).toString(16);return e.length===1?`0${e}`:e}function Mw(n,e="#"){const t=Ci(n.getComponents("rgb")).map(O1).join("");return`${e}${t}`}function Tw(n,e="#"){const t=n.getComponents("rgb"),i=[t[0],t[1],t[2],t[3]*255].map(O1).join("");return`${e}${i}`}function j1(n){const e=hn(0),t=Nt(n,"int");return`rgb(${Ci(t.getComponents("rgb")).map(s=>e(s)).join(", ")})`}function Ec(n){const e=hn(2),t=hn(0);return`rgba(${Nt(n,"int").getComponents("rgb").map((r,o)=>(o===3?e:t)(r)).join(", ")})`}function fH(n){const e=[hn(0),nd,nd],t=Nt(n,"int");return`hsl(${Ci(t.getComponents("hsl")).map((s,r)=>e[r](s)).join(", ")})`}function _H(n){const e=[hn(0),nd,nd,hn(2)];return`hsla(${Nt(n,"int").getComponents("hsl").map((s,r)=>e[r](s)).join(", ")})`}function N1(n,e){const t=hn(e==="float"?2:0),i=["r","g","b"],s=Nt(n,e);return`{${Ci(s.getComponents("rgb")).map((o,l)=>`${i[l]}: ${t(o)}`).join(", ")}}`}function wH(n){return e=>N1(e,n)}function B1(n,e){const t=hn(2),i=hn(e==="float"?2:0),s=["r","g","b","a"];return`{${Nt(n,e).getComponents("rgb").map((l,a)=>{const u=a===3?t:i;return`${s[a]}: ${u(l)}`}).join(", ")}}`}function bH(n){return e=>B1(e,n)}const gH=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:Mw},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:Tw},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:j1},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:Ec},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:fH},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:_H},...["int","float"].reduce((n,e)=>[...n,{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:wH(e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:bH(e)}],[])];function I1(n){return gH.reduce((e,t)=>e||(sH(t.format,n)?t.stringifier:null),null)}const eu=X("apl");let CH=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(eu()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(eu("b")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(eu("c")),i.appendChild(s),this.colorElem_=s;const r=e.createElement("div");r.classList.add(eu("m")),this.element.appendChild(r),this.markerElem_=r;const o=e.createElement("div");o.classList.add(eu("p")),this.markerElem_.appendChild(o),this.previewElem_=o,this.update_()}update_(){const e=this.value.rawValue,t=e.getComponents("rgb"),i=new de([t[0],t[1],t[2],0],"rgb"),s=new de([t[0],t[1],t[2],255],"rgb"),r=["to right",Ec(i),Ec(s)];this.colorElem_.style.background=`linear-gradient(${r.join(",")})`,this.previewElem_.style.backgroundColor=Ec(e);const o=se(t[3],0,1,0,100);this.markerElem_.style.left=`${o}%`}onValueChange_(){this.update_()}},PH=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new CH(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ko(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=e.point.x/e.bounds.width,s=this.value.rawValue,[r,o,l]=s.getComponents("hsv");this.value.setRawValue(new de([r,o,l,i],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Jt(Co(!0),Vs(e));if(t===0)return;const i=this.value.rawValue,[s,r,o,l]=i.getComponents("hsv");this.value.setRawValue(new de([s,r,o,l+t],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){Jt(Co(!0),Vs(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const nl=X("coltxt");function yH(n){const e=n.createElement("select"),t=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}];return e.appendChild(t.reduce((i,s)=>{const r=n.createElement("option");return r.textContent=s.text,r.value=s.value,i.appendChild(r),i},n.createDocumentFragment())),e}let EH=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(nl()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(nl("m")),this.modeElem_=yH(e),this.modeElem_.classList.add(nl("ms")),i.appendChild(this.modeSelectElement),t.viewProps.bindDisabled(this.modeElem_);const s=e.createElement("div");s.classList.add(nl("mm")),s.appendChild(Hd(e,"dropdown")),i.appendChild(s),this.element.appendChild(i);const r=e.createElement("div");r.classList.add(nl("w")),this.element.appendChild(r),this.inputsElem_=r,this.inputViews_=t.inputViews,this.applyInputViews_(),fs(t.mode,o=>{this.modeElem_.value=o})}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(e){this.inputViews_=e,this.applyInputViews_()}applyInputViews_(){a1(this.inputsElem_);const e=this.element.ownerDocument;this.inputViews_.forEach(t=>{const i=e.createElement("div");i.classList.add(nl("c")),i.appendChild(t.element),this.inputsElem_.appendChild(i)})}};function xH(n){return hn(n==="float"?2:0)}function $H(n,e,t){const i=Zl(n,e)[t];return new Kd({min:0,max:i})}function VH(n,e,t){return new kh(n,{arrayPosition:t===0?"fst":t===2?"lst":"mid",parser:e.parser,props:be.fromObject({formatter:xH(e.colorType),keyScale:Co(!1),pointerScale:e.colorType==="float"?.01:1}),value:lt(0,{constraint:$H(e.colorMode,e.colorType,t)}),viewProps:e.viewProps})}function kH(n,e){const t={colorMode:e.colorMode,colorType:e.colorType,parser:Tr,viewProps:e.viewProps};return[0,1,2].map(i=>{const s=VH(n,t,i);return Pa({primary:e.value,secondary:s.value,forward(r){return Nt(r,e.colorType).getComponents(e.colorMode)[i]},backward(r,o){const l=e.colorMode,u=Nt(r,e.colorType).getComponents(l);u[i]=o;const h=Aw(Gd(Ci(u),u[3]),l,e.colorType);return Nt(h,"int")}}),s})}function SH(n,e){const t=new kw(n,{parser:Lh("int"),props:be.fromObject({formatter:Mw}),value:lt(de.black()),viewProps:e.viewProps});return Pa({primary:e.value,secondary:t.value,forward:i=>new de(Ci(i.getComponents()),i.mode),backward:(i,s)=>new de(Gd(Ci(s.getComponents(i.mode)),i.getComponents()[3]),i.mode)}),[t]}function LH(n){return n!=="hex"}let AH=class{constructor(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=t.colorType,this.value=t.value,this.viewProps=t.viewProps,this.colorMode=lt(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new EH(e,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const t=this.colorMode.rawValue;return LH(t)?kH(e,{colorMode:t,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):SH(e,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(e){const t=e.currentTarget;this.colorMode.rawValue=t.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map(i=>i.view)}};const Cm=X("hpl");let MH=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Cm()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(Cm("c")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Cm("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=this.value.rawValue,[t]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=j1(new de([t,100,100],"hsv"));const i=se(t,0,360,0,100);this.markerElem_.style.left=`${i}%`}onValueChange_(){this.update_()}},TH=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new MH(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ko(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=se(ze(e.point.x,0,e.bounds.width),0,e.bounds.width,0,360),s=this.value.rawValue,[,r,o,l]=s.getComponents("hsv");this.value.setRawValue(new de([i,r,o,l],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Jt(Co(!1),Vs(e));if(t===0)return;const i=this.value.rawValue,[s,r,o,l]=i.getComponents("hsv");this.value.setRawValue(new de([s+t,r,o,l],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){Jt(Co(!1),Vs(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const Pm=X("svp"),RP=64;let DH=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Pm()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("canvas");i.height=RP,i.width=RP,i.classList.add(Pm("c")),this.element.appendChild(i),this.canvasElement=i;const s=e.createElement("div");s.classList.add(Pm("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=q4(this.canvasElement);if(!e)return;const i=this.value.rawValue.getComponents("hsv"),s=this.canvasElement.width,r=this.canvasElement.height,o=e.getImageData(0,0,s,r),l=o.data;for(let h=0;h<r;h++)for(let c=0;c<s;c++){const p=se(c,0,s,0,100),d=se(h,0,r,100,0),m=P1(i[0],p,d),f=(h*s+c)*4;l[f]=m[0],l[f+1]=m[1],l[f+2]=m[2],l[f+3]=255}e.putImageData(o,0,0);const a=se(i[1],0,100,0,100);this.markerElem_.style.left=`${a}%`;const u=se(i[2],0,100,100,0);this.markerElem_.style.top=`${u}%`}onValueChange_(){this.update_()}},RH=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new DH(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ko(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=se(e.point.x,0,e.bounds.width,0,100),s=se(e.point.y,0,e.bounds.height,100,0),[r,,,o]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new de([r,i,s,o],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){b1(e.key)&&e.preventDefault();const[t,i,s,r]=this.value.rawValue.getComponents("hsv"),o=Co(!1),l=Jt(o,Vs(e)),a=Jt(o,Bu(e));l===0&&a===0||this.value.setRawValue(new de([t,i+l,s+a,r],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){const t=Co(!1),i=Jt(t,Vs(e)),s=Jt(t,Bu(e));i===0&&s===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},OH=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.hPaletteC_=new TH(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new RH(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=t.supportsAlpha?{palette:new PH(e,{value:this.value,viewProps:this.viewProps}),text:new kh(e,{parser:Tr,props:be.fromObject({pointerScale:.01,keyScale:.1,formatter:hn(2)}),value:lt(0,{constraint:new Kd({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Pa({primary:this.value,secondary:this.alphaIcs_.text.value,forward:i=>i.getComponents()[3],backward:(i,s)=>{const r=i.getComponents();return r[3]=s,new de(r,i.mode)}}),this.textsC_=new AH(e,{colorType:t.colorType,value:this.value,viewProps:this.viewProps}),this.view=new ZU(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}};const ym=X("colsw");let jH=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(ym()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(ym("sw")),this.element.appendChild(i),this.swatchElem_=i;const s=e.createElement("button");s.classList.add(ym("b")),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s,this.update_()}update_(){const e=this.value.rawValue;this.swatchElem_.style.backgroundColor=Tw(e)}onValueChange_(){this.update_()}},NH=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new jH(e,{value:this.value,viewProps:this.viewProps})}},Dw=class{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=yw.create(t.expanded),this.swatchC_=new NH(e,{value:this.value,viewProps:this.viewProps});const i=this.swatchC_.view.buttonElement;i.addEventListener("blur",this.onButtonBlur_),i.addEventListener("click",this.onButtonClick_),this.textC_=new kw(e,{parser:t.parser,props:be.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new UU(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=t.pickerLayout==="popup"?new f1(e,{viewProps:this.viewProps}):null;const s=new OH(e,{colorType:t.colorType,supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});s.view.allFocusableElements.forEach(r=>{r.addEventListener("blur",this.onPopupChildBlur_),r.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=s,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(s.view.element),Pa({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:r=>r,backward:(r,o)=>o})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Ew(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=u1(e);i&&t.contains(i)||i&&i===this.swatchC_.view.buttonElement&&!_w(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}};function BH(n){return Ci(n.getComponents("rgb")).reduce((e,t)=>e<<8|Math.floor(t)&255,0)}function IH(n){return n.getComponents("rgb").reduce((e,t,i)=>{const s=Math.floor(i===3?t*255:t)&255;return e<<8|s},0)>>>0}function FH(n){return new de([n>>16&255,n>>8&255,n&255],"rgb")}function KH(n){return new de([n>>24&255,n>>16&255,n>>8&255,se(n&255,0,255,0,1)],"rgb")}function UH(n){return typeof n!="number"?de.black():FH(n)}function HH(n){return typeof n!="number"?de.black():KH(n)}function xc(n,e){return typeof n!="object"||Ae(n)?!1:e in n&&typeof n[e]=="number"}function F1(n){return xc(n,"r")&&xc(n,"g")&&xc(n,"b")}function K1(n){return F1(n)&&xc(n,"a")}function U1(n){return F1(n)}function Rw(n,e){if(n.mode!==e.mode||n.type!==e.type)return!1;const t=n.getComponents(),i=e.getComponents();for(let s=0;s<t.length;s++)if(t[s]!==i[s])return!1;return!0}function OP(n){return"a"in n?[n.r,n.g,n.b,n.a]:[n.r,n.g,n.b]}function zH(n){const e=I1(n);return e?(t,i)=>{Sh(t,e(i))}:null}function qH(n){const e=n?IH:BH;return(t,i)=>{Sh(t,e(i))}}function GH(n,e,t){const s=Nt(e,t).toRgbaObject();n.writeProperty("r",s.r),n.writeProperty("g",s.g),n.writeProperty("b",s.b),n.writeProperty("a",s.a)}function YH(n,e,t){const s=Nt(e,t).toRgbaObject();n.writeProperty("r",s.r),n.writeProperty("g",s.g),n.writeProperty("b",s.b)}function XH(n,e){return(t,i)=>{n?GH(t,i,e):YH(t,i,e)}}function WH(n){var e;return!!(!((e=n?.color)===null||e===void 0)&&e.alpha)}function ZH(n){return n?e=>Tw(e,"0x"):e=>Mw(e,"0x")}function QH(n){return"color"in n||n.view==="color"}kt({id:"input-color-number",type:"input",accept:(n,e)=>{if(typeof n!="number"||!QH(e))return null;const t=Sw(e);return t?{initialValue:n,params:Object.assign(Object.assign({},t),{supportsAlpha:WH(e)})}:null},binding:{reader:n=>n.params.supportsAlpha?HH:UH,equals:Rw,writer:n=>qH(n.params.supportsAlpha)},controller:n=>{var e,t;return new Dw(n.document,{colorType:"int",expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:ZH(n.params.supportsAlpha),parser:Lh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.supportsAlpha,value:n.value,viewProps:n.viewProps})}});function JH(n,e){if(!U1(n))return Nt(de.black(),e);if(e==="int"){const t=OP(n);return new de(t,"rgb")}if(e==="float"){const t=OP(n);return new Lw(t,"rgb")}return Nt(de.black(),"int")}function ez(n){return K1(n)}function tz(n){return e=>{const t=JH(e,n);return Nt(t,"int")}}function nz(n,e){return t=>n?B1(t,e):N1(t,e)}kt({id:"input-color-object",type:"input",accept:(n,e)=>{var t;if(!U1(n))return null;const i=Sw(e);return i?{initialValue:n,params:Object.assign(Object.assign({},i),{colorType:(t=$1(e))!==null&&t!==void 0?t:"int"})}:null},binding:{reader:n=>tz(n.params.colorType),equals:Rw,writer:n=>XH(ez(n.initialValue),n.params.colorType)},controller:n=>{var e,t;const i=K1(n.initialValue);return new Dw(n.document,{colorType:n.params.colorType,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:nz(i,n.params.colorType),parser:Lh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:i,value:n.value,viewProps:n.viewProps})}});kt({id:"input-color-string",type:"input",accept:(n,e)=>{if(typeof n!="string"||e.view==="text")return null;const t=mH(n,$1(e));if(!t)return null;const i=I1(t);if(!i)return null;const s=Sw(e);return s?{initialValue:n,params:Object.assign(Object.assign({},s),{format:t,stringifier:i})}:null},binding:{reader:()=>vH,equals:Rw,writer:n=>{const e=zH(n.params.format);if(!e)throw go.notBindable();return e}},controller:n=>{var e,t;return new Dw(n.document,{colorType:n.params.format.type,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:n.params.stringifier,parser:Lh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.format.alpha,value:n.value,viewProps:n.viewProps})}});let Ow=class{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map((i,s)=>{var r,o;return(o=(r=this.components[s])===null||r===void 0?void 0:r.constrain(i))!==null&&o!==void 0?o:i});return this.asm_.fromComponents(t)}};const jP=X("pndtxt");let iz=class{constructor(e,t){this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add(jP()),this.textViews.forEach(i=>{const s=e.createElement("div");s.classList.add(jP("a")),s.appendChild(i.element),this.element.appendChild(s)})}};function sz(n,e,t){return new kh(n,{arrayPosition:t===0?"fst":t===e.axes.length-1?"lst":"mid",parser:e.parser,props:e.axes[t].textProps,value:lt(0,{constraint:e.axes[t].constraint}),viewProps:e.viewProps})}let jw=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map((i,s)=>sz(e,t,s)),this.acs_.forEach((i,s)=>{Pa({primary:this.value,secondary:i.value,forward:r=>t.assembly.toComponents(r)[s],backward:(r,o)=>{const l=t.assembly.toComponents(r);return l[s]=o,t.assembly.fromComponents(l)}})}),this.view=new iz(e,{textViews:this.acs_.map(i=>i.view)})}get textControllers(){return this.acs_}},rz=class extends fw{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(e){this.controller.valueController.sliderController.props.set("max",e)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(e){this.controller.valueController.sliderController.props.set("min",e)}};function oz(n,e){const t=[],i=n1(n,e);i&&t.push(i);const s=i1(n);s&&t.push(s);const r=Vw(n.options);return r&&t.push(r),new Vh(t)}kt({id:"input-number",type:"input",accept:(n,e)=>{if(typeof n!="number")return null;const t=ft(e,i=>Object.assign(Object.assign({},r1(i)),{options:i.optional.custom(qd),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>Jk,constraint:n=>oz(n.params,n.initialValue),writer:n=>Sh},controller:n=>{const e=n.value,t=n.constraint,i=t&&td(t,zd);if(i)return new Wl(n.document,{props:new be({options:i.values.value("options")}),value:e,viewProps:n.viewProps});const s=s1(n.params,e.rawValue),r=t&&td(t,Kd);return r?new AP(n.document,Object.assign(Object.assign({},NU(Object.assign(Object.assign({},s),{keyScale:lt(s.keyScale),max:r.values.value("max"),min:r.values.value("min")}))),{parser:Tr,value:e,viewProps:n.viewProps})):new kh(n.document,{parser:Tr,props:be.fromObject(s),value:e,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="number"?null:n.controller.valueController instanceof AP?new rz(n.controller):n.controller.valueController instanceof Wl?new $w(n.controller):null}});let Cr=class{constructor(e=0,t=0){this.x=e,this.y=t}getComponents(){return[this.x,this.y]}static isObject(e){if(Ae(e))return!1;const t=e.x,i=e.y;return!(typeof t!="number"||typeof i!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y}toObject(){return{x:this.x,y:this.y}}};const H1={toComponents:n=>n.getComponents(),fromComponents:n=>new Cr(...n)},il=X("p2d");let lz=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(il()),t.viewProps.bindClassModifiers(this.element),fs(t.expanded,Ca(this.element,il(void 0,"expanded")));const i=e.createElement("div");i.classList.add(il("h")),this.element.appendChild(i);const s=e.createElement("button");s.classList.add(il("b")),s.appendChild(Hd(e,"p2dpad")),t.viewProps.bindDisabled(s),i.appendChild(s),this.buttonElement=s;const r=e.createElement("div");if(r.classList.add(il("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(il("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}};const qs=X("p2dp");let az=class{constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=e.createElement("div"),this.element.classList.add(qs()),t.layout==="popup"&&this.element.classList.add(qs(void 0,"p")),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(qs("p")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.padElement=i;const s=e.createElementNS(ci,"svg");s.classList.add(qs("g")),this.padElement.appendChild(s),this.svgElem_=s;const r=e.createElementNS(ci,"line");r.classList.add(qs("ax")),r.setAttributeNS(null,"x1","0"),r.setAttributeNS(null,"y1","50%"),r.setAttributeNS(null,"x2","100%"),r.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(r);const o=e.createElementNS(ci,"line");o.classList.add(qs("ax")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","0"),o.setAttributeNS(null,"x2","50%"),o.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(o);const l=e.createElementNS(ci,"line");l.classList.add(qs("l")),l.setAttributeNS(null,"x1","50%"),l.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(l),this.lineElem_=l;const a=e.createElement("div");a.classList.add(qs("m")),this.padElement.appendChild(a),this.markerElem_=a,t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,t]=this.value.rawValue.getComponents(),i=this.props_.get("max"),s=se(e,-i,+i,0,100),r=se(t,-i,+i,0,100),o=this.props_.get("invertsY")?100-r:r;this.lineElem_.setAttributeNS(null,"x2",`${s}%`),this.lineElem_.setAttributeNS(null,"y2",`${o}%`),this.markerElem_.style.left=`${s}%`,this.markerElem_.style.top=`${o}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}};function NP(n,e,t){return[Jt(e[0],Vs(n)),Jt(e[1],Bu(n))*(t?1:-1)]}let uz=class{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new az(e,{layout:t.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ko(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=this.props.get("max"),s=se(e.point.x,0,e.bounds.width,-i,+i),r=se(this.props.get("invertsY")?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-i,+i);this.value.setRawValue(new Cr(s,r),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onPadKeyDown_(e){b1(e.key)&&e.preventDefault();const[t,i]=NP(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(new Cr(this.value.rawValue.x+t,this.value.rawValue.y+i),{forceEmit:!1,last:!1})}onPadKeyUp_(e){const[t,i]=NP(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},hz=class{constructor(e,t){var i,s;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=yw.create(t.expanded),this.popC_=t.pickerLayout==="popup"?new f1(e,{viewProps:this.viewProps}):null;const r=new uz(e,{layout:t.pickerLayout,props:new be({invertsY:lt(t.invertsY),max:lt(t.max),xKeyScale:t.axes[0].textProps.value("keyScale"),yKeyScale:t.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});r.view.allFocusableElements.forEach(o=>{o.addEventListener("blur",this.onPopupChildBlur_),o.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=r,this.textC_=new jw(e,{assembly:H1,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new lz(e,{expanded:this.foldable_.value("expanded"),pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(i=this.view.buttonElement)===null||i===void 0||i.addEventListener("blur",this.onPadButtonBlur_),(s=this.view.buttonElement)===null||s===void 0||s.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Pa({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:o=>o,backward:(o,l)=>l})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Ew(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=u1(e);i&&t.contains(i)||i&&i===this.view.buttonElement&&!_w(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.view.buttonElement.focus()}};function cz(n){return Cr.isObject(n)?new Cr(n.x,n.y):new Cr}function dz(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y)}function pz(n,e){return new Ow({assembly:H1,components:[ls(Object.assign(Object.assign({},n),n.x),e.x),ls(Object.assign(Object.assign({},n),n.y),e.y)]})}function BP(n,e){var t,i;if(!Ae(n.min)||!Ae(n.max))return Math.max(Math.abs((t=n.min)!==null&&t!==void 0?t:0),Math.abs((i=n.max)!==null&&i!==void 0?i:0));const s=t1(n);return Math.max(Math.abs(s)*10,Math.abs(e)*10)}function mz(n,e){var t,i;const s=BP(bo(n,(t=n.x)!==null&&t!==void 0?t:{}),e.x),r=BP(bo(n,(i=n.y)!==null&&i!==void 0?i:{}),e.y);return Math.max(s,r)}function vz(n){if(!("y"in n))return!1;const e=n.y;return e&&"inverted"in e?!!e.inverted:!1}kt({id:"input-point2d",type:"input",accept:(n,e)=>{if(!Cr.isObject(n))return null;const t=ft(e,i=>Object.assign(Object.assign({},Iu(i)),{expanded:i.optional.boolean,picker:i.optional.custom(C1),readonly:i.optional.constant(!1),x:i.optional.custom(mr),y:i.optional.object(Object.assign(Object.assign({},Iu(i)),{inverted:i.optional.boolean}))}));return t?{initialValue:n,params:t}:null},binding:{reader:()=>cz,constraint:n=>pz(n.params,n.initialValue),equals:Cr.equals,writer:()=>dz},controller:n=>{var e,t;const i=n.document,s=n.value,r=n.constraint,o=[n.params.x,n.params.y];return new hz(i,{axes:s.rawValue.getComponents().map((l,a)=>{var u;return mw({constraint:r.components[a],initialValue:l,params:bo(n.params,(u=o[a])!==null&&u!==void 0?u:{})})}),expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,invertsY:vz(n.params),max:mz(n.params,s.rawValue),parser:Tr,pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",value:s,viewProps:n.viewProps})}});let Ml=class{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if(Ae(e))return!1;const t=e.x,i=e.y,s=e.z;return!(typeof t!="number"||typeof i!="number"||typeof s!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}};const z1={toComponents:n=>n.getComponents(),fromComponents:n=>new Ml(...n)};function fz(n){return Ml.isObject(n)?new Ml(n.x,n.y,n.z):new Ml}function _z(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z)}function wz(n,e){return new Ow({assembly:z1,components:[ls(Object.assign(Object.assign({},n),n.x),e.x),ls(Object.assign(Object.assign({},n),n.y),e.y),ls(Object.assign(Object.assign({},n),n.z),e.z)]})}kt({id:"input-point3d",type:"input",accept:(n,e)=>{if(!Ml.isObject(n))return null;const t=ft(e,i=>Object.assign(Object.assign({},Iu(i)),{readonly:i.optional.constant(!1),x:i.optional.custom(mr),y:i.optional.custom(mr),z:i.optional.custom(mr)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>fz,constraint:n=>wz(n.params,n.initialValue),equals:Ml.equals,writer:n=>_z},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z];return new jw(n.document,{assembly:z1,axes:e.rawValue.getComponents().map((s,r)=>{var o;return mw({constraint:t.components[r],initialValue:s,params:bo(n.params,(o=i[r])!==null&&o!==void 0?o:{})})}),parser:Tr,value:e,viewProps:n.viewProps})}});let Tl=class{constructor(e=0,t=0,i=0,s=0){this.x=e,this.y=t,this.z=i,this.w=s}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if(Ae(e))return!1;const t=e.x,i=e.y,s=e.z,r=e.w;return!(typeof t!="number"||typeof i!="number"||typeof s!="number"||typeof r!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}};const q1={toComponents:n=>n.getComponents(),fromComponents:n=>new Tl(...n)};function bz(n){return Tl.isObject(n)?new Tl(n.x,n.y,n.z,n.w):new Tl}function gz(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z),n.writeProperty("w",e.w)}function Cz(n,e){return new Ow({assembly:q1,components:[ls(Object.assign(Object.assign({},n),n.x),e.x),ls(Object.assign(Object.assign({},n),n.y),e.y),ls(Object.assign(Object.assign({},n),n.z),e.z),ls(Object.assign(Object.assign({},n),n.w),e.w)]})}kt({id:"input-point4d",type:"input",accept:(n,e)=>{if(!Tl.isObject(n))return null;const t=ft(e,i=>Object.assign(Object.assign({},Iu(i)),{readonly:i.optional.constant(!1),w:i.optional.custom(mr),x:i.optional.custom(mr),y:i.optional.custom(mr),z:i.optional.custom(mr)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>bz,constraint:n=>Cz(n.params,n.initialValue),equals:Tl.equals,writer:n=>gz},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z,n.params.w];return new jw(n.document,{assembly:q1,axes:e.rawValue.getComponents().map((s,r)=>{var o;return mw({constraint:t.components[r],initialValue:s,params:bo(n.params,(o=i[r])!==null&&o!==void 0?o:{})})}),parser:Tr,value:e,viewProps:n.viewProps})}});function Pz(n){const e=[],t=Vw(n.options);return t&&e.push(t),new Vh(e)}kt({id:"input-string",type:"input",accept:(n,e)=>{if(typeof n!="string")return null;const t=ft(e,i=>({readonly:i.optional.constant(!1),options:i.optional.custom(qd)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>w1,constraint:n=>Pz(n.params),writer:n=>Sh},controller:n=>{const e=n.document,t=n.value,i=n.constraint,s=i&&td(i,zd);return s?new Wl(e,{props:new be({options:s.values.value("options")}),value:t,viewProps:n.viewProps}):new kw(e,{parser:r=>r,props:be.fromObject({formatter:Fv}),value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="string"?null:n.controller.valueController instanceof Wl?new $w(n.controller):null}});const Yd={monitor:{defaultInterval:200,defaultRows:3}},IP=X("mll");let yz=class{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(IP()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("textarea");i.classList.add(IP("i")),i.style.height=`calc(var(${g1("containerUnitSize")}) * ${t.rows})`,i.readOnly=!0,t.viewProps.bindDisabled(i),this.element.appendChild(i),this.textareaElem_=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.textareaElem_,t=e.scrollTop===e.scrollHeight-e.clientHeight,i=[];this.value.rawValue.forEach(s=>{s!==void 0&&i.push(this.formatter_(s))}),e.textContent=i.join(`
`),t&&(e.scrollTop=e.scrollHeight)}onValueUpdate_(){this.update_()}},Nw=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new yz(e,{formatter:t.formatter,rows:t.rows,value:this.value,viewProps:this.viewProps})}};const FP=X("sgl");let Ez=class{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(FP()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(FP("i")),i.readOnly=!0,i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.value.rawValue,t=e[e.length-1];this.inputElement.value=t!==void 0?this.formatter_(t):""}onValueUpdate_(){this.update_()}},Bw=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new Ez(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}};kt({id:"monitor-bool",type:"monitor",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=ft(e,i=>({readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>_1},controller:n=>{var e;return n.value.rawValue.length===1?new Bw(n.document,{formatter:LP,value:n.value,viewProps:n.viewProps}):new Nw(n.document,{formatter:LP,rows:(e=n.params.rows)!==null&&e!==void 0?e:Yd.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}});let xz=class extends fw{get max(){return this.controller.valueController.props.get("max")}set max(e){this.controller.valueController.props.set("max",e)}get min(){return this.controller.valueController.props.get("min")}set min(e){this.controller.valueController.props.set("min",e)}};const Gs=X("grl");let $z=class{constructor(e,t){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Gs()),t.viewProps.bindClassModifiers(this.element),this.formatter_=t.formatter,this.props_=t.props,this.cursor_=t.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const i=e.createElementNS(ci,"svg");i.classList.add(Gs("g")),i.style.height=`calc(var(${g1("containerUnitSize")}) * ${t.rows})`,this.element.appendChild(i),this.svgElem_=i;const s=e.createElementNS(ci,"polyline");this.svgElem_.appendChild(s),this.lineElem_=s;const r=e.createElement("div");r.classList.add(Gs("t"),X("tt")()),this.element.appendChild(r),this.tooltipElem_=r,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const e=this.svgElem_.getBoundingClientRect(),t=this.value.rawValue.length-1,i=this.props_.get("min"),s=this.props_.get("max"),r=[];this.value.rawValue.forEach((h,c)=>{if(h===void 0)return;const p=se(c,0,t,0,e.width),d=se(h,i,s,e.height,0);r.push([p,d].join(","))}),this.lineElem_.setAttributeNS(null,"points",r.join(" "));const o=this.tooltipElem_,l=this.value.rawValue[this.cursor_.rawValue];if(l===void 0){o.classList.remove(Gs("t","a"));return}const a=se(this.cursor_.rawValue,0,t,0,e.width),u=se(l,i,s,e.height,0);o.style.left=`${a}px`,o.style.top=`${u}px`,o.textContent=`${this.formatter_(l)}`,o.classList.contains(Gs("t","a"))||(o.classList.add(Gs("t","a"),Gs("t","in")),ed(o),o.classList.remove(Gs("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}},G1=class{constructor(e,t){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.cursor_=lt(-1),this.view=new $z(e,{cursor:this.cursor_,formatter:t.formatter,rows:t.rows,props:this.props,value:this.value,viewProps:this.viewProps}),!_w(e))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const i=new Ko(this.view.element);i.emitter.on("down",this.onGraphPointerDown_),i.emitter.on("move",this.onGraphPointerMove_),i.emitter.on("up",this.onGraphPointerUp_)}}importProps(e){return Oi(e,null,t=>({max:t.required.number,min:t.required.number}),t=>(this.props.set("max",t.max),this.props.set("min",t.min),!0))}exportProps(){return ji(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(e){const t=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(se(e.offsetX,0,t.width,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){if(!e.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(se(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}};function Kv(n){return Ae(n.format)?hn(2):n.format}function Vz(n){var e;return n.value.rawValue.length===1?new Bw(n.document,{formatter:Kv(n.params),value:n.value,viewProps:n.viewProps}):new Nw(n.document,{formatter:Kv(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:Yd.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}function kz(n){var e,t,i;return new G1(n.document,{formatter:Kv(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:Yd.monitor.defaultRows,props:be.fromObject({max:(t=n.params.max)!==null&&t!==void 0?t:100,min:(i=n.params.min)!==null&&i!==void 0?i:0}),value:n.value,viewProps:n.viewProps})}function KP(n){return n.view==="graph"}kt({id:"monitor-number",type:"monitor",accept:(n,e)=>{if(typeof n!="number")return null;const t=ft(e,i=>({format:i.optional.function,max:i.optional.number,min:i.optional.number,readonly:i.required.constant(!0),rows:i.optional.number,view:i.optional.string}));return t?{initialValue:n,params:t}:null},binding:{defaultBufferSize:n=>KP(n)?64:1,reader:n=>Jk},controller:n=>KP(n.params)?kz(n):Vz(n),api:n=>n.controller.valueController instanceof G1?new xz(n.controller):null});kt({id:"monitor-string",type:"monitor",accept:(n,e)=>{if(typeof n!="string")return null;const t=ft(e,i=>({multiline:i.optional.boolean,readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>w1},controller:n=>{var e;const t=n.value;return t.rawValue.length>1||n.params.multiline?new Nw(n.document,{formatter:Fv,rows:(e=n.params.rows)!==null&&e!==void 0?e:Yd.monitor.defaultRows,value:t,viewProps:n.viewProps}):new Bw(n.document,{formatter:Fv,value:t,viewProps:n.viewProps})}});function Sz(){const n=`
	<svg width="320" height="50" xmlns="http://www.w3.org/2000/svg">
  <style>
    text {
      font-family: "Menlo", monospace;
      font-size: 12px;
			fill: gray;
    }
  </style>
  <text x="50%" y="55%" text-anchor="middle">
    No Image
  </text>
</svg>`,e=new Blob([n],{type:"image/svg+xml"}),t=new Image;return t.src=URL.createObjectURL(e),t}function UP(n){const e=new Image;return e.crossOrigin="anonymous",e.src=n,e}const Xr=X("img");class Lz{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Xr()),t.viewProps.bindClassModifiers(this.element),this.input=e.createElement("input"),this.input.classList.add(Xr("input")),this.input.setAttribute("type","file"),this.input.setAttribute("accept",t.extensions.join(",")),this.image_=e.createElement("img"),this.image_.id="tpimg_"+Math.random().toString(36).slice(2),this.image_.classList.add(Xr("image")),this.image_.classList.add(Xr(`image_${t.imageFit}`)),this.image_.crossOrigin="anonymous",this.image_.onclick=i=>{t.clickCallback?t.clickCallback(i,this.input):this.input.click()},this.element.classList.add(Xr("area_root")),this.element.appendChild(this.image_),this.element.appendChild(this.input)}changeImage(e){this.image_.src=e}changeDraggingState(e){const t=this.element;e?t?.classList.add(Xr("area_dragging")):t?.classList.remove(Xr("area_dragging"))}}let Em=null;class Az{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new Lz(e,{viewProps:this.viewProps,extensions:t.extensions,imageFit:t.imageFit,clickCallback:t.clickCallback}),this.onFile=this.onFile.bind(this),this.onDrop=this.onDrop.bind(this),this.onDragStart=this.onDragStart.bind(this),this.onDragOver=this.onDragOver.bind(this),this.onDragLeave=this.onDragLeave.bind(this),this.view.input.addEventListener("change",this.onFile),this.view.element.addEventListener("drop",this.onDrop),this.view.element.addEventListener("dragstart",this.onDragStart),this.view.element.addEventListener("dragover",this.onDragOver),this.view.element.addEventListener("dragleave",this.onDragLeave),this.viewProps.handleDispose(()=>{this.view.input.removeEventListener("change",this.onFile),this.view.element.removeEventListener("drop",this.onDrop),this.view.element.removeEventListener("dragstart",this.onDragStart),this.view.element.removeEventListener("dragover",this.onDragOver),this.view.element.removeEventListener("dragleave",this.onDragLeave)}),this.value.emitter.on("change",()=>this.handleValueChange()),this.handleValueChange()}onFile(e){const t=(e?.target).files;if(!t||!t.length)return;const i=t[0];this.setValue(i)}onDrop(e){e.preventDefault();try{const{dataTransfer:t}=e,i=t?.files[0];if(i)this.setValue(i);else{const s=t?.getData("img-id");if(s){const r=document.getElementById(s);this.setValue(r)}else{const r=t?.getData("url");if(!r)throw new Error("No url");this.setValue(r)}}}catch(t){console.error("Could not parse the dropped image",t)}finally{this.view.changeDraggingState(!1)}}onDragStart(e){var t,i;(t=e.dataTransfer)===null||t===void 0||t.setData("img-id",this.view.image_.id),(i=e.dataTransfer)===null||i===void 0||i.setDragImage(this.view.image_,0,0)}onDragOver(e){e.preventDefault(),this.view.changeDraggingState(!0)}onDragLeave(){this.view.changeDraggingState(!1)}handleImage(e){e instanceof HTMLImageElement?this.updateImage(e.src):typeof e=="string"||!e?((e==="placeholder"||!e)&&(e=this.handlePlaceholderImage().src),this.updateImage(e)):this.setValue(e)}updateImage(e){this.view.changeImage(e)}setValue(e){if(e instanceof HTMLImageElement)this.value.setRawValue(e);else if(e instanceof File){const t=URL.createObjectURL(e)+"#"+e.name;e.src=t;const i=UP(t);this.value.setRawValue(i||e)}else e?this.value.setRawValue(UP(e)):this.value.setRawValue(this.handlePlaceholderImage())}handleValueChange(){this.handleImage(this.value.rawValue)}handlePlaceholderImage(){return Em||(Em=Sz()),Em}}const Mz=[".jpg",".png",".gif"];kt({id:"input-image",type:"input",accept(n,e){if(!(n instanceof HTMLImageElement||typeof n=="string"))return null;const t=ft(e,i=>({view:i.required.constant("input-image"),acceptUrl:i.optional.boolean,clickCallback:i.optional.function,imageFit:i.optional.custom(s=>s==="contain"||s==="cover"?s:void 0),extensions:i.optional.array(i.required.string)}));return t?{initialValue:n,params:t}:null},binding:{reader(n){return e=>e.src!==void 0?e.src===""?"placeholder":e.src:e},writer(n){return(e,t)=>{e.write(t)}}},controller(n){var e,t;return new Az(n.document,{value:n.value,imageFit:(e=n.params.imageFit)!==null&&e!==void 0?e:"cover",clickCallback:n.params.clickCallback,viewProps:n.viewProps,extensions:(t=n.params.extensions)!==null&&t!==void 0?t:Mz})}});function Tz(n){let e,t,i;const s=[{options:n[1]},n[2]];function r(l){n[11](l)}let o={};for(let l=0;l<s.length;l+=1)o=B(o,s[l]);return n[0]!==void 0&&(o.value=n[0]),e=new Gk({props:o}),y.push(()=>k(e,"value",r)),{c(){A(e.$$.fragment)},l(l){M(e.$$.fragment,l)},m(l,a){T(e,l,a),i=!0},p(l,[a]){const u=a&6?zt(s,[a&2&&{options:l[1]},a&4&&qt(l[2])]):{};!t&&a&1&&(t=!0,u.value=l[0],V(()=>t=!1)),e.$set(u)},i(l){i||(_(e.$$.fragment,l),i=!0)},o(l){b(e.$$.fragment,l),i=!1},d(l){D(e,l)}}}function Dz(n,e,t){const i=["value","options","min","max","step","pointerScale","keyScale","format"];let s=je(e,i),{value:r}=e,{options:o=void 0}=e,{min:l=void 0}=e,{max:a=void 0}=e,{step:u=void 0}=e,{pointerScale:h=void 0}=e,{keyScale:c=void 0}=e,{format:p=void 0}=e,d=p,m;function f(v){r=v,t(0,r)}return n.$$set=v=>{e=B(B({},e),Cn(v)),t(2,s=je(e,i)),"value"in v&&t(0,r=v.value),"options"in v&&t(3,o=v.options),"min"in v&&t(4,l=v.min),"max"in v&&t(5,a=v.max),"step"in v&&t(6,u=v.step),"pointerScale"in v&&t(7,h=v.pointerScale),"keyScale"in v&&t(8,c=v.keyScale),"format"in v&&t(9,p=v.format)},n.$$.update=()=>{n.$$.dirty&1536&&d!==p&&t(10,d=p),n.$$.dirty&1528&&t(1,m={min:l,max:a,format:d,keyScale:c,pointerScale:h,step:u,...o})},[r,m,s,o,l,a,u,h,c,p,d,f]}class Rz extends Je{constructor(e){super(),et(this,e,Dz,Tz,Qe,{value:0,options:3,min:4,max:5,step:6,pointerScale:7,keyScale:8,format:9})}}function Me(n){return n==null}function Iw(n){return n!==null&&typeof n=="object"}function Uv(n){return n!==null&&typeof n=="object"}function Oz(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function Po(n,e){return Array.from(new Set([...Object.keys(n),...Object.keys(e)])).reduce((i,s)=>{const r=n[s],o=e[s];return Uv(r)&&Uv(o)?Object.assign(Object.assign({},i),{[s]:Po(r,o)}):Object.assign(Object.assign({},i),{[s]:s in e?o:r})},{})}function jz(n){return Iw(n)?"target"in n:!1}const Nz={alreadydisposed:()=>"View has been already disposed",invalidparams:n=>`Invalid parameters for '${n.name}'`,nomatchingcontroller:n=>`No matching controller for '${n.key}'`,nomatchingview:n=>`No matching view for '${JSON.stringify(n.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:n=>`Not compatible with  plugin '${n.id}'`,propertynotfound:n=>`Property '${n.name}' not found`,shouldneverhappen:()=>"This error should never happen"};let yo=class yl{static alreadyDisposed(){return new yl({type:"alreadydisposed"})}static notBindable(){return new yl({type:"notbindable"})}static notCompatible(e,t){return new yl({type:"notcompatible",context:{id:`${e}.${t}`}})}static propertyNotFound(e){return new yl({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new yl({type:"shouldneverhappen"})}constructor(e){var t;this.message=(t=Nz[e.type](e.context))!==null&&t!==void 0?t:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}toString(){return this.message}},HP=class Y1{constructor(e,t){this.obj_=e,this.key=t}static isBindable(e){return!(e===null||typeof e!="object"&&typeof e!="function")}read(){return this.obj_[this.key]}write(e){this.obj_[this.key]=e}writeProperty(e,t){const i=this.read();if(!Y1.isBindable(i))throw yo.notBindable();if(!(e in i))throw yo.propertyNotFound(e);i[e]=t}},$n=class{constructor(){this.observers_={}}on(e,t){let i=this.observers_[e];return i||(i=this.observers_[e]=[]),i.push({handler:t}),this}off(e,t){const i=this.observers_[e];return i&&(this.observers_[e]=i.filter(s=>s.handler!==t)),this}emit(e,t){const i=this.observers_[e];i&&i.forEach(s=>{s.handler(t)})}},Bz=class{constructor(e,t){var i;this.constraint_=t?.constraint,this.equals_=(i=t?.equals)!==null&&i!==void 0?i:(s,r)=>s===r,this.emitter=new $n,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},s=this.constraint_?this.constraint_.constrain(e):e,r=this.rawValue_;this.equals_(r,s)&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=s,this.emitter.emit("change",{options:i,previousRawValue:r,rawValue:s,sender:this}))}},Iz=class{constructor(e){this.emitter=new $n,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},s=this.value_;s===e&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:i,previousRawValue:s,rawValue:this.value_,sender:this}))}},Fz=class{constructor(e){this.emitter=new $n,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}};function We(n,e){const t=e?.constraint,i=e?.equals;return!t&&!i?new Iz(n):new Bz(n,e)}function Kz(n){return[new Fz(n),(e,t)=>{n.setRawValue(e,t)}]}let J=class X1{constructor(e){this.emitter=new $n,this.valMap_=e;for(const t in this.valMap_)this.valMap_[t].emitter.on("change",()=>{this.emitter.emit("change",{key:t,sender:this})})}static createCore(e){return Object.keys(e).reduce((i,s)=>Object.assign(i,{[s]:We(e[s])}),{})}static fromObject(e){const t=this.createCore(e);return new X1(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}},Xd=class{constructor(e){this.values=J.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");return Math.min(Math.max(e,i),t)}},Uz=class{constructor(e){this.values=J.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");let s=e;return Me(i)||(s=Math.max(s,i)),Me(t)||(s=Math.min(s,t)),s}},Hz=class{constructor(e,t=0){this.step=e,this.origin=t}constrain(e){const t=this.origin%this.step,i=Math.round((e-t)/this.step);return t+i*this.step}},zz=class{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}};const qz={"**":(n,e)=>Math.pow(n,e),"*":(n,e)=>n*e,"/":(n,e)=>n/e,"%":(n,e)=>n%e,"+":(n,e)=>n+e,"-":(n,e)=>n-e,"<<":(n,e)=>n<<e,">>":(n,e)=>n>>e,">>>":(n,e)=>n>>>e,"&":(n,e)=>n&e,"^":(n,e)=>n^e,"|":(n,e)=>n|e};let Gz=class{constructor(e,t,i){this.left=t,this.operator=e,this.right=i}evaluate(){const e=qz[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}};const Yz={"+":n=>n,"-":n=>-n,"~":n=>~n};let Xz=class{constructor(e,t){this.operator=e,this.expression=t}evaluate(){const e=Yz[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}};function Fw(n){return(e,t)=>{for(let i=0;i<n.length;i++){const s=n[i](e,t);if(s!=="")return s}return""}}function Fu(n,e){var t;const i=n.substr(e).match(/^\s+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function Wz(n,e){const t=n.substr(e,1);return t.match(/^[1-9]$/)?t:""}function Ku(n,e){var t;const i=n.substr(e).match(/^[0-9]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function Zz(n,e){const t=Ku(n,e);if(t!=="")return t;const i=n.substr(e,1);if(e+=1,i!=="-"&&i!=="+")return"";const s=Ku(n,e);return s===""?"":i+s}function Kw(n,e){const t=n.substr(e,1);if(e+=1,t.toLowerCase()!=="e")return"";const i=Zz(n,e);return i===""?"":t+i}function W1(n,e){const t=n.substr(e,1);if(t==="0")return t;const i=Wz(n,e);return e+=i.length,i===""?"":i+Ku(n,e)}function Qz(n,e){const t=W1(n,e);if(e+=t.length,t==="")return"";const i=n.substr(e,1);if(e+=i.length,i!==".")return"";const s=Ku(n,e);return e+=s.length,t+i+s+Kw(n,e)}function Jz(n,e){const t=n.substr(e,1);if(e+=t.length,t!==".")return"";const i=Ku(n,e);return e+=i.length,i===""?"":t+i+Kw(n,e)}function e8(n,e){const t=W1(n,e);return e+=t.length,t===""?"":t+Kw(n,e)}const t8=Fw([Qz,Jz,e8]);function n8(n,e){var t;const i=n.substr(e).match(/^[01]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function i8(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0b")return"";const i=n8(n,e);return i===""?"":t+i}function s8(n,e){var t;const i=n.substr(e).match(/^[0-7]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function r8(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0o")return"";const i=s8(n,e);return i===""?"":t+i}function o8(n,e){var t;const i=n.substr(e).match(/^[0-9a-f]+/i);return(t=i&&i[0])!==null&&t!==void 0?t:""}function l8(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0x")return"";const i=o8(n,e);return i===""?"":t+i}const a8=Fw([i8,r8,l8]),u8=Fw([a8,t8]);function h8(n,e){const t=u8(n,e);return e+=t.length,t===""?null:{evaluable:new zz(t),cursor:e}}function c8(n,e){const t=n.substr(e,1);if(e+=t.length,t!=="(")return null;const i=Q1(n,e);if(!i)return null;e=i.cursor,e+=Fu(n,e).length;const s=n.substr(e,1);return e+=s.length,s!==")"?null:{evaluable:i.evaluable,cursor:e}}function d8(n,e){var t;return(t=h8(n,e))!==null&&t!==void 0?t:c8(n,e)}function Z1(n,e){const t=d8(n,e);if(t)return t;const i=n.substr(e,1);if(e+=i.length,i!=="+"&&i!=="-"&&i!=="~")return null;const s=Z1(n,e);return s?(e=s.cursor,{cursor:e,evaluable:new Xz(i,s.evaluable)}):null}function p8(n,e,t){t+=Fu(e,t).length;const i=n.filter(s=>e.startsWith(s,t))[0];return i?(t+=i.length,t+=Fu(e,t).length,{cursor:t,operator:i}):null}function m8(n,e){return(t,i)=>{const s=n(t,i);if(!s)return null;i=s.cursor;let r=s.evaluable;for(;;){const o=p8(e,t,i);if(!o)break;i=o.cursor;const l=n(t,i);if(!l)return null;i=l.cursor,r=new Gz(o.operator,r,l.evaluable)}return r?{cursor:i,evaluable:r}:null}}const v8=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((n,e)=>m8(n,e),Z1);function Q1(n,e){return e+=Fu(n,e).length,v8(n,e)}function f8(n){const e=Q1(n,0);return!e||e.cursor+Fu(n,e.cursor).length!==n.length?null:e.evaluable}function Pi(n){var e;const t=f8(n);return(e=t?.evaluate())!==null&&e!==void 0?e:null}function Wd(n){if(typeof n=="number")return n;if(typeof n=="string"){const e=Pi(n);if(!Me(e))return e}return 0}function xt(n){return e=>e.toFixed(Math.max(Math.min(n,20),0))}function re(n,e,t,i,s){const r=(n-e)/(t-e);return i+r*(s-i)}function Hv(n){return String(n.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Fe(n,e,t){return Math.min(Math.max(n,e),t)}function J1(n,e){return(n%e+e)%e}function _8(n,e){return Me(n.step)?Math.max(Hv(e),2):Hv(n.step)}function eS(n){var e;return(e=n.step)!==null&&e!==void 0?e:1}function w8(n,e){var t;const i=Math.abs((t=n.step)!==null&&t!==void 0?t:e);return i===0?.1:Math.pow(10,Math.floor(Math.log10(i))-1)}function Uw(n,e){return Me(n.step)?null:new Hz(n.step,e)}function Hw(n){return!Me(n.max)&&!Me(n.min)?new Xd({max:n.max,min:n.min}):!Me(n.max)||!Me(n.min)?new Uz({max:n.max,min:n.min}):null}function Zd(n,e){var t,i,s;return{formatter:(t=n.format)!==null&&t!==void 0?t:xt(_8(n,e)),keyScale:(i=n.keyScale)!==null&&i!==void 0?i:eS(n),pointerScale:(s=n.pointerScale)!==null&&s!==void 0?s:w8(n,e)}}function Qd(n){return{format:n.optional.function,keyScale:n.optional.number,max:n.optional.number,min:n.optional.number,pointerScale:n.optional.number,step:n.optional.number}}function zw(n){return{constraint:n.constraint,textProps:J.fromObject(Zd(n.params,n.initialValue))}}let qw=class{constructor(e){this.controller=e}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(e){this.controller.viewProps.set("disabled",e)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(e){this.controller.viewProps.set("hidden",e)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(e){return this.controller.importState(e)}exportState(){return this.controller.exportState()}},Jd=class{constructor(e){this.target=e}},tS=class extends Jd{constructor(e,t,i){super(e),this.value=t,this.last=i??!0}},b8=class extends Jd{constructor(e,t){super(e),this.expanded=t}},g8=class extends Jd{constructor(e,t){super(e),this.index=t}},Gw=class extends qw{constructor(e){super(e),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new $n,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(e){this.controller.tag=e}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}refresh(){this.controller.value.fetch()}onValueChange_(e){const t=this.controller.value;this.emitter_.emit("change",new tS(this,t.binding.target.read(),e.options.last))}};function C8(n,e){const i=Object.keys(e).reduce((s,r)=>{if(s===void 0)return;const o=e[r],l=o(n[r]);return l.succeeded?Object.assign(Object.assign({},s),{[r]:l.value}):void 0},{});return i}function P8(n,e){return n.reduce((t,i)=>{if(t===void 0)return;const s=e(i);if(!(!s.succeeded||s.value===void 0))return[...t,s.value]},[])}function y8(n){return n===null?!1:typeof n=="object"}function Ji(n){return e=>t=>{if(!e&&t===void 0)return{succeeded:!1,value:void 0};if(e&&t===void 0)return{succeeded:!0,value:void 0};const i=n(t);return i!==void 0?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}function zP(n){return{custom:e=>Ji(e)(n),boolean:Ji(e=>typeof e=="boolean"?e:void 0)(n),number:Ji(e=>typeof e=="number"?e:void 0)(n),string:Ji(e=>typeof e=="string"?e:void 0)(n),function:Ji(e=>typeof e=="function"?e:void 0)(n),constant:e=>Ji(t=>t===e?e:void 0)(n),raw:Ji(e=>e)(n),object:e=>Ji(t=>{if(y8(t))return C8(t,e)})(n),array:e=>Ji(t=>{if(Array.isArray(t))return P8(t,e)})(n)}}const zv={optional:zP(!0),required:zP(!1)};function ct(n,e){const t=e(zv),i=zv.required.object(t)(n);return i.succeeded?i.value:void 0}function Ni(n,e,t,i){if(e&&!e(n))return!1;const s=ct(n,t);return s?i(s):!1}function Bi(n,e){var t;return Po((t=n?.())!==null&&t!==void 0?t:{},e)}function $c(n){return"value"in n}function E8(n){if(!Iw(n)||!("binding"in n))return!1;const e=n.binding;return jz(e)}const gn="http://www.w3.org/2000/svg";function id(n){n.offsetHeight}function x8(n,e){const t=n.style.transition;n.style.transition="none",e(),n.style.transition=t}function Yw(n){return n.ontouchstart!==void 0}function $8(n){const e=n.ownerDocument.defaultView;return e&&"document"in e?n.getContext("2d",{willReadFrequently:!0}):null}const V8={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function ep(n,e){const t=n.createElementNS(gn,"svg");return t.innerHTML=V8[e],t}function nS(n,e,t){n.insertBefore(e,n.children[t])}function Uu(n){n.parentElement&&n.parentElement.removeChild(n)}function iS(n){for(;n.children.length>0;)n.removeChild(n.children[0])}function k8(n){for(;n.childNodes.length>0;)n.removeChild(n.childNodes[0])}function sS(n){return n.relatedTarget?n.relatedTarget:"explicitOriginalTarget"in n?n.explicitOriginalTarget:null}function _s(n,e){n.emitter.on("change",t=>{e(t.rawValue)}),e(n.rawValue)}function yi(n,e,t){_s(n.value(e),t)}const S8="tp";function F(n){return(t,i)=>[S8,"-",n,"v",t?`_${t}`:"",i?`-${i}`:""].join("")}const tu=F("lbl");function L8(n,e){const t=n.createDocumentFragment();return e.split(`
`).map(s=>n.createTextNode(s)).forEach((s,r)=>{r>0&&t.appendChild(n.createElement("br")),t.appendChild(s)}),t}let A8=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(tu()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(tu("l")),yi(t.props,"label",r=>{Me(r)?this.element.classList.add(tu(void 0,"nol")):(this.element.classList.remove(tu(void 0,"nol")),k8(i),i.appendChild(L8(e,r)))}),this.element.appendChild(i),this.labelElement=i;const s=e.createElement("div");s.classList.add(tu("v")),this.element.appendChild(s),this.valueElement=s}},M8=class{constructor(e,t){this.props=t.props,this.valueController=t.valueController,this.viewProps=t.valueController.viewProps,this.view=new A8(e,{props:t.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(e){return Ni(e,null,t=>({label:t.optional.string}),t=>(this.props.set("label",t.label),!0))}exportProps(){return Bi(null,{label:this.props.get("label")})}};function T8(){return["veryfirst","first","last","verylast"]}const qP=F(""),GP={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};let rS=class{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",()=>{T8().forEach(i=>{t.classList.remove(qP(void 0,GP[i]))}),this.blade.get("positions").forEach(i=>{t.classList.add(qP(void 0,GP[i]))})}),this.viewProps.handleDispose(()=>{Uu(t)})}get parent(){return this.parent_}set parent(e){this.parent_=e,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(e){return Ni(e,null,t=>({disabled:t.required.boolean,hidden:t.required.boolean}),t=>(this.viewProps.importState(t),!0))}exportState(){return Bi(null,Object.assign({},this.viewProps.exportState()))}},D8=class extends qw{get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get title(){var e;return(e=this.controller.buttonController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.buttonController.props.set("title",e)}on(e,t){const i=t.bind(this);return this.controller.buttonController.emitter.on(e,()=>{i(new Jd(this))}),this}};function R8(n,e,t){t?n.classList.add(e):n.classList.remove(e)}function ya(n,e){return t=>{R8(n,e,t)}}function Xw(n,e){_s(n,t=>{e.textContent=t??""})}const xm=F("btn");let O8=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(xm()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("button");i.classList.add(xm("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(xm("t")),Xw(t.props.value("title"),s),this.buttonElement.appendChild(s)}},j8=class{constructor(e,t){this.emitter=new $n,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new O8(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(e){return Ni(e,null,t=>({title:t.optional.string}),t=>(this.props.set("title",t.title),!0))}exportProps(){return Bi(null,{title:this.props.get("title")})}onClick_(){this.emitter.emit("click",{sender:this})}},YP=class extends rS{constructor(e,t){const i=new j8(e,{props:t.buttonProps,viewProps:t.viewProps}),s=new M8(e,{blade:t.blade,props:t.labelProps,valueController:i});super({blade:t.blade,view:s.view,viewProps:t.viewProps}),this.buttonController=i,this.labelController=s}importState(e){return Ni(e,t=>super.importState(t)&&this.buttonController.importProps(t)&&this.labelController.importProps(t),()=>({}),()=>!0)}exportState(){return Bi(()=>super.exportState(),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}},N8=class{constructor(e){const[t,i]=e.split("-"),s=t.split(".");this.major=parseInt(s[0],10),this.minor=parseInt(s[1],10),this.patch=parseInt(s[2],10),this.prerelease=i??null}toString(){const e=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[e,this.prerelease].join("-"):e}};const B8=new N8("2.0.0-beta.2");function _t(n){return Object.assign({core:B8},n)}_t({id:"button",type:"blade",accept(n){const e=ct(n,t=>({title:t.required.string,view:t.required.constant("button"),label:t.optional.string}));return e?{params:e}:null},controller(n){return new YP(n.document,{blade:n.blade,buttonProps:J.fromObject({title:n.params.title}),labelProps:J.fromObject({label:n.params.label}),viewProps:n.viewProps})},api(n){return n.controller instanceof YP?new D8(n.controller):null}});function I8(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}function F8(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}function K8(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}function U8(n){return Iw(n)?"refresh"in n&&typeof n.refresh=="function":!1}function H8(n,e){if(!HP.isBindable(n))throw yo.notBindable();return new HP(n,e)}let z8=class{constructor(e,t){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=e,this.emitter_=new $n,this.pool_=t,this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map(e=>this.pool_.createApi(e))}addBinding(e,t,i){const s=i??{},r=this.controller_.element.ownerDocument,o=this.pool_.createBinding(r,H8(e,t),s),l=this.pool_.createBindingApi(o);return this.add(l,s.index)}addFolder(e){return F8(this,e)}addButton(e){return I8(this,e)}addTab(e){return K8(this,e)}add(e,t){const i=e.controller;return this.controller_.rack.add(i,t),e}remove(e){this.controller_.rack.remove(e.controller)}addBlade(e){const t=this.controller_.element.ownerDocument,i=this.pool_.createBlade(t,e),s=this.pool_.createApi(i);return this.add(s,e.index)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}refresh(){this.children.forEach(e=>{U8(e)&&e.refresh()})}onRackValueChange_(e){const t=e.bladeController,i=this.pool_.createApi(t),s=E8(t.value)?t.value.binding:null;this.emitter_.emit("change",new tS(i,s?s.target.read():t.value.rawValue,e.options.last))}},Ww=class extends qw{constructor(e,t){super(e),this.rackApi_=new z8(e.rackController,t)}},Zw=class extends rS{constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps}),this.rackController=e.rackController}importState(e){return Ni(e,t=>super.importState(t),t=>({children:t.required.array(t.required.raw)}),t=>this.rackController.rack.children.every((i,s)=>i.importState(t.children[s])))}exportState(){return Bi(()=>super.exportState(),{children:this.rackController.rack.children.map(e=>e.exportState())})}};function qv(n){return"rackController"in n}let q8=class{constructor(e){this.emitter=new $n,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const t of this.allItems())if(e(t))return t;return null}includes(e){return this.cache_.has(e)}add(e,t){if(this.includes(e))throw yo.shouldNeverHappen();const i=t!==void 0?t:this.items_.length;this.items_.splice(i,0,e),this.cache_.add(e);const s=this.extract_(e);s&&(s.emitter.on("add",this.onSubListAdd_),s.emitter.on("remove",this.onSubListRemove_),s.allItems().forEach(r=>{this.cache_.add(r)})),this.emitter.emit("add",{index:i,item:e,root:this,target:this})}remove(e){const t=this.items_.indexOf(e);if(t<0)return;this.items_.splice(t,1),this.cache_.delete(e);const i=this.extract_(e);i&&(i.allItems().forEach(s=>{this.cache_.delete(s)}),i.emitter.off("add",this.onSubListAdd_),i.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}};function G8(n,e){for(let t=0;t<n.length;t++){const i=n[t];if($c(i)&&i.value===e)return i}return null}function Y8(n){return qv(n)?n.rackController.rack.bcSet_:null}let X8=class{constructor(e){var t,i;this.emitter=new $n,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=(t=e.blade)!==null&&t!==void 0?t:null,(i=this.blade_)===null||i===void 0||i.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=e.viewProps,this.bcSet_=new q8(Y8),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,t){var i;(i=e.parent)===null||i===void 0||i.remove(e),e.parent=this,this.bcSet_.add(e,t)}remove(e){e.parent=null,this.bcSet_.remove(e)}find(e){return this.bcSet_.allItems().filter(e)}onSetAdd_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,root:t,sender:this}),!t)return;const i=e.item;if(i.viewProps.emitter.on("change",this.onChildViewPropsChange_),i.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),i.viewProps.handleDispose(this.onChildDispose_),$c(i))i.value.emitter.on("change",this.onChildValueChange_);else if(qv(i)){const s=i.rackController.rack;if(s){const r=s.emitter;r.on("layout",this.onRackLayout_),r.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,root:t,sender:this}),!t)return;const i=e.item;if($c(i))i.value.emitter.off("change",this.onChildValueChange_);else if(qv(i)){const s=i.rackController.rack;if(s){const r=s.emitter;r.off("layout",this.onRackLayout_),r.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){const e=this.bcSet_.items.filter(s=>!s.viewProps.get("hidden")),t=e[0],i=e[e.length-1];this.bcSet_.items.forEach(s=>{const r=[];s===t&&(r.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&r.push("veryfirst")),s===i&&(r.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&r.push("verylast")),s.blade.set("positions",r)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(t=>t.viewProps.get("disposed")).forEach(t=>{this.bcSet_.remove(t)})}onChildValueChange_(e){const t=G8(this.find($c),e.sender);if(!t)throw yo.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:t,options:e.options,sender:this})}onRackLayout_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(e){this.emitter.emit("valuechange",{bladeController:e.bladeController,options:e.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}},Qw=class{constructor(e){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=e.element,this.viewProps=e.viewProps;const t=new X8({blade:e.root?void 0:e.blade,viewProps:e.viewProps});t.emitter.on("add",this.onRackAdd_),t.emitter.on("remove",this.onRackRemove_),this.rack=t,this.viewProps.handleDispose(()=>{for(let i=this.rack.children.length-1;i>=0;i--)this.rack.children[i].viewProps.set("disposed",!0)})}onRackAdd_(e){e.root&&nS(this.element,e.bladeController.view.element,e.index)}onRackRemove_(e){e.root&&Uu(e.bladeController.view.element)}};function oS(){return new J({positions:We([],{equals:Oz})})}let Jw=class lS extends J{constructor(e){super(e)}static create(e){const t={completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},i=J.createCore(t);return new lS(i)}get styleExpanded(){var e;return(e=this.get("temporaryExpanded"))!==null&&e!==void 0?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!Me(e)?`${e}px`:"auto"}bindExpandedClass(e,t){const i=()=>{this.styleExpanded?e.classList.add(t):e.classList.remove(t)};yi(this,"expanded",i),yi(this,"temporaryExpanded",i)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}};function W8(n,e){let t=0;return x8(e,()=>{n.set("expandedHeight",null),n.set("temporaryExpanded",!0),id(e),t=e.clientHeight,n.set("temporaryExpanded",null),id(e)}),t}function XP(n,e){e.style.height=n.styleHeight}function eb(n,e){n.value("expanded").emitter.on("beforechange",()=>{if(n.set("completed",!1),Me(n.get("expandedHeight"))){const t=W8(n,e);t>0&&n.set("expandedHeight",t)}n.set("shouldFixHeight",!0),id(e)}),n.emitter.on("change",()=>{XP(n,e)}),XP(n,e),e.addEventListener("transitionend",t=>{t.propertyName==="height"&&n.cleanUpTransition()})}let Z8=class extends Ww{constructor(e,t){super(e,t),this.emitter_=new $n,this.controller.foldable.value("expanded").emitter.on("change",i=>{this.emitter_.emit("fold",new b8(this,i.sender.rawValue))}),this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)})}get expanded(){return this.controller.foldable.get("expanded")}set expanded(e){this.controller.foldable.set("expanded",e)}get title(){return this.controller.props.get("title")}set title(e){this.controller.props.set("title",e)}get children(){return this.rackApi_.children}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){return this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}refresh(){this.rackApi_.refresh()}};const aS=F("cnt");let Q8=class{constructor(e,t){var i;this.className_=F((i=t.viewName)!==null&&i!==void 0?i:"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),aS()),t.viewProps.bindClassModifiers(this.element),this.foldable_=t.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),yi(this.foldable_,"completed",ya(this.element,this.className_(void 0,"cpl")));const s=e.createElement("button");s.classList.add(this.className_("b")),yi(t.props,"title",u=>{Me(u)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s;const r=e.createElement("div");r.classList.add(this.className_("i")),this.element.appendChild(r);const o=e.createElement("div");o.classList.add(this.className_("t")),Xw(t.props.value("title"),o),this.buttonElement.appendChild(o),this.titleElement=o;const l=e.createElement("div");l.classList.add(this.className_("m")),this.buttonElement.appendChild(l);const a=e.createElement("div");a.classList.add(this.className_("c")),this.element.appendChild(a),this.containerElement=a}},WP=class extends Zw{constructor(e,t){var i;const s=Jw.create((i=t.expanded)!==null&&i!==void 0?i:!0),r=new Q8(e,{foldable:s,props:t.props,viewName:t.root?"rot":void 0,viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new Qw({blade:t.blade,element:r.containerElement,root:t.root,viewProps:t.viewProps}),view:r})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=t.props,this.foldable=s,eb(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(e){return Ni(e,t=>super.importState(t),t=>({expanded:t.required.boolean,title:t.optional.string}),t=>(this.foldable.set("expanded",t.expanded),this.props.set("title",t.title),!0))}exportState(){return Bi(()=>super.exportState(),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}};_t({id:"folder",type:"blade",accept(n){const e=ct(n,t=>({title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean}));return e?{params:e}:null},controller(n){return new WP(n.document,{blade:n.blade,expanded:n.params.expanded,props:J.fromObject({title:n.params.title}),viewProps:n.viewProps})},api(n){return n.controller instanceof WP?new Z8(n.controller,n.pool):null}});const J8=F("");function ZP(n,e){return ya(n,J8(void 0,e))}let tb=class uS extends J{constructor(e){var t;super(e),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=Kz(We(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(e){var t,i,s;const r=e??{};return new uS(J.createCore({disabled:(t=r.disabled)!==null&&t!==void 0?t:!1,disposed:!1,hidden:(i=r.hidden)!==null&&i!==void 0?i:!1,parent:(s=r.parent)!==null&&s!==void 0?s:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(e){_s(this.globalDisabled_,ZP(e,"disabled")),yi(this,"hidden",ZP(e,"hidden"))}bindDisabled(e){_s(this.globalDisabled_,t=>{e.disabled=t})}bindTabIndex(e){_s(this.globalDisabled_,t=>{e.tabIndex=t?-1:0})}handleDispose(e){this.value("disposed").emitter.on("change",t=>{t&&e()})}importState(e){this.set("disabled",e.disabled),this.set("hidden",e.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){const e=this.get("parent");return(e?e.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(e){var t;const i=e.previousRawValue;i?.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}};const QP=F("tbp");let eq=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(QP()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(QP("c")),this.element.appendChild(i),this.containerElement=i}};const nu=F("tbi");let tq=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(nu()),t.viewProps.bindClassModifiers(this.element),yi(t.props,"selected",r=>{r?this.element.classList.add(nu(void 0,"sel")):this.element.classList.remove(nu(void 0,"sel"))});const i=e.createElement("button");i.classList.add(nu("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(nu("t")),Xw(t.props.value("title"),s),this.buttonElement.appendChild(s),this.titleElement=s}},nq=class{constructor(e,t){this.emitter=new $n,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new tq(e,{props:t.props,viewProps:t.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}},Gv=class extends Zw{constructor(e,t){const i=new eq(e,{viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new Qw({blade:t.blade,element:i.containerElement,viewProps:t.viewProps}),view:i})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new nq(e,{props:t.itemProps,viewProps:tb.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=t.props,yi(this.props,"selected",s=>{this.itemController.props.set("selected",s),this.viewProps.set("hidden",!s)})}get itemController(){return this.ic_}importState(e){return Ni(e,t=>super.importState(t),t=>({selected:t.required.boolean,title:t.required.string}),t=>(this.ic_.props.set("selected",t.selected),this.ic_.props.set("title",t.title),!0))}exportState(){return Bi(()=>super.exportState(),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}},iq=class extends Ww{constructor(e,t){super(e,t),this.emitter_=new $n,this.onSelect_=this.onSelect_.bind(this),this.pool_=t,this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)}),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(e){const t=this.controller.view.element.ownerDocument,i=new Gv(t,{blade:oS(),itemProps:J.fromObject({selected:!1,title:e.title}),props:J.fromObject({selected:!1}),viewProps:tb.create()}),s=this.pool_.createApi(i);return this.rackApi_.add(s,e.index)}removePage(e){this.rackApi_.remove(this.rackApi_.children[e])}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}onSelect_(e){this.emitter_.emit("select",new g8(this,e.rawValue))}},sq=class extends Ww{get title(){var e;return(e=this.controller.itemController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.itemController.props.set("title",e)}get selected(){return this.controller.props.get("selected")}set selected(e){this.controller.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addBlade(e){return this.rackApi_.addBlade(e)}refresh(){this.rackApi_.refresh()}};const JP=-1;let rq=class{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=We(!0),this.selectedIndex=We(JP),this.items_=[]}add(e,t){const i=t??this.items_.length;this.items_.splice(i,0,e),e.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(e){const t=this.items_.indexOf(e);t<0||(this.items_.splice(t,1),e.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=JP,this.empty.rawValue=!0;return}const e=this.items_.findIndex(t=>t.rawValue);e<0?(this.items_.forEach((t,i)=>{t.rawValue=i===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((t,i)=>{t.rawValue=i===e}),this.selectedIndex.rawValue=e),this.empty.rawValue=!1}onItemSelectedChange_(e){if(e.rawValue){const t=this.items_.findIndex(i=>i===e.sender);this.items_.forEach((i,s)=>{i.rawValue=s===t}),this.selectedIndex.rawValue=t}else this.keepSelection_()}};const iu=F("tab");let oq=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(iu(),aS()),t.viewProps.bindClassModifiers(this.element),_s(t.empty,ya(this.element,iu(void 0,"nop")));const i=e.createElement("div");i.classList.add(iu("t")),this.element.appendChild(i),this.itemsElement=i;const s=e.createElement("div");s.classList.add(iu("i")),this.element.appendChild(s);const r=e.createElement("div");r.classList.add(iu("c")),this.element.appendChild(r),this.contentsElement=r}},ey=class extends Zw{constructor(e,t){const i=new rq,s=new oq(e,{empty:i.empty,viewProps:t.viewProps});super({blade:t.blade,rackController:new Qw({blade:t.blade,element:s.contentsElement,viewProps:t.viewProps}),view:s}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const r=this.rackController.rack;r.emitter.on("add",this.onRackAdd_),r.emitter.on("remove",this.onRackRemove_),this.tab=i}add(e,t){this.rackController.rack.add(e,t)}remove(e){this.rackController.rack.remove(this.rackController.rack.children[e])}onRackAdd_(e){if(!e.root)return;const t=e.bladeController;nS(this.view.itemsElement,t.itemController.view.element,e.index),t.itemController.viewProps.set("parent",this.viewProps),this.tab.add(t.props.value("selected"))}onRackRemove_(e){if(!e.root)return;const t=e.bladeController;Uu(t.itemController.view.element),t.itemController.viewProps.set("parent",null),this.tab.remove(t.props.value("selected"))}};_t({id:"tab",type:"blade",accept(n){const e=ct(n,t=>({pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")}));return!e||e.pages.length===0?null:{params:e}},controller(n){const e=new ey(n.document,{blade:n.blade,viewProps:n.viewProps});return n.params.pages.forEach(t=>{const i=new Gv(n.document,{blade:oS(),itemProps:J.fromObject({selected:!1,title:t.title}),props:J.fromObject({selected:!1}),viewProps:tb.create()});e.add(i)}),e},api(n){return n.controller instanceof ey?new iq(n.controller,n.pool):n.controller instanceof Gv?new sq(n.controller,n.pool):null}});let nb=class extends Gw{get options(){return this.controller.valueController.props.get("options")}set options(e){this.controller.valueController.props.set("options",e)}},Ea=class{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce((t,i)=>i.constrain(t),e)}};function sd(n,e){if(n instanceof e)return n;if(n instanceof Ea){const t=n.constraints.reduce((i,s)=>i||(s instanceof e?s:null),null);if(t)return t}return null}let tp=class{constructor(e){this.values=J.fromObject({options:e})}constrain(e){const t=this.values.get("options");return t.length===0||t.filter(s=>s.value===e).length>0?e:t[0].value}};function np(n){var e;const t=zv;if(Array.isArray(n))return(e=ct({items:n},i=>({items:i.required.array(i.required.object({text:i.required.string,value:i.required.raw}))})))===null||e===void 0?void 0:e.items;if(typeof n=="object")return t.required.raw(n).value}function hS(n){if(Array.isArray(n))return n;const e=[];return Object.keys(n).forEach(t=>{e.push({text:t,value:n[t]})}),e}function ib(n){return Me(n)?null:new tp(hS(n))}const $m=F("lst");let lq=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add($m()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("select");i.classList.add($m("s")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.selectElement=i;const s=e.createElement("div");s.classList.add($m("m")),s.appendChild(ep(e,"dropdown")),this.element.appendChild(s),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,yi(this.props_,"options",r=>{iS(this.selectElement),r.forEach(o=>{const l=e.createElement("option");l.textContent=o.text,this.selectElement.appendChild(l)}),this.update_()})}update_(){const e=this.props_.get("options").map(t=>t.value);this.selectElement.selectedIndex=e.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}},Ql=class{constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new lq(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const t=e.currentTarget;this.value.rawValue=this.props.get("options")[t.selectedIndex].value}importProps(e){return Ni(e,null,t=>({options:t.required.custom(np)}),t=>(this.props.set("options",hS(t.options)),!0))}exportProps(){return Bi(null,{options:this.props.get("options")})}};const ty=F("pop");let aq=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(ty()),t.viewProps.bindClassModifiers(this.element),_s(t.shows,ya(this.element,ty(void 0,"v")))}},cS=class{constructor(e,t){this.shows=We(!1),this.viewProps=t.viewProps,this.view=new aq(e,{shows:this.shows,viewProps:this.viewProps})}};const ny=F("txt");let uq=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(ny()),t.viewProps.bindClassModifiers(this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);const i=e.createElement("input");i.classList.add(ny("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}},sb=class{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new uq(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const i=e.currentTarget.value,s=this.parser_(i);Me(s)||(this.value.rawValue=s),this.view.refresh()}};function hq(n){return String(n)}function dS(n){return n==="false"?!1:!!n}function iy(n){return hq(n)}function cq(n){return e=>n.reduce((t,i)=>t!==null?t:i(e),null)}const dq=xt(0);function rd(n){return dq(n)+"%"}function pS(n){return String(n)}function Yv(n){return n}function xa({primary:n,secondary:e,forward:t,backward:i}){let s=!1;function r(o){s||(s=!0,o(),s=!1)}n.emitter.on("change",o=>{r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),e.emitter.on("change",o=>{r(()=>{n.setRawValue(i(n.rawValue,e.rawValue),o.options)}),r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),{forceEmit:!1,last:!0})})}function en(n,e){const t=n*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+t:e.downKey?-t:0}function Hu(n){return{altKey:n.altKey,downKey:n.key==="ArrowDown",shiftKey:n.shiftKey,upKey:n.key==="ArrowUp"}}function ks(n){return{altKey:n.altKey,downKey:n.key==="ArrowLeft",shiftKey:n.shiftKey,upKey:n.key==="ArrowRight"}}function pq(n){return n==="ArrowUp"||n==="ArrowDown"}function mS(n){return pq(n)||n==="ArrowLeft"||n==="ArrowRight"}function Vm(n,e){var t,i;const s=e.ownerDocument.defaultView,r=e.getBoundingClientRect();return{x:n.pageX-(((t=s&&s.scrollX)!==null&&t!==void 0?t:0)+r.left),y:n.pageY-(((i=s&&s.scrollY)!==null&&i!==void 0?i:0)+r.top)}}let Fr=class{constructor(e){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new $n,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault(),(t=e.currentTarget)===null||t===void 0||t.focus();const i=this.elem_.ownerDocument;i.addEventListener("mousemove",this.onDocumentMouseMove_),i.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(Vm(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(Vm(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(Vm(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchMove_(e){const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchEnd_(e){var t;const i=(t=e.targetTouches.item(0))!==null&&t!==void 0?t:this.lastTouch_,s=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(i?{x:i.clientX-s.left,y:i.clientY-s.top}:void 0),sender:this,shiftKey:e.shiftKey})}};const Rn=F("txt");let mq=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(Rn(),Rn(void 0,"num")),t.arrayPosition&&this.element.classList.add(Rn(void 0,t.arrayPosition)),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(Rn("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Rn()),this.inputElement.classList.add(Rn("i"));const s=e.createElement("div");s.classList.add(Rn("k")),this.element.appendChild(s),this.knobElement=s;const r=e.createElementNS(gn,"svg");r.classList.add(Rn("g")),this.knobElement.appendChild(r);const o=e.createElementNS(gn,"path");o.classList.add(Rn("gb")),r.appendChild(o),this.guideBodyElem_=o;const l=e.createElementNS(gn,"path");l.classList.add(Rn("gh")),r.appendChild(l),this.guideHeadElem_=l;const a=e.createElement("div");a.classList.add(F("tt")()),this.knobElement.appendChild(a),this.tooltipElem_=a,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.refresh()}onDraggingChange_(e){if(e.rawValue===null){this.element.classList.remove(Rn(void 0,"drg"));return}this.element.classList.add(Rn(void 0,"drg"));const t=e.rawValue/this.props_.get("pointerScale"),i=t+(t>0?-1:t<0?1:0),s=Fe(-i,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${i+s},0 L${i},4 L${i+s},8`,`M ${t},-1 L${t},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${t},4`);const r=this.props_.get("formatter");this.tooltipElem_.textContent=r(this.value.rawValue),this.tooltipElem_.style.left=`${t}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}},$a=class{constructor(e,t){var i;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=t.parser,this.props=t.props,this.sliderProps_=(i=t.sliderProps)!==null&&i!==void 0?i:null,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=We(null),this.view=new mq(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const s=new Fr(this.view.knobElement);s.emitter.on("down",this.onPointerDown_),s.emitter.on("move",this.onPointerMove_),s.emitter.on("up",this.onPointerUp_)}constrainValue_(e){var t,i;const s=(t=this.sliderProps_)===null||t===void 0?void 0:t.get("min"),r=(i=this.sliderProps_)===null||i===void 0?void 0:i.get("max");let o=e;return s!==void 0&&(o=Math.max(o,s)),r!==void 0&&(o=Math.min(o,r)),o}onInputChange_(e){const i=e.currentTarget.value,s=this.parser_(i);Me(s)||(this.value.rawValue=this.constrainValue_(s)),this.view.refresh()}onInputKeyDown_(e){const t=en(this.props.get("keyScale"),Hu(e));t!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+t),{forceEmit:!1,last:!1})}onInputKeyUp_(e){en(this.props.get("keyScale"),Hu(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;const t=e.point.x-e.bounds.width/2;return this.constrainValue_(this.originRawValue_+t*this.props.get("pointerScale"))}onPointerMove_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}};const km=F("sld");let vq=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(km()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(km("t")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.trackElement=i;const s=e.createElement("div");s.classList.add(km("k")),this.trackElement.appendChild(s),this.knobElement=s,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}update_(){const e=Fe(re(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${e}%`}onChange_(){this.update_()}},fq=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.props=t.props,this.view=new vq(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Fr(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){e.point&&this.value.setRawValue(re(Fe(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("min"),this.props.get("max")),t)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=en(this.props.get("keyScale"),ks(e));t!==0&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onKeyUp_(e){en(this.props.get("keyScale"),ks(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const Sm=F("sldtxt");let _q=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Sm());const i=e.createElement("div");i.classList.add(Sm("s")),this.sliderView_=t.sliderView,i.appendChild(this.sliderView_.element),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Sm("t")),this.textView_=t.textView,s.appendChild(this.textView_.element),this.element.appendChild(s)}},sy=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sliderC_=new fq(e,{props:t.sliderProps,value:t.value,viewProps:this.viewProps}),this.textC_=new $a(e,{parser:t.parser,props:t.textProps,sliderProps:t.sliderProps,value:t.value,viewProps:t.viewProps}),this.view=new _q(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(e){return Ni(e,null,t=>({max:t.required.number,min:t.required.number}),t=>{const i=this.sliderC_.props;return i.set("max",t.max),i.set("min",t.min),!0})}exportProps(){const e=this.sliderC_.props;return Bi(null,{max:e.get("max"),min:e.get("min")})}};function wq(n){return{sliderProps:new J({keyScale:n.keyScale,max:n.max,min:n.min}),textProps:new J({formatter:We(n.formatter),keyScale:n.keyScale,pointerScale:We(n.pointerScale)})}}const bq={containerUnitSize:"cnt-usz"};function vS(n){return`--${bq[n]}`}function zu(n){return Qd(n)}function vr(n){if(Uv(n))return ct(n,zu)}function as(n,e){if(!n)return;const t=[],i=Uw(n,e);i&&t.push(i);const s=Hw(n);return s&&t.push(s),new Ea(t)}function fS(n){if(n==="inline"||n==="popup")return n}function Uo(n,e){n.write(e)}const rc=F("ckb");let gq=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(rc()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("label");i.classList.add(rc("l")),this.element.appendChild(i);const s=e.createElement("input");s.classList.add(rc("i")),s.type="checkbox",i.appendChild(s),this.inputElement=s,t.viewProps.bindDisabled(this.inputElement);const r=e.createElement("div");r.classList.add(rc("w")),i.appendChild(r);const o=ep(e,"check");r.appendChild(o),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}},Cq=class{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new gq(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const t=e.currentTarget;this.value.rawValue=t.checked}};function Pq(n){const e=[],t=ib(n.options);return t&&e.push(t),new Ea(e)}_t({id:"input-bool",type:"input",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=ct(e,i=>({options:i.optional.custom(np),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>dS,constraint:n=>Pq(n.params),writer:n=>Uo},controller:n=>{const e=n.document,t=n.value,i=n.constraint,s=i&&sd(i,tp);return s?new Ql(e,{props:new J({options:s.values.value("options")}),value:t,viewProps:n.viewProps}):new Cq(e,{value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="boolean"?null:n.controller.valueController instanceof Ql?new nb(n.controller):null}});const Wr=F("col");let yq=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Wr()),t.foldable.bindExpandedClass(this.element,Wr(void 0,"expanded")),yi(t.foldable,"completed",ya(this.element,Wr(void 0,"cpl")));const i=e.createElement("div");i.classList.add(Wr("h")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Wr("s")),i.appendChild(s),this.swatchElement=s;const r=e.createElement("div");if(r.classList.add(Wr("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(Wr("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}};function Eq(n,e,t){const i=Fe(n/255,0,1),s=Fe(e/255,0,1),r=Fe(t/255,0,1),o=Math.max(i,s,r),l=Math.min(i,s,r),a=o-l;let u=0,h=0;const c=(l+o)/2;return a!==0&&(h=a/(1-Math.abs(o+l-1)),i===o?u=(s-r)/a:s===o?u=2+(r-i)/a:u=4+(i-s)/a,u=u/6+(u<0?1:0)),[u*360,h*100,c*100]}function xq(n,e,t){const i=(n%360+360)%360,s=Fe(e/100,0,1),r=Fe(t/100,0,1),o=(1-Math.abs(2*r-1))*s,l=o*(1-Math.abs(i/60%2-1)),a=r-o/2;let u,h,c;return i>=0&&i<60?[u,h,c]=[o,l,0]:i>=60&&i<120?[u,h,c]=[l,o,0]:i>=120&&i<180?[u,h,c]=[0,o,l]:i>=180&&i<240?[u,h,c]=[0,l,o]:i>=240&&i<300?[u,h,c]=[l,0,o]:[u,h,c]=[o,0,l],[(u+a)*255,(h+a)*255,(c+a)*255]}function $q(n,e,t){const i=Fe(n/255,0,1),s=Fe(e/255,0,1),r=Fe(t/255,0,1),o=Math.max(i,s,r),l=Math.min(i,s,r),a=o-l;let u;a===0?u=0:o===i?u=60*(((s-r)/a%6+6)%6):o===s?u=60*((r-i)/a+2):u=60*((i-s)/a+4);const h=o===0?0:a/o,c=o;return[u,h*100,c*100]}function _S(n,e,t){const i=J1(n,360),s=Fe(e/100,0,1),r=Fe(t/100,0,1),o=r*s,l=o*(1-Math.abs(i/60%2-1)),a=r-o;let u,h,c;return i>=0&&i<60?[u,h,c]=[o,l,0]:i>=60&&i<120?[u,h,c]=[l,o,0]:i>=120&&i<180?[u,h,c]=[0,o,l]:i>=180&&i<240?[u,h,c]=[0,l,o]:i>=240&&i<300?[u,h,c]=[l,0,o]:[u,h,c]=[o,0,l],[(u+a)*255,(h+a)*255,(c+a)*255]}function Vq(n,e,t){const i=t+e*(100-Math.abs(2*t-100))/200;return[n,i!==0?e*(100-Math.abs(2*t-100))/i:0,t+e*(100-Math.abs(2*t-100))/(2*100)]}function kq(n,e,t){const i=100-Math.abs(t*(200-e)/100-100);return[n,i!==0?e*t/i:0,t*(200-e)/(2*100)]}function Ei(n){return[n[0],n[1],n[2]]}function ip(n,e){return[n[0],n[1],n[2],e]}const Sq={hsl:{hsl:(n,e,t)=>[n,e,t],hsv:Vq,rgb:xq},hsv:{hsl:kq,hsv:(n,e,t)=>[n,e,t],rgb:_S},rgb:{hsl:Eq,hsv:$q,rgb:(n,e,t)=>[n,e,t]}};function Jl(n,e){return[e==="float"?1:n==="rgb"?255:360,e==="float"?1:n==="rgb"?255:100,e==="float"?1:n==="rgb"?255:100]}function Lq(n,e){return n===e?e:J1(n,e)}function wS(n,e,t){var i;const s=Jl(e,t);return[e==="rgb"?Fe(n[0],0,s[0]):Lq(n[0],s[0]),Fe(n[1],0,s[1]),Fe(n[2],0,s[2]),Fe((i=n[3])!==null&&i!==void 0?i:1,0,1)]}function ry(n,e,t,i){const s=Jl(e,t),r=Jl(e,i);return n.map((o,l)=>o/s[l]*r[l])}function bS(n,e,t){const i=ry(n,e.mode,e.type,"int"),s=Sq[e.mode][t.mode](...i);return ry(s,t.mode,"int",t.type)}let pe=class gS{static black(){return new gS([0,0,0],"rgb")}constructor(e,t){this.type="int",this.mode=t,this.comps_=wS(e,t,this.type)}getComponents(e){return ip(bS(Ei(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}};const Ys=F("colp");let Aq=class{constructor(e,t){this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(Ys()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Ys("hsv"));const s=e.createElement("div");s.classList.add(Ys("sv")),this.svPaletteView_=t.svPaletteView,s.appendChild(this.svPaletteView_.element),i.appendChild(s);const r=e.createElement("div");r.classList.add(Ys("h")),this.hPaletteView_=t.hPaletteView,r.appendChild(this.hPaletteView_.element),i.appendChild(r),this.element.appendChild(i);const o=e.createElement("div");if(o.classList.add(Ys("rgb")),this.textsView_=t.textsView,o.appendChild(this.textsView_.element),this.element.appendChild(o),t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};const l=e.createElement("div");l.classList.add(Ys("a"));const a=e.createElement("div");a.classList.add(Ys("ap")),a.appendChild(this.alphaViews_.palette.element),l.appendChild(a);const u=e.createElement("div");u.classList.add(Ys("at")),u.appendChild(this.alphaViews_.text.element),l.appendChild(u),this.element.appendChild(l)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map(t=>t.inputElement)];return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}};function Mq(n){return n==="int"?"int":n==="float"?"float":void 0}function rb(n){return ct(n,e=>({color:e.optional.object({alpha:e.optional.boolean,type:e.optional.custom(Mq)}),expanded:e.optional.boolean,picker:e.optional.custom(fS),readonly:e.optional.constant(!1)}))}function Eo(n){return n?.1:1}function CS(n){var e;return(e=n.color)===null||e===void 0?void 0:e.type}let ob=class{constructor(e,t){this.type="float",this.mode=t,this.comps_=wS(e,t,this.type)}getComponents(e){return ip(bS(Ei(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}};const Tq={int:(n,e)=>new pe(n,e),float:(n,e)=>new ob(n,e)};function lb(n,e,t){return Tq[t](n,e)}function Dq(n){return n.type==="float"}function Rq(n){return n.type==="int"}function Oq(n){const e=n.getComponents(),t=Jl(n.mode,"int");return new pe([Math.round(re(e[0],0,1,0,t[0])),Math.round(re(e[1],0,1,0,t[1])),Math.round(re(e[2],0,1,0,t[2])),e[3]],n.mode)}function jq(n){const e=n.getComponents(),t=Jl(n.mode,"int");return new ob([re(e[0],0,t[0],0,1),re(e[1],0,t[1],0,1),re(e[2],0,t[2],0,1),e[3]],n.mode)}function Bt(n,e){if(n.type===e)return n;if(Rq(n)&&e==="float")return jq(n);if(Dq(n)&&e==="int")return Oq(n);throw yo.shouldNeverHappen()}function Nq(n,e){return n.alpha===e.alpha&&n.mode===e.mode&&n.notation===e.notation&&n.type===e.type}function Hn(n,e){const t=n.match(/^(.+)%$/);return Math.min(t?parseFloat(t[1])*.01*e:parseFloat(n),e)}const Bq={deg:n=>n,grad:n=>n*360/400,rad:n=>n*360/(2*Math.PI),turn:n=>n*360};function PS(n){const e=n.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(n);const t=parseFloat(e[1]),i=e[2];return Bq[i](t)}function yS(n){const e=n.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Hn(e[1],255),Hn(e[2],255),Hn(e[3],255)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function Iq(n){const e=yS(n);return e?new pe(e,"rgb"):null}function ES(n){const e=n.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Hn(e[1],255),Hn(e[2],255),Hn(e[3],255),Hn(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function Fq(n){const e=ES(n);return e?new pe(e,"rgb"):null}function xS(n){const e=n.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[PS(e[1]),Hn(e[2],100),Hn(e[3],100)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function Kq(n){const e=xS(n);return e?new pe(e,"hsl"):null}function $S(n){const e=n.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[PS(e[1]),Hn(e[2],100),Hn(e[3],100),Hn(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function Uq(n){const e=$S(n);return e?new pe(e,"hsl"):null}function VS(n){const e=n.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];const t=n.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}function Hq(n){const e=VS(n);return e?new pe(e,"rgb"):null}function kS(n){const e=n.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),re(parseInt(e[4]+e[4],16),0,255,0,1)];const t=n.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),re(parseInt(t[4],16),0,255,0,1)]:null}function zq(n){const e=kS(n);return e?new pe(e,"rgb"):null}function SS(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function oy(n){return e=>{const t=SS(e);return t?lb(t,"rgb",n):null}}function LS(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function ly(n){return e=>{const t=LS(e);return t?lb(t,"rgb",n):null}}const qq=[{parser:VS,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:kS,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:yS,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:ES,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:xS,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:$S,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:SS,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:LS,result:{alpha:!0,mode:"rgb",notation:"object"}}];function Gq(n){return qq.reduce((e,{parser:t,result:i})=>e||(t(n)?i:null),null)}function Yq(n,e="int"){const t=Gq(n);return t?t.notation==="hex"&&e!=="float"?Object.assign(Object.assign({},t),{type:"int"}):t.notation==="func"?Object.assign(Object.assign({},t),{type:e}):null:null}function Ah(n){const e=[Hq,zq,Iq,Fq,Kq,Uq];n==="int"&&e.push(oy("int"),ly("int")),n==="float"&&e.push(oy("float"),ly("float"));const t=cq(e);return i=>{const s=t(i);return s?Bt(s,n):null}}function Xq(n){const e=Ah("int");if(typeof n!="string")return pe.black();const t=e(n);return t??pe.black()}function AS(n){const e=Fe(Math.floor(n),0,255).toString(16);return e.length===1?`0${e}`:e}function ab(n,e="#"){const t=Ei(n.getComponents("rgb")).map(AS).join("");return`${e}${t}`}function ub(n,e="#"){const t=n.getComponents("rgb"),i=[t[0],t[1],t[2],t[3]*255].map(AS).join("");return`${e}${i}`}function MS(n){const e=xt(0),t=Bt(n,"int");return`rgb(${Ei(t.getComponents("rgb")).map(s=>e(s)).join(", ")})`}function Vc(n){const e=xt(2),t=xt(0);return`rgba(${Bt(n,"int").getComponents("rgb").map((r,o)=>(o===3?e:t)(r)).join(", ")})`}function Wq(n){const e=[xt(0),rd,rd],t=Bt(n,"int");return`hsl(${Ei(t.getComponents("hsl")).map((s,r)=>e[r](s)).join(", ")})`}function Zq(n){const e=[xt(0),rd,rd,xt(2)];return`hsla(${Bt(n,"int").getComponents("hsl").map((s,r)=>e[r](s)).join(", ")})`}function TS(n,e){const t=xt(e==="float"?2:0),i=["r","g","b"],s=Bt(n,e);return`{${Ei(s.getComponents("rgb")).map((o,l)=>`${i[l]}: ${t(o)}`).join(", ")}}`}function Qq(n){return e=>TS(e,n)}function DS(n,e){const t=xt(2),i=xt(e==="float"?2:0),s=["r","g","b","a"];return`{${Bt(n,e).getComponents("rgb").map((l,a)=>{const u=a===3?t:i;return`${s[a]}: ${u(l)}`}).join(", ")}}`}function Jq(n){return e=>DS(e,n)}const e7=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:ab},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:ub},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:MS},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:Vc},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:Wq},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:Zq},...["int","float"].reduce((n,e)=>[...n,{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:Qq(e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:Jq(e)}],[])];function RS(n){return e7.reduce((e,t)=>e||(Nq(t.format,n)?t.stringifier:null),null)}const su=F("apl");let t7=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(su()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(su("b")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(su("c")),i.appendChild(s),this.colorElem_=s;const r=e.createElement("div");r.classList.add(su("m")),this.element.appendChild(r),this.markerElem_=r;const o=e.createElement("div");o.classList.add(su("p")),this.markerElem_.appendChild(o),this.previewElem_=o,this.update_()}update_(){const e=this.value.rawValue,t=e.getComponents("rgb"),i=new pe([t[0],t[1],t[2],0],"rgb"),s=new pe([t[0],t[1],t[2],255],"rgb"),r=["to right",Vc(i),Vc(s)];this.colorElem_.style.background=`linear-gradient(${r.join(",")})`,this.previewElem_.style.backgroundColor=Vc(e);const o=re(t[3],0,1,0,100);this.markerElem_.style.left=`${o}%`}onValueChange_(){this.update_()}},n7=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new t7(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Fr(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=e.point.x/e.bounds.width,s=this.value.rawValue,[r,o,l]=s.getComponents("hsv");this.value.setRawValue(new pe([r,o,l,i],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=en(Eo(!0),ks(e));if(t===0)return;const i=this.value.rawValue,[s,r,o,l]=i.getComponents("hsv");this.value.setRawValue(new pe([s,r,o,l+t],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){en(Eo(!0),ks(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const sl=F("coltxt");function i7(n){const e=n.createElement("select"),t=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}];return e.appendChild(t.reduce((i,s)=>{const r=n.createElement("option");return r.textContent=s.text,r.value=s.value,i.appendChild(r),i},n.createDocumentFragment())),e}let s7=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(sl()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(sl("m")),this.modeElem_=i7(e),this.modeElem_.classList.add(sl("ms")),i.appendChild(this.modeSelectElement),t.viewProps.bindDisabled(this.modeElem_);const s=e.createElement("div");s.classList.add(sl("mm")),s.appendChild(ep(e,"dropdown")),i.appendChild(s),this.element.appendChild(i);const r=e.createElement("div");r.classList.add(sl("w")),this.element.appendChild(r),this.inputsElem_=r,this.inputViews_=t.inputViews,this.applyInputViews_(),_s(t.mode,o=>{this.modeElem_.value=o})}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(e){this.inputViews_=e,this.applyInputViews_()}applyInputViews_(){iS(this.inputsElem_);const e=this.element.ownerDocument;this.inputViews_.forEach(t=>{const i=e.createElement("div");i.classList.add(sl("c")),i.appendChild(t.element),this.inputsElem_.appendChild(i)})}};function r7(n){return xt(n==="float"?2:0)}function o7(n,e,t){const i=Jl(n,e)[t];return new Xd({min:0,max:i})}function l7(n,e,t){return new $a(n,{arrayPosition:t===0?"fst":t===2?"lst":"mid",parser:e.parser,props:J.fromObject({formatter:r7(e.colorType),keyScale:Eo(!1),pointerScale:e.colorType==="float"?.01:1}),value:We(0,{constraint:o7(e.colorMode,e.colorType,t)}),viewProps:e.viewProps})}function a7(n,e){const t={colorMode:e.colorMode,colorType:e.colorType,parser:Pi,viewProps:e.viewProps};return[0,1,2].map(i=>{const s=l7(n,t,i);return xa({primary:e.value,secondary:s.value,forward(r){return Bt(r,e.colorType).getComponents(e.colorMode)[i]},backward(r,o){const l=e.colorMode,u=Bt(r,e.colorType).getComponents(l);u[i]=o;const h=lb(ip(Ei(u),u[3]),l,e.colorType);return Bt(h,"int")}}),s})}function u7(n,e){const t=new sb(n,{parser:Ah("int"),props:J.fromObject({formatter:ab}),value:We(pe.black()),viewProps:e.viewProps});return xa({primary:e.value,secondary:t.value,forward:i=>new pe(Ei(i.getComponents()),i.mode),backward:(i,s)=>new pe(ip(Ei(s.getComponents(i.mode)),i.getComponents()[3]),i.mode)}),[t]}function h7(n){return n!=="hex"}let c7=class{constructor(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=t.colorType,this.value=t.value,this.viewProps=t.viewProps,this.colorMode=We(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new s7(e,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const t=this.colorMode.rawValue;return h7(t)?a7(e,{colorMode:t,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):u7(e,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(e){const t=e.currentTarget;this.colorMode.rawValue=t.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map(i=>i.view)}};const Lm=F("hpl");let d7=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Lm()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(Lm("c")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Lm("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=this.value.rawValue,[t]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=MS(new pe([t,100,100],"hsv"));const i=re(t,0,360,0,100);this.markerElem_.style.left=`${i}%`}onValueChange_(){this.update_()}},p7=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new d7(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Fr(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=re(Fe(e.point.x,0,e.bounds.width),0,e.bounds.width,0,360),s=this.value.rawValue,[,r,o,l]=s.getComponents("hsv");this.value.setRawValue(new pe([i,r,o,l],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=en(Eo(!1),ks(e));if(t===0)return;const i=this.value.rawValue,[s,r,o,l]=i.getComponents("hsv");this.value.setRawValue(new pe([s+t,r,o,l],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){en(Eo(!1),ks(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const Am=F("svp"),ay=64;let m7=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Am()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("canvas");i.height=ay,i.width=ay,i.classList.add(Am("c")),this.element.appendChild(i),this.canvasElement=i;const s=e.createElement("div");s.classList.add(Am("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=$8(this.canvasElement);if(!e)return;const i=this.value.rawValue.getComponents("hsv"),s=this.canvasElement.width,r=this.canvasElement.height,o=e.getImageData(0,0,s,r),l=o.data;for(let h=0;h<r;h++)for(let c=0;c<s;c++){const p=re(c,0,s,0,100),d=re(h,0,r,100,0),m=_S(i[0],p,d),f=(h*s+c)*4;l[f]=m[0],l[f+1]=m[1],l[f+2]=m[2],l[f+3]=255}e.putImageData(o,0,0);const a=re(i[1],0,100,0,100);this.markerElem_.style.left=`${a}%`;const u=re(i[2],0,100,100,0);this.markerElem_.style.top=`${u}%`}onValueChange_(){this.update_()}},v7=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new m7(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Fr(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=re(e.point.x,0,e.bounds.width,0,100),s=re(e.point.y,0,e.bounds.height,100,0),[r,,,o]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new pe([r,i,s,o],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){mS(e.key)&&e.preventDefault();const[t,i,s,r]=this.value.rawValue.getComponents("hsv"),o=Eo(!1),l=en(o,ks(e)),a=en(o,Hu(e));l===0&&a===0||this.value.setRawValue(new pe([t,i+l,s+a,r],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){const t=Eo(!1),i=en(t,ks(e)),s=en(t,Hu(e));i===0&&s===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},f7=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.hPaletteC_=new p7(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new v7(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=t.supportsAlpha?{palette:new n7(e,{value:this.value,viewProps:this.viewProps}),text:new $a(e,{parser:Pi,props:J.fromObject({pointerScale:.01,keyScale:.1,formatter:xt(2)}),value:We(0,{constraint:new Xd({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&xa({primary:this.value,secondary:this.alphaIcs_.text.value,forward:i=>i.getComponents()[3],backward:(i,s)=>{const r=i.getComponents();return r[3]=s,new pe(r,i.mode)}}),this.textsC_=new c7(e,{colorType:t.colorType,value:this.value,viewProps:this.viewProps}),this.view=new Aq(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}};const Mm=F("colsw");let _7=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(Mm()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Mm("sw")),this.element.appendChild(i),this.swatchElem_=i;const s=e.createElement("button");s.classList.add(Mm("b")),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s,this.update_()}update_(){const e=this.value.rawValue;this.swatchElem_.style.backgroundColor=ub(e)}onValueChange_(){this.update_()}},w7=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new _7(e,{value:this.value,viewProps:this.viewProps})}},hb=class{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=Jw.create(t.expanded),this.swatchC_=new w7(e,{value:this.value,viewProps:this.viewProps});const i=this.swatchC_.view.buttonElement;i.addEventListener("blur",this.onButtonBlur_),i.addEventListener("click",this.onButtonClick_),this.textC_=new sb(e,{parser:t.parser,props:J.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new yq(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=t.pickerLayout==="popup"?new cS(e,{viewProps:this.viewProps}):null;const s=new f7(e,{colorType:t.colorType,supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});s.view.allFocusableElements.forEach(r=>{r.addEventListener("blur",this.onPopupChildBlur_),r.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=s,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(s.view.element),xa({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:r=>r,backward:(r,o)=>o})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),eb(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=sS(e);i&&t.contains(i)||i&&i===this.swatchC_.view.buttonElement&&!Yw(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}};function b7(n){return Ei(n.getComponents("rgb")).reduce((e,t)=>e<<8|Math.floor(t)&255,0)}function g7(n){return n.getComponents("rgb").reduce((e,t,i)=>{const s=Math.floor(i===3?t*255:t)&255;return e<<8|s},0)>>>0}function C7(n){return new pe([n>>16&255,n>>8&255,n&255],"rgb")}function P7(n){return new pe([n>>24&255,n>>16&255,n>>8&255,re(n&255,0,255,0,1)],"rgb")}function y7(n){return typeof n!="number"?pe.black():C7(n)}function E7(n){return typeof n!="number"?pe.black():P7(n)}function kc(n,e){return typeof n!="object"||Me(n)?!1:e in n&&typeof n[e]=="number"}function OS(n){return kc(n,"r")&&kc(n,"g")&&kc(n,"b")}function jS(n){return OS(n)&&kc(n,"a")}function NS(n){return OS(n)}function cb(n,e){if(n.mode!==e.mode||n.type!==e.type)return!1;const t=n.getComponents(),i=e.getComponents();for(let s=0;s<t.length;s++)if(t[s]!==i[s])return!1;return!0}function uy(n){return"a"in n?[n.r,n.g,n.b,n.a]:[n.r,n.g,n.b]}function x7(n){const e=RS(n);return e?(t,i)=>{Uo(t,e(i))}:null}function $7(n){const e=n?g7:b7;return(t,i)=>{Uo(t,e(i))}}function V7(n,e,t){const s=Bt(e,t).toRgbaObject();n.writeProperty("r",s.r),n.writeProperty("g",s.g),n.writeProperty("b",s.b),n.writeProperty("a",s.a)}function k7(n,e,t){const s=Bt(e,t).toRgbaObject();n.writeProperty("r",s.r),n.writeProperty("g",s.g),n.writeProperty("b",s.b)}function S7(n,e){return(t,i)=>{n?V7(t,i,e):k7(t,i,e)}}function L7(n){var e;return!!(!((e=n?.color)===null||e===void 0)&&e.alpha)}function A7(n){return n?e=>ub(e,"0x"):e=>ab(e,"0x")}function M7(n){return"color"in n||n.view==="color"}_t({id:"input-color-number",type:"input",accept:(n,e)=>{if(typeof n!="number"||!M7(e))return null;const t=rb(e);return t?{initialValue:n,params:Object.assign(Object.assign({},t),{supportsAlpha:L7(e)})}:null},binding:{reader:n=>n.params.supportsAlpha?E7:y7,equals:cb,writer:n=>$7(n.params.supportsAlpha)},controller:n=>{var e,t;return new hb(n.document,{colorType:"int",expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:A7(n.params.supportsAlpha),parser:Ah("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.supportsAlpha,value:n.value,viewProps:n.viewProps})}});function T7(n,e){if(!NS(n))return Bt(pe.black(),e);if(e==="int"){const t=uy(n);return new pe(t,"rgb")}if(e==="float"){const t=uy(n);return new ob(t,"rgb")}return Bt(pe.black(),"int")}function D7(n){return jS(n)}function R7(n){return e=>{const t=T7(e,n);return Bt(t,"int")}}function O7(n,e){return t=>n?DS(t,e):TS(t,e)}_t({id:"input-color-object",type:"input",accept:(n,e)=>{var t;if(!NS(n))return null;const i=rb(e);return i?{initialValue:n,params:Object.assign(Object.assign({},i),{colorType:(t=CS(e))!==null&&t!==void 0?t:"int"})}:null},binding:{reader:n=>R7(n.params.colorType),equals:cb,writer:n=>S7(D7(n.initialValue),n.params.colorType)},controller:n=>{var e,t;const i=jS(n.initialValue);return new hb(n.document,{colorType:n.params.colorType,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:O7(i,n.params.colorType),parser:Ah("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:i,value:n.value,viewProps:n.viewProps})}});_t({id:"input-color-string",type:"input",accept:(n,e)=>{if(typeof n!="string"||e.view==="text")return null;const t=Yq(n,CS(e));if(!t)return null;const i=RS(t);if(!i)return null;const s=rb(e);return s?{initialValue:n,params:Object.assign(Object.assign({},s),{format:t,stringifier:i})}:null},binding:{reader:()=>Xq,equals:cb,writer:n=>{const e=x7(n.params.format);if(!e)throw yo.notBindable();return e}},controller:n=>{var e,t;return new hb(n.document,{colorType:n.params.format.type,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:n.params.stringifier,parser:Ah("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.format.alpha,value:n.value,viewProps:n.viewProps})}});let db=class{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map((i,s)=>{var r,o;return(o=(r=this.components[s])===null||r===void 0?void 0:r.constrain(i))!==null&&o!==void 0?o:i});return this.asm_.fromComponents(t)}};const hy=F("pndtxt");let j7=class{constructor(e,t){this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add(hy()),this.textViews.forEach(i=>{const s=e.createElement("div");s.classList.add(hy("a")),s.appendChild(i.element),this.element.appendChild(s)})}};function N7(n,e,t){return new $a(n,{arrayPosition:t===0?"fst":t===e.axes.length-1?"lst":"mid",parser:e.parser,props:e.axes[t].textProps,value:We(0,{constraint:e.axes[t].constraint}),viewProps:e.viewProps})}let pb=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map((i,s)=>N7(e,t,s)),this.acs_.forEach((i,s)=>{xa({primary:this.value,secondary:i.value,forward:r=>t.assembly.toComponents(r)[s],backward:(r,o)=>{const l=t.assembly.toComponents(r);return l[s]=o,t.assembly.fromComponents(l)}})}),this.view=new j7(e,{textViews:this.acs_.map(i=>i.view)})}get textControllers(){return this.acs_}},B7=class extends Gw{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(e){this.controller.valueController.sliderController.props.set("max",e)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(e){this.controller.valueController.sliderController.props.set("min",e)}};function I7(n,e){const t=[],i=Uw(n,e);i&&t.push(i);const s=Hw(n);s&&t.push(s);const r=ib(n.options);return r&&t.push(r),new Ea(t)}_t({id:"input-number",type:"input",accept:(n,e)=>{if(typeof n!="number")return null;const t=ct(e,i=>Object.assign(Object.assign({},Qd(i)),{options:i.optional.custom(np),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>Wd,constraint:n=>I7(n.params,n.initialValue),writer:n=>Uo},controller:n=>{const e=n.value,t=n.constraint,i=t&&sd(t,tp);if(i)return new Ql(n.document,{props:new J({options:i.values.value("options")}),value:e,viewProps:n.viewProps});const s=Zd(n.params,e.rawValue),r=t&&sd(t,Xd);return r?new sy(n.document,Object.assign(Object.assign({},wq(Object.assign(Object.assign({},s),{keyScale:We(s.keyScale),max:r.values.value("max"),min:r.values.value("min")}))),{parser:Pi,value:e,viewProps:n.viewProps})):new $a(n.document,{parser:Pi,props:J.fromObject(s),value:e,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="number"?null:n.controller.valueController instanceof sy?new B7(n.controller):n.controller.valueController instanceof Ql?new nb(n.controller):null}});let Pr=class{constructor(e=0,t=0){this.x=e,this.y=t}getComponents(){return[this.x,this.y]}static isObject(e){if(Me(e))return!1;const t=e.x,i=e.y;return!(typeof t!="number"||typeof i!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y}toObject(){return{x:this.x,y:this.y}}};const BS={toComponents:n=>n.getComponents(),fromComponents:n=>new Pr(...n)},rl=F("p2d");let F7=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(rl()),t.viewProps.bindClassModifiers(this.element),_s(t.expanded,ya(this.element,rl(void 0,"expanded")));const i=e.createElement("div");i.classList.add(rl("h")),this.element.appendChild(i);const s=e.createElement("button");s.classList.add(rl("b")),s.appendChild(ep(e,"p2dpad")),t.viewProps.bindDisabled(s),i.appendChild(s),this.buttonElement=s;const r=e.createElement("div");if(r.classList.add(rl("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(rl("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}};const Xs=F("p2dp");let K7=class{constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=e.createElement("div"),this.element.classList.add(Xs()),t.layout==="popup"&&this.element.classList.add(Xs(void 0,"p")),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Xs("p")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.padElement=i;const s=e.createElementNS(gn,"svg");s.classList.add(Xs("g")),this.padElement.appendChild(s),this.svgElem_=s;const r=e.createElementNS(gn,"line");r.classList.add(Xs("ax")),r.setAttributeNS(null,"x1","0"),r.setAttributeNS(null,"y1","50%"),r.setAttributeNS(null,"x2","100%"),r.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(r);const o=e.createElementNS(gn,"line");o.classList.add(Xs("ax")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","0"),o.setAttributeNS(null,"x2","50%"),o.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(o);const l=e.createElementNS(gn,"line");l.classList.add(Xs("l")),l.setAttributeNS(null,"x1","50%"),l.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(l),this.lineElem_=l;const a=e.createElement("div");a.classList.add(Xs("m")),this.padElement.appendChild(a),this.markerElem_=a,t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,t]=this.value.rawValue.getComponents(),i=this.props_.get("max"),s=re(e,-i,+i,0,100),r=re(t,-i,+i,0,100),o=this.props_.get("invertsY")?100-r:r;this.lineElem_.setAttributeNS(null,"x2",`${s}%`),this.lineElem_.setAttributeNS(null,"y2",`${o}%`),this.markerElem_.style.left=`${s}%`,this.markerElem_.style.top=`${o}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}};function cy(n,e,t){return[en(e[0],ks(n)),en(e[1],Hu(n))*(t?1:-1)]}let U7=class{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new K7(e,{layout:t.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Fr(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=this.props.get("max"),s=re(e.point.x,0,e.bounds.width,-i,+i),r=re(this.props.get("invertsY")?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-i,+i);this.value.setRawValue(new Pr(s,r),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onPadKeyDown_(e){mS(e.key)&&e.preventDefault();const[t,i]=cy(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(new Pr(this.value.rawValue.x+t,this.value.rawValue.y+i),{forceEmit:!1,last:!1})}onPadKeyUp_(e){const[t,i]=cy(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},H7=class{constructor(e,t){var i,s;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=Jw.create(t.expanded),this.popC_=t.pickerLayout==="popup"?new cS(e,{viewProps:this.viewProps}):null;const r=new U7(e,{layout:t.pickerLayout,props:new J({invertsY:We(t.invertsY),max:We(t.max),xKeyScale:t.axes[0].textProps.value("keyScale"),yKeyScale:t.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});r.view.allFocusableElements.forEach(o=>{o.addEventListener("blur",this.onPopupChildBlur_),o.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=r,this.textC_=new pb(e,{assembly:BS,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new F7(e,{expanded:this.foldable_.value("expanded"),pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(i=this.view.buttonElement)===null||i===void 0||i.addEventListener("blur",this.onPadButtonBlur_),(s=this.view.buttonElement)===null||s===void 0||s.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),xa({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:o=>o,backward:(o,l)=>l})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),eb(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=sS(e);i&&t.contains(i)||i&&i===this.view.buttonElement&&!Yw(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.view.buttonElement.focus()}};function z7(n){return Pr.isObject(n)?new Pr(n.x,n.y):new Pr}function q7(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y)}function G7(n,e){return new db({assembly:BS,components:[as(Object.assign(Object.assign({},n),n.x),e.x),as(Object.assign(Object.assign({},n),n.y),e.y)]})}function dy(n,e){var t,i;if(!Me(n.min)||!Me(n.max))return Math.max(Math.abs((t=n.min)!==null&&t!==void 0?t:0),Math.abs((i=n.max)!==null&&i!==void 0?i:0));const s=eS(n);return Math.max(Math.abs(s)*10,Math.abs(e)*10)}function Y7(n,e){var t,i;const s=dy(Po(n,(t=n.x)!==null&&t!==void 0?t:{}),e.x),r=dy(Po(n,(i=n.y)!==null&&i!==void 0?i:{}),e.y);return Math.max(s,r)}function X7(n){if(!("y"in n))return!1;const e=n.y;return e&&"inverted"in e?!!e.inverted:!1}_t({id:"input-point2d",type:"input",accept:(n,e)=>{if(!Pr.isObject(n))return null;const t=ct(e,i=>Object.assign(Object.assign({},zu(i)),{expanded:i.optional.boolean,picker:i.optional.custom(fS),readonly:i.optional.constant(!1),x:i.optional.custom(vr),y:i.optional.object(Object.assign(Object.assign({},zu(i)),{inverted:i.optional.boolean}))}));return t?{initialValue:n,params:t}:null},binding:{reader:()=>z7,constraint:n=>G7(n.params,n.initialValue),equals:Pr.equals,writer:()=>q7},controller:n=>{var e,t;const i=n.document,s=n.value,r=n.constraint,o=[n.params.x,n.params.y];return new H7(i,{axes:s.rawValue.getComponents().map((l,a)=>{var u;return zw({constraint:r.components[a],initialValue:l,params:Po(n.params,(u=o[a])!==null&&u!==void 0?u:{})})}),expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,invertsY:X7(n.params),max:Y7(n.params,s.rawValue),parser:Pi,pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",value:s,viewProps:n.viewProps})}});let Dl=class{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if(Me(e))return!1;const t=e.x,i=e.y,s=e.z;return!(typeof t!="number"||typeof i!="number"||typeof s!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}};const IS={toComponents:n=>n.getComponents(),fromComponents:n=>new Dl(...n)};function W7(n){return Dl.isObject(n)?new Dl(n.x,n.y,n.z):new Dl}function Z7(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z)}function Q7(n,e){return new db({assembly:IS,components:[as(Object.assign(Object.assign({},n),n.x),e.x),as(Object.assign(Object.assign({},n),n.y),e.y),as(Object.assign(Object.assign({},n),n.z),e.z)]})}_t({id:"input-point3d",type:"input",accept:(n,e)=>{if(!Dl.isObject(n))return null;const t=ct(e,i=>Object.assign(Object.assign({},zu(i)),{readonly:i.optional.constant(!1),x:i.optional.custom(vr),y:i.optional.custom(vr),z:i.optional.custom(vr)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>W7,constraint:n=>Q7(n.params,n.initialValue),equals:Dl.equals,writer:n=>Z7},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z];return new pb(n.document,{assembly:IS,axes:e.rawValue.getComponents().map((s,r)=>{var o;return zw({constraint:t.components[r],initialValue:s,params:Po(n.params,(o=i[r])!==null&&o!==void 0?o:{})})}),parser:Pi,value:e,viewProps:n.viewProps})}});let Rl=class{constructor(e=0,t=0,i=0,s=0){this.x=e,this.y=t,this.z=i,this.w=s}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if(Me(e))return!1;const t=e.x,i=e.y,s=e.z,r=e.w;return!(typeof t!="number"||typeof i!="number"||typeof s!="number"||typeof r!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}};const FS={toComponents:n=>n.getComponents(),fromComponents:n=>new Rl(...n)};function J7(n){return Rl.isObject(n)?new Rl(n.x,n.y,n.z,n.w):new Rl}function eG(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z),n.writeProperty("w",e.w)}function tG(n,e){return new db({assembly:FS,components:[as(Object.assign(Object.assign({},n),n.x),e.x),as(Object.assign(Object.assign({},n),n.y),e.y),as(Object.assign(Object.assign({},n),n.z),e.z),as(Object.assign(Object.assign({},n),n.w),e.w)]})}_t({id:"input-point4d",type:"input",accept:(n,e)=>{if(!Rl.isObject(n))return null;const t=ct(e,i=>Object.assign(Object.assign({},zu(i)),{readonly:i.optional.constant(!1),w:i.optional.custom(vr),x:i.optional.custom(vr),y:i.optional.custom(vr),z:i.optional.custom(vr)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>J7,constraint:n=>tG(n.params,n.initialValue),equals:Rl.equals,writer:n=>eG},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z,n.params.w];return new pb(n.document,{assembly:FS,axes:e.rawValue.getComponents().map((s,r)=>{var o;return zw({constraint:t.components[r],initialValue:s,params:Po(n.params,(o=i[r])!==null&&o!==void 0?o:{})})}),parser:Pi,value:e,viewProps:n.viewProps})}});function nG(n){const e=[],t=ib(n.options);return t&&e.push(t),new Ea(e)}_t({id:"input-string",type:"input",accept:(n,e)=>{if(typeof n!="string")return null;const t=ct(e,i=>({readonly:i.optional.constant(!1),options:i.optional.custom(np)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>pS,constraint:n=>nG(n.params),writer:n=>Uo},controller:n=>{const e=n.document,t=n.value,i=n.constraint,s=i&&sd(i,tp);return s?new Ql(e,{props:new J({options:s.values.value("options")}),value:t,viewProps:n.viewProps}):new sb(e,{parser:r=>r,props:J.fromObject({formatter:Yv}),value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="string"?null:n.controller.valueController instanceof Ql?new nb(n.controller):null}});const sp={monitor:{defaultInterval:200,defaultRows:3}},py=F("mll");let iG=class{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(py()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("textarea");i.classList.add(py("i")),i.style.height=`calc(var(${vS("containerUnitSize")}) * ${t.rows})`,i.readOnly=!0,t.viewProps.bindDisabled(i),this.element.appendChild(i),this.textareaElem_=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.textareaElem_,t=e.scrollTop===e.scrollHeight-e.clientHeight,i=[];this.value.rawValue.forEach(s=>{s!==void 0&&i.push(this.formatter_(s))}),e.textContent=i.join(`
`),t&&(e.scrollTop=e.scrollHeight)}onValueUpdate_(){this.update_()}},mb=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new iG(e,{formatter:t.formatter,rows:t.rows,value:this.value,viewProps:this.viewProps})}};const my=F("sgl");let sG=class{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(my()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(my("i")),i.readOnly=!0,i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.value.rawValue,t=e[e.length-1];this.inputElement.value=t!==void 0?this.formatter_(t):""}onValueUpdate_(){this.update_()}},vb=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new sG(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}};_t({id:"monitor-bool",type:"monitor",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=ct(e,i=>({readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>dS},controller:n=>{var e;return n.value.rawValue.length===1?new vb(n.document,{formatter:iy,value:n.value,viewProps:n.viewProps}):new mb(n.document,{formatter:iy,rows:(e=n.params.rows)!==null&&e!==void 0?e:sp.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}});let rG=class extends Gw{get max(){return this.controller.valueController.props.get("max")}set max(e){this.controller.valueController.props.set("max",e)}get min(){return this.controller.valueController.props.get("min")}set min(e){this.controller.valueController.props.set("min",e)}};const Ws=F("grl");let oG=class{constructor(e,t){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Ws()),t.viewProps.bindClassModifiers(this.element),this.formatter_=t.formatter,this.props_=t.props,this.cursor_=t.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const i=e.createElementNS(gn,"svg");i.classList.add(Ws("g")),i.style.height=`calc(var(${vS("containerUnitSize")}) * ${t.rows})`,this.element.appendChild(i),this.svgElem_=i;const s=e.createElementNS(gn,"polyline");this.svgElem_.appendChild(s),this.lineElem_=s;const r=e.createElement("div");r.classList.add(Ws("t"),F("tt")()),this.element.appendChild(r),this.tooltipElem_=r,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const e=this.svgElem_.getBoundingClientRect(),t=this.value.rawValue.length-1,i=this.props_.get("min"),s=this.props_.get("max"),r=[];this.value.rawValue.forEach((h,c)=>{if(h===void 0)return;const p=re(c,0,t,0,e.width),d=re(h,i,s,e.height,0);r.push([p,d].join(","))}),this.lineElem_.setAttributeNS(null,"points",r.join(" "));const o=this.tooltipElem_,l=this.value.rawValue[this.cursor_.rawValue];if(l===void 0){o.classList.remove(Ws("t","a"));return}const a=re(this.cursor_.rawValue,0,t,0,e.width),u=re(l,i,s,e.height,0);o.style.left=`${a}px`,o.style.top=`${u}px`,o.textContent=`${this.formatter_(l)}`,o.classList.contains(Ws("t","a"))||(o.classList.add(Ws("t","a"),Ws("t","in")),id(o),o.classList.remove(Ws("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}},KS=class{constructor(e,t){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.cursor_=We(-1),this.view=new oG(e,{cursor:this.cursor_,formatter:t.formatter,rows:t.rows,props:this.props,value:this.value,viewProps:this.viewProps}),!Yw(e))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const i=new Fr(this.view.element);i.emitter.on("down",this.onGraphPointerDown_),i.emitter.on("move",this.onGraphPointerMove_),i.emitter.on("up",this.onGraphPointerUp_)}}importProps(e){return Ni(e,null,t=>({max:t.required.number,min:t.required.number}),t=>(this.props.set("max",t.max),this.props.set("min",t.min),!0))}exportProps(){return Bi(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(e){const t=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(re(e.offsetX,0,t.width,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){if(!e.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(re(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}};function Xv(n){return Me(n.format)?xt(2):n.format}function lG(n){var e;return n.value.rawValue.length===1?new vb(n.document,{formatter:Xv(n.params),value:n.value,viewProps:n.viewProps}):new mb(n.document,{formatter:Xv(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:sp.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}function aG(n){var e,t,i;return new KS(n.document,{formatter:Xv(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:sp.monitor.defaultRows,props:J.fromObject({max:(t=n.params.max)!==null&&t!==void 0?t:100,min:(i=n.params.min)!==null&&i!==void 0?i:0}),value:n.value,viewProps:n.viewProps})}function vy(n){return n.view==="graph"}_t({id:"monitor-number",type:"monitor",accept:(n,e)=>{if(typeof n!="number")return null;const t=ct(e,i=>({format:i.optional.function,max:i.optional.number,min:i.optional.number,readonly:i.required.constant(!0),rows:i.optional.number,view:i.optional.string}));return t?{initialValue:n,params:t}:null},binding:{defaultBufferSize:n=>vy(n)?64:1,reader:n=>Wd},controller:n=>vy(n.params)?aG(n):lG(n),api:n=>n.controller.valueController instanceof KS?new rG(n.controller):null});_t({id:"monitor-string",type:"monitor",accept:(n,e)=>{if(typeof n!="string")return null;const t=ct(e,i=>({multiline:i.optional.boolean,readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>pS},controller:n=>{var e;const t=n.value;return t.rawValue.length>1||n.params.multiline?new mb(n.document,{formatter:Yv,rows:(e=n.params.rows)!==null&&e!==void 0?e:sp.monitor.defaultRows,value:t,viewProps:n.viewProps}):new vb(n.document,{formatter:Yv,value:t,viewProps:n.viewProps})}});const Jn=F("ckr");class uG{constructor(e,t){this.tickElems_=[],this.labelElems_=[],this.boundsWidth_=-1,this.onShowsTooltipChange_=this.onShowsTooltipChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.formatters_=t.formatters,this.unit_=t.unit,this.element=e.createElement("div"),this.element.classList.add(Jn(),Jn(void 0,`m${t.seriesId}`)),t.viewProps.bindClassModifiers(this.element),this.value_=t.value,this.value_.emitter.on("change",this.onValueChange_),t.showsTooltip.emitter.on("change",this.onShowsTooltipChange_);const i=e.createElement("div");i.classList.add(Jn("w")),this.element.appendChild(i),this.offsetElem_=e.createElement("div"),this.offsetElem_.classList.add(Jn("o")),i.appendChild(this.offsetElem_),this.svgElem_=e.createElementNS(gn,"svg"),this.svgElem_.classList.add(Jn("g")),this.offsetElem_.appendChild(this.svgElem_),this.tooltipElem_=e.createElement("div"),this.tooltipElem_.classList.add(F("tt")(),Jn("tt")),this.element.appendChild(this.tooltipElem_),this.waitToBeAdded_()}waitToBeAdded_(){const e=new IntersectionObserver(t=>{t.forEach(i=>{i.target!==this.element||i.intersectionRatio===0||(this.update(),e.disconnect())})},{root:null});e.observe(this.element)}rebuildScaleIfNeeded_(e){if(this.boundsWidth_===e)return;this.boundsWidth_=e,this.tickElems_.forEach(u=>{Uu(u)}),this.tickElems_=[],this.labelElems_.forEach(u=>{Uu(u)}),this.labelElems_=[];const t=this.element.ownerDocument,i=this.unit_.ticks,s=this.unit_.pixels,l=((Math.ceil(e/2/s)+1)*2+1)*i,a=s/i;for(let u=0;u<l;u++){const h=u*a;if(u%i===0){const c=t.createElementNS(gn,"line");c.classList.add(Jn("mjt")),c.setAttributeNS(null,"x1",String(h)),c.setAttributeNS(null,"y1","0"),c.setAttributeNS(null,"x2",String(h)),c.setAttributeNS(null,"y2","2"),this.svgElem_.appendChild(c),this.tickElems_.push(c);const p=t.createElement("div");p.classList.add(Jn("l")),p.style.left=`${h}px`,this.offsetElem_.appendChild(p),this.labelElems_.push(p)}else{const c=t.createElementNS(gn,"line");c.classList.add(Jn("mnt")),c.setAttributeNS(null,"x1",String(h)),c.setAttributeNS(null,"y1","0"),c.setAttributeNS(null,"x2",String(h)),c.setAttributeNS(null,"y2","2"),this.svgElem_.appendChild(c),this.tickElems_.push(c)}}}updateScale_(e){const t=this.unit_.value,i=this.unit_.pixels,s=this.value_.rawValue,r=Math.ceil(e/2/i)+1,o=s-s%t-t*r,l=u=>1-Math.pow(Fe(Math.abs(s-u)/(e/2*(t/i)),0,1),10);this.labelElems_.forEach((u,h)=>{const c=o+h*t;u.textContent=this.formatters_.ring(c),u.style.opacity=String(l(c))});const a=this.unit_.ticks;this.tickElems_.forEach((u,h)=>{const c=o+h/a*t;u.style.opacity=String(l(c))})}update(){const e=this.element.getBoundingClientRect().width,t=this.unit_.value,i=this.unit_.pixels,s=this.value_.rawValue,r=Math.ceil(e/2/i)+1,o=(s%t+t*r)*(i/t),l=e/2-o;this.offsetElem_.style.transform=`translateX(${l}px)`,this.tooltipElem_.textContent=this.formatters_.text(s),this.rebuildScaleIfNeeded_(e),this.updateScale_(e)}onValueChange_(){this.update()}onShowsTooltipChange_(e){e.rawValue?this.element.classList.add(Jn(void 0,"tt")):this.element.classList.remove(Jn(void 0,"tt"))}}class fb{constructor(e,t){this.ox_=0,this.ov_=0,this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.tooltipEnabled_=t.tooltipEnabled,this.unit_=t.unit,this.showsTooltip_=We(!1),this.view=new uG(e,{formatters:t.formatters,seriesId:t.seriesId,showsTooltip:this.showsTooltip_,unit:t.unit,value:this.value,viewProps:this.viewProps});const i=new Fr(this.view.element);i.emitter.on("down",this.onPointerDown_),i.emitter.on("move",this.onPointerMove_),i.emitter.on("up",this.onPointerUp_)}onPointerDown_(e){const t=e.data;t.point&&(this.ox_=t.point.x,this.ov_=this.value.rawValue,this.tooltipEnabled_&&(this.showsTooltip_.rawValue=!0))}onPointerMove_(e){const t=e.data;if(!t.point)return;const i=t.point.x-this.ox_,s=this.unit_.pixels,r=this.unit_.value;this.value.setRawValue(this.ov_-i/s*r,{forceEmit:!1,last:!1})}onPointerUp_(){this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0}),this.showsTooltip_.rawValue=!1}}const Tm=F("ckrtxt");class hG{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Tm());const i=e.createElement("div");i.classList.add(Tm("r")),i.appendChild(t.ringView.element),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Tm("t")),s.appendChild(t.textView.element),this.element.appendChild(s)}}class US{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.rc_=new fb(e,{formatters:{ring:t.ringFormatter,text:t.textProps.get("formatter")},seriesId:t.seriesId,tooltipEnabled:!1,unit:t.ringUnit,value:this.value,viewProps:this.viewProps}),this.tc_=new $a(e,{parser:t.parser,props:t.textProps,value:this.value,viewProps:this.viewProps}),this.view=new hG(e,{ringView:this.rc_.view,textView:this.tc_.view})}}function HS(n){const e=[],t=Hw(n);t&&e.push(t);const i=Uw(n);return i&&e.push(i),new Ea(e)}function cG(n){return n===0||n===1||n===2?n:void 0}function fy(n){return n!==void 0?String(n):"0"}function dG(n){const e=xt(Hv(n.value));return t=>{const i=e(t),s=i.substr(0,1);return i+(s==="-"||s==="+"?" ":"")}}_t({id:"input-ring",type:"input",accept(n,e){if(typeof n!="number")return null;const t=ct(e,i=>Object.assign(Object.assign({},Qd(i)),{series:i.optional.custom(cG),unit:i.optional.object({pixels:i.required.number,ticks:i.required.number,value:i.required.number}),view:i.required.constant("cameraring"),wide:i.optional.boolean}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>Wd,constraint:n=>HS(n.params),writer:n=>Uo},controller(n){var e,t,i;const s=(e=n.params.unit)!==null&&e!==void 0?e:{ticks:5,pixels:40,value:10},r=dG(s),o=Zd(n.params,n.initialValue);if(n.params.wide)return new fb(n.document,{formatters:{ring:r,text:o.formatter},seriesId:(t=fy(n.params.series))!==null&&t!==void 0?t:"0",tooltipEnabled:!0,unit:s,value:n.value,viewProps:n.viewProps});const l=J.fromObject(o);return new US(n.document,{parser:Pi,ringFormatter:r,ringUnit:s,seriesId:(i=fy(n.params.series))!==null&&i!==void 0?i:"0",textProps:l,value:n.value,viewProps:n.viewProps})}});_t({id:"input-wheel",type:"input",accept(n,e){if(typeof n!="number")return null;const t=ct(e,i=>Object.assign(Object.assign({},Qd(i)),{amount:i.optional.number,view:i.required.constant("camerawheel"),wide:i.optional.boolean}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>Wd,constraint:n=>HS(n.params),writer:n=>Uo},controller(n){var e,t;const i=xt(0),s=Zd(n.params,n.initialValue);return n.params.wide?new fb(n.document,{formatters:{ring:i,text:s.formatter},seriesId:"w",tooltipEnabled:!0,unit:{ticks:10,pixels:40,value:((e=n.params.amount)!==null&&e!==void 0?e:s.pointerScale)*40},value:n.value,viewProps:n.viewProps}):new US(n.document,{parser:Pi,ringFormatter:i,ringUnit:{ticks:10,pixels:40,value:((t=n.params.amount)!==null&&t!==void 0?t:s.pointerScale)*40},seriesId:"w",textProps:J.fromObject(s),value:n.value,viewProps:n.viewProps})}});function Ee(n){return n==null}function _b(n){return n!==null&&typeof n=="object"}function Wv(n){return n!==null&&typeof n=="object"}function pG(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function xo(n,e){return Array.from(new Set([...Object.keys(n),...Object.keys(e)])).reduce((i,s)=>{const r=n[s],o=e[s];return Wv(r)&&Wv(o)?Object.assign(Object.assign({},i),{[s]:xo(r,o)}):Object.assign(Object.assign({},i),{[s]:s in e?o:r})},{})}function mG(n){return _b(n)?"target"in n:!1}const vG={alreadydisposed:()=>"View has been already disposed",invalidparams:n=>`Invalid parameters for '${n.name}'`,nomatchingcontroller:n=>`No matching controller for '${n.key}'`,nomatchingview:n=>`No matching view for '${JSON.stringify(n.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:n=>`Not compatible with  plugin '${n.id}'`,propertynotfound:n=>`Property '${n.name}' not found`,shouldneverhappen:()=>"This error should never happen"};let Ss=class El{static alreadyDisposed(){return new El({type:"alreadydisposed"})}static notBindable(){return new El({type:"notbindable"})}static notCompatible(e,t){return new El({type:"notcompatible",context:{id:`${e}.${t}`}})}static propertyNotFound(e){return new El({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new El({type:"shouldneverhappen"})}constructor(e){var t;this.message=(t=vG[e.type](e.context))!==null&&t!==void 0?t:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}toString(){return this.message}},_y=class zS{constructor(e,t){this.obj_=e,this.key=t}static isBindable(e){return!(e===null||typeof e!="object"&&typeof e!="function")}read(){return this.obj_[this.key]}write(e){this.obj_[this.key]=e}writeProperty(e,t){const i=this.read();if(!zS.isBindable(i))throw Ss.notBindable();if(!(e in i))throw Ss.propertyNotFound(e);i[e]=t}},Vn=class{constructor(){this.observers_={}}on(e,t){let i=this.observers_[e];return i||(i=this.observers_[e]=[]),i.push({handler:t}),this}off(e,t){const i=this.observers_[e];return i&&(this.observers_[e]=i.filter(s=>s.handler!==t)),this}emit(e,t){const i=this.observers_[e];i&&i.forEach(s=>{s.handler(t)})}},fG=class{constructor(e,t){var i;this.constraint_=t?.constraint,this.equals_=(i=t?.equals)!==null&&i!==void 0?i:(s,r)=>s===r,this.emitter=new Vn,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},s=this.constraint_?this.constraint_.constrain(e):e,r=this.rawValue_;this.equals_(r,s)&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=s,this.emitter.emit("change",{options:i,previousRawValue:r,rawValue:s,sender:this}))}},_G=class{constructor(e){this.emitter=new Vn,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},s=this.value_;s===e&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:i,previousRawValue:s,rawValue:this.value_,sender:this}))}},wG=class{constructor(e){this.emitter=new Vn,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}};function Ze(n,e){const t=e?.constraint,i=e?.equals;return!t&&!i?new _G(n):new fG(n,e)}function bG(n){return[new wG(n),(e,t)=>{n.setRawValue(e,t)}]}let ee=class qS{constructor(e){this.emitter=new Vn,this.valMap_=e;for(const t in this.valMap_)this.valMap_[t].emitter.on("change",()=>{this.emitter.emit("change",{key:t,sender:this})})}static createCore(e){return Object.keys(e).reduce((i,s)=>Object.assign(i,{[s]:Ze(e[s])}),{})}static fromObject(e){const t=this.createCore(e);return new qS(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}},rp=class{constructor(e){this.values=ee.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");return Math.min(Math.max(e,i),t)}},GS=class{constructor(e){this.values=ee.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");let s=e;return Ee(i)||(s=Math.max(s,i)),Ee(t)||(s=Math.min(s,t)),s}},YS=class{constructor(e,t=0){this.step=e,this.origin=t}constrain(e){const t=this.origin%this.step,i=Math.round((e-t)/this.step);return t+i*this.step}},gG=class{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}};const CG={"**":(n,e)=>Math.pow(n,e),"*":(n,e)=>n*e,"/":(n,e)=>n/e,"%":(n,e)=>n%e,"+":(n,e)=>n+e,"-":(n,e)=>n-e,"<<":(n,e)=>n<<e,">>":(n,e)=>n>>e,">>>":(n,e)=>n>>>e,"&":(n,e)=>n&e,"^":(n,e)=>n^e,"|":(n,e)=>n|e};let PG=class{constructor(e,t,i){this.left=t,this.operator=e,this.right=i}evaluate(){const e=CG[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}};const yG={"+":n=>n,"-":n=>-n,"~":n=>~n};let EG=class{constructor(e,t){this.operator=e,this.expression=t}evaluate(){const e=yG[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}};function wb(n){return(e,t)=>{for(let i=0;i<n.length;i++){const s=n[i](e,t);if(s!=="")return s}return""}}function qu(n,e){var t;const i=n.substr(e).match(/^\s+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function xG(n,e){const t=n.substr(e,1);return t.match(/^[1-9]$/)?t:""}function Gu(n,e){var t;const i=n.substr(e).match(/^[0-9]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function $G(n,e){const t=Gu(n,e);if(t!=="")return t;const i=n.substr(e,1);if(e+=1,i!=="-"&&i!=="+")return"";const s=Gu(n,e);return s===""?"":i+s}function bb(n,e){const t=n.substr(e,1);if(e+=1,t.toLowerCase()!=="e")return"";const i=$G(n,e);return i===""?"":t+i}function XS(n,e){const t=n.substr(e,1);if(t==="0")return t;const i=xG(n,e);return e+=i.length,i===""?"":i+Gu(n,e)}function VG(n,e){const t=XS(n,e);if(e+=t.length,t==="")return"";const i=n.substr(e,1);if(e+=i.length,i!==".")return"";const s=Gu(n,e);return e+=s.length,t+i+s+bb(n,e)}function kG(n,e){const t=n.substr(e,1);if(e+=t.length,t!==".")return"";const i=Gu(n,e);return e+=i.length,i===""?"":t+i+bb(n,e)}function SG(n,e){const t=XS(n,e);return e+=t.length,t===""?"":t+bb(n,e)}const LG=wb([VG,kG,SG]);function AG(n,e){var t;const i=n.substr(e).match(/^[01]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function MG(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0b")return"";const i=AG(n,e);return i===""?"":t+i}function TG(n,e){var t;const i=n.substr(e).match(/^[0-7]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function DG(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0o")return"";const i=TG(n,e);return i===""?"":t+i}function RG(n,e){var t;const i=n.substr(e).match(/^[0-9a-f]+/i);return(t=i&&i[0])!==null&&t!==void 0?t:""}function OG(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0x")return"";const i=RG(n,e);return i===""?"":t+i}const jG=wb([MG,DG,OG]),NG=wb([jG,LG]);function BG(n,e){const t=NG(n,e);return e+=t.length,t===""?null:{evaluable:new gG(t),cursor:e}}function IG(n,e){const t=n.substr(e,1);if(e+=t.length,t!=="(")return null;const i=ZS(n,e);if(!i)return null;e=i.cursor,e+=qu(n,e).length;const s=n.substr(e,1);return e+=s.length,s!==")"?null:{evaluable:i.evaluable,cursor:e}}function FG(n,e){var t;return(t=BG(n,e))!==null&&t!==void 0?t:IG(n,e)}function WS(n,e){const t=FG(n,e);if(t)return t;const i=n.substr(e,1);if(e+=i.length,i!=="+"&&i!=="-"&&i!=="~")return null;const s=WS(n,e);return s?(e=s.cursor,{cursor:e,evaluable:new EG(i,s.evaluable)}):null}function KG(n,e,t){t+=qu(e,t).length;const i=n.filter(s=>e.startsWith(s,t))[0];return i?(t+=i.length,t+=qu(e,t).length,{cursor:t,operator:i}):null}function UG(n,e){return(t,i)=>{const s=n(t,i);if(!s)return null;i=s.cursor;let r=s.evaluable;for(;;){const o=KG(e,t,i);if(!o)break;i=o.cursor;const l=n(t,i);if(!l)return null;i=l.cursor,r=new PG(o.operator,r,l.evaluable)}return r?{cursor:i,evaluable:r}:null}}const HG=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((n,e)=>UG(n,e),WS);function ZS(n,e){return e+=qu(n,e).length,HG(n,e)}function zG(n){const e=ZS(n,0);return!e||e.cursor+qu(n,e.cursor).length!==n.length?null:e.evaluable}function xi(n){var e;const t=zG(n);return(e=t?.evaluate())!==null&&e!==void 0?e:null}function QS(n){if(typeof n=="number")return n;if(typeof n=="string"){const e=xi(n);if(!Ee(e))return e}return 0}function Ht(n){return e=>e.toFixed(Math.max(Math.min(n,20),0))}function oe(n,e,t,i,s){const r=(n-e)/(t-e);return i+r*(s-i)}function wy(n){return String(n.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function qe(n,e,t){return Math.min(Math.max(n,e),t)}function JS(n,e){return(n%e+e)%e}function qG(n,e){return Ee(n.step)?Math.max(wy(e),2):wy(n.step)}function eL(n){var e;return(e=n.step)!==null&&e!==void 0?e:1}function GG(n,e){var t;const i=Math.abs((t=n.step)!==null&&t!==void 0?t:e);return i===0?.1:Math.pow(10,Math.floor(Math.log10(i))-1)}function tL(n,e){return Ee(n.step)?null:new YS(n.step,e)}function nL(n){return!Ee(n.max)&&!Ee(n.min)?new rp({max:n.max,min:n.min}):!Ee(n.max)||!Ee(n.min)?new GS({max:n.max,min:n.min}):null}function iL(n,e){var t,i,s;return{formatter:(t=n.format)!==null&&t!==void 0?t:Ht(qG(n,e)),keyScale:(i=n.keyScale)!==null&&i!==void 0?i:eL(n),pointerScale:(s=n.pointerScale)!==null&&s!==void 0?s:GG(n,e)}}function sL(n){return{format:n.optional.function,keyScale:n.optional.number,max:n.optional.number,min:n.optional.number,pointerScale:n.optional.number,step:n.optional.number}}function gb(n){return{constraint:n.constraint,textProps:ee.fromObject(iL(n.params,n.initialValue))}}let Cb=class{constructor(e){this.controller=e}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(e){this.controller.viewProps.set("disabled",e)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(e){this.controller.viewProps.set("hidden",e)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(e){return this.controller.importState(e)}exportState(){return this.controller.exportState()}},op=class{constructor(e){this.target=e}},rL=class extends op{constructor(e,t,i){super(e),this.value=t,this.last=i??!0}},YG=class extends op{constructor(e,t){super(e),this.expanded=t}},XG=class extends op{constructor(e,t){super(e),this.index=t}},Pb=class extends Cb{constructor(e){super(e),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new Vn,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(e){this.controller.tag=e}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}refresh(){this.controller.value.fetch()}onValueChange_(e){const t=this.controller.value;this.emitter_.emit("change",new rL(this,t.binding.target.read(),e.options.last))}};function WG(n,e){const i=Object.keys(e).reduce((s,r)=>{if(s===void 0)return;const o=e[r],l=o(n[r]);return l.succeeded?Object.assign(Object.assign({},s),{[r]:l.value}):void 0},{});return i}function ZG(n,e){return n.reduce((t,i)=>{if(t===void 0)return;const s=e(i);if(!(!s.succeeded||s.value===void 0))return[...t,s.value]},[])}function QG(n){return n===null?!1:typeof n=="object"}function es(n){return e=>t=>{if(!e&&t===void 0)return{succeeded:!1,value:void 0};if(e&&t===void 0)return{succeeded:!0,value:void 0};const i=n(t);return i!==void 0?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}function by(n){return{custom:e=>es(e)(n),boolean:es(e=>typeof e=="boolean"?e:void 0)(n),number:es(e=>typeof e=="number"?e:void 0)(n),string:es(e=>typeof e=="string"?e:void 0)(n),function:es(e=>typeof e=="function"?e:void 0)(n),constant:e=>es(t=>t===e?e:void 0)(n),raw:es(e=>e)(n),object:e=>es(t=>{if(QG(t))return WG(t,e)})(n),array:e=>es(t=>{if(Array.isArray(t))return ZG(t,e)})(n)}}const Zv={optional:by(!0),required:by(!1)};function dt(n,e){const t=e(Zv),i=Zv.required.object(t)(n);return i.succeeded?i.value:void 0}function Ii(n,e,t,i){if(e&&!e(n))return!1;const s=dt(n,t);return s?i(s):!1}function Fi(n,e){var t;return xo((t=n?.())!==null&&t!==void 0?t:{},e)}function Sc(n){return"value"in n}function JG(n){if(!_b(n)||!("binding"in n))return!1;const e=n.binding;return mG(e)}const rt="http://www.w3.org/2000/svg";function od(n){n.offsetHeight}function e9(n,e){const t=n.style.transition;n.style.transition="none",e(),n.style.transition=t}function lp(n){return n.ontouchstart!==void 0}function t9(n){const e=n.ownerDocument.defaultView;return e&&"document"in e?n.getContext("2d",{willReadFrequently:!0}):null}const n9={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function ap(n,e){const t=n.createElementNS(rt,"svg");return t.innerHTML=n9[e],t}function oL(n,e,t){n.insertBefore(e,n.children[t])}function yb(n){n.parentElement&&n.parentElement.removeChild(n)}function lL(n){for(;n.children.length>0;)n.removeChild(n.children[0])}function i9(n){for(;n.childNodes.length>0;)n.removeChild(n.childNodes[0])}function Eb(n){return n.relatedTarget?n.relatedTarget:"explicitOriginalTarget"in n?n.explicitOriginalTarget:null}function ws(n,e){n.emitter.on("change",t=>{e(t.rawValue)}),e(n.rawValue)}function ni(n,e,t){ws(n.value(e),t)}const s9="tp";function K(n){return(t,i)=>[s9,"-",n,"v",t?`_${t}`:"",i?`-${i}`:""].join("")}const ru=K("lbl");function r9(n,e){const t=n.createDocumentFragment();return e.split(`
`).map(s=>n.createTextNode(s)).forEach((s,r)=>{r>0&&t.appendChild(n.createElement("br")),t.appendChild(s)}),t}let o9=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(ru()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(ru("l")),ni(t.props,"label",r=>{Ee(r)?this.element.classList.add(ru(void 0,"nol")):(this.element.classList.remove(ru(void 0,"nol")),i9(i),i.appendChild(r9(e,r)))}),this.element.appendChild(i),this.labelElement=i;const s=e.createElement("div");s.classList.add(ru("v")),this.element.appendChild(s),this.valueElement=s}},l9=class{constructor(e,t){this.props=t.props,this.valueController=t.valueController,this.viewProps=t.valueController.viewProps,this.view=new o9(e,{props:t.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(e){return Ii(e,null,t=>({label:t.optional.string}),t=>(this.props.set("label",t.label),!0))}exportProps(){return Fi(null,{label:this.props.get("label")})}};function a9(){return["veryfirst","first","last","verylast"]}const gy=K(""),Cy={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};let aL=class{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",()=>{a9().forEach(i=>{t.classList.remove(gy(void 0,Cy[i]))}),this.blade.get("positions").forEach(i=>{t.classList.add(gy(void 0,Cy[i]))})}),this.viewProps.handleDispose(()=>{yb(t)})}get parent(){return this.parent_}set parent(e){this.parent_=e,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(e){return Ii(e,null,t=>({disabled:t.required.boolean,hidden:t.required.boolean}),t=>(this.viewProps.importState(t),!0))}exportState(){return Fi(null,Object.assign({},this.viewProps.exportState()))}},u9=class extends Cb{get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get title(){var e;return(e=this.controller.buttonController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.buttonController.props.set("title",e)}on(e,t){const i=t.bind(this);return this.controller.buttonController.emitter.on(e,()=>{i(new op(this))}),this}};function h9(n,e,t){t?n.classList.add(e):n.classList.remove(e)}function Ho(n,e){return t=>{h9(n,e,t)}}function xb(n,e){ws(n,t=>{e.textContent=t??""})}const Dm=K("btn");let c9=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Dm()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("button");i.classList.add(Dm("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(Dm("t")),xb(t.props.value("title"),s),this.buttonElement.appendChild(s)}},d9=class{constructor(e,t){this.emitter=new Vn,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new c9(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(e){return Ii(e,null,t=>({title:t.optional.string}),t=>(this.props.set("title",t.title),!0))}exportProps(){return Fi(null,{title:this.props.get("title")})}onClick_(){this.emitter.emit("click",{sender:this})}},Py=class extends aL{constructor(e,t){const i=new d9(e,{props:t.buttonProps,viewProps:t.viewProps}),s=new l9(e,{blade:t.blade,props:t.labelProps,valueController:i});super({blade:t.blade,view:s.view,viewProps:t.viewProps}),this.buttonController=i,this.labelController=s}importState(e){return Ii(e,t=>super.importState(t)&&this.buttonController.importProps(t)&&this.labelController.importProps(t),()=>({}),()=>!0)}exportState(){return Fi(()=>super.exportState(),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}},p9=class{constructor(e){const[t,i]=e.split("-"),s=t.split(".");this.major=parseInt(s[0],10),this.minor=parseInt(s[1],10),this.patch=parseInt(s[2],10),this.prerelease=i??null}toString(){const e=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[e,this.prerelease].join("-"):e}};const m9=new p9("2.0.1");function wt(n){return Object.assign({core:m9},n)}wt({id:"button",type:"blade",accept(n){const e=dt(n,t=>({title:t.required.string,view:t.required.constant("button"),label:t.optional.string}));return e?{params:e}:null},controller(n){return new Py(n.document,{blade:n.blade,buttonProps:ee.fromObject({title:n.params.title}),labelProps:ee.fromObject({label:n.params.label}),viewProps:n.viewProps})},api(n){return n.controller instanceof Py?new u9(n.controller):null}});function v9(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}function f9(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}function _9(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}function w9(n){return _b(n)?"refresh"in n&&typeof n.refresh=="function":!1}function b9(n,e){if(!_y.isBindable(n))throw Ss.notBindable();return new _y(n,e)}let g9=class{constructor(e,t){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=e,this.emitter_=new Vn,this.pool_=t,this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map(e=>this.pool_.createApi(e))}addBinding(e,t,i){const s=i??{},r=this.controller_.element.ownerDocument,o=this.pool_.createBinding(r,b9(e,t),s),l=this.pool_.createBindingApi(o);return this.add(l,s.index)}addFolder(e){return f9(this,e)}addButton(e){return v9(this,e)}addTab(e){return _9(this,e)}add(e,t){const i=e.controller;return this.controller_.rack.add(i,t),e}remove(e){this.controller_.rack.remove(e.controller)}addBlade(e){const t=this.controller_.element.ownerDocument,i=this.pool_.createBlade(t,e),s=this.pool_.createApi(i);return this.add(s,e.index)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}refresh(){this.children.forEach(e=>{w9(e)&&e.refresh()})}onRackValueChange_(e){const t=e.bladeController,i=this.pool_.createApi(t),s=JG(t.value)?t.value.binding:null;this.emitter_.emit("change",new rL(i,s?s.target.read():t.value.rawValue,e.options.last))}},$b=class extends Cb{constructor(e,t){super(e),this.rackApi_=new g9(e.rackController,t)}refresh(){this.rackApi_.refresh()}},Vb=class extends aL{constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps}),this.rackController=e.rackController}importState(e){return Ii(e,t=>super.importState(t),t=>({children:t.required.array(t.required.raw)}),t=>this.rackController.rack.children.every((i,s)=>i.importState(t.children[s])))}exportState(){return Fi(()=>super.exportState(),{children:this.rackController.rack.children.map(e=>e.exportState())})}};function Qv(n){return"rackController"in n}let C9=class{constructor(e){this.emitter=new Vn,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const t of this.allItems())if(e(t))return t;return null}includes(e){return this.cache_.has(e)}add(e,t){if(this.includes(e))throw Ss.shouldNeverHappen();const i=t!==void 0?t:this.items_.length;this.items_.splice(i,0,e),this.cache_.add(e);const s=this.extract_(e);s&&(s.emitter.on("add",this.onSubListAdd_),s.emitter.on("remove",this.onSubListRemove_),s.allItems().forEach(r=>{this.cache_.add(r)})),this.emitter.emit("add",{index:i,item:e,root:this,target:this})}remove(e){const t=this.items_.indexOf(e);if(t<0)return;this.items_.splice(t,1),this.cache_.delete(e);const i=this.extract_(e);i&&(i.allItems().forEach(s=>{this.cache_.delete(s)}),i.emitter.off("add",this.onSubListAdd_),i.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}};function P9(n,e){for(let t=0;t<n.length;t++){const i=n[t];if(Sc(i)&&i.value===e)return i}return null}function y9(n){return Qv(n)?n.rackController.rack.bcSet_:null}let E9=class{constructor(e){var t,i;this.emitter=new Vn,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=(t=e.blade)!==null&&t!==void 0?t:null,(i=this.blade_)===null||i===void 0||i.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=e.viewProps,this.bcSet_=new C9(y9),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,t){var i;(i=e.parent)===null||i===void 0||i.remove(e),e.parent=this,this.bcSet_.add(e,t)}remove(e){e.parent=null,this.bcSet_.remove(e)}find(e){return this.bcSet_.allItems().filter(e)}onSetAdd_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,root:t,sender:this}),!t)return;const i=e.item;if(i.viewProps.emitter.on("change",this.onChildViewPropsChange_),i.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),i.viewProps.handleDispose(this.onChildDispose_),Sc(i))i.value.emitter.on("change",this.onChildValueChange_);else if(Qv(i)){const s=i.rackController.rack;if(s){const r=s.emitter;r.on("layout",this.onRackLayout_),r.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,root:t,sender:this}),!t)return;const i=e.item;if(Sc(i))i.value.emitter.off("change",this.onChildValueChange_);else if(Qv(i)){const s=i.rackController.rack;if(s){const r=s.emitter;r.off("layout",this.onRackLayout_),r.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){const e=this.bcSet_.items.filter(s=>!s.viewProps.get("hidden")),t=e[0],i=e[e.length-1];this.bcSet_.items.forEach(s=>{const r=[];s===t&&(r.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&r.push("veryfirst")),s===i&&(r.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&r.push("verylast")),s.blade.set("positions",r)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(t=>t.viewProps.get("disposed")).forEach(t=>{this.bcSet_.remove(t)})}onChildValueChange_(e){const t=P9(this.find(Sc),e.sender);if(!t)throw Ss.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:t,options:e.options,sender:this})}onRackLayout_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(e){this.emitter.emit("valuechange",{bladeController:e.bladeController,options:e.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}},kb=class{constructor(e){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=e.element,this.viewProps=e.viewProps;const t=new E9({blade:e.root?void 0:e.blade,viewProps:e.viewProps});t.emitter.on("add",this.onRackAdd_),t.emitter.on("remove",this.onRackRemove_),this.rack=t,this.viewProps.handleDispose(()=>{for(let i=this.rack.children.length-1;i>=0;i--)this.rack.children[i].viewProps.set("disposed",!0)})}onRackAdd_(e){e.root&&oL(this.element,e.bladeController.view.element,e.index)}onRackRemove_(e){e.root&&yb(e.bladeController.view.element)}};function uL(){return new ee({positions:Ze([],{equals:pG})})}let up=class hL extends ee{constructor(e){super(e)}static create(e){const t={completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},i=ee.createCore(t);return new hL(i)}get styleExpanded(){var e;return(e=this.get("temporaryExpanded"))!==null&&e!==void 0?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!Ee(e)?`${e}px`:"auto"}bindExpandedClass(e,t){const i=()=>{this.styleExpanded?e.classList.add(t):e.classList.remove(t)};ni(this,"expanded",i),ni(this,"temporaryExpanded",i)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}};function x9(n,e){let t=0;return e9(e,()=>{n.set("expandedHeight",null),n.set("temporaryExpanded",!0),od(e),t=e.clientHeight,n.set("temporaryExpanded",null),od(e)}),t}function yy(n,e){e.style.height=n.styleHeight}function hp(n,e){n.value("expanded").emitter.on("beforechange",()=>{if(n.set("completed",!1),Ee(n.get("expandedHeight"))){const t=x9(n,e);t>0&&n.set("expandedHeight",t)}n.set("shouldFixHeight",!0),od(e)}),n.emitter.on("change",()=>{yy(n,e)}),yy(n,e),e.addEventListener("transitionend",t=>{t.propertyName==="height"&&n.cleanUpTransition()})}let $9=class extends $b{constructor(e,t){super(e,t),this.emitter_=new Vn,this.controller.foldable.value("expanded").emitter.on("change",i=>{this.emitter_.emit("fold",new YG(this,i.sender.rawValue))}),this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)})}get expanded(){return this.controller.foldable.get("expanded")}set expanded(e){this.controller.foldable.set("expanded",e)}get title(){return this.controller.props.get("title")}set title(e){this.controller.props.set("title",e)}get children(){return this.rackApi_.children}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){return this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}};const cL=K("cnt");let V9=class{constructor(e,t){var i;this.className_=K((i=t.viewName)!==null&&i!==void 0?i:"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),cL()),t.viewProps.bindClassModifiers(this.element),this.foldable_=t.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),ni(this.foldable_,"completed",Ho(this.element,this.className_(void 0,"cpl")));const s=e.createElement("button");s.classList.add(this.className_("b")),ni(t.props,"title",u=>{Ee(u)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s;const r=e.createElement("div");r.classList.add(this.className_("i")),this.element.appendChild(r);const o=e.createElement("div");o.classList.add(this.className_("t")),xb(t.props.value("title"),o),this.buttonElement.appendChild(o),this.titleElement=o;const l=e.createElement("div");l.classList.add(this.className_("m")),this.buttonElement.appendChild(l);const a=e.createElement("div");a.classList.add(this.className_("c")),this.element.appendChild(a),this.containerElement=a}},Ey=class extends Vb{constructor(e,t){var i;const s=up.create((i=t.expanded)!==null&&i!==void 0?i:!0),r=new V9(e,{foldable:s,props:t.props,viewName:t.root?"rot":void 0,viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new kb({blade:t.blade,element:r.containerElement,root:t.root,viewProps:t.viewProps}),view:r})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=t.props,this.foldable=s,hp(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(e){return Ii(e,t=>super.importState(t),t=>({expanded:t.required.boolean,title:t.optional.string}),t=>(this.foldable.set("expanded",t.expanded),this.props.set("title",t.title),!0))}exportState(){return Fi(()=>super.exportState(),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}};wt({id:"folder",type:"blade",accept(n){const e=dt(n,t=>({title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean}));return e?{params:e}:null},controller(n){return new Ey(n.document,{blade:n.blade,expanded:n.params.expanded,props:ee.fromObject({title:n.params.title}),viewProps:n.viewProps})},api(n){return n.controller instanceof Ey?new $9(n.controller,n.pool):null}});const k9=K("");function xy(n,e){return Ho(n,k9(void 0,e))}let Sb=class dL extends ee{constructor(e){var t;super(e),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=bG(Ze(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(e){var t,i,s;const r=e??{};return new dL(ee.createCore({disabled:(t=r.disabled)!==null&&t!==void 0?t:!1,disposed:!1,hidden:(i=r.hidden)!==null&&i!==void 0?i:!1,parent:(s=r.parent)!==null&&s!==void 0?s:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(e){ws(this.globalDisabled_,xy(e,"disabled")),ni(this,"hidden",xy(e,"hidden"))}bindDisabled(e){ws(this.globalDisabled_,t=>{e.disabled=t})}bindTabIndex(e){ws(this.globalDisabled_,t=>{e.tabIndex=t?-1:0})}handleDispose(e){this.value("disposed").emitter.on("change",t=>{t&&e()})}importState(e){this.set("disabled",e.disabled),this.set("hidden",e.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){const e=this.get("parent");return(e?e.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(e){var t;const i=e.previousRawValue;i?.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}};const $y=K("tbp");let S9=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add($y()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add($y("c")),this.element.appendChild(i),this.containerElement=i}};const ou=K("tbi");let L9=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(ou()),t.viewProps.bindClassModifiers(this.element),ni(t.props,"selected",r=>{r?this.element.classList.add(ou(void 0,"sel")):this.element.classList.remove(ou(void 0,"sel"))});const i=e.createElement("button");i.classList.add(ou("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(ou("t")),xb(t.props.value("title"),s),this.buttonElement.appendChild(s),this.titleElement=s}},A9=class{constructor(e,t){this.emitter=new Vn,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new L9(e,{props:t.props,viewProps:t.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}},Jv=class extends Vb{constructor(e,t){const i=new S9(e,{viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new kb({blade:t.blade,element:i.containerElement,viewProps:t.viewProps}),view:i})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new A9(e,{props:t.itemProps,viewProps:Sb.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=t.props,ni(this.props,"selected",s=>{this.itemController.props.set("selected",s),this.viewProps.set("hidden",!s)})}get itemController(){return this.ic_}importState(e){return Ii(e,t=>super.importState(t),t=>({selected:t.required.boolean,title:t.required.string}),t=>(this.ic_.props.set("selected",t.selected),this.ic_.props.set("title",t.title),!0))}exportState(){return Fi(()=>super.exportState(),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}},M9=class extends $b{constructor(e,t){super(e,t),this.emitter_=new Vn,this.onSelect_=this.onSelect_.bind(this),this.pool_=t,this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)}),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(e){const t=this.controller.view.element.ownerDocument,i=new Jv(t,{blade:uL(),itemProps:ee.fromObject({selected:!1,title:e.title}),props:ee.fromObject({selected:!1}),viewProps:Sb.create()}),s=this.pool_.createApi(i);return this.rackApi_.add(s,e.index)}removePage(e){this.rackApi_.remove(this.rackApi_.children[e])}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}onSelect_(e){this.emitter_.emit("select",new XG(this,e.rawValue))}},T9=class extends $b{get title(){var e;return(e=this.controller.itemController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.itemController.props.set("title",e)}get selected(){return this.controller.props.get("selected")}set selected(e){this.controller.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addBlade(e){return this.rackApi_.addBlade(e)}};const Vy=-1;let D9=class{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=Ze(!0),this.selectedIndex=Ze(Vy),this.items_=[]}add(e,t){const i=t??this.items_.length;this.items_.splice(i,0,e),e.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(e){const t=this.items_.indexOf(e);t<0||(this.items_.splice(t,1),e.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=Vy,this.empty.rawValue=!0;return}const e=this.items_.findIndex(t=>t.rawValue);e<0?(this.items_.forEach((t,i)=>{t.rawValue=i===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((t,i)=>{t.rawValue=i===e}),this.selectedIndex.rawValue=e),this.empty.rawValue=!1}onItemSelectedChange_(e){if(e.rawValue){const t=this.items_.findIndex(i=>i===e.sender);this.items_.forEach((i,s)=>{i.rawValue=s===t}),this.selectedIndex.rawValue=t}else this.keepSelection_()}};const lu=K("tab");let R9=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(lu(),cL()),t.viewProps.bindClassModifiers(this.element),ws(t.empty,Ho(this.element,lu(void 0,"nop")));const i=e.createElement("div");i.classList.add(lu("t")),this.element.appendChild(i),this.itemsElement=i;const s=e.createElement("div");s.classList.add(lu("i")),this.element.appendChild(s);const r=e.createElement("div");r.classList.add(lu("c")),this.element.appendChild(r),this.contentsElement=r}},ky=class extends Vb{constructor(e,t){const i=new D9,s=new R9(e,{empty:i.empty,viewProps:t.viewProps});super({blade:t.blade,rackController:new kb({blade:t.blade,element:s.contentsElement,viewProps:t.viewProps}),view:s}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const r=this.rackController.rack;r.emitter.on("add",this.onRackAdd_),r.emitter.on("remove",this.onRackRemove_),this.tab=i}add(e,t){this.rackController.rack.add(e,t)}remove(e){this.rackController.rack.remove(this.rackController.rack.children[e])}onRackAdd_(e){if(!e.root)return;const t=e.bladeController;oL(this.view.itemsElement,t.itemController.view.element,e.index),t.itemController.viewProps.set("parent",this.viewProps),this.tab.add(t.props.value("selected"))}onRackRemove_(e){if(!e.root)return;const t=e.bladeController;yb(t.itemController.view.element),t.itemController.viewProps.set("parent",null),this.tab.remove(t.props.value("selected"))}};wt({id:"tab",type:"blade",accept(n){const e=dt(n,t=>({pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")}));return!e||e.pages.length===0?null:{params:e}},controller(n){const e=new ky(n.document,{blade:n.blade,viewProps:n.viewProps});return n.params.pages.forEach(t=>{const i=new Jv(n.document,{blade:uL(),itemProps:ee.fromObject({selected:!1,title:t.title}),props:ee.fromObject({selected:!1}),viewProps:Sb.create()});e.add(i)}),e},api(n){return n.controller instanceof ky?new M9(n.controller,n.pool):n.controller instanceof Jv?new T9(n.controller,n.pool):null}});let Lb=class extends Pb{get options(){return this.controller.valueController.props.get("options")}set options(e){this.controller.valueController.props.set("options",e)}},Va=class{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce((t,i)=>i.constrain(t),e)}};function ld(n,e){if(n instanceof e)return n;if(n instanceof Va){const t=n.constraints.reduce((i,s)=>i||(s instanceof e?s:null),null);if(t)return t}return null}let cp=class{constructor(e){this.values=ee.fromObject({options:e})}constrain(e){const t=this.values.get("options");return t.length===0||t.filter(s=>s.value===e).length>0?e:t[0].value}};function dp(n){var e;const t=Zv;if(Array.isArray(n))return(e=dt({items:n},i=>({items:i.required.array(i.required.object({text:i.required.string,value:i.required.raw}))})))===null||e===void 0?void 0:e.items;if(typeof n=="object")return t.required.raw(n).value}function pL(n){if(Array.isArray(n))return n;const e=[];return Object.keys(n).forEach(t=>{e.push({text:t,value:n[t]})}),e}function Ab(n){return Ee(n)?null:new cp(pL(n))}const Rm=K("lst");let O9=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add(Rm()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("select");i.classList.add(Rm("s")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.selectElement=i;const s=e.createElement("div");s.classList.add(Rm("m")),s.appendChild(ap(e,"dropdown")),this.element.appendChild(s),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,ni(this.props_,"options",r=>{lL(this.selectElement),r.forEach(o=>{const l=e.createElement("option");l.textContent=o.text,this.selectElement.appendChild(l)}),this.update_()})}update_(){const e=this.props_.get("options").map(t=>t.value);this.selectElement.selectedIndex=e.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}},ea=class{constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new O9(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const t=e.currentTarget;this.value.rawValue=this.props.get("options")[t.selectedIndex].value}importProps(e){return Ii(e,null,t=>({options:t.required.custom(dp)}),t=>(this.props.set("options",pL(t.options)),!0))}exportProps(){return Fi(null,{options:this.props.get("options")})}};const Sy=K("pop");let j9=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Sy()),t.viewProps.bindClassModifiers(this.element),ws(t.shows,Ho(this.element,Sy(void 0,"v")))}},Mb=class{constructor(e,t){this.shows=Ze(!1),this.viewProps=t.viewProps,this.view=new j9(e,{shows:this.shows,viewProps:this.viewProps})}};const Ly=K("txt");let N9=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Ly()),t.viewProps.bindClassModifiers(this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);const i=e.createElement("input");i.classList.add(Ly("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}},Tb=class{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new N9(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const i=e.currentTarget.value,s=this.parser_(i);Ee(s)||(this.value.rawValue=s),this.view.refresh()}};function B9(n){return String(n)}function mL(n){return n==="false"?!1:!!n}function Ay(n){return B9(n)}function I9(n){return e=>n.reduce((t,i)=>t!==null?t:i(e),null)}const F9=Ht(0);function ad(n){return F9(n)+"%"}function vL(n){return String(n)}function ef(n){return n}function zo({primary:n,secondary:e,forward:t,backward:i}){let s=!1;function r(o){s||(s=!0,o(),s=!1)}n.emitter.on("change",o=>{r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),e.emitter.on("change",o=>{r(()=>{n.setRawValue(i(n.rawValue,e.rawValue),o.options)}),r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),{forceEmit:!1,last:!0})})}function Et(n,e){const t=n*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+t:e.downKey?-t:0}function ta(n){return{altKey:n.altKey,downKey:n.key==="ArrowDown",shiftKey:n.shiftKey,upKey:n.key==="ArrowUp"}}function $i(n){return{altKey:n.altKey,downKey:n.key==="ArrowLeft",shiftKey:n.shiftKey,upKey:n.key==="ArrowRight"}}function K9(n){return n==="ArrowUp"||n==="ArrowDown"}function Db(n){return K9(n)||n==="ArrowLeft"||n==="ArrowRight"}function Om(n,e){var t,i;const s=e.ownerDocument.defaultView,r=e.getBoundingClientRect();return{x:n.pageX-(((t=s&&s.scrollX)!==null&&t!==void 0?t:0)+r.left),y:n.pageY-(((i=s&&s.scrollY)!==null&&i!==void 0?i:0)+r.top)}}let Pt=class{constructor(e){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new Vn,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault(),(t=e.currentTarget)===null||t===void 0||t.focus();const i=this.elem_.ownerDocument;i.addEventListener("mousemove",this.onDocumentMouseMove_),i.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(Om(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(Om(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(Om(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchMove_(e){const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchEnd_(e){var t;const i=(t=e.targetTouches.item(0))!==null&&t!==void 0?t:this.lastTouch_,s=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(i?{x:i.clientX-s.left,y:i.clientY-s.top}:void 0),sender:this,shiftKey:e.shiftKey})}};const On=K("txt");let U9=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(On(),On(void 0,"num")),t.arrayPosition&&this.element.classList.add(On(void 0,t.arrayPosition)),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(On("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(On()),this.inputElement.classList.add(On("i"));const s=e.createElement("div");s.classList.add(On("k")),this.element.appendChild(s),this.knobElement=s;const r=e.createElementNS(rt,"svg");r.classList.add(On("g")),this.knobElement.appendChild(r);const o=e.createElementNS(rt,"path");o.classList.add(On("gb")),r.appendChild(o),this.guideBodyElem_=o;const l=e.createElementNS(rt,"path");l.classList.add(On("gh")),r.appendChild(l),this.guideHeadElem_=l;const a=e.createElement("div");a.classList.add(K("tt")()),this.knobElement.appendChild(a),this.tooltipElem_=a,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.refresh()}onDraggingChange_(e){if(e.rawValue===null){this.element.classList.remove(On(void 0,"drg"));return}this.element.classList.add(On(void 0,"drg"));const t=e.rawValue/this.props_.get("pointerScale"),i=t+(t>0?-1:t<0?1:0),s=qe(-i,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${i+s},0 L${i},4 L${i+s},8`,`M ${t},-1 L${t},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${t},4`);const r=this.props_.get("formatter");this.tooltipElem_.textContent=r(this.value.rawValue),this.tooltipElem_.style.left=`${t}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}},Mh=class{constructor(e,t){var i;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=t.parser,this.props=t.props,this.sliderProps_=(i=t.sliderProps)!==null&&i!==void 0?i:null,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=Ze(null),this.view=new U9(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const s=new Pt(this.view.knobElement);s.emitter.on("down",this.onPointerDown_),s.emitter.on("move",this.onPointerMove_),s.emitter.on("up",this.onPointerUp_)}constrainValue_(e){var t,i;const s=(t=this.sliderProps_)===null||t===void 0?void 0:t.get("min"),r=(i=this.sliderProps_)===null||i===void 0?void 0:i.get("max");let o=e;return s!==void 0&&(o=Math.max(o,s)),r!==void 0&&(o=Math.min(o,r)),o}onInputChange_(e){const i=e.currentTarget.value,s=this.parser_(i);Ee(s)||(this.value.rawValue=this.constrainValue_(s)),this.view.refresh()}onInputKeyDown_(e){const t=Et(this.props.get("keyScale"),ta(e));t!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+t),{forceEmit:!1,last:!1})}onInputKeyUp_(e){Et(this.props.get("keyScale"),ta(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;const t=e.point.x-e.bounds.width/2;return this.constrainValue_(this.originRawValue_+t*this.props.get("pointerScale"))}onPointerMove_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}};const jm=K("sld");let H9=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(jm()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(jm("t")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.trackElement=i;const s=e.createElement("div");s.classList.add(jm("k")),this.trackElement.appendChild(s),this.knobElement=s,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}update_(){const e=qe(oe(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${e}%`}onChange_(){this.update_()}},z9=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.props=t.props,this.view=new H9(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Pt(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){e.point&&this.value.setRawValue(oe(qe(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("min"),this.props.get("max")),t)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Et(this.props.get("keyScale"),$i(e));t!==0&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onKeyUp_(e){Et(this.props.get("keyScale"),$i(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const Nm=K("sldtxt");let q9=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Nm());const i=e.createElement("div");i.classList.add(Nm("s")),this.sliderView_=t.sliderView,i.appendChild(this.sliderView_.element),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Nm("t")),this.textView_=t.textView,s.appendChild(this.textView_.element),this.element.appendChild(s)}},My=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sliderC_=new z9(e,{props:t.sliderProps,value:t.value,viewProps:this.viewProps}),this.textC_=new Mh(e,{parser:t.parser,props:t.textProps,sliderProps:t.sliderProps,value:t.value,viewProps:t.viewProps}),this.view=new q9(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(e){return Ii(e,null,t=>({max:t.required.number,min:t.required.number}),t=>{const i=this.sliderC_.props;return i.set("max",t.max),i.set("min",t.min),!0})}exportProps(){const e=this.sliderC_.props;return Fi(null,{max:e.get("max"),min:e.get("min")})}};function G9(n){return{sliderProps:new ee({keyScale:n.keyScale,max:n.max,min:n.min}),textProps:new ee({formatter:Ze(n.formatter),keyScale:n.keyScale,pointerScale:Ze(n.pointerScale)})}}const Y9={containerUnitSize:"cnt-usz"};function fL(n){return`--${Y9[n]}`}function Yu(n){return sL(n)}function Dt(n){if(Wv(n))return dt(n,Yu)}function us(n,e){if(!n)return;const t=[],i=tL(n,e);i&&t.push(i);const s=nL(n);return s&&t.push(s),new Va(t)}function pp(n){if(n==="inline"||n==="popup")return n}function Th(n,e){n.write(e)}const oc=K("ckb");let X9=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(oc()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("label");i.classList.add(oc("l")),this.element.appendChild(i);const s=e.createElement("input");s.classList.add(oc("i")),s.type="checkbox",i.appendChild(s),this.inputElement=s,t.viewProps.bindDisabled(this.inputElement);const r=e.createElement("div");r.classList.add(oc("w")),i.appendChild(r);const o=ap(e,"check");r.appendChild(o),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}},W9=class{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new X9(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const t=e.currentTarget;this.value.rawValue=t.checked}};function Z9(n){const e=[],t=Ab(n.options);return t&&e.push(t),new Va(e)}wt({id:"input-bool",type:"input",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=dt(e,i=>({options:i.optional.custom(dp),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>mL,constraint:n=>Z9(n.params),writer:n=>Th},controller:n=>{const e=n.document,t=n.value,i=n.constraint,s=i&&ld(i,cp);return s?new ea(e,{props:new ee({options:s.values.value("options")}),value:t,viewProps:n.viewProps}):new W9(e,{value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="boolean"?null:n.controller.valueController instanceof ea?new Lb(n.controller):null}});const Zr=K("col");let Q9=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Zr()),t.foldable.bindExpandedClass(this.element,Zr(void 0,"expanded")),ni(t.foldable,"completed",Ho(this.element,Zr(void 0,"cpl")));const i=e.createElement("div");i.classList.add(Zr("h")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Zr("s")),i.appendChild(s),this.swatchElement=s;const r=e.createElement("div");if(r.classList.add(Zr("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(Zr("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}};function J9(n,e,t){const i=qe(n/255,0,1),s=qe(e/255,0,1),r=qe(t/255,0,1),o=Math.max(i,s,r),l=Math.min(i,s,r),a=o-l;let u=0,h=0;const c=(l+o)/2;return a!==0&&(h=a/(1-Math.abs(o+l-1)),i===o?u=(s-r)/a:s===o?u=2+(r-i)/a:u=4+(i-s)/a,u=u/6+(u<0?1:0)),[u*360,h*100,c*100]}function eY(n,e,t){const i=(n%360+360)%360,s=qe(e/100,0,1),r=qe(t/100,0,1),o=(1-Math.abs(2*r-1))*s,l=o*(1-Math.abs(i/60%2-1)),a=r-o/2;let u,h,c;return i>=0&&i<60?[u,h,c]=[o,l,0]:i>=60&&i<120?[u,h,c]=[l,o,0]:i>=120&&i<180?[u,h,c]=[0,o,l]:i>=180&&i<240?[u,h,c]=[0,l,o]:i>=240&&i<300?[u,h,c]=[l,0,o]:[u,h,c]=[o,0,l],[(u+a)*255,(h+a)*255,(c+a)*255]}function tY(n,e,t){const i=qe(n/255,0,1),s=qe(e/255,0,1),r=qe(t/255,0,1),o=Math.max(i,s,r),l=Math.min(i,s,r),a=o-l;let u;a===0?u=0:o===i?u=60*(((s-r)/a%6+6)%6):o===s?u=60*((r-i)/a+2):u=60*((i-s)/a+4);const h=o===0?0:a/o,c=o;return[u,h*100,c*100]}function _L(n,e,t){const i=JS(n,360),s=qe(e/100,0,1),r=qe(t/100,0,1),o=r*s,l=o*(1-Math.abs(i/60%2-1)),a=r-o;let u,h,c;return i>=0&&i<60?[u,h,c]=[o,l,0]:i>=60&&i<120?[u,h,c]=[l,o,0]:i>=120&&i<180?[u,h,c]=[0,o,l]:i>=180&&i<240?[u,h,c]=[0,l,o]:i>=240&&i<300?[u,h,c]=[l,0,o]:[u,h,c]=[o,0,l],[(u+a)*255,(h+a)*255,(c+a)*255]}function nY(n,e,t){const i=t+e*(100-Math.abs(2*t-100))/200;return[n,i!==0?e*(100-Math.abs(2*t-100))/i:0,t+e*(100-Math.abs(2*t-100))/(2*100)]}function iY(n,e,t){const i=100-Math.abs(t*(200-e)/100-100);return[n,i!==0?e*t/i:0,t*(200-e)/(2*100)]}function Vi(n){return[n[0],n[1],n[2]]}function mp(n,e){return[n[0],n[1],n[2],e]}const sY={hsl:{hsl:(n,e,t)=>[n,e,t],hsv:nY,rgb:eY},hsv:{hsl:iY,hsv:(n,e,t)=>[n,e,t],rgb:_L},rgb:{hsl:J9,hsv:tY,rgb:(n,e,t)=>[n,e,t]}};function na(n,e){return[e==="float"?1:n==="rgb"?255:360,e==="float"?1:n==="rgb"?255:100,e==="float"?1:n==="rgb"?255:100]}function rY(n,e){return n===e?e:JS(n,e)}function wL(n,e,t){var i;const s=na(e,t);return[e==="rgb"?qe(n[0],0,s[0]):rY(n[0],s[0]),qe(n[1],0,s[1]),qe(n[2],0,s[2]),qe((i=n[3])!==null&&i!==void 0?i:1,0,1)]}function Ty(n,e,t,i){const s=na(e,t),r=na(e,i);return n.map((o,l)=>o/s[l]*r[l])}function bL(n,e,t){const i=Ty(n,e.mode,e.type,"int"),s=sY[e.mode][t.mode](...i);return Ty(s,t.mode,"int",t.type)}let me=class gL{static black(){return new gL([0,0,0],"rgb")}constructor(e,t){this.type="int",this.mode=t,this.comps_=wL(e,t,this.type)}getComponents(e){return mp(bL(Vi(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}};const Zs=K("colp");let oY=class{constructor(e,t){this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(Zs()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Zs("hsv"));const s=e.createElement("div");s.classList.add(Zs("sv")),this.svPaletteView_=t.svPaletteView,s.appendChild(this.svPaletteView_.element),i.appendChild(s);const r=e.createElement("div");r.classList.add(Zs("h")),this.hPaletteView_=t.hPaletteView,r.appendChild(this.hPaletteView_.element),i.appendChild(r),this.element.appendChild(i);const o=e.createElement("div");if(o.classList.add(Zs("rgb")),this.textsView_=t.textsView,o.appendChild(this.textsView_.element),this.element.appendChild(o),t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};const l=e.createElement("div");l.classList.add(Zs("a"));const a=e.createElement("div");a.classList.add(Zs("ap")),a.appendChild(this.alphaViews_.palette.element),l.appendChild(a);const u=e.createElement("div");u.classList.add(Zs("at")),u.appendChild(this.alphaViews_.text.element),l.appendChild(u),this.element.appendChild(l)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map(t=>t.inputElement)];return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}};function lY(n){return n==="int"?"int":n==="float"?"float":void 0}function Rb(n){return dt(n,e=>({color:e.optional.object({alpha:e.optional.boolean,type:e.optional.custom(lY)}),expanded:e.optional.boolean,picker:e.optional.custom(pp),readonly:e.optional.constant(!1)}))}function $o(n){return n?.1:1}function CL(n){var e;return(e=n.color)===null||e===void 0?void 0:e.type}let Ob=class{constructor(e,t){this.type="float",this.mode=t,this.comps_=wL(e,t,this.type)}getComponents(e){return mp(bL(Vi(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}};const aY={int:(n,e)=>new me(n,e),float:(n,e)=>new Ob(n,e)};function jb(n,e,t){return aY[t](n,e)}function uY(n){return n.type==="float"}function hY(n){return n.type==="int"}function cY(n){const e=n.getComponents(),t=na(n.mode,"int");return new me([Math.round(oe(e[0],0,1,0,t[0])),Math.round(oe(e[1],0,1,0,t[1])),Math.round(oe(e[2],0,1,0,t[2])),e[3]],n.mode)}function dY(n){const e=n.getComponents(),t=na(n.mode,"int");return new Ob([oe(e[0],0,t[0],0,1),oe(e[1],0,t[1],0,1),oe(e[2],0,t[2],0,1),e[3]],n.mode)}function It(n,e){if(n.type===e)return n;if(hY(n)&&e==="float")return dY(n);if(uY(n)&&e==="int")return cY(n);throw Ss.shouldNeverHappen()}function pY(n,e){return n.alpha===e.alpha&&n.mode===e.mode&&n.notation===e.notation&&n.type===e.type}function zn(n,e){const t=n.match(/^(.+)%$/);return Math.min(t?parseFloat(t[1])*.01*e:parseFloat(n),e)}const mY={deg:n=>n,grad:n=>n*360/400,rad:n=>n*360/(2*Math.PI),turn:n=>n*360};function PL(n){const e=n.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(n);const t=parseFloat(e[1]),i=e[2];return mY[i](t)}function yL(n){const e=n.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[zn(e[1],255),zn(e[2],255),zn(e[3],255)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function vY(n){const e=yL(n);return e?new me(e,"rgb"):null}function EL(n){const e=n.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[zn(e[1],255),zn(e[2],255),zn(e[3],255),zn(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function fY(n){const e=EL(n);return e?new me(e,"rgb"):null}function xL(n){const e=n.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[PL(e[1]),zn(e[2],100),zn(e[3],100)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function _Y(n){const e=xL(n);return e?new me(e,"hsl"):null}function $L(n){const e=n.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[PL(e[1]),zn(e[2],100),zn(e[3],100),zn(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function wY(n){const e=$L(n);return e?new me(e,"hsl"):null}function VL(n){const e=n.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];const t=n.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}function bY(n){const e=VL(n);return e?new me(e,"rgb"):null}function kL(n){const e=n.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),oe(parseInt(e[4]+e[4],16),0,255,0,1)];const t=n.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),oe(parseInt(t[4],16),0,255,0,1)]:null}function gY(n){const e=kL(n);return e?new me(e,"rgb"):null}function SL(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function Dy(n){return e=>{const t=SL(e);return t?jb(t,"rgb",n):null}}function LL(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function Ry(n){return e=>{const t=LL(e);return t?jb(t,"rgb",n):null}}const CY=[{parser:VL,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:kL,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:yL,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:EL,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:xL,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:$L,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:SL,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:LL,result:{alpha:!0,mode:"rgb",notation:"object"}}];function PY(n){return CY.reduce((e,{parser:t,result:i})=>e||(t(n)?i:null),null)}function yY(n,e="int"){const t=PY(n);return t?t.notation==="hex"&&e!=="float"?Object.assign(Object.assign({},t),{type:"int"}):t.notation==="func"?Object.assign(Object.assign({},t),{type:e}):null:null}function Dh(n){const e=[bY,gY,vY,fY,_Y,wY];n==="int"&&e.push(Dy("int"),Ry("int")),n==="float"&&e.push(Dy("float"),Ry("float"));const t=I9(e);return i=>{const s=t(i);return s?It(s,n):null}}function EY(n){const e=Dh("int");if(typeof n!="string")return me.black();const t=e(n);return t??me.black()}function AL(n){const e=qe(Math.floor(n),0,255).toString(16);return e.length===1?`0${e}`:e}function Nb(n,e="#"){const t=Vi(n.getComponents("rgb")).map(AL).join("");return`${e}${t}`}function Bb(n,e="#"){const t=n.getComponents("rgb"),i=[t[0],t[1],t[2],t[3]*255].map(AL).join("");return`${e}${i}`}function ML(n){const e=Ht(0),t=It(n,"int");return`rgb(${Vi(t.getComponents("rgb")).map(s=>e(s)).join(", ")})`}function Lc(n){const e=Ht(2),t=Ht(0);return`rgba(${It(n,"int").getComponents("rgb").map((r,o)=>(o===3?e:t)(r)).join(", ")})`}function xY(n){const e=[Ht(0),ad,ad],t=It(n,"int");return`hsl(${Vi(t.getComponents("hsl")).map((s,r)=>e[r](s)).join(", ")})`}function $Y(n){const e=[Ht(0),ad,ad,Ht(2)];return`hsla(${It(n,"int").getComponents("hsl").map((s,r)=>e[r](s)).join(", ")})`}function TL(n,e){const t=Ht(e==="float"?2:0),i=["r","g","b"],s=It(n,e);return`{${Vi(s.getComponents("rgb")).map((o,l)=>`${i[l]}: ${t(o)}`).join(", ")}}`}function VY(n){return e=>TL(e,n)}function DL(n,e){const t=Ht(2),i=Ht(e==="float"?2:0),s=["r","g","b","a"];return`{${It(n,e).getComponents("rgb").map((l,a)=>{const u=a===3?t:i;return`${s[a]}: ${u(l)}`}).join(", ")}}`}function kY(n){return e=>DL(e,n)}const SY=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:Nb},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:Bb},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:ML},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:Lc},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:xY},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:$Y},...["int","float"].reduce((n,e)=>[...n,{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:VY(e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:kY(e)}],[])];function RL(n){return SY.reduce((e,t)=>e||(pY(t.format,n)?t.stringifier:null),null)}const au=K("apl");let LY=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(au()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(au("b")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(au("c")),i.appendChild(s),this.colorElem_=s;const r=e.createElement("div");r.classList.add(au("m")),this.element.appendChild(r),this.markerElem_=r;const o=e.createElement("div");o.classList.add(au("p")),this.markerElem_.appendChild(o),this.previewElem_=o,this.update_()}update_(){const e=this.value.rawValue,t=e.getComponents("rgb"),i=new me([t[0],t[1],t[2],0],"rgb"),s=new me([t[0],t[1],t[2],255],"rgb"),r=["to right",Lc(i),Lc(s)];this.colorElem_.style.background=`linear-gradient(${r.join(",")})`,this.previewElem_.style.backgroundColor=Lc(e);const o=oe(t[3],0,1,0,100);this.markerElem_.style.left=`${o}%`}onValueChange_(){this.update_()}},AY=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new LY(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Pt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=e.point.x/e.bounds.width,s=this.value.rawValue,[r,o,l]=s.getComponents("hsv");this.value.setRawValue(new me([r,o,l,i],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Et($o(!0),$i(e));if(t===0)return;const i=this.value.rawValue,[s,r,o,l]=i.getComponents("hsv");this.value.setRawValue(new me([s,r,o,l+t],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){Et($o(!0),$i(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const ol=K("coltxt");function MY(n){const e=n.createElement("select"),t=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}];return e.appendChild(t.reduce((i,s)=>{const r=n.createElement("option");return r.textContent=s.text,r.value=s.value,i.appendChild(r),i},n.createDocumentFragment())),e}let TY=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(ol()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(ol("m")),this.modeElem_=MY(e),this.modeElem_.classList.add(ol("ms")),i.appendChild(this.modeSelectElement),t.viewProps.bindDisabled(this.modeElem_);const s=e.createElement("div");s.classList.add(ol("mm")),s.appendChild(ap(e,"dropdown")),i.appendChild(s),this.element.appendChild(i);const r=e.createElement("div");r.classList.add(ol("w")),this.element.appendChild(r),this.inputsElem_=r,this.inputViews_=t.inputViews,this.applyInputViews_(),ws(t.mode,o=>{this.modeElem_.value=o})}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(e){this.inputViews_=e,this.applyInputViews_()}applyInputViews_(){lL(this.inputsElem_);const e=this.element.ownerDocument;this.inputViews_.forEach(t=>{const i=e.createElement("div");i.classList.add(ol("c")),i.appendChild(t.element),this.inputsElem_.appendChild(i)})}};function DY(n){return Ht(n==="float"?2:0)}function RY(n,e,t){const i=na(n,e)[t];return new rp({min:0,max:i})}function OY(n,e,t){return new Mh(n,{arrayPosition:t===0?"fst":t===2?"lst":"mid",parser:e.parser,props:ee.fromObject({formatter:DY(e.colorType),keyScale:$o(!1),pointerScale:e.colorType==="float"?.01:1}),value:Ze(0,{constraint:RY(e.colorMode,e.colorType,t)}),viewProps:e.viewProps})}function jY(n,e){const t={colorMode:e.colorMode,colorType:e.colorType,parser:xi,viewProps:e.viewProps};return[0,1,2].map(i=>{const s=OY(n,t,i);return zo({primary:e.value,secondary:s.value,forward(r){return It(r,e.colorType).getComponents(e.colorMode)[i]},backward(r,o){const l=e.colorMode,u=It(r,e.colorType).getComponents(l);u[i]=o;const h=jb(mp(Vi(u),u[3]),l,e.colorType);return It(h,"int")}}),s})}function NY(n,e){const t=new Tb(n,{parser:Dh("int"),props:ee.fromObject({formatter:Nb}),value:Ze(me.black()),viewProps:e.viewProps});return zo({primary:e.value,secondary:t.value,forward:i=>new me(Vi(i.getComponents()),i.mode),backward:(i,s)=>new me(mp(Vi(s.getComponents(i.mode)),i.getComponents()[3]),i.mode)}),[t]}function BY(n){return n!=="hex"}let IY=class{constructor(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=t.colorType,this.value=t.value,this.viewProps=t.viewProps,this.colorMode=Ze(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new TY(e,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const t=this.colorMode.rawValue;return BY(t)?jY(e,{colorMode:t,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):NY(e,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(e){const t=e.currentTarget;this.colorMode.rawValue=t.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map(i=>i.view)}};const Bm=K("hpl");let FY=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Bm()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(Bm("c")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Bm("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=this.value.rawValue,[t]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=ML(new me([t,100,100],"hsv"));const i=oe(t,0,360,0,100);this.markerElem_.style.left=`${i}%`}onValueChange_(){this.update_()}},KY=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new FY(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Pt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=oe(qe(e.point.x,0,e.bounds.width),0,e.bounds.width,0,360),s=this.value.rawValue,[,r,o,l]=s.getComponents("hsv");this.value.setRawValue(new me([i,r,o,l],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=Et($o(!1),$i(e));if(t===0)return;const i=this.value.rawValue,[s,r,o,l]=i.getComponents("hsv");this.value.setRawValue(new me([s+t,r,o,l],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){Et($o(!1),$i(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const Im=K("svp"),Oy=64;let UY=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Im()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("canvas");i.height=Oy,i.width=Oy,i.classList.add(Im("c")),this.element.appendChild(i),this.canvasElement=i;const s=e.createElement("div");s.classList.add(Im("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=t9(this.canvasElement);if(!e)return;const i=this.value.rawValue.getComponents("hsv"),s=this.canvasElement.width,r=this.canvasElement.height,o=e.getImageData(0,0,s,r),l=o.data;for(let h=0;h<r;h++)for(let c=0;c<s;c++){const p=oe(c,0,s,0,100),d=oe(h,0,r,100,0),m=_L(i[0],p,d),f=(h*s+c)*4;l[f]=m[0],l[f+1]=m[1],l[f+2]=m[2],l[f+3]=255}e.putImageData(o,0,0);const a=oe(i[1],0,100,0,100);this.markerElem_.style.left=`${a}%`;const u=oe(i[2],0,100,100,0);this.markerElem_.style.top=`${u}%`}onValueChange_(){this.update_()}},HY=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new UY(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Pt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=oe(e.point.x,0,e.bounds.width,0,100),s=oe(e.point.y,0,e.bounds.height,100,0),[r,,,o]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new me([r,i,s,o],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){Db(e.key)&&e.preventDefault();const[t,i,s,r]=this.value.rawValue.getComponents("hsv"),o=$o(!1),l=Et(o,$i(e)),a=Et(o,ta(e));l===0&&a===0||this.value.setRawValue(new me([t,i+l,s+a,r],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){const t=$o(!1),i=Et(t,$i(e)),s=Et(t,ta(e));i===0&&s===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},zY=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.hPaletteC_=new KY(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new HY(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=t.supportsAlpha?{palette:new AY(e,{value:this.value,viewProps:this.viewProps}),text:new Mh(e,{parser:xi,props:ee.fromObject({pointerScale:.01,keyScale:.1,formatter:Ht(2)}),value:Ze(0,{constraint:new rp({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&zo({primary:this.value,secondary:this.alphaIcs_.text.value,forward:i=>i.getComponents()[3],backward:(i,s)=>{const r=i.getComponents();return r[3]=s,new me(r,i.mode)}}),this.textsC_=new IY(e,{colorType:t.colorType,value:this.value,viewProps:this.viewProps}),this.view=new oY(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}};const Fm=K("colsw");let qY=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(Fm()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Fm("sw")),this.element.appendChild(i),this.swatchElem_=i;const s=e.createElement("button");s.classList.add(Fm("b")),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s,this.update_()}update_(){const e=this.value.rawValue;this.swatchElem_.style.backgroundColor=Bb(e)}onValueChange_(){this.update_()}},GY=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new qY(e,{value:this.value,viewProps:this.viewProps})}},Ib=class{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=up.create(t.expanded),this.swatchC_=new GY(e,{value:this.value,viewProps:this.viewProps});const i=this.swatchC_.view.buttonElement;i.addEventListener("blur",this.onButtonBlur_),i.addEventListener("click",this.onButtonClick_),this.textC_=new Tb(e,{parser:t.parser,props:ee.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new Q9(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=t.pickerLayout==="popup"?new Mb(e,{viewProps:this.viewProps}):null;const s=new zY(e,{colorType:t.colorType,supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});s.view.allFocusableElements.forEach(r=>{r.addEventListener("blur",this.onPopupChildBlur_),r.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=s,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(s.view.element),zo({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:r=>r,backward:(r,o)=>o})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),hp(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=Eb(e);i&&t.contains(i)||i&&i===this.swatchC_.view.buttonElement&&!lp(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}};function YY(n){return Vi(n.getComponents("rgb")).reduce((e,t)=>e<<8|Math.floor(t)&255,0)}function XY(n){return n.getComponents("rgb").reduce((e,t,i)=>{const s=Math.floor(i===3?t*255:t)&255;return e<<8|s},0)>>>0}function WY(n){return new me([n>>16&255,n>>8&255,n&255],"rgb")}function ZY(n){return new me([n>>24&255,n>>16&255,n>>8&255,oe(n&255,0,255,0,1)],"rgb")}function QY(n){return typeof n!="number"?me.black():WY(n)}function JY(n){return typeof n!="number"?me.black():ZY(n)}function Ac(n,e){return typeof n!="object"||Ee(n)?!1:e in n&&typeof n[e]=="number"}function OL(n){return Ac(n,"r")&&Ac(n,"g")&&Ac(n,"b")}function jL(n){return OL(n)&&Ac(n,"a")}function NL(n){return OL(n)}function Fb(n,e){if(n.mode!==e.mode||n.type!==e.type)return!1;const t=n.getComponents(),i=e.getComponents();for(let s=0;s<t.length;s++)if(t[s]!==i[s])return!1;return!0}function jy(n){return"a"in n?[n.r,n.g,n.b,n.a]:[n.r,n.g,n.b]}function eX(n){const e=RL(n);return e?(t,i)=>{Th(t,e(i))}:null}function tX(n){const e=n?XY:YY;return(t,i)=>{Th(t,e(i))}}function nX(n,e,t){const s=It(e,t).toRgbaObject();n.writeProperty("r",s.r),n.writeProperty("g",s.g),n.writeProperty("b",s.b),n.writeProperty("a",s.a)}function iX(n,e,t){const s=It(e,t).toRgbaObject();n.writeProperty("r",s.r),n.writeProperty("g",s.g),n.writeProperty("b",s.b)}function sX(n,e){return(t,i)=>{n?nX(t,i,e):iX(t,i,e)}}function rX(n){var e;return!!(!((e=n?.color)===null||e===void 0)&&e.alpha)}function oX(n){return n?e=>Bb(e,"0x"):e=>Nb(e,"0x")}function lX(n){return"color"in n||n.view==="color"}wt({id:"input-color-number",type:"input",accept:(n,e)=>{if(typeof n!="number"||!lX(e))return null;const t=Rb(e);return t?{initialValue:n,params:Object.assign(Object.assign({},t),{supportsAlpha:rX(e)})}:null},binding:{reader:n=>n.params.supportsAlpha?JY:QY,equals:Fb,writer:n=>tX(n.params.supportsAlpha)},controller:n=>{var e,t;return new Ib(n.document,{colorType:"int",expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:oX(n.params.supportsAlpha),parser:Dh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.supportsAlpha,value:n.value,viewProps:n.viewProps})}});function aX(n,e){if(!NL(n))return It(me.black(),e);if(e==="int"){const t=jy(n);return new me(t,"rgb")}if(e==="float"){const t=jy(n);return new Ob(t,"rgb")}return It(me.black(),"int")}function uX(n){return jL(n)}function hX(n){return e=>{const t=aX(e,n);return It(t,"int")}}function cX(n,e){return t=>n?DL(t,e):TL(t,e)}wt({id:"input-color-object",type:"input",accept:(n,e)=>{var t;if(!NL(n))return null;const i=Rb(e);return i?{initialValue:n,params:Object.assign(Object.assign({},i),{colorType:(t=CL(e))!==null&&t!==void 0?t:"int"})}:null},binding:{reader:n=>hX(n.params.colorType),equals:Fb,writer:n=>sX(uX(n.initialValue),n.params.colorType)},controller:n=>{var e,t;const i=jL(n.initialValue);return new Ib(n.document,{colorType:n.params.colorType,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:cX(i,n.params.colorType),parser:Dh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:i,value:n.value,viewProps:n.viewProps})}});wt({id:"input-color-string",type:"input",accept:(n,e)=>{if(typeof n!="string"||e.view==="text")return null;const t=yY(n,CL(e));if(!t)return null;const i=RL(t);if(!i)return null;const s=Rb(e);return s?{initialValue:n,params:Object.assign(Object.assign({},s),{format:t,stringifier:i})}:null},binding:{reader:()=>EY,equals:Fb,writer:n=>{const e=eX(n.params.format);if(!e)throw Ss.notBindable();return e}},controller:n=>{var e,t;return new Ib(n.document,{colorType:n.params.format.type,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:n.params.stringifier,parser:Dh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.format.alpha,value:n.value,viewProps:n.viewProps})}});let Vo=class{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map((i,s)=>{var r,o;return(o=(r=this.components[s])===null||r===void 0?void 0:r.constrain(i))!==null&&o!==void 0?o:i});return this.asm_.fromComponents(t)}};const Ny=K("pndtxt");let dX=class{constructor(e,t){this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add(Ny()),this.textViews.forEach(i=>{const s=e.createElement("div");s.classList.add(Ny("a")),s.appendChild(i.element),this.element.appendChild(s)})}};function pX(n,e,t){return new Mh(n,{arrayPosition:t===0?"fst":t===e.axes.length-1?"lst":"mid",parser:e.parser,props:e.axes[t].textProps,value:Ze(0,{constraint:e.axes[t].constraint}),viewProps:e.viewProps})}let vp=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map((i,s)=>pX(e,t,s)),this.acs_.forEach((i,s)=>{zo({primary:this.value,secondary:i.value,forward:r=>t.assembly.toComponents(r)[s],backward:(r,o)=>{const l=t.assembly.toComponents(r);return l[s]=o,t.assembly.fromComponents(l)}})}),this.view=new dX(e,{textViews:this.acs_.map(i=>i.view)})}get textControllers(){return this.acs_}},mX=class extends Pb{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(e){this.controller.valueController.sliderController.props.set("max",e)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(e){this.controller.valueController.sliderController.props.set("min",e)}};function vX(n,e){const t=[],i=tL(n,e);i&&t.push(i);const s=nL(n);s&&t.push(s);const r=Ab(n.options);return r&&t.push(r),new Va(t)}wt({id:"input-number",type:"input",accept:(n,e)=>{if(typeof n!="number")return null;const t=dt(e,i=>Object.assign(Object.assign({},sL(i)),{options:i.optional.custom(dp),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>QS,constraint:n=>vX(n.params,n.initialValue),writer:n=>Th},controller:n=>{const e=n.value,t=n.constraint,i=t&&ld(t,cp);if(i)return new ea(n.document,{props:new ee({options:i.values.value("options")}),value:e,viewProps:n.viewProps});const s=iL(n.params,e.rawValue),r=t&&ld(t,rp);return r?new My(n.document,Object.assign(Object.assign({},G9(Object.assign(Object.assign({},s),{keyScale:Ze(s.keyScale),max:r.values.value("max"),min:r.values.value("min")}))),{parser:xi,value:e,viewProps:n.viewProps})):new Mh(n.document,{parser:xi,props:ee.fromObject(s),value:e,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="number"?null:n.controller.valueController instanceof My?new mX(n.controller):n.controller.valueController instanceof ea?new Lb(n.controller):null}});let yr=class{constructor(e=0,t=0){this.x=e,this.y=t}getComponents(){return[this.x,this.y]}static isObject(e){if(Ee(e))return!1;const t=e.x,i=e.y;return!(typeof t!="number"||typeof i!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y}toObject(){return{x:this.x,y:this.y}}};const BL={toComponents:n=>n.getComponents(),fromComponents:n=>new yr(...n)},ll=K("p2d");let fX=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(ll()),t.viewProps.bindClassModifiers(this.element),ws(t.expanded,Ho(this.element,ll(void 0,"expanded")));const i=e.createElement("div");i.classList.add(ll("h")),this.element.appendChild(i);const s=e.createElement("button");s.classList.add(ll("b")),s.appendChild(ap(e,"p2dpad")),t.viewProps.bindDisabled(s),i.appendChild(s),this.buttonElement=s;const r=e.createElement("div");if(r.classList.add(ll("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(ll("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}};const Qs=K("p2dp");let _X=class{constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=e.createElement("div"),this.element.classList.add(Qs()),t.layout==="popup"&&this.element.classList.add(Qs(void 0,"p")),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Qs("p")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.padElement=i;const s=e.createElementNS(rt,"svg");s.classList.add(Qs("g")),this.padElement.appendChild(s),this.svgElem_=s;const r=e.createElementNS(rt,"line");r.classList.add(Qs("ax")),r.setAttributeNS(null,"x1","0"),r.setAttributeNS(null,"y1","50%"),r.setAttributeNS(null,"x2","100%"),r.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(r);const o=e.createElementNS(rt,"line");o.classList.add(Qs("ax")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","0"),o.setAttributeNS(null,"x2","50%"),o.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(o);const l=e.createElementNS(rt,"line");l.classList.add(Qs("l")),l.setAttributeNS(null,"x1","50%"),l.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(l),this.lineElem_=l;const a=e.createElement("div");a.classList.add(Qs("m")),this.padElement.appendChild(a),this.markerElem_=a,t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,t]=this.value.rawValue.getComponents(),i=this.props_.get("max"),s=oe(e,-i,+i,0,100),r=oe(t,-i,+i,0,100),o=this.props_.get("invertsY")?100-r:r;this.lineElem_.setAttributeNS(null,"x2",`${s}%`),this.lineElem_.setAttributeNS(null,"y2",`${o}%`),this.markerElem_.style.left=`${s}%`,this.markerElem_.style.top=`${o}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}};function By(n,e,t){return[Et(e[0],$i(n)),Et(e[1],ta(n))*(t?1:-1)]}let wX=class{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new _X(e,{layout:t.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Pt(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=this.props.get("max"),s=oe(e.point.x,0,e.bounds.width,-i,+i),r=oe(this.props.get("invertsY")?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-i,+i);this.value.setRawValue(new yr(s,r),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onPadKeyDown_(e){Db(e.key)&&e.preventDefault();const[t,i]=By(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(new yr(this.value.rawValue.x+t,this.value.rawValue.y+i),{forceEmit:!1,last:!1})}onPadKeyUp_(e){const[t,i]=By(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},bX=class{constructor(e,t){var i,s;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=up.create(t.expanded),this.popC_=t.pickerLayout==="popup"?new Mb(e,{viewProps:this.viewProps}):null;const r=new wX(e,{layout:t.pickerLayout,props:new ee({invertsY:Ze(t.invertsY),max:Ze(t.max),xKeyScale:t.axes[0].textProps.value("keyScale"),yKeyScale:t.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});r.view.allFocusableElements.forEach(o=>{o.addEventListener("blur",this.onPopupChildBlur_),o.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=r,this.textC_=new vp(e,{assembly:BL,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new fX(e,{expanded:this.foldable_.value("expanded"),pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(i=this.view.buttonElement)===null||i===void 0||i.addEventListener("blur",this.onPadButtonBlur_),(s=this.view.buttonElement)===null||s===void 0||s.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),zo({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:o=>o,backward:(o,l)=>l})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),hp(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=Eb(e);i&&t.contains(i)||i&&i===this.view.buttonElement&&!lp(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.view.buttonElement.focus()}};function gX(n){return yr.isObject(n)?new yr(n.x,n.y):new yr}function CX(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y)}function PX(n,e){return new Vo({assembly:BL,components:[us(Object.assign(Object.assign({},n),n.x),e.x),us(Object.assign(Object.assign({},n),n.y),e.y)]})}function Iy(n,e){var t,i;if(!Ee(n.min)||!Ee(n.max))return Math.max(Math.abs((t=n.min)!==null&&t!==void 0?t:0),Math.abs((i=n.max)!==null&&i!==void 0?i:0));const s=eL(n);return Math.max(Math.abs(s)*10,Math.abs(e)*10)}function yX(n,e){var t,i;const s=Iy(xo(n,(t=n.x)!==null&&t!==void 0?t:{}),e.x),r=Iy(xo(n,(i=n.y)!==null&&i!==void 0?i:{}),e.y);return Math.max(s,r)}function EX(n){if(!("y"in n))return!1;const e=n.y;return e&&"inverted"in e?!!e.inverted:!1}wt({id:"input-point2d",type:"input",accept:(n,e)=>{if(!yr.isObject(n))return null;const t=dt(e,i=>Object.assign(Object.assign({},Yu(i)),{expanded:i.optional.boolean,picker:i.optional.custom(pp),readonly:i.optional.constant(!1),x:i.optional.custom(Dt),y:i.optional.object(Object.assign(Object.assign({},Yu(i)),{inverted:i.optional.boolean}))}));return t?{initialValue:n,params:t}:null},binding:{reader:()=>gX,constraint:n=>PX(n.params,n.initialValue),equals:yr.equals,writer:()=>CX},controller:n=>{var e,t;const i=n.document,s=n.value,r=n.constraint,o=[n.params.x,n.params.y];return new bX(i,{axes:s.rawValue.getComponents().map((l,a)=>{var u;return gb({constraint:r.components[a],initialValue:l,params:xo(n.params,(u=o[a])!==null&&u!==void 0?u:{})})}),expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,invertsY:EX(n.params),max:yX(n.params,s.rawValue),parser:xi,pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",value:s,viewProps:n.viewProps})}});let Ol=class{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if(Ee(e))return!1;const t=e.x,i=e.y,s=e.z;return!(typeof t!="number"||typeof i!="number"||typeof s!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}};const IL={toComponents:n=>n.getComponents(),fromComponents:n=>new Ol(...n)};function xX(n){return Ol.isObject(n)?new Ol(n.x,n.y,n.z):new Ol}function $X(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z)}function VX(n,e){return new Vo({assembly:IL,components:[us(Object.assign(Object.assign({},n),n.x),e.x),us(Object.assign(Object.assign({},n),n.y),e.y),us(Object.assign(Object.assign({},n),n.z),e.z)]})}wt({id:"input-point3d",type:"input",accept:(n,e)=>{if(!Ol.isObject(n))return null;const t=dt(e,i=>Object.assign(Object.assign({},Yu(i)),{readonly:i.optional.constant(!1),x:i.optional.custom(Dt),y:i.optional.custom(Dt),z:i.optional.custom(Dt)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>xX,constraint:n=>VX(n.params,n.initialValue),equals:Ol.equals,writer:n=>$X},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z];return new vp(n.document,{assembly:IL,axes:e.rawValue.getComponents().map((s,r)=>{var o;return gb({constraint:t.components[r],initialValue:s,params:xo(n.params,(o=i[r])!==null&&o!==void 0?o:{})})}),parser:xi,value:e,viewProps:n.viewProps})}});let jl=class{constructor(e=0,t=0,i=0,s=0){this.x=e,this.y=t,this.z=i,this.w=s}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if(Ee(e))return!1;const t=e.x,i=e.y,s=e.z,r=e.w;return!(typeof t!="number"||typeof i!="number"||typeof s!="number"||typeof r!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}};const FL={toComponents:n=>n.getComponents(),fromComponents:n=>new jl(...n)};function kX(n){return jl.isObject(n)?new jl(n.x,n.y,n.z,n.w):new jl}function SX(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z),n.writeProperty("w",e.w)}function LX(n,e){return new Vo({assembly:FL,components:[us(Object.assign(Object.assign({},n),n.x),e.x),us(Object.assign(Object.assign({},n),n.y),e.y),us(Object.assign(Object.assign({},n),n.z),e.z),us(Object.assign(Object.assign({},n),n.w),e.w)]})}wt({id:"input-point4d",type:"input",accept:(n,e)=>{if(!jl.isObject(n))return null;const t=dt(e,i=>Object.assign(Object.assign({},Yu(i)),{readonly:i.optional.constant(!1),w:i.optional.custom(Dt),x:i.optional.custom(Dt),y:i.optional.custom(Dt),z:i.optional.custom(Dt)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>kX,constraint:n=>LX(n.params,n.initialValue),equals:jl.equals,writer:n=>SX},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z,n.params.w];return new vp(n.document,{assembly:FL,axes:e.rawValue.getComponents().map((s,r)=>{var o;return gb({constraint:t.components[r],initialValue:s,params:xo(n.params,(o=i[r])!==null&&o!==void 0?o:{})})}),parser:xi,value:e,viewProps:n.viewProps})}});function AX(n){const e=[],t=Ab(n.options);return t&&e.push(t),new Va(e)}wt({id:"input-string",type:"input",accept:(n,e)=>{if(typeof n!="string")return null;const t=dt(e,i=>({readonly:i.optional.constant(!1),options:i.optional.custom(dp)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>vL,constraint:n=>AX(n.params),writer:n=>Th},controller:n=>{const e=n.document,t=n.value,i=n.constraint,s=i&&ld(i,cp);return s?new ea(e,{props:new ee({options:s.values.value("options")}),value:t,viewProps:n.viewProps}):new Tb(e,{parser:r=>r,props:ee.fromObject({formatter:ef}),value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="string"?null:n.controller.valueController instanceof ea?new Lb(n.controller):null}});const fp={monitor:{defaultInterval:200,defaultRows:3}},Fy=K("mll");let MX=class{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(Fy()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("textarea");i.classList.add(Fy("i")),i.style.height=`calc(var(${fL("containerUnitSize")}) * ${t.rows})`,i.readOnly=!0,t.viewProps.bindDisabled(i),this.element.appendChild(i),this.textareaElem_=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.textareaElem_,t=e.scrollTop===e.scrollHeight-e.clientHeight,i=[];this.value.rawValue.forEach(s=>{s!==void 0&&i.push(this.formatter_(s))}),e.textContent=i.join(`
`),t&&(e.scrollTop=e.scrollHeight)}onValueUpdate_(){this.update_()}},Kb=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new MX(e,{formatter:t.formatter,rows:t.rows,value:this.value,viewProps:this.viewProps})}};const Ky=K("sgl");let TX=class{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(Ky()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(Ky("i")),i.readOnly=!0,i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.value.rawValue,t=e[e.length-1];this.inputElement.value=t!==void 0?this.formatter_(t):""}onValueUpdate_(){this.update_()}},Ub=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new TX(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}};wt({id:"monitor-bool",type:"monitor",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=dt(e,i=>({readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>mL},controller:n=>{var e;return n.value.rawValue.length===1?new Ub(n.document,{formatter:Ay,value:n.value,viewProps:n.viewProps}):new Kb(n.document,{formatter:Ay,rows:(e=n.params.rows)!==null&&e!==void 0?e:fp.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}});let DX=class extends Pb{get max(){return this.controller.valueController.props.get("max")}set max(e){this.controller.valueController.props.set("max",e)}get min(){return this.controller.valueController.props.get("min")}set min(e){this.controller.valueController.props.set("min",e)}};const Js=K("grl");let RX=class{constructor(e,t){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Js()),t.viewProps.bindClassModifiers(this.element),this.formatter_=t.formatter,this.props_=t.props,this.cursor_=t.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const i=e.createElementNS(rt,"svg");i.classList.add(Js("g")),i.style.height=`calc(var(${fL("containerUnitSize")}) * ${t.rows})`,this.element.appendChild(i),this.svgElem_=i;const s=e.createElementNS(rt,"polyline");this.svgElem_.appendChild(s),this.lineElem_=s;const r=e.createElement("div");r.classList.add(Js("t"),K("tt")()),this.element.appendChild(r),this.tooltipElem_=r,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const e=this.svgElem_.getBoundingClientRect(),t=this.value.rawValue.length-1,i=this.props_.get("min"),s=this.props_.get("max"),r=[];this.value.rawValue.forEach((h,c)=>{if(h===void 0)return;const p=oe(c,0,t,0,e.width),d=oe(h,i,s,e.height,0);r.push([p,d].join(","))}),this.lineElem_.setAttributeNS(null,"points",r.join(" "));const o=this.tooltipElem_,l=this.value.rawValue[this.cursor_.rawValue];if(l===void 0){o.classList.remove(Js("t","a"));return}const a=oe(this.cursor_.rawValue,0,t,0,e.width),u=oe(l,i,s,e.height,0);o.style.left=`${a}px`,o.style.top=`${u}px`,o.textContent=`${this.formatter_(l)}`,o.classList.contains(Js("t","a"))||(o.classList.add(Js("t","a"),Js("t","in")),od(o),o.classList.remove(Js("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}},KL=class{constructor(e,t){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.cursor_=Ze(-1),this.view=new RX(e,{cursor:this.cursor_,formatter:t.formatter,rows:t.rows,props:this.props,value:this.value,viewProps:this.viewProps}),!lp(e))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const i=new Pt(this.view.element);i.emitter.on("down",this.onGraphPointerDown_),i.emitter.on("move",this.onGraphPointerMove_),i.emitter.on("up",this.onGraphPointerUp_)}}importProps(e){return Ii(e,null,t=>({max:t.required.number,min:t.required.number}),t=>(this.props.set("max",t.max),this.props.set("min",t.min),!0))}exportProps(){return Fi(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(e){const t=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(oe(e.offsetX,0,t.width,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){if(!e.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(oe(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}};function tf(n){return Ee(n.format)?Ht(2):n.format}function OX(n){var e;return n.value.rawValue.length===1?new Ub(n.document,{formatter:tf(n.params),value:n.value,viewProps:n.viewProps}):new Kb(n.document,{formatter:tf(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:fp.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}function jX(n){var e,t,i;return new KL(n.document,{formatter:tf(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:fp.monitor.defaultRows,props:ee.fromObject({max:(t=n.params.max)!==null&&t!==void 0?t:100,min:(i=n.params.min)!==null&&i!==void 0?i:0}),value:n.value,viewProps:n.viewProps})}function Uy(n){return n.view==="graph"}wt({id:"monitor-number",type:"monitor",accept:(n,e)=>{if(typeof n!="number")return null;const t=dt(e,i=>({format:i.optional.function,max:i.optional.number,min:i.optional.number,readonly:i.required.constant(!0),rows:i.optional.number,view:i.optional.string}));return t?{initialValue:n,params:t}:null},binding:{defaultBufferSize:n=>Uy(n)?64:1,reader:n=>QS},controller:n=>Uy(n.params)?jX(n):OX(n),api:n=>n.controller.valueController instanceof KL?new DX(n.controller):null});wt({id:"monitor-string",type:"monitor",accept:(n,e)=>{if(typeof n!="string")return null;const t=dt(e,i=>({multiline:i.optional.boolean,readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>vL},controller:n=>{var e;const t=n.value;return t.rawValue.length>1||n.params.multiline?new Kb(n.document,{formatter:ef,rows:(e=n.params.rows)!==null&&e!==void 0?e:fp.monitor.defaultRows,value:t,viewProps:n.viewProps}):new Ub(n.document,{formatter:ef,value:t,viewProps:n.viewProps})}});class UL{multiply(e){return this.format(this.quat.multiply(e.quat))}premultiply(e){return this.format(e.multiply(this))}slerp(e,t){return this.format(this.quat.slerp(e.quat,t))}}function HL(n,e,t){return Math.min(Math.max(n,e),t)}function NX(n,e){return Math.floor(n/e)*e}function BX(n,e){return n-NX(n,e)}function Pu(n){return BX(n+Math.PI,Math.PI*2)-Math.PI}class Er extends UL{static fromQuaternion(e,t,i){const s=e.toMat3(),[r,o,l,a]=t==="XYZ"?[0,1,2,1]:t==="XZY"?[0,2,1,-1]:t==="YXZ"?[1,0,2,-1]:t==="YZX"?[1,2,0,1]:t==="ZXY"?[2,0,1,1]:[2,1,0,-1],u=[0,0,0],h=s[l+r*3];return u[o]=-a*Math.asin(HL(h,-1,1)),Math.abs(h)<.999999?(u[r]=a*Math.atan2(s[l+o*3],s[l*4]),u[l]=a*Math.atan2(s[o+r*3],s[r*4])):u[r]=a*Math.atan2(-s[o+l*3],s[o*4]),Math.abs(u[r])+Math.abs(u[l])>Math.PI&&(u[r]=Pu(u[r]+Math.PI),u[o]=Pu(Math.PI-u[o]),u[l]=Pu(u[l]+Math.PI)),new Er(...u,t).reunit(i)}constructor(e,t,i,s,r){super(),this.x=e??0,this.y=t??0,this.z=i??0,this.order=s??"XYZ",this.unit=r??"rad"}get quat(){return H.fromEuler(this)}getComponents(){return[this.x,this.y,this.z]}toEuler(e,t){return this.reorder(e).reunit(t)}format(e){return e instanceof Er?e.reorder(this.order):e.toEuler(this.order,this.unit)}reorder(e){return e===this.order?this:this.quat.toEuler(e,this.unit)}reunit(e){const t={deg:Math.PI/180,rad:1,turn:2*Math.PI}[this.unit],i={deg:180/Math.PI,rad:1,turn:.5/Math.PI}[e],s=t*i;return new Er(s*this.x,s*this.y,s*this.z,this.order,e)}}class H extends UL{static fromAxisAngle(e,t){const i=t/2,s=Math.sin(i);return new H(e.x*s,e.y*s,e.z*s,Math.cos(i))}static fromEuler(e){const t=e.reunit("rad"),[i,s,r,o]=t.order==="XYZ"?[0,1,2,1]:t.order==="XZY"?[0,2,1,-1]:t.order==="YXZ"?[1,0,2,-1]:t.order==="YZX"?[1,2,0,1]:t.order==="ZXY"?[2,0,1,1]:[2,1,0,-1],l=t.getComponents(),a=.5*l[i],u=.5*o*l[s],h=.5*l[r],c=Math.cos(a),p=Math.cos(u),d=Math.cos(h),m=Math.sin(a),f=Math.sin(u),v=Math.sin(h),w=[0,0,0,d*p*c+v*f*m];return w[i]=d*p*m-v*f*c,w[s]=o*(d*f*c+v*p*m),w[r]=v*p*c-d*f*m,new H(...w)}static lookRotation(e,t){const{normal:i,tangent:s,binormal:r}=e.orthoNormalize(t),o=r.x,l=s.x,a=i.x,u=r.y,h=s.y,c=i.y,p=r.z,d=s.z,m=i.z,f=o+h+m;if(f>0){const v=.5/Math.sqrt(f+1);return new H((d-c)*v,(a-p)*v,(u-l)*v,.25/v)}else if(o>h&&o>m){const v=2*Math.sqrt(1+o-h-m);return new H(.25*v,(l+u)/v,(a+p)/v,(d-c)/v)}else if(h>m){const v=2*Math.sqrt(1+h-o-m);return new H((l+u)/v,.25*v,(c+d)/v,(a-p)/v)}else{const v=2*Math.sqrt(1+m-o-h);return new H((a+p)/v,(c+d)/v,.25*v,(u-l)/v)}}constructor(e,t,i,s){super(),this.x=e??0,this.y=t??0,this.z=i??0,this.w=s??1}get quat(){return this}getComponents(){return[this.x,this.y,this.z,this.w]}toEuler(e,t){return Er.fromQuaternion(this,e,t)}get lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}get length(){return Math.sqrt(this.lengthSq)}get normalized(){const e=this.length;return e===0?new H:new H(this.x/e,this.y/e,this.z/e,this.w/e)}get negated(){return new H(-this.x,-this.y,-this.z,-this.w)}get ban360s(){return this.w<0?this.negated:this}multiply(e){const t=e.quat;return new H(this.w*t.x+this.x*t.w+this.y*t.z-this.z*t.y,this.w*t.y-this.x*t.z+this.y*t.w+this.z*t.x,this.w*t.z+this.x*t.y-this.y*t.x+this.z*t.w,this.w*t.w-this.x*t.x-this.y*t.y-this.z*t.z)}format(e){return e.quat}slerp(e,t){let i=e.quat;if(t===0)return this;if(t===1)return i;const s=this.ban360s;i=i.ban360s;let r=s.w*i.w+s.x*i.x+s.y*i.y+s.z*i.z;if(r<0&&(i=i.negated,r=-r),r>=1)return s;const o=1-r*r;if(o<=Number.EPSILON){const c=1-t;return new H(c*s.x+t*i.x,c*s.y+t*i.y,c*s.z+t*i.z,c*s.w+t*i.w).normalized}const l=Math.sqrt(o),a=Math.atan2(l,r),u=Math.sin((1-t)*a)/l,h=Math.sin(t*a)/l;return new H(s.x*u+i.x*h,s.y*u+i.y*h,s.z*u+i.z*h,s.w*u+i.w*h)}toMat3(){const{x:e,y:t,z:i,w:s}=this;return[1-2*t*t-2*i*i,2*e*t+2*i*s,2*e*i-2*t*s,2*e*t-2*i*s,1-2*e*e-2*i*i,2*t*i+2*e*s,2*e*i+2*t*s,2*t*i-2*e*s,1-2*e*e-2*t*t]}}class zL{constructor(){this.offset=[0,0,-5],this.fov=30,this.aspect=1,this.viewport=[0,0,1,1]}project(e){const t=(this.viewport[0]+this.viewport[2])*.5,i=(this.viewport[1]+this.viewport[3])*.5,s=this.viewport[2]-this.viewport[0],r=this.viewport[3]-this.viewport[1],o=1/Math.tan(this.fov*Math.PI/360),l=-(e.z+this.offset[2]),a=t+(e.x+this.offset[0])/l*o*s*.5/this.aspect,u=i-(e.y+this.offset[1])/l*o*r*.5;return[a,u]}}class xe{constructor(e,t,i){this.element=e.createElementNS(rt,"path"),this.vertices=t,this.projector=i}setRotation(e){let t="";return this.vertices.forEach((i,s)=>{const r=i.applyQuaternion(e),[o,l]=this.projector.project(r);t+=`${s===0?"M":"L"}${o} ${l}`}),this.element.setAttributeNS(null,"d",t),this}}class z{constructor(e,t,i){this.x=e??0,this.y=t??0,this.z=i??0}getComponents(){return[this.x,this.y,this.z]}get lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}get length(){return Math.sqrt(this.lengthSq)}get normalized(){const e=this.length;return e===0?new z:new z(this.x/e,this.y/e,this.z/e)}get negated(){return new z(-this.x,-this.y,-this.z)}add(e){return new z(this.x+e.x,this.y+e.y,this.z+e.z)}sub(e){return new z(this.x-e.x,this.y-e.y,this.z-e.z)}scale(e){return new z(this.x*e,this.y*e,this.z*e)}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}cross(e){return new z(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)}orthoNormalize(e){const t=this.normalized;e=e.normalized;let i=t.dot(e);i===1&&(Math.abs(t.y)>Math.abs(t.z)?e=new z(0,0,1):e=new z(0,1,0),i=t.dot(e)),e=e.sub(t.scale(i)).normalized;const s=e.cross(t);return{normal:t,tangent:e,binormal:s}}applyQuaternion(e){const t=e.w*this.x+e.y*this.z-e.z*this.y,i=e.w*this.y+e.z*this.x-e.x*this.z,s=e.w*this.z+e.x*this.y-e.y*this.x,r=-e.x*this.x-e.y*this.y-e.z*this.z;return new z(t*e.w+r*-e.x+i*-e.z-s*-e.y,i*e.w+r*-e.y+s*-e.x-t*-e.z,s*e.w+r*-e.z+t*-e.y-i*-e.x)}}function Tt(n,e){const t=e.z>0?new H(0,0,0,1):new H(0,0,1,0);return Math.abs(n.z)>.9999?t:H.lookRotation(n,e)}function ud(n,e,t,i,s,r=1){const o=[];for(let l=0;l<t;l++){const a=n+e*l/(t-1),u=new z;u[i]=r*Math.cos(a),u[s]=r*Math.sin(a),o.push(u)}return o}const $=K("rotationgizmo"),al=new z(0,0,0),IX=new z(1,0,0),FX=new z(0,1,0),Qr=new z(0,0,1),ul=new z(0,0,-1),Hy=new z(.7,0,0),zy=new z(0,.7,0),qy=new z(0,0,.7),Gy=new z(-.7,0,0),Yy=new z(0,-.7,0),Xy=new z(0,0,-.7),Wy=new H(0,0,0,1);function hl(n,e,t){const i=n.createElementNS(rt,"g"),s=n.createElementNS(rt,"circle");s.classList.add($(e)),s.setAttributeNS(null,"cx","0"),s.setAttributeNS(null,"cy","0"),s.setAttributeNS(null,"r","8"),i.appendChild(s);const r=n.createElementNS(rt,"text");return r.classList.add($("labeltext")),r.setAttributeNS(null,"y","4"),r.setAttributeNS(null,"text-anchor","middle"),r.setAttributeNS(null,"font-size","10"),r.textContent=t,i.appendChild(r),i}class KX{get xArcBElement(){return this.xArcBC_.element}get yArcBElement(){return this.yArcBC_.element}get zArcBElement(){return this.zArcBC_.element}get xArcFElement(){return this.xArcFC_.element}get yArcFElement(){return this.yArcFC_.element}get zArcFElement(){return this.zArcFC_.element}get rArcElement(){return this.rArcC_.element}constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.onModeChange_=this.onModeChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add($()),t.pickerLayout==="popup"&&this.element.classList.add($(void 0,"p"));const i=e.createElement("div");i.classList.add($("p")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.padElement=i;const s=e.createElementNS(rt,"svg");s.classList.add($("g")),this.padElement.appendChild(s),this.svgElem_=s,this.projector_=new zL,this.projector_.viewport=[0,0,136,136];const r=ud(0,Math.PI,33,"x","y"),o=ud(0,2*Math.PI,65,"x","y",1.1);this.xArcB_=new xe(e,r,this.projector_),this.xArcB_.element.classList.add($("arcx")),this.svgElem_.appendChild(this.xArcB_.element),this.yArcB_=new xe(e,r,this.projector_),this.yArcB_.element.classList.add($("arcy")),this.svgElem_.appendChild(this.yArcB_.element),this.zArcB_=new xe(e,r,this.projector_),this.zArcB_.element.classList.add($("arcz")),this.svgElem_.appendChild(this.zArcB_.element),this.xArcBC_=new xe(e,r,this.projector_),this.xArcBC_.element.classList.add($("arcc")),this.svgElem_.appendChild(this.xArcBC_.element),this.yArcBC_=new xe(e,r,this.projector_),this.yArcBC_.element.classList.add($("arcc")),this.svgElem_.appendChild(this.yArcBC_.element),this.zArcBC_=new xe(e,r,this.projector_),this.zArcBC_.element.classList.add($("arcc")),this.svgElem_.appendChild(this.zArcBC_.element);const l=e.createElementNS(rt,"g");s.classList.add($("axes")),this.svgElem_.appendChild(l),this.axesElem_=l,this.xAxis_=new xe(e,[al,Hy],this.projector_),this.xAxis_.element.classList.add($("axisx")),this.axesElem_.appendChild(this.xAxis_.element),this.yAxis_=new xe(e,[al,zy],this.projector_),this.yAxis_.element.classList.add($("axisy")),this.axesElem_.appendChild(this.yAxis_.element),this.zAxis_=new xe(e,[al,qy],this.projector_),this.zAxis_.element.classList.add($("axisz")),this.axesElem_.appendChild(this.zAxis_.element),this.xnAxis_=new xe(e,[al,Gy],this.projector_),this.xnAxis_.element.classList.add($("axisn")),this.axesElem_.appendChild(this.xnAxis_.element),this.ynAxis_=new xe(e,[al,Yy],this.projector_),this.ynAxis_.element.classList.add($("axisn")),this.axesElem_.appendChild(this.ynAxis_.element),this.znAxis_=new xe(e,[al,Xy],this.projector_),this.znAxis_.element.classList.add($("axisn")),this.axesElem_.appendChild(this.znAxis_.element),this.xArcF_=new xe(e,r,this.projector_),this.xArcF_.element.classList.add($("arcx")),this.svgElem_.appendChild(this.xArcF_.element),this.yArcF_=new xe(e,r,this.projector_),this.yArcF_.element.classList.add($("arcy")),this.svgElem_.appendChild(this.yArcF_.element),this.zArcF_=new xe(e,r,this.projector_),this.zArcF_.element.classList.add($("arcz")),this.svgElem_.appendChild(this.zArcF_.element),this.xArcFC_=new xe(e,r,this.projector_),this.xArcFC_.element.classList.add($("arcc")),this.svgElem_.appendChild(this.xArcFC_.element),this.yArcFC_=new xe(e,r,this.projector_),this.yArcFC_.element.classList.add($("arcc")),this.svgElem_.appendChild(this.yArcFC_.element),this.zArcFC_=new xe(e,r,this.projector_),this.zArcFC_.element.classList.add($("arcc")),this.svgElem_.appendChild(this.zArcFC_.element),this.rArc_=new xe(e,o,this.projector_),this.rArc_.element.classList.add($("arcr")),this.rArc_.setRotation(Wy),this.svgElem_.appendChild(this.rArc_.element),this.rArcC_=new xe(e,o,this.projector_),this.rArcC_.element.classList.add($("arcc")),this.rArcC_.setRotation(Wy),this.svgElem_.appendChild(this.rArcC_.element);const a=e.createElementNS(rt,"g");s.classList.add($("labels")),this.svgElem_.appendChild(a),this.labelsElem_=a,this.xLabel=hl(e,"labelcirclex","X"),this.labelsElem_.appendChild(this.xLabel),this.yLabel=hl(e,"labelcircley","Y"),this.labelsElem_.appendChild(this.yLabel),this.zLabel=hl(e,"labelcirclez","Z"),this.labelsElem_.appendChild(this.zLabel),this.xnLabel=hl(e,"labelcirclen","-X"),this.labelsElem_.appendChild(this.xnLabel),this.ynLabel=hl(e,"labelcirclen","-Y"),this.labelsElem_.appendChild(this.ynLabel),this.znLabel=hl(e,"labelcirclen","-Z"),this.labelsElem_.appendChild(this.znLabel);const u=()=>{this.xArcB_.element.classList.add($("arcx_hover")),this.xArcF_.element.classList.add($("arcx_hover"))},h=()=>{this.xArcB_.element.classList.remove($("arcx_hover")),this.xArcF_.element.classList.remove($("arcx_hover"))};this.xArcBC_.element.addEventListener("mouseenter",u),this.xArcBC_.element.addEventListener("mouseleave",h),this.xArcFC_.element.addEventListener("mouseenter",u),this.xArcFC_.element.addEventListener("mouseleave",h);const c=()=>{this.yArcB_.element.classList.add($("arcy_hover")),this.yArcF_.element.classList.add($("arcy_hover"))},p=()=>{this.yArcB_.element.classList.remove($("arcy_hover")),this.yArcF_.element.classList.remove($("arcy_hover"))};this.yArcBC_.element.addEventListener("mouseenter",c),this.yArcBC_.element.addEventListener("mouseleave",p),this.yArcFC_.element.addEventListener("mouseenter",c),this.yArcFC_.element.addEventListener("mouseleave",p);const d=()=>{this.zArcB_.element.classList.add($("arcz_hover")),this.zArcF_.element.classList.add($("arcz_hover"))},m=()=>{this.zArcB_.element.classList.remove($("arcz_hover")),this.zArcF_.element.classList.remove($("arcz_hover"))};this.zArcBC_.element.addEventListener("mouseenter",d),this.zArcBC_.element.addEventListener("mouseleave",m),this.zArcFC_.element.addEventListener("mouseenter",d),this.zArcFC_.element.addEventListener("mouseleave",m);const f=()=>{this.rArc_.element.classList.add($("arcr_hover"))},v=()=>{this.rArc_.element.classList.remove($("arcr_hover"))};this.rArcC_.element.addEventListener("mouseenter",f),this.rArcC_.element.addEventListener("mouseleave",v),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,t.mode.emitter.on("change",this.onModeChange_),this.mode_=t.mode,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const e=this.value.rawValue.quat.normalized;this.xAxis_.setRotation(e),this.yAxis_.setRotation(e),this.zAxis_.setRotation(e),this.xnAxis_.setRotation(e),this.ynAxis_.setRotation(e),this.znAxis_.setRotation(e);const t=IX.applyQuaternion(e),i=FX.applyQuaternion(e),s=Qr.applyQuaternion(e),r=t.negated,o=i.negated,l=s.negated;[{el:this.xAxis_.element,v:t},{el:this.yAxis_.element,v:i},{el:this.zAxis_.element,v:s},{el:this.xnAxis_.element,v:r},{el:this.ynAxis_.element,v:o},{el:this.znAxis_.element,v:l}].map(({el:a,v:u})=>(this.axesElem_.removeChild(a),{el:a,v:u})).sort((a,u)=>a.v.z-u.v.z).forEach(({el:a})=>{this.axesElem_.appendChild(a)}),this.xArcB_.setRotation(Tt(t,ul)),this.yArcB_.setRotation(Tt(i,ul)),this.zArcB_.setRotation(Tt(s,ul)),this.xArcBC_.setRotation(Tt(t,ul)),this.yArcBC_.setRotation(Tt(i,ul)),this.zArcBC_.setRotation(Tt(s,ul)),this.xArcF_.setRotation(Tt(t,Qr)),this.yArcF_.setRotation(Tt(i,Qr)),this.zArcF_.setRotation(Tt(s,Qr)),this.xArcFC_.setRotation(Tt(t,Qr)),this.yArcFC_.setRotation(Tt(i,Qr)),this.zArcFC_.setRotation(Tt(s,Qr)),[{el:this.xLabel,v:Hy},{el:this.yLabel,v:zy},{el:this.zLabel,v:qy},{el:this.xnLabel,v:Gy},{el:this.ynLabel,v:Yy},{el:this.znLabel,v:Xy}].forEach(({el:a,v:u})=>{const[h,c]=this.projector_.project(u.applyQuaternion(e));a.setAttributeNS(null,"transform",`translate( ${h}, ${c} )`)}),[{el:this.xLabel,v:t},{el:this.yLabel,v:i},{el:this.zLabel,v:s},{el:this.xnLabel,v:r},{el:this.ynLabel,v:o},{el:this.znLabel,v:l}].map(({el:a,v:u})=>(this.labelsElem_.removeChild(a),{el:a,v:u})).sort((a,u)=>a.v.z-u.v.z).forEach(({el:a})=>{this.labelsElem_.appendChild(a)})}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}onModeChange_(){const e=this.mode_.rawValue,t=e==="angle-x"?"add":"remove",i=e==="angle-y"?"add":"remove",s=e==="angle-z"?"add":"remove",r=e==="angle-r"?"add":"remove";this.xArcB_.element.classList[t]($("arcx_active")),this.yArcB_.element.classList[i]($("arcy_active")),this.zArcB_.element.classList[s]($("arcz_active")),this.xArcF_.element.classList[t]($("arcx_active")),this.yArcF_.element.classList[i]($("arcy_active")),this.zArcF_.element.classList[s]($("arcz_active")),this.rArc_.element.classList[r]($("arcr_active"))}}function qL(n){return HL(n,0,1)}function UX(n){if(n<=0)return 0;if(n>=1)return 1;const e=1-n,t=e*(e*(e*(e*(e*(e*(e*-6+7))))));return qL(1-t)}function HX(n,e,t){return qL((t-n)/(e-n))}const Dr=1/Math.sqrt(2),zX=new z(1,0,0),qX=new z(0,1,0),GX=new z(0,0,1),YX=new H(0,0,0,1),XX=new H(Dr,0,0,Dr),WX=new H(0,-Dr,0,Dr),ZX=new H(-Dr,0,0,Dr),QX=new H(0,Dr,0,Dr),JX=new H(0,1,0,0);class eW{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.mode_=Ze("free"),this.view=new KX(e,{value:this.value,mode:this.mode_,viewProps:this.viewProps,pickerLayout:t.pickerLayout}),this.ptHandler_=new Pt(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_);const i=new Pt(this.view.xArcBElement);i.emitter.on("down",()=>this.changeModeIfNotAuto_("angle-x")),i.emitter.on("up",()=>this.changeModeIfNotAuto_("free"));const s=new Pt(this.view.xArcFElement);s.emitter.on("down",()=>this.changeModeIfNotAuto_("angle-x")),s.emitter.on("up",()=>this.changeModeIfNotAuto_("free"));const r=new Pt(this.view.yArcBElement);r.emitter.on("down",()=>this.changeModeIfNotAuto_("angle-y")),r.emitter.on("up",()=>this.changeModeIfNotAuto_("free"));const o=new Pt(this.view.yArcFElement);o.emitter.on("down",()=>this.changeModeIfNotAuto_("angle-y")),o.emitter.on("up",()=>this.changeModeIfNotAuto_("free"));const l=new Pt(this.view.zArcBElement);l.emitter.on("down",()=>this.changeModeIfNotAuto_("angle-z")),l.emitter.on("up",()=>this.changeModeIfNotAuto_("free"));const a=new Pt(this.view.zArcFElement);a.emitter.on("down",()=>this.changeModeIfNotAuto_("angle-z")),a.emitter.on("up",()=>this.changeModeIfNotAuto_("free"));const u=new Pt(this.view.rArcElement);u.emitter.on("down",()=>this.changeModeIfNotAuto_("angle-r")),u.emitter.on("up",()=>this.changeModeIfNotAuto_("free")),[{el:this.view.xLabel,q:WX},{el:this.view.yLabel,q:XX},{el:this.view.zLabel,q:YX},{el:this.view.xnLabel,q:QX},{el:this.view.ynLabel,q:ZX},{el:this.view.znLabel,q:JX}].forEach(({el:h,q:c})=>{new Pt(h).emitter.on("down",()=>this.autoRotate_(c))}),this.px_=null,this.py_=null,this.angleState_=null}handlePointerEvent_(e){if(!e.point)return;const t=this.mode_.rawValue,i=e.point.x,s=e.point.y;if(t!=="auto")if(t==="free"){if(this.px_!=null&&this.py_!=null){const r=i-this.px_,o=s-this.py_,l=Math.sqrt(r*r+o*o);if(l===0)return;const a=new z(o/l,r/l,0),u=H.fromAxisAngle(a,l/68);this.value.rawValue=this.value.rawValue.premultiply(u)}this.px_=i,this.py_=s}else if(t==="angle-r"){const r=e.bounds.width/2,o=e.bounds.height/2,l=Math.atan2(s-o,i-r);if(this.angleState_==null){const a=new z(0,0,1);this.angleState_={initialRotation:this.value.rawValue,initialAngle:l,axis:a,reverseAngle:!0}}else{const{initialRotation:a,initialAngle:u,axis:h}=this.angleState_,c=-Pu(l-u),p=H.fromAxisAngle(h,c);this.value.rawValue=a.premultiply(p)}}else{const r=e.bounds.width/2,o=e.bounds.height/2,l=Math.atan2(s-o,i-r);if(this.angleState_==null){const a=t==="angle-x"?zX:t==="angle-y"?qX:GX,u=a.applyQuaternion(this.value.rawValue.quat).z>0;this.angleState_={initialRotation:this.value.rawValue,initialAngle:l,axis:a,reverseAngle:u}}else{const{initialRotation:a,initialAngle:u,axis:h,reverseAngle:c}=this.angleState_;let p=Pu(l-u);p=c?-p:p;const d=H.fromAxisAngle(h,p);this.value.rawValue=a.multiply(d)}}}onPointerDown_(e){this.handlePointerEvent_(e.data)}onPointerMove_(e){this.handlePointerEvent_(e.data)}onPointerUp_(){this.px_=null,this.py_=null,this.angleState_=null}onPadKeyDown_(e){Db(e.key)&&e.preventDefault();const t=Et(1,$i(e)),i=Et(1,ta(e));if(t!==0||i!==0){const s=new z(-i,t,0),r=H.fromAxisAngle(s,Math.PI/16);this.value.rawValue=this.value.rawValue.premultiply(r)}}changeModeIfNotAuto_(e){this.mode_.rawValue!=="auto"&&(this.mode_.rawValue=e)}autoRotate_(e){this.mode_.rawValue="auto";const t=this.value.rawValue,i=Date.now(),s=()=>{const r=Date.now(),o=UX(HX(0,300,r-i));if(this.value.rawValue=t.slerp(e,o),o===1){this.mode_.rawValue="free";return}requestAnimationFrame(s)};requestAnimationFrame(s)}}const Jr=K("rotationswatch"),tW=new z(1,0,0),nW=new z(0,1,0),lc=new z(0,0,1),iW=new H(0,0,0,1);class sW{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(Jr()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("button");i.classList.add(Jr("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElementNS(rt,"svg");s.classList.add(Jr("g")),i.appendChild(s),this.svgElem_=s,this.projector_=new zL,this.projector_.viewport=[0,0,20,20];const r=ud(0,Math.PI,33,"x","y"),o=ud(0,2*Math.PI,65,"x","y");this.rArc_=new xe(e,o,this.projector_),this.rArc_.element.classList.add(Jr("arcr")),s.appendChild(this.rArc_.element),this.rArc_.setRotation(iW),this.xArc_=new xe(e,r,this.projector_),this.xArc_.element.classList.add(Jr("arc")),s.appendChild(this.xArc_.element),this.yArc_=new xe(e,r,this.projector_),this.yArc_.element.classList.add(Jr("arc")),s.appendChild(this.yArc_.element),this.zArc_=new xe(e,r,this.projector_),this.zArc_.element.classList.add(Jr("arc")),s.appendChild(this.zArc_.element),this.update_()}update_(){const e=this.value.rawValue.quat.normalized,t=tW.applyQuaternion(e),i=nW.applyQuaternion(e),s=lc.applyQuaternion(e);this.xArc_.setRotation(Tt(t,lc)),this.yArc_.setRotation(Tt(i,lc)),this.zArc_.setRotation(Tt(s,lc))}onValueChange_(){this.update_()}}class rW{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new sW(e,{value:this.value,viewProps:this.viewProps})}}const er=K("rotation");class oW{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(er()),t.foldable.bindExpandedClass(this.element,er(void 0,"expanded")),ni(t.foldable,"completed",Ho(this.element,er(void 0,"cpl"))),t.rotationMode==="quaternion"&&this.element.classList.add(er("quat"));const i=e.createElement("div");i.classList.add(er("h")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(er("s")),i.appendChild(s),this.swatchElement=s;const r=e.createElement("div");if(r.classList.add(er("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(er("g")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}}class GL{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=up.create(t.expanded),this.swatchC_=new rW(e,{value:this.value,viewProps:this.viewProps});const i=this.swatchC_.view.buttonElement;i.addEventListener("blur",this.onButtonBlur_),i.addEventListener("click",this.onButtonClick_),this.textC_=new vp(e,{assembly:t.assembly,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new oW(e,{rotationMode:t.rotationMode,foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=t.pickerLayout==="popup"?new Mb(e,{viewProps:this.viewProps}):null;const s=new eW(e,{value:this.value,viewProps:this.viewProps,pickerLayout:t.pickerLayout});s.view.allFocusableElements.forEach(r=>{r.addEventListener("blur",this.onPopupChildBlur_),r.addEventListener("keydown",this.onPopupChildKeydown_)}),this.gizmoC_=s,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(s.view.element),zo({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:r=>r,backward:(r,o)=>o})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.gizmoC_.view.element),hp(this.foldable_,this.view.pickerElement))}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.gizmoC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=Eb(e);i&&t.contains(i)||i&&i===this.swatchC_.view.buttonElement&&!lp(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function Km(n,e){const t=Math.pow(.1,n);return{baseStep:t,constraint:e,textProps:ee.fromObject({formatter:Ht(n),keyScale:t,pointerScale:t})}}function io(n){if(!n)return;const e=[];return Ee(n.step)||e.push(new YS(n.step)),(!Ee(n.max)||!Ee(n.min))&&e.push(new GS({max:n.max,min:n.min})),new Va(e)}function Zy(n,e){return{toComponents:t=>t.getComponents(),fromComponents:t=>new Er(t[0],t[1],t[2],n,e)}}function Qy(n,e,t){return typeof n?.x=="number"&&typeof n?.y=="number"&&typeof n?.z=="number"?new Er(n.x,n.y,n.z,e,t):new Er(0,0,0,e,t)}function lW(n){switch(n){case"XYZ":case"XZY":case"YXZ":case"YZX":case"ZXY":case"ZYX":return n;default:return}}function aW(n){switch(n){case"rad":case"deg":case"turn":return n;default:return}}wt({id:"rotation",type:"input",accept(n,e){var t,i;const s=dt(e,r=>({view:r.required.constant("rotation"),label:r.optional.string,picker:r.optional.custom(pp),expanded:r.optional.boolean,rotationMode:r.required.constant("euler"),x:r.optional.custom(Dt),y:r.optional.custom(Dt),z:r.optional.custom(Dt),order:r.optional.custom(lW),unit:r.optional.custom(aW)}));return s?{initialValue:Qy(n,(t=s.order)!==null&&t!==void 0?t:"XYZ",(i=s.unit)!==null&&i!==void 0?i:"rad"),params:s}:null},binding:{reader({params:n}){return e=>{var t,i;return Qy(e,(t=n.order)!==null&&t!==void 0?t:"XYZ",(i=n.unit)!==null&&i!==void 0?i:"rad")}},constraint({params:n}){var e,t;return new Vo({assembly:Zy((e=n.order)!==null&&e!==void 0?e:"XYZ",(t=n.unit)!==null&&t!==void 0?t:"rad"),components:[io("x"in n?n.x:void 0),io("y"in n?n.y:void 0),io("z"in n?n.z:void 0)]})},writer(n){return(e,t)=>{e.writeProperty("x",t.x),e.writeProperty("y",t.y),e.writeProperty("z",t.z)}}},controller({document:n,value:e,constraint:t,params:i,viewProps:s}){var r,o;if(!(t instanceof Vo))throw Ss.shouldNeverHappen();const l="expanded"in i?i.expanded:void 0,a="picker"in i?i.picker:void 0,u=(r=i.unit)!==null&&r!==void 0?r:"rad",h={rad:2,deg:0,turn:2}[u];return new GL(n,{axes:[Km(h,t.components[0]),Km(h,t.components[1]),Km(h,t.components[2])],assembly:Zy((o=i.order)!==null&&o!==void 0?o:"XYZ",u),rotationMode:"euler",expanded:l??!1,parser:xi,pickerLayout:a??"popup",value:e,viewProps:s})}});const Jy={toComponents:n=>[n.x,n.y,n.z,n.w],fromComponents:n=>new H(n[0],n[1],n[2],n[3])};function ac(n){return{baseStep:.01,constraint:n,textProps:ee.fromObject({formatter:e=>Math.abs(e)<.995?e.toFixed(2).replace("0.","."):e.toFixed(1),keyScale:.01,pointerScale:.01})}}function eE(n){return typeof n?.x=="number"&&typeof n?.y=="number"&&typeof n?.z=="number"&&typeof n?.w=="number"?new H(n.x,n.y,n.z,n.w):new H(0,0,0,1)}wt({id:"rotation",type:"input",accept(n,e){const t=dt(e,i=>({view:i.required.constant("rotation"),label:i.optional.string,picker:i.optional.custom(pp),expanded:i.optional.boolean,rotationMode:i.optional.constant("quaternion"),x:i.optional.custom(Dt),y:i.optional.custom(Dt),z:i.optional.custom(Dt),w:i.optional.custom(Dt)}));return t?{initialValue:eE(n),params:t}:null},binding:{reader(n){return e=>eE(e)},constraint({params:n}){return new Vo({assembly:Jy,components:[io("x"in n?n.x:void 0),io("y"in n?n.y:void 0),io("z"in n?n.z:void 0),io("w"in n?n.w:void 0)]})},writer(n){return(e,t)=>{e.writeProperty("x",t.x),e.writeProperty("y",t.y),e.writeProperty("z",t.z),e.writeProperty("w",t.w)}}},controller({document:n,value:e,constraint:t,params:i,viewProps:s}){if(!(t instanceof Vo))throw Ss.shouldNeverHappen();const r="expanded"in i?i.expanded:void 0,o="picker"in i?i.picker:void 0;return new GL(n,{axes:[ac(t.components[0]),ac(t.components[1]),ac(t.components[2]),ac(t.components[3])],assembly:Jy,rotationMode:"quaternion",expanded:r??!1,parser:xi,pickerLayout:o??"popup",value:e,viewProps:s})}});function uW(n){let e,t,i;const s=[n[1]];function r(l){n[2](l)}let o={};for(let l=0;l<s.length;l+=1)o=B(o,s[l]);return n[0]!==void 0&&(o.value=n[0]),e=new Rz({props:o}),y.push(()=>k(e,"value",r)),{c(){A(e.$$.fragment)},l(l){M(e.$$.fragment,l)},m(l,a){T(e,l,a),i=!0},p(l,[a]){const u=a&2?zt(s,[qt(l[1])]):{};!t&&a&1&&(t=!0,u.value=l[0],V(()=>t=!1)),e.$set(u)},i(l){i||(_(e.$$.fragment,l),i=!0)},o(l){b(e.$$.fragment,l),i=!1},d(l){D(e,l)}}}function hW(n,e,t){const i=["value"];let s=je(e,i),{value:r}=e;function o(l){r=l,t(0,r)}return n.$$set=l=>{e=B(B({},e),Cn(l)),t(1,s=je(e,i)),"value"in l&&t(0,r=l.value)},[r,s,o]}class cW extends Je{constructor(e){super(),et(this,e,hW,uW,Qe,{value:0})}}function dW(n){let e,t,i,s;const r=[n[2]];function o(u){n[4](u)}function l(u){n[5](u)}let a={};for(let u=0;u<r.length;u+=1)a=B(a,r[u]);return n[0]!==void 0&&(a.value=n[0]),n[1]!==void 0&&(a.ref=n[1]),e=new Gk({props:a}),y.push(()=>k(e,"value",o)),y.push(()=>k(e,"ref",l)),{c(){A(e.$$.fragment)},l(u){M(e.$$.fragment,u)},m(u,h){T(e,u,h),s=!0},p(u,[h]){const c=h&4?zt(r,[qt(u[2])]):{};!t&&h&1&&(t=!0,c.value=u[0],V(()=>t=!1)),!i&&h&2&&(i=!0,c.ref=u[1],V(()=>i=!1)),e.$set(c)},i(u){s||(_(e.$$.fragment,u),s=!0)},o(u){b(e.$$.fragment,u),s=!1},d(u){D(e,u)}}}function pW(n,e,t){const i=["value","live"];let s=je(e,i),{value:r}=e,{live:o=!0}=e,l;ha(()=>{u(o??!0,!0)});function a(p){p.target&&t(0,r=p.target.value)}function u(p,d=!1){let m=l?.controller.valueController.view.element.querySelector("input");m&&(m.removeEventListener("input",a),!d&&p&&m.addEventListener("input",a))}function h(p){r=p,t(0,r)}function c(p){l=p,t(1,l)}return n.$$set=p=>{e=B(B({},e),Cn(p)),t(2,s=je(e,i)),"value"in p&&t(0,r=p.value),"live"in p&&t(3,o=p.live)},n.$$.update=()=>{n.$$.dirty&10&&l&&o!==void 0&&u(o)},[r,l,s,o,h,c]}class YL extends Je{constructor(e){super(),et(this,e,pW,dW,Qe,{value:0,live:3})}}function Te(n){return n==null}function Hb(n){return n!==null&&typeof n=="object"}function nf(n){return n!==null&&typeof n=="object"}function mW(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function ko(n,e){return Array.from(new Set([...Object.keys(n),...Object.keys(e)])).reduce((i,s)=>{const r=n[s],o=e[s];return nf(r)&&nf(o)?Object.assign(Object.assign({},i),{[s]:ko(r,o)}):Object.assign(Object.assign({},i),{[s]:s in e?o:r})},{})}function vW(n){return Hb(n)?"target"in n:!1}const fW={alreadydisposed:()=>"View has been already disposed",invalidparams:n=>`Invalid parameters for '${n.name}'`,nomatchingcontroller:n=>`No matching controller for '${n.key}'`,nomatchingview:n=>`No matching view for '${JSON.stringify(n.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:n=>`Not compatible with  plugin '${n.id}'`,propertynotfound:n=>`Property '${n.name}' not found`,shouldneverhappen:()=>"This error should never happen"};let So=class xl{static alreadyDisposed(){return new xl({type:"alreadydisposed"})}static notBindable(){return new xl({type:"notbindable"})}static notCompatible(e,t){return new xl({type:"notcompatible",context:{id:`${e}.${t}`}})}static propertyNotFound(e){return new xl({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new xl({type:"shouldneverhappen"})}constructor(e){var t;this.message=(t=fW[e.type](e.context))!==null&&t!==void 0?t:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}toString(){return this.message}},tE=class XL{constructor(e,t){this.obj_=e,this.key=t}static isBindable(e){return!(e===null||typeof e!="object"&&typeof e!="function")}read(){return this.obj_[this.key]}write(e){this.obj_[this.key]=e}writeProperty(e,t){const i=this.read();if(!XL.isBindable(i))throw So.notBindable();if(!(e in i))throw So.propertyNotFound(e);i[e]=t}},kn=class{constructor(){this.observers_={}}on(e,t){let i=this.observers_[e];return i||(i=this.observers_[e]=[]),i.push({handler:t}),this}off(e,t){const i=this.observers_[e];return i&&(this.observers_[e]=i.filter(s=>s.handler!==t)),this}emit(e,t){const i=this.observers_[e];i&&i.forEach(s=>{s.handler(t)})}},_W=class{constructor(e,t){var i;this.constraint_=t?.constraint,this.equals_=(i=t?.equals)!==null&&i!==void 0?i:(s,r)=>s===r,this.emitter=new kn,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},s=this.constraint_?this.constraint_.constrain(e):e,r=this.rawValue_;this.equals_(r,s)&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=s,this.emitter.emit("change",{options:i,previousRawValue:r,rawValue:s,sender:this}))}},wW=class{constructor(e){this.emitter=new kn,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},s=this.value_;s===e&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:i,previousRawValue:s,rawValue:this.value_,sender:this}))}},bW=class{constructor(e){this.emitter=new kn,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}};function at(n,e){const t=e?.constraint,i=e?.equals;return!t&&!i?new wW(n):new _W(n,e)}function gW(n){return[new bW(n),(e,t)=>{n.setRawValue(e,t)}]}let ge=class WL{constructor(e){this.emitter=new kn,this.valMap_=e;for(const t in this.valMap_)this.valMap_[t].emitter.on("change",()=>{this.emitter.emit("change",{key:t,sender:this})})}static createCore(e){return Object.keys(e).reduce((i,s)=>Object.assign(i,{[s]:at(e[s])}),{})}static fromObject(e){const t=this.createCore(e);return new WL(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}},_p=class{constructor(e){this.values=ge.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");return Math.min(Math.max(e,i),t)}},CW=class{constructor(e){this.values=ge.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");let s=e;return Te(i)||(s=Math.max(s,i)),Te(t)||(s=Math.min(s,t)),s}},PW=class{constructor(e,t=0){this.step=e,this.origin=t}constrain(e){const t=this.origin%this.step,i=Math.round((e-t)/this.step);return t+i*this.step}},yW=class{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}};const EW={"**":(n,e)=>Math.pow(n,e),"*":(n,e)=>n*e,"/":(n,e)=>n/e,"%":(n,e)=>n%e,"+":(n,e)=>n+e,"-":(n,e)=>n-e,"<<":(n,e)=>n<<e,">>":(n,e)=>n>>e,">>>":(n,e)=>n>>>e,"&":(n,e)=>n&e,"^":(n,e)=>n^e,"|":(n,e)=>n|e};let xW=class{constructor(e,t,i){this.left=t,this.operator=e,this.right=i}evaluate(){const e=EW[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}};const $W={"+":n=>n,"-":n=>-n,"~":n=>~n};let VW=class{constructor(e,t){this.operator=e,this.expression=t}evaluate(){const e=$W[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}};function zb(n){return(e,t)=>{for(let i=0;i<n.length;i++){const s=n[i](e,t);if(s!=="")return s}return""}}function Xu(n,e){var t;const i=n.substr(e).match(/^\s+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function kW(n,e){const t=n.substr(e,1);return t.match(/^[1-9]$/)?t:""}function Wu(n,e){var t;const i=n.substr(e).match(/^[0-9]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function SW(n,e){const t=Wu(n,e);if(t!=="")return t;const i=n.substr(e,1);if(e+=1,i!=="-"&&i!=="+")return"";const s=Wu(n,e);return s===""?"":i+s}function qb(n,e){const t=n.substr(e,1);if(e+=1,t.toLowerCase()!=="e")return"";const i=SW(n,e);return i===""?"":t+i}function ZL(n,e){const t=n.substr(e,1);if(t==="0")return t;const i=kW(n,e);return e+=i.length,i===""?"":i+Wu(n,e)}function LW(n,e){const t=ZL(n,e);if(e+=t.length,t==="")return"";const i=n.substr(e,1);if(e+=i.length,i!==".")return"";const s=Wu(n,e);return e+=s.length,t+i+s+qb(n,e)}function AW(n,e){const t=n.substr(e,1);if(e+=t.length,t!==".")return"";const i=Wu(n,e);return e+=i.length,i===""?"":t+i+qb(n,e)}function MW(n,e){const t=ZL(n,e);return e+=t.length,t===""?"":t+qb(n,e)}const TW=zb([LW,AW,MW]);function DW(n,e){var t;const i=n.substr(e).match(/^[01]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function RW(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0b")return"";const i=DW(n,e);return i===""?"":t+i}function OW(n,e){var t;const i=n.substr(e).match(/^[0-7]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function jW(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0o")return"";const i=OW(n,e);return i===""?"":t+i}function NW(n,e){var t;const i=n.substr(e).match(/^[0-9a-f]+/i);return(t=i&&i[0])!==null&&t!==void 0?t:""}function BW(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0x")return"";const i=NW(n,e);return i===""?"":t+i}const IW=zb([RW,jW,BW]),FW=zb([IW,TW]);function KW(n,e){const t=FW(n,e);return e+=t.length,t===""?null:{evaluable:new yW(t),cursor:e}}function UW(n,e){const t=n.substr(e,1);if(e+=t.length,t!=="(")return null;const i=JL(n,e);if(!i)return null;e=i.cursor,e+=Xu(n,e).length;const s=n.substr(e,1);return e+=s.length,s!==")"?null:{evaluable:i.evaluable,cursor:e}}function HW(n,e){var t;return(t=KW(n,e))!==null&&t!==void 0?t:UW(n,e)}function QL(n,e){const t=HW(n,e);if(t)return t;const i=n.substr(e,1);if(e+=i.length,i!=="+"&&i!=="-"&&i!=="~")return null;const s=QL(n,e);return s?(e=s.cursor,{cursor:e,evaluable:new VW(i,s.evaluable)}):null}function zW(n,e,t){t+=Xu(e,t).length;const i=n.filter(s=>e.startsWith(s,t))[0];return i?(t+=i.length,t+=Xu(e,t).length,{cursor:t,operator:i}):null}function qW(n,e){return(t,i)=>{const s=n(t,i);if(!s)return null;i=s.cursor;let r=s.evaluable;for(;;){const o=zW(e,t,i);if(!o)break;i=o.cursor;const l=n(t,i);if(!l)return null;i=l.cursor,r=new xW(o.operator,r,l.evaluable)}return r?{cursor:i,evaluable:r}:null}}const GW=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((n,e)=>qW(n,e),QL);function JL(n,e){return e+=Xu(n,e).length,GW(n,e)}function YW(n){const e=JL(n,0);return!e||e.cursor+Xu(n,e.cursor).length!==n.length?null:e.evaluable}function Rr(n){var e;const t=YW(n);return(e=t?.evaluate())!==null&&e!==void 0?e:null}function e2(n){if(typeof n=="number")return n;if(typeof n=="string"){const e=Rr(n);if(!Te(e))return e}return 0}function cn(n){return e=>e.toFixed(Math.max(Math.min(n,20),0))}function le(n,e,t,i,s){const r=(n-e)/(t-e);return i+r*(s-i)}function nE(n){return String(n.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Ge(n,e,t){return Math.min(Math.max(n,e),t)}function t2(n,e){return(n%e+e)%e}function XW(n,e){return Te(n.step)?Math.max(nE(e),2):nE(n.step)}function n2(n){var e;return(e=n.step)!==null&&e!==void 0?e:1}function WW(n,e){var t;const i=Math.abs((t=n.step)!==null&&t!==void 0?t:e);return i===0?.1:Math.pow(10,Math.floor(Math.log10(i))-1)}function i2(n,e){return Te(n.step)?null:new PW(n.step,e)}function s2(n){return!Te(n.max)&&!Te(n.min)?new _p({max:n.max,min:n.min}):!Te(n.max)||!Te(n.min)?new CW({max:n.max,min:n.min}):null}function r2(n,e){var t,i,s;return{formatter:(t=n.format)!==null&&t!==void 0?t:cn(XW(n,e)),keyScale:(i=n.keyScale)!==null&&i!==void 0?i:n2(n),pointerScale:(s=n.pointerScale)!==null&&s!==void 0?s:WW(n,e)}}function o2(n){return{format:n.optional.function,keyScale:n.optional.number,max:n.optional.number,min:n.optional.number,pointerScale:n.optional.number,step:n.optional.number}}function Gb(n){return{constraint:n.constraint,textProps:ge.fromObject(r2(n.params,n.initialValue))}}let Yb=class{constructor(e){this.controller=e}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(e){this.controller.viewProps.set("disabled",e)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(e){this.controller.viewProps.set("hidden",e)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(e){return this.controller.importState(e)}exportState(){return this.controller.exportState()}},wp=class{constructor(e){this.target=e}},l2=class extends wp{constructor(e,t,i){super(e),this.value=t,this.last=i??!0}},ZW=class extends wp{constructor(e,t){super(e),this.expanded=t}},QW=class extends wp{constructor(e,t){super(e),this.index=t}},Xb=class extends Yb{constructor(e){super(e),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new kn,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(e){this.controller.tag=e}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}refresh(){this.controller.value.fetch()}onValueChange_(e){const t=this.controller.value;this.emitter_.emit("change",new l2(this,t.binding.target.read(),e.options.last))}};function JW(n,e){const i=Object.keys(e).reduce((s,r)=>{if(s===void 0)return;const o=e[r],l=o(n[r]);return l.succeeded?Object.assign(Object.assign({},s),{[r]:l.value}):void 0},{});return i}function eZ(n,e){return n.reduce((t,i)=>{if(t===void 0)return;const s=e(i);if(!(!s.succeeded||s.value===void 0))return[...t,s.value]},[])}function tZ(n){return n===null?!1:typeof n=="object"}function ts(n){return e=>t=>{if(!e&&t===void 0)return{succeeded:!1,value:void 0};if(e&&t===void 0)return{succeeded:!0,value:void 0};const i=n(t);return i!==void 0?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}function iE(n){return{custom:e=>ts(e)(n),boolean:ts(e=>typeof e=="boolean"?e:void 0)(n),number:ts(e=>typeof e=="number"?e:void 0)(n),string:ts(e=>typeof e=="string"?e:void 0)(n),function:ts(e=>typeof e=="function"?e:void 0)(n),constant:e=>ts(t=>t===e?e:void 0)(n),raw:ts(e=>e)(n),object:e=>ts(t=>{if(tZ(t))return JW(t,e)})(n),array:e=>ts(t=>{if(Array.isArray(t))return eZ(t,e)})(n)}}const sf={optional:iE(!0),required:iE(!1)};function bt(n,e){const t=e(sf),i=sf.required.object(t)(n);return i.succeeded?i.value:void 0}function Ki(n,e,t,i){if(e&&!e(n))return!1;const s=bt(n,t);return s?i(s):!1}function Ui(n,e){var t;return ko((t=n?.())!==null&&t!==void 0?t:{},e)}function Mc(n){return"value"in n}function nZ(n){if(!Hb(n)||!("binding"in n))return!1;const e=n.binding;return vW(e)}const di="http://www.w3.org/2000/svg";function hd(n){n.offsetHeight}function iZ(n,e){const t=n.style.transition;n.style.transition="none",e(),n.style.transition=t}function Wb(n){return n.ontouchstart!==void 0}function sZ(n){const e=n.ownerDocument.defaultView;return e&&"document"in e?n.getContext("2d",{willReadFrequently:!0}):null}const rZ={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function bp(n,e){const t=n.createElementNS(di,"svg");return t.innerHTML=rZ[e],t}function a2(n,e,t){n.insertBefore(e,n.children[t])}function Zb(n){n.parentElement&&n.parentElement.removeChild(n)}function u2(n){for(;n.children.length>0;)n.removeChild(n.children[0])}function oZ(n){for(;n.childNodes.length>0;)n.removeChild(n.childNodes[0])}function h2(n){return n.relatedTarget?n.relatedTarget:"explicitOriginalTarget"in n?n.explicitOriginalTarget:null}function bs(n,e){n.emitter.on("change",t=>{e(t.rawValue)}),e(n.rawValue)}function ki(n,e,t){bs(n.value(e),t)}const lZ="tp";function W(n){return(t,i)=>[lZ,"-",n,"v",t?`_${t}`:"",i?`-${i}`:""].join("")}const uu=W("lbl");function aZ(n,e){const t=n.createDocumentFragment();return e.split(`
`).map(s=>n.createTextNode(s)).forEach((s,r)=>{r>0&&t.appendChild(n.createElement("br")),t.appendChild(s)}),t}let uZ=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(uu()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(uu("l")),ki(t.props,"label",r=>{Te(r)?this.element.classList.add(uu(void 0,"nol")):(this.element.classList.remove(uu(void 0,"nol")),oZ(i),i.appendChild(aZ(e,r)))}),this.element.appendChild(i),this.labelElement=i;const s=e.createElement("div");s.classList.add(uu("v")),this.element.appendChild(s),this.valueElement=s}},hZ=class{constructor(e,t){this.props=t.props,this.valueController=t.valueController,this.viewProps=t.valueController.viewProps,this.view=new uZ(e,{props:t.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(e){return Ki(e,null,t=>({label:t.optional.string}),t=>(this.props.set("label",t.label),!0))}exportProps(){return Ui(null,{label:this.props.get("label")})}};function cZ(){return["veryfirst","first","last","verylast"]}const sE=W(""),rE={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};let c2=class{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",()=>{cZ().forEach(i=>{t.classList.remove(sE(void 0,rE[i]))}),this.blade.get("positions").forEach(i=>{t.classList.add(sE(void 0,rE[i]))})}),this.viewProps.handleDispose(()=>{Zb(t)})}get parent(){return this.parent_}set parent(e){this.parent_=e,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(e){return Ki(e,null,t=>({disabled:t.required.boolean,hidden:t.required.boolean}),t=>(this.viewProps.importState(t),!0))}exportState(){return Ui(null,Object.assign({},this.viewProps.exportState()))}},dZ=class extends Yb{get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get title(){var e;return(e=this.controller.buttonController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.buttonController.props.set("title",e)}on(e,t){const i=t.bind(this);return this.controller.buttonController.emitter.on(e,()=>{i(new wp(this))}),this}};function pZ(n,e,t){t?n.classList.add(e):n.classList.remove(e)}function ka(n,e){return t=>{pZ(n,e,t)}}function Qb(n,e){bs(n,t=>{e.textContent=t??""})}const Um=W("btn");let mZ=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Um()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("button");i.classList.add(Um("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(Um("t")),Qb(t.props.value("title"),s),this.buttonElement.appendChild(s)}},vZ=class{constructor(e,t){this.emitter=new kn,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new mZ(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(e){return Ki(e,null,t=>({title:t.optional.string}),t=>(this.props.set("title",t.title),!0))}exportProps(){return Ui(null,{title:this.props.get("title")})}onClick_(){this.emitter.emit("click",{sender:this})}},oE=class extends c2{constructor(e,t){const i=new vZ(e,{props:t.buttonProps,viewProps:t.viewProps}),s=new hZ(e,{blade:t.blade,props:t.labelProps,valueController:i});super({blade:t.blade,view:s.view,viewProps:t.viewProps}),this.buttonController=i,this.labelController=s}importState(e){return Ki(e,t=>super.importState(t)&&this.buttonController.importProps(t)&&this.labelController.importProps(t),()=>({}),()=>!0)}exportState(){return Ui(()=>super.exportState(),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}},fZ=class{constructor(e){const[t,i]=e.split("-"),s=t.split(".");this.major=parseInt(s[0],10),this.minor=parseInt(s[1],10),this.patch=parseInt(s[2],10),this.prerelease=i??null}toString(){const e=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[e,this.prerelease].join("-"):e}};const _Z=new fZ("2.0.1");function St(n){return Object.assign({core:_Z},n)}St({id:"button",type:"blade",accept(n){const e=bt(n,t=>({title:t.required.string,view:t.required.constant("button"),label:t.optional.string}));return e?{params:e}:null},controller(n){return new oE(n.document,{blade:n.blade,buttonProps:ge.fromObject({title:n.params.title}),labelProps:ge.fromObject({label:n.params.label}),viewProps:n.viewProps})},api(n){return n.controller instanceof oE?new dZ(n.controller):null}});function wZ(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}function bZ(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}function gZ(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}function CZ(n){return Hb(n)?"refresh"in n&&typeof n.refresh=="function":!1}function PZ(n,e){if(!tE.isBindable(n))throw So.notBindable();return new tE(n,e)}let yZ=class{constructor(e,t){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=e,this.emitter_=new kn,this.pool_=t,this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map(e=>this.pool_.createApi(e))}addBinding(e,t,i){const s=i??{},r=this.controller_.element.ownerDocument,o=this.pool_.createBinding(r,PZ(e,t),s),l=this.pool_.createBindingApi(o);return this.add(l,s.index)}addFolder(e){return bZ(this,e)}addButton(e){return wZ(this,e)}addTab(e){return gZ(this,e)}add(e,t){const i=e.controller;return this.controller_.rack.add(i,t),e}remove(e){this.controller_.rack.remove(e.controller)}addBlade(e){const t=this.controller_.element.ownerDocument,i=this.pool_.createBlade(t,e),s=this.pool_.createApi(i);return this.add(s,e.index)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}refresh(){this.children.forEach(e=>{CZ(e)&&e.refresh()})}onRackValueChange_(e){const t=e.bladeController,i=this.pool_.createApi(t),s=nZ(t.value)?t.value.binding:null;this.emitter_.emit("change",new l2(i,s?s.target.read():t.value.rawValue,e.options.last))}},Jb=class extends Yb{constructor(e,t){super(e),this.rackApi_=new yZ(e.rackController,t)}refresh(){this.rackApi_.refresh()}},eg=class extends c2{constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps}),this.rackController=e.rackController}importState(e){return Ki(e,t=>super.importState(t),t=>({children:t.required.array(t.required.raw)}),t=>this.rackController.rack.children.every((i,s)=>i.importState(t.children[s])))}exportState(){return Ui(()=>super.exportState(),{children:this.rackController.rack.children.map(e=>e.exportState())})}};function rf(n){return"rackController"in n}let EZ=class{constructor(e){this.emitter=new kn,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const t of this.allItems())if(e(t))return t;return null}includes(e){return this.cache_.has(e)}add(e,t){if(this.includes(e))throw So.shouldNeverHappen();const i=t!==void 0?t:this.items_.length;this.items_.splice(i,0,e),this.cache_.add(e);const s=this.extract_(e);s&&(s.emitter.on("add",this.onSubListAdd_),s.emitter.on("remove",this.onSubListRemove_),s.allItems().forEach(r=>{this.cache_.add(r)})),this.emitter.emit("add",{index:i,item:e,root:this,target:this})}remove(e){const t=this.items_.indexOf(e);if(t<0)return;this.items_.splice(t,1),this.cache_.delete(e);const i=this.extract_(e);i&&(i.allItems().forEach(s=>{this.cache_.delete(s)}),i.emitter.off("add",this.onSubListAdd_),i.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}};function xZ(n,e){for(let t=0;t<n.length;t++){const i=n[t];if(Mc(i)&&i.value===e)return i}return null}function $Z(n){return rf(n)?n.rackController.rack.bcSet_:null}let VZ=class{constructor(e){var t,i;this.emitter=new kn,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=(t=e.blade)!==null&&t!==void 0?t:null,(i=this.blade_)===null||i===void 0||i.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=e.viewProps,this.bcSet_=new EZ($Z),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,t){var i;(i=e.parent)===null||i===void 0||i.remove(e),e.parent=this,this.bcSet_.add(e,t)}remove(e){e.parent=null,this.bcSet_.remove(e)}find(e){return this.bcSet_.allItems().filter(e)}onSetAdd_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,root:t,sender:this}),!t)return;const i=e.item;if(i.viewProps.emitter.on("change",this.onChildViewPropsChange_),i.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),i.viewProps.handleDispose(this.onChildDispose_),Mc(i))i.value.emitter.on("change",this.onChildValueChange_);else if(rf(i)){const s=i.rackController.rack;if(s){const r=s.emitter;r.on("layout",this.onRackLayout_),r.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,root:t,sender:this}),!t)return;const i=e.item;if(Mc(i))i.value.emitter.off("change",this.onChildValueChange_);else if(rf(i)){const s=i.rackController.rack;if(s){const r=s.emitter;r.off("layout",this.onRackLayout_),r.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){const e=this.bcSet_.items.filter(s=>!s.viewProps.get("hidden")),t=e[0],i=e[e.length-1];this.bcSet_.items.forEach(s=>{const r=[];s===t&&(r.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&r.push("veryfirst")),s===i&&(r.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&r.push("verylast")),s.blade.set("positions",r)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(t=>t.viewProps.get("disposed")).forEach(t=>{this.bcSet_.remove(t)})}onChildValueChange_(e){const t=xZ(this.find(Mc),e.sender);if(!t)throw So.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:t,options:e.options,sender:this})}onRackLayout_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(e){this.emitter.emit("valuechange",{bladeController:e.bladeController,options:e.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}},tg=class{constructor(e){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=e.element,this.viewProps=e.viewProps;const t=new VZ({blade:e.root?void 0:e.blade,viewProps:e.viewProps});t.emitter.on("add",this.onRackAdd_),t.emitter.on("remove",this.onRackRemove_),this.rack=t,this.viewProps.handleDispose(()=>{for(let i=this.rack.children.length-1;i>=0;i--)this.rack.children[i].viewProps.set("disposed",!0)})}onRackAdd_(e){e.root&&a2(this.element,e.bladeController.view.element,e.index)}onRackRemove_(e){e.root&&Zb(e.bladeController.view.element)}};function d2(){return new ge({positions:at([],{equals:mW})})}let ng=class p2 extends ge{constructor(e){super(e)}static create(e){const t={completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},i=ge.createCore(t);return new p2(i)}get styleExpanded(){var e;return(e=this.get("temporaryExpanded"))!==null&&e!==void 0?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!Te(e)?`${e}px`:"auto"}bindExpandedClass(e,t){const i=()=>{this.styleExpanded?e.classList.add(t):e.classList.remove(t)};ki(this,"expanded",i),ki(this,"temporaryExpanded",i)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}};function kZ(n,e){let t=0;return iZ(e,()=>{n.set("expandedHeight",null),n.set("temporaryExpanded",!0),hd(e),t=e.clientHeight,n.set("temporaryExpanded",null),hd(e)}),t}function lE(n,e){e.style.height=n.styleHeight}function ig(n,e){n.value("expanded").emitter.on("beforechange",()=>{if(n.set("completed",!1),Te(n.get("expandedHeight"))){const t=kZ(n,e);t>0&&n.set("expandedHeight",t)}n.set("shouldFixHeight",!0),hd(e)}),n.emitter.on("change",()=>{lE(n,e)}),lE(n,e),e.addEventListener("transitionend",t=>{t.propertyName==="height"&&n.cleanUpTransition()})}let SZ=class extends Jb{constructor(e,t){super(e,t),this.emitter_=new kn,this.controller.foldable.value("expanded").emitter.on("change",i=>{this.emitter_.emit("fold",new ZW(this,i.sender.rawValue))}),this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)})}get expanded(){return this.controller.foldable.get("expanded")}set expanded(e){this.controller.foldable.set("expanded",e)}get title(){return this.controller.props.get("title")}set title(e){this.controller.props.set("title",e)}get children(){return this.rackApi_.children}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){return this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}};const m2=W("cnt");let LZ=class{constructor(e,t){var i;this.className_=W((i=t.viewName)!==null&&i!==void 0?i:"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),m2()),t.viewProps.bindClassModifiers(this.element),this.foldable_=t.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),ki(this.foldable_,"completed",ka(this.element,this.className_(void 0,"cpl")));const s=e.createElement("button");s.classList.add(this.className_("b")),ki(t.props,"title",u=>{Te(u)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s;const r=e.createElement("div");r.classList.add(this.className_("i")),this.element.appendChild(r);const o=e.createElement("div");o.classList.add(this.className_("t")),Qb(t.props.value("title"),o),this.buttonElement.appendChild(o),this.titleElement=o;const l=e.createElement("div");l.classList.add(this.className_("m")),this.buttonElement.appendChild(l);const a=e.createElement("div");a.classList.add(this.className_("c")),this.element.appendChild(a),this.containerElement=a}},aE=class extends eg{constructor(e,t){var i;const s=ng.create((i=t.expanded)!==null&&i!==void 0?i:!0),r=new LZ(e,{foldable:s,props:t.props,viewName:t.root?"rot":void 0,viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new tg({blade:t.blade,element:r.containerElement,root:t.root,viewProps:t.viewProps}),view:r})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=t.props,this.foldable=s,ig(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(e){return Ki(e,t=>super.importState(t),t=>({expanded:t.required.boolean,title:t.optional.string}),t=>(this.foldable.set("expanded",t.expanded),this.props.set("title",t.title),!0))}exportState(){return Ui(()=>super.exportState(),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}};St({id:"folder",type:"blade",accept(n){const e=bt(n,t=>({title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean}));return e?{params:e}:null},controller(n){return new aE(n.document,{blade:n.blade,expanded:n.params.expanded,props:ge.fromObject({title:n.params.title}),viewProps:n.viewProps})},api(n){return n.controller instanceof aE?new SZ(n.controller,n.pool):null}});const AZ=W("");function uE(n,e){return ka(n,AZ(void 0,e))}let sg=class v2 extends ge{constructor(e){var t;super(e),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=gW(at(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(e){var t,i,s;const r=e??{};return new v2(ge.createCore({disabled:(t=r.disabled)!==null&&t!==void 0?t:!1,disposed:!1,hidden:(i=r.hidden)!==null&&i!==void 0?i:!1,parent:(s=r.parent)!==null&&s!==void 0?s:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(e){bs(this.globalDisabled_,uE(e,"disabled")),ki(this,"hidden",uE(e,"hidden"))}bindDisabled(e){bs(this.globalDisabled_,t=>{e.disabled=t})}bindTabIndex(e){bs(this.globalDisabled_,t=>{e.tabIndex=t?-1:0})}handleDispose(e){this.value("disposed").emitter.on("change",t=>{t&&e()})}importState(e){this.set("disabled",e.disabled),this.set("hidden",e.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){const e=this.get("parent");return(e?e.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(e){var t;const i=e.previousRawValue;i?.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}};const hE=W("tbp");let MZ=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(hE()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(hE("c")),this.element.appendChild(i),this.containerElement=i}};const hu=W("tbi");let TZ=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(hu()),t.viewProps.bindClassModifiers(this.element),ki(t.props,"selected",r=>{r?this.element.classList.add(hu(void 0,"sel")):this.element.classList.remove(hu(void 0,"sel"))});const i=e.createElement("button");i.classList.add(hu("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(hu("t")),Qb(t.props.value("title"),s),this.buttonElement.appendChild(s),this.titleElement=s}},DZ=class{constructor(e,t){this.emitter=new kn,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new TZ(e,{props:t.props,viewProps:t.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}},of=class extends eg{constructor(e,t){const i=new MZ(e,{viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new tg({blade:t.blade,element:i.containerElement,viewProps:t.viewProps}),view:i})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new DZ(e,{props:t.itemProps,viewProps:sg.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=t.props,ki(this.props,"selected",s=>{this.itemController.props.set("selected",s),this.viewProps.set("hidden",!s)})}get itemController(){return this.ic_}importState(e){return Ki(e,t=>super.importState(t),t=>({selected:t.required.boolean,title:t.required.string}),t=>(this.ic_.props.set("selected",t.selected),this.ic_.props.set("title",t.title),!0))}exportState(){return Ui(()=>super.exportState(),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}},RZ=class extends Jb{constructor(e,t){super(e,t),this.emitter_=new kn,this.onSelect_=this.onSelect_.bind(this),this.pool_=t,this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)}),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(e){const t=this.controller.view.element.ownerDocument,i=new of(t,{blade:d2(),itemProps:ge.fromObject({selected:!1,title:e.title}),props:ge.fromObject({selected:!1}),viewProps:sg.create()}),s=this.pool_.createApi(i);return this.rackApi_.add(s,e.index)}removePage(e){this.rackApi_.remove(this.rackApi_.children[e])}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}onSelect_(e){this.emitter_.emit("select",new QW(this,e.rawValue))}},OZ=class extends Jb{get title(){var e;return(e=this.controller.itemController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.itemController.props.set("title",e)}get selected(){return this.controller.props.get("selected")}set selected(e){this.controller.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addBlade(e){return this.rackApi_.addBlade(e)}};const cE=-1;let jZ=class{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=at(!0),this.selectedIndex=at(cE),this.items_=[]}add(e,t){const i=t??this.items_.length;this.items_.splice(i,0,e),e.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(e){const t=this.items_.indexOf(e);t<0||(this.items_.splice(t,1),e.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=cE,this.empty.rawValue=!0;return}const e=this.items_.findIndex(t=>t.rawValue);e<0?(this.items_.forEach((t,i)=>{t.rawValue=i===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((t,i)=>{t.rawValue=i===e}),this.selectedIndex.rawValue=e),this.empty.rawValue=!1}onItemSelectedChange_(e){if(e.rawValue){const t=this.items_.findIndex(i=>i===e.sender);this.items_.forEach((i,s)=>{i.rawValue=s===t}),this.selectedIndex.rawValue=t}else this.keepSelection_()}};const cu=W("tab");let NZ=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(cu(),m2()),t.viewProps.bindClassModifiers(this.element),bs(t.empty,ka(this.element,cu(void 0,"nop")));const i=e.createElement("div");i.classList.add(cu("t")),this.element.appendChild(i),this.itemsElement=i;const s=e.createElement("div");s.classList.add(cu("i")),this.element.appendChild(s);const r=e.createElement("div");r.classList.add(cu("c")),this.element.appendChild(r),this.contentsElement=r}},dE=class extends eg{constructor(e,t){const i=new jZ,s=new NZ(e,{empty:i.empty,viewProps:t.viewProps});super({blade:t.blade,rackController:new tg({blade:t.blade,element:s.contentsElement,viewProps:t.viewProps}),view:s}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const r=this.rackController.rack;r.emitter.on("add",this.onRackAdd_),r.emitter.on("remove",this.onRackRemove_),this.tab=i}add(e,t){this.rackController.rack.add(e,t)}remove(e){this.rackController.rack.remove(this.rackController.rack.children[e])}onRackAdd_(e){if(!e.root)return;const t=e.bladeController;a2(this.view.itemsElement,t.itemController.view.element,e.index),t.itemController.viewProps.set("parent",this.viewProps),this.tab.add(t.props.value("selected"))}onRackRemove_(e){if(!e.root)return;const t=e.bladeController;Zb(t.itemController.view.element),t.itemController.viewProps.set("parent",null),this.tab.remove(t.props.value("selected"))}};St({id:"tab",type:"blade",accept(n){const e=bt(n,t=>({pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")}));return!e||e.pages.length===0?null:{params:e}},controller(n){const e=new dE(n.document,{blade:n.blade,viewProps:n.viewProps});return n.params.pages.forEach(t=>{const i=new of(n.document,{blade:d2(),itemProps:ge.fromObject({selected:!1,title:t.title}),props:ge.fromObject({selected:!1}),viewProps:sg.create()});e.add(i)}),e},api(n){return n.controller instanceof dE?new RZ(n.controller,n.pool):n.controller instanceof of?new OZ(n.controller,n.pool):null}});let rg=class extends Xb{get options(){return this.controller.valueController.props.get("options")}set options(e){this.controller.valueController.props.set("options",e)}},Rh=class{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce((t,i)=>i.constrain(t),e)}};function cd(n,e){if(n instanceof e)return n;if(n instanceof Rh){const t=n.constraints.reduce((i,s)=>i||(s instanceof e?s:null),null);if(t)return t}return null}let gp=class{constructor(e){this.values=ge.fromObject({options:e})}constrain(e){const t=this.values.get("options");return t.length===0||t.filter(s=>s.value===e).length>0?e:t[0].value}};function Cp(n){var e;const t=sf;if(Array.isArray(n))return(e=bt({items:n},i=>({items:i.required.array(i.required.object({text:i.required.string,value:i.required.raw}))})))===null||e===void 0?void 0:e.items;if(typeof n=="object")return t.required.raw(n).value}function f2(n){if(Array.isArray(n))return n;const e=[];return Object.keys(n).forEach(t=>{e.push({text:t,value:n[t]})}),e}function og(n){return Te(n)?null:new gp(f2(n))}const Hm=W("lst");let BZ=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add(Hm()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("select");i.classList.add(Hm("s")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.selectElement=i;const s=e.createElement("div");s.classList.add(Hm("m")),s.appendChild(bp(e,"dropdown")),this.element.appendChild(s),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,ki(this.props_,"options",r=>{u2(this.selectElement),r.forEach(o=>{const l=e.createElement("option");l.textContent=o.text,this.selectElement.appendChild(l)}),this.update_()})}update_(){const e=this.props_.get("options").map(t=>t.value);this.selectElement.selectedIndex=e.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}},ia=class{constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new BZ(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const t=e.currentTarget;this.value.rawValue=this.props.get("options")[t.selectedIndex].value}importProps(e){return Ki(e,null,t=>({options:t.required.custom(Cp)}),t=>(this.props.set("options",f2(t.options)),!0))}exportProps(){return Ui(null,{options:this.props.get("options")})}};const pE=W("pop");let IZ=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(pE()),t.viewProps.bindClassModifiers(this.element),bs(t.shows,ka(this.element,pE(void 0,"v")))}},_2=class{constructor(e,t){this.shows=at(!1),this.viewProps=t.viewProps,this.view=new IZ(e,{shows:this.shows,viewProps:this.viewProps})}};const mE=W("txt");let FZ=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(mE()),t.viewProps.bindClassModifiers(this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);const i=e.createElement("input");i.classList.add(mE("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}},lg=class{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new FZ(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const i=e.currentTarget.value,s=this.parser_(i);Te(s)||(this.value.rawValue=s),this.view.refresh()}};function KZ(n){return String(n)}function w2(n){return n==="false"?!1:!!n}function vE(n){return KZ(n)}function UZ(n){return e=>n.reduce((t,i)=>t!==null?t:i(e),null)}const HZ=cn(0);function dd(n){return HZ(n)+"%"}function b2(n){return String(n)}function lf(n){return n}function Sa({primary:n,secondary:e,forward:t,backward:i}){let s=!1;function r(o){s||(s=!0,o(),s=!1)}n.emitter.on("change",o=>{r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),e.emitter.on("change",o=>{r(()=>{n.setRawValue(i(n.rawValue,e.rawValue),o.options)}),r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),{forceEmit:!1,last:!0})})}function tn(n,e){const t=n*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+t:e.downKey?-t:0}function Zu(n){return{altKey:n.altKey,downKey:n.key==="ArrowDown",shiftKey:n.shiftKey,upKey:n.key==="ArrowUp"}}function Ls(n){return{altKey:n.altKey,downKey:n.key==="ArrowLeft",shiftKey:n.shiftKey,upKey:n.key==="ArrowRight"}}function zZ(n){return n==="ArrowUp"||n==="ArrowDown"}function g2(n){return zZ(n)||n==="ArrowLeft"||n==="ArrowRight"}function zm(n,e){var t,i;const s=e.ownerDocument.defaultView,r=e.getBoundingClientRect();return{x:n.pageX-(((t=s&&s.scrollX)!==null&&t!==void 0?t:0)+r.left),y:n.pageY-(((i=s&&s.scrollY)!==null&&i!==void 0?i:0)+r.top)}}let qo=class{constructor(e){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new kn,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault(),(t=e.currentTarget)===null||t===void 0||t.focus();const i=this.elem_.ownerDocument;i.addEventListener("mousemove",this.onDocumentMouseMove_),i.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(zm(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(zm(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(zm(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchMove_(e){const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchEnd_(e){var t;const i=(t=e.targetTouches.item(0))!==null&&t!==void 0?t:this.lastTouch_,s=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(i?{x:i.clientX-s.left,y:i.clientY-s.top}:void 0),sender:this,shiftKey:e.shiftKey})}};const jn=W("txt");let qZ=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(jn(),jn(void 0,"num")),t.arrayPosition&&this.element.classList.add(jn(void 0,t.arrayPosition)),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(jn("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(jn()),this.inputElement.classList.add(jn("i"));const s=e.createElement("div");s.classList.add(jn("k")),this.element.appendChild(s),this.knobElement=s;const r=e.createElementNS(di,"svg");r.classList.add(jn("g")),this.knobElement.appendChild(r);const o=e.createElementNS(di,"path");o.classList.add(jn("gb")),r.appendChild(o),this.guideBodyElem_=o;const l=e.createElementNS(di,"path");l.classList.add(jn("gh")),r.appendChild(l),this.guideHeadElem_=l;const a=e.createElement("div");a.classList.add(W("tt")()),this.knobElement.appendChild(a),this.tooltipElem_=a,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.refresh()}onDraggingChange_(e){if(e.rawValue===null){this.element.classList.remove(jn(void 0,"drg"));return}this.element.classList.add(jn(void 0,"drg"));const t=e.rawValue/this.props_.get("pointerScale"),i=t+(t>0?-1:t<0?1:0),s=Ge(-i,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${i+s},0 L${i},4 L${i+s},8`,`M ${t},-1 L${t},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${t},4`);const r=this.props_.get("formatter");this.tooltipElem_.textContent=r(this.value.rawValue),this.tooltipElem_.style.left=`${t}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}},Oh=class{constructor(e,t){var i;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=t.parser,this.props=t.props,this.sliderProps_=(i=t.sliderProps)!==null&&i!==void 0?i:null,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=at(null),this.view=new qZ(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const s=new qo(this.view.knobElement);s.emitter.on("down",this.onPointerDown_),s.emitter.on("move",this.onPointerMove_),s.emitter.on("up",this.onPointerUp_)}constrainValue_(e){var t,i;const s=(t=this.sliderProps_)===null||t===void 0?void 0:t.get("min"),r=(i=this.sliderProps_)===null||i===void 0?void 0:i.get("max");let o=e;return s!==void 0&&(o=Math.max(o,s)),r!==void 0&&(o=Math.min(o,r)),o}onInputChange_(e){const i=e.currentTarget.value,s=this.parser_(i);Te(s)||(this.value.rawValue=this.constrainValue_(s)),this.view.refresh()}onInputKeyDown_(e){const t=tn(this.props.get("keyScale"),Zu(e));t!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+t),{forceEmit:!1,last:!1})}onInputKeyUp_(e){tn(this.props.get("keyScale"),Zu(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;const t=e.point.x-e.bounds.width/2;return this.constrainValue_(this.originRawValue_+t*this.props.get("pointerScale"))}onPointerMove_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}};const qm=W("sld");let GZ=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(qm()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(qm("t")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.trackElement=i;const s=e.createElement("div");s.classList.add(qm("k")),this.trackElement.appendChild(s),this.knobElement=s,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}update_(){const e=Ge(le(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${e}%`}onChange_(){this.update_()}},YZ=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.props=t.props,this.view=new GZ(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new qo(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){e.point&&this.value.setRawValue(le(Ge(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("min"),this.props.get("max")),t)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=tn(this.props.get("keyScale"),Ls(e));t!==0&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onKeyUp_(e){tn(this.props.get("keyScale"),Ls(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const Gm=W("sldtxt");let XZ=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Gm());const i=e.createElement("div");i.classList.add(Gm("s")),this.sliderView_=t.sliderView,i.appendChild(this.sliderView_.element),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Gm("t")),this.textView_=t.textView,s.appendChild(this.textView_.element),this.element.appendChild(s)}},fE=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sliderC_=new YZ(e,{props:t.sliderProps,value:t.value,viewProps:this.viewProps}),this.textC_=new Oh(e,{parser:t.parser,props:t.textProps,sliderProps:t.sliderProps,value:t.value,viewProps:t.viewProps}),this.view=new XZ(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(e){return Ki(e,null,t=>({max:t.required.number,min:t.required.number}),t=>{const i=this.sliderC_.props;return i.set("max",t.max),i.set("min",t.min),!0})}exportProps(){const e=this.sliderC_.props;return Ui(null,{max:e.get("max"),min:e.get("min")})}};function WZ(n){return{sliderProps:new ge({keyScale:n.keyScale,max:n.max,min:n.min}),textProps:new ge({formatter:at(n.formatter),keyScale:n.keyScale,pointerScale:at(n.pointerScale)})}}const ZZ={containerUnitSize:"cnt-usz"};function C2(n){return`--${ZZ[n]}`}function Qu(n){return o2(n)}function fr(n){if(nf(n))return bt(n,Qu)}function hs(n,e){if(!n)return;const t=[],i=i2(n,e);i&&t.push(i);const s=s2(n);return s&&t.push(s),new Rh(t)}function P2(n){if(n==="inline"||n==="popup")return n}function jh(n,e){n.write(e)}const uc=W("ckb");let QZ=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(uc()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("label");i.classList.add(uc("l")),this.element.appendChild(i);const s=e.createElement("input");s.classList.add(uc("i")),s.type="checkbox",i.appendChild(s),this.inputElement=s,t.viewProps.bindDisabled(this.inputElement);const r=e.createElement("div");r.classList.add(uc("w")),i.appendChild(r);const o=bp(e,"check");r.appendChild(o),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}},JZ=class{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new QZ(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const t=e.currentTarget;this.value.rawValue=t.checked}};function eQ(n){const e=[],t=og(n.options);return t&&e.push(t),new Rh(e)}St({id:"input-bool",type:"input",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=bt(e,i=>({options:i.optional.custom(Cp),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>w2,constraint:n=>eQ(n.params),writer:n=>jh},controller:n=>{const e=n.document,t=n.value,i=n.constraint,s=i&&cd(i,gp);return s?new ia(e,{props:new ge({options:s.values.value("options")}),value:t,viewProps:n.viewProps}):new JZ(e,{value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="boolean"?null:n.controller.valueController instanceof ia?new rg(n.controller):null}});const eo=W("col");let tQ=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(eo()),t.foldable.bindExpandedClass(this.element,eo(void 0,"expanded")),ki(t.foldable,"completed",ka(this.element,eo(void 0,"cpl")));const i=e.createElement("div");i.classList.add(eo("h")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(eo("s")),i.appendChild(s),this.swatchElement=s;const r=e.createElement("div");if(r.classList.add(eo("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(eo("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}};function nQ(n,e,t){const i=Ge(n/255,0,1),s=Ge(e/255,0,1),r=Ge(t/255,0,1),o=Math.max(i,s,r),l=Math.min(i,s,r),a=o-l;let u=0,h=0;const c=(l+o)/2;return a!==0&&(h=a/(1-Math.abs(o+l-1)),i===o?u=(s-r)/a:s===o?u=2+(r-i)/a:u=4+(i-s)/a,u=u/6+(u<0?1:0)),[u*360,h*100,c*100]}function iQ(n,e,t){const i=(n%360+360)%360,s=Ge(e/100,0,1),r=Ge(t/100,0,1),o=(1-Math.abs(2*r-1))*s,l=o*(1-Math.abs(i/60%2-1)),a=r-o/2;let u,h,c;return i>=0&&i<60?[u,h,c]=[o,l,0]:i>=60&&i<120?[u,h,c]=[l,o,0]:i>=120&&i<180?[u,h,c]=[0,o,l]:i>=180&&i<240?[u,h,c]=[0,l,o]:i>=240&&i<300?[u,h,c]=[l,0,o]:[u,h,c]=[o,0,l],[(u+a)*255,(h+a)*255,(c+a)*255]}function sQ(n,e,t){const i=Ge(n/255,0,1),s=Ge(e/255,0,1),r=Ge(t/255,0,1),o=Math.max(i,s,r),l=Math.min(i,s,r),a=o-l;let u;a===0?u=0:o===i?u=60*(((s-r)/a%6+6)%6):o===s?u=60*((r-i)/a+2):u=60*((i-s)/a+4);const h=o===0?0:a/o,c=o;return[u,h*100,c*100]}function y2(n,e,t){const i=t2(n,360),s=Ge(e/100,0,1),r=Ge(t/100,0,1),o=r*s,l=o*(1-Math.abs(i/60%2-1)),a=r-o;let u,h,c;return i>=0&&i<60?[u,h,c]=[o,l,0]:i>=60&&i<120?[u,h,c]=[l,o,0]:i>=120&&i<180?[u,h,c]=[0,o,l]:i>=180&&i<240?[u,h,c]=[0,l,o]:i>=240&&i<300?[u,h,c]=[l,0,o]:[u,h,c]=[o,0,l],[(u+a)*255,(h+a)*255,(c+a)*255]}function rQ(n,e,t){const i=t+e*(100-Math.abs(2*t-100))/200;return[n,i!==0?e*(100-Math.abs(2*t-100))/i:0,t+e*(100-Math.abs(2*t-100))/(2*100)]}function oQ(n,e,t){const i=100-Math.abs(t*(200-e)/100-100);return[n,i!==0?e*t/i:0,t*(200-e)/(2*100)]}function Si(n){return[n[0],n[1],n[2]]}function Pp(n,e){return[n[0],n[1],n[2],e]}const lQ={hsl:{hsl:(n,e,t)=>[n,e,t],hsv:rQ,rgb:iQ},hsv:{hsl:oQ,hsv:(n,e,t)=>[n,e,t],rgb:y2},rgb:{hsl:nQ,hsv:sQ,rgb:(n,e,t)=>[n,e,t]}};function sa(n,e){return[e==="float"?1:n==="rgb"?255:360,e==="float"?1:n==="rgb"?255:100,e==="float"?1:n==="rgb"?255:100]}function aQ(n,e){return n===e?e:t2(n,e)}function E2(n,e,t){var i;const s=sa(e,t);return[e==="rgb"?Ge(n[0],0,s[0]):aQ(n[0],s[0]),Ge(n[1],0,s[1]),Ge(n[2],0,s[2]),Ge((i=n[3])!==null&&i!==void 0?i:1,0,1)]}function _E(n,e,t,i){const s=sa(e,t),r=sa(e,i);return n.map((o,l)=>o/s[l]*r[l])}function x2(n,e,t){const i=_E(n,e.mode,e.type,"int"),s=lQ[e.mode][t.mode](...i);return _E(s,t.mode,"int",t.type)}let ve=class $2{static black(){return new $2([0,0,0],"rgb")}constructor(e,t){this.type="int",this.mode=t,this.comps_=E2(e,t,this.type)}getComponents(e){return Pp(x2(Si(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}};const tr=W("colp");let uQ=class{constructor(e,t){this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(tr()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(tr("hsv"));const s=e.createElement("div");s.classList.add(tr("sv")),this.svPaletteView_=t.svPaletteView,s.appendChild(this.svPaletteView_.element),i.appendChild(s);const r=e.createElement("div");r.classList.add(tr("h")),this.hPaletteView_=t.hPaletteView,r.appendChild(this.hPaletteView_.element),i.appendChild(r),this.element.appendChild(i);const o=e.createElement("div");if(o.classList.add(tr("rgb")),this.textsView_=t.textsView,o.appendChild(this.textsView_.element),this.element.appendChild(o),t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};const l=e.createElement("div");l.classList.add(tr("a"));const a=e.createElement("div");a.classList.add(tr("ap")),a.appendChild(this.alphaViews_.palette.element),l.appendChild(a);const u=e.createElement("div");u.classList.add(tr("at")),u.appendChild(this.alphaViews_.text.element),l.appendChild(u),this.element.appendChild(l)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map(t=>t.inputElement)];return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}};function hQ(n){return n==="int"?"int":n==="float"?"float":void 0}function ag(n){return bt(n,e=>({color:e.optional.object({alpha:e.optional.boolean,type:e.optional.custom(hQ)}),expanded:e.optional.boolean,picker:e.optional.custom(P2),readonly:e.optional.constant(!1)}))}function Lo(n){return n?.1:1}function V2(n){var e;return(e=n.color)===null||e===void 0?void 0:e.type}let ug=class{constructor(e,t){this.type="float",this.mode=t,this.comps_=E2(e,t,this.type)}getComponents(e){return Pp(x2(Si(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}};const cQ={int:(n,e)=>new ve(n,e),float:(n,e)=>new ug(n,e)};function hg(n,e,t){return cQ[t](n,e)}function dQ(n){return n.type==="float"}function pQ(n){return n.type==="int"}function mQ(n){const e=n.getComponents(),t=sa(n.mode,"int");return new ve([Math.round(le(e[0],0,1,0,t[0])),Math.round(le(e[1],0,1,0,t[1])),Math.round(le(e[2],0,1,0,t[2])),e[3]],n.mode)}function vQ(n){const e=n.getComponents(),t=sa(n.mode,"int");return new ug([le(e[0],0,t[0],0,1),le(e[1],0,t[1],0,1),le(e[2],0,t[2],0,1),e[3]],n.mode)}function Ft(n,e){if(n.type===e)return n;if(pQ(n)&&e==="float")return vQ(n);if(dQ(n)&&e==="int")return mQ(n);throw So.shouldNeverHappen()}function fQ(n,e){return n.alpha===e.alpha&&n.mode===e.mode&&n.notation===e.notation&&n.type===e.type}function qn(n,e){const t=n.match(/^(.+)%$/);return Math.min(t?parseFloat(t[1])*.01*e:parseFloat(n),e)}const _Q={deg:n=>n,grad:n=>n*360/400,rad:n=>n*360/(2*Math.PI),turn:n=>n*360};function k2(n){const e=n.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(n);const t=parseFloat(e[1]),i=e[2];return _Q[i](t)}function S2(n){const e=n.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[qn(e[1],255),qn(e[2],255),qn(e[3],255)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function wQ(n){const e=S2(n);return e?new ve(e,"rgb"):null}function L2(n){const e=n.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[qn(e[1],255),qn(e[2],255),qn(e[3],255),qn(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function bQ(n){const e=L2(n);return e?new ve(e,"rgb"):null}function A2(n){const e=n.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[k2(e[1]),qn(e[2],100),qn(e[3],100)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function gQ(n){const e=A2(n);return e?new ve(e,"hsl"):null}function M2(n){const e=n.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[k2(e[1]),qn(e[2],100),qn(e[3],100),qn(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function CQ(n){const e=M2(n);return e?new ve(e,"hsl"):null}function T2(n){const e=n.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];const t=n.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}function PQ(n){const e=T2(n);return e?new ve(e,"rgb"):null}function D2(n){const e=n.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),le(parseInt(e[4]+e[4],16),0,255,0,1)];const t=n.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),le(parseInt(t[4],16),0,255,0,1)]:null}function yQ(n){const e=D2(n);return e?new ve(e,"rgb"):null}function R2(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function wE(n){return e=>{const t=R2(e);return t?hg(t,"rgb",n):null}}function O2(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function bE(n){return e=>{const t=O2(e);return t?hg(t,"rgb",n):null}}const EQ=[{parser:T2,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:D2,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:S2,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:L2,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:A2,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:M2,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:R2,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:O2,result:{alpha:!0,mode:"rgb",notation:"object"}}];function xQ(n){return EQ.reduce((e,{parser:t,result:i})=>e||(t(n)?i:null),null)}function $Q(n,e="int"){const t=xQ(n);return t?t.notation==="hex"&&e!=="float"?Object.assign(Object.assign({},t),{type:"int"}):t.notation==="func"?Object.assign(Object.assign({},t),{type:e}):null:null}function Nh(n){const e=[PQ,yQ,wQ,bQ,gQ,CQ];n==="int"&&e.push(wE("int"),bE("int")),n==="float"&&e.push(wE("float"),bE("float"));const t=UZ(e);return i=>{const s=t(i);return s?Ft(s,n):null}}function VQ(n){const e=Nh("int");if(typeof n!="string")return ve.black();const t=e(n);return t??ve.black()}function j2(n){const e=Ge(Math.floor(n),0,255).toString(16);return e.length===1?`0${e}`:e}function cg(n,e="#"){const t=Si(n.getComponents("rgb")).map(j2).join("");return`${e}${t}`}function dg(n,e="#"){const t=n.getComponents("rgb"),i=[t[0],t[1],t[2],t[3]*255].map(j2).join("");return`${e}${i}`}function N2(n){const e=cn(0),t=Ft(n,"int");return`rgb(${Si(t.getComponents("rgb")).map(s=>e(s)).join(", ")})`}function Tc(n){const e=cn(2),t=cn(0);return`rgba(${Ft(n,"int").getComponents("rgb").map((r,o)=>(o===3?e:t)(r)).join(", ")})`}function kQ(n){const e=[cn(0),dd,dd],t=Ft(n,"int");return`hsl(${Si(t.getComponents("hsl")).map((s,r)=>e[r](s)).join(", ")})`}function SQ(n){const e=[cn(0),dd,dd,cn(2)];return`hsla(${Ft(n,"int").getComponents("hsl").map((s,r)=>e[r](s)).join(", ")})`}function B2(n,e){const t=cn(e==="float"?2:0),i=["r","g","b"],s=Ft(n,e);return`{${Si(s.getComponents("rgb")).map((o,l)=>`${i[l]}: ${t(o)}`).join(", ")}}`}function LQ(n){return e=>B2(e,n)}function I2(n,e){const t=cn(2),i=cn(e==="float"?2:0),s=["r","g","b","a"];return`{${Ft(n,e).getComponents("rgb").map((l,a)=>{const u=a===3?t:i;return`${s[a]}: ${u(l)}`}).join(", ")}}`}function AQ(n){return e=>I2(e,n)}const MQ=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:cg},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:dg},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:N2},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:Tc},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:kQ},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:SQ},...["int","float"].reduce((n,e)=>[...n,{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:LQ(e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:AQ(e)}],[])];function F2(n){return MQ.reduce((e,t)=>e||(fQ(t.format,n)?t.stringifier:null),null)}const du=W("apl");let TQ=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(du()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(du("b")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(du("c")),i.appendChild(s),this.colorElem_=s;const r=e.createElement("div");r.classList.add(du("m")),this.element.appendChild(r),this.markerElem_=r;const o=e.createElement("div");o.classList.add(du("p")),this.markerElem_.appendChild(o),this.previewElem_=o,this.update_()}update_(){const e=this.value.rawValue,t=e.getComponents("rgb"),i=new ve([t[0],t[1],t[2],0],"rgb"),s=new ve([t[0],t[1],t[2],255],"rgb"),r=["to right",Tc(i),Tc(s)];this.colorElem_.style.background=`linear-gradient(${r.join(",")})`,this.previewElem_.style.backgroundColor=Tc(e);const o=le(t[3],0,1,0,100);this.markerElem_.style.left=`${o}%`}onValueChange_(){this.update_()}},DQ=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new TQ(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new qo(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=e.point.x/e.bounds.width,s=this.value.rawValue,[r,o,l]=s.getComponents("hsv");this.value.setRawValue(new ve([r,o,l,i],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=tn(Lo(!0),Ls(e));if(t===0)return;const i=this.value.rawValue,[s,r,o,l]=i.getComponents("hsv");this.value.setRawValue(new ve([s,r,o,l+t],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){tn(Lo(!0),Ls(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const cl=W("coltxt");function RQ(n){const e=n.createElement("select"),t=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}];return e.appendChild(t.reduce((i,s)=>{const r=n.createElement("option");return r.textContent=s.text,r.value=s.value,i.appendChild(r),i},n.createDocumentFragment())),e}let OQ=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(cl()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(cl("m")),this.modeElem_=RQ(e),this.modeElem_.classList.add(cl("ms")),i.appendChild(this.modeSelectElement),t.viewProps.bindDisabled(this.modeElem_);const s=e.createElement("div");s.classList.add(cl("mm")),s.appendChild(bp(e,"dropdown")),i.appendChild(s),this.element.appendChild(i);const r=e.createElement("div");r.classList.add(cl("w")),this.element.appendChild(r),this.inputsElem_=r,this.inputViews_=t.inputViews,this.applyInputViews_(),bs(t.mode,o=>{this.modeElem_.value=o})}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(e){this.inputViews_=e,this.applyInputViews_()}applyInputViews_(){u2(this.inputsElem_);const e=this.element.ownerDocument;this.inputViews_.forEach(t=>{const i=e.createElement("div");i.classList.add(cl("c")),i.appendChild(t.element),this.inputsElem_.appendChild(i)})}};function jQ(n){return cn(n==="float"?2:0)}function NQ(n,e,t){const i=sa(n,e)[t];return new _p({min:0,max:i})}function BQ(n,e,t){return new Oh(n,{arrayPosition:t===0?"fst":t===2?"lst":"mid",parser:e.parser,props:ge.fromObject({formatter:jQ(e.colorType),keyScale:Lo(!1),pointerScale:e.colorType==="float"?.01:1}),value:at(0,{constraint:NQ(e.colorMode,e.colorType,t)}),viewProps:e.viewProps})}function IQ(n,e){const t={colorMode:e.colorMode,colorType:e.colorType,parser:Rr,viewProps:e.viewProps};return[0,1,2].map(i=>{const s=BQ(n,t,i);return Sa({primary:e.value,secondary:s.value,forward(r){return Ft(r,e.colorType).getComponents(e.colorMode)[i]},backward(r,o){const l=e.colorMode,u=Ft(r,e.colorType).getComponents(l);u[i]=o;const h=hg(Pp(Si(u),u[3]),l,e.colorType);return Ft(h,"int")}}),s})}function FQ(n,e){const t=new lg(n,{parser:Nh("int"),props:ge.fromObject({formatter:cg}),value:at(ve.black()),viewProps:e.viewProps});return Sa({primary:e.value,secondary:t.value,forward:i=>new ve(Si(i.getComponents()),i.mode),backward:(i,s)=>new ve(Pp(Si(s.getComponents(i.mode)),i.getComponents()[3]),i.mode)}),[t]}function KQ(n){return n!=="hex"}let UQ=class{constructor(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=t.colorType,this.value=t.value,this.viewProps=t.viewProps,this.colorMode=at(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new OQ(e,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const t=this.colorMode.rawValue;return KQ(t)?IQ(e,{colorMode:t,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):FQ(e,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(e){const t=e.currentTarget;this.colorMode.rawValue=t.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map(i=>i.view)}};const Ym=W("hpl");let HQ=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Ym()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(Ym("c")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(Ym("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=this.value.rawValue,[t]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=N2(new ve([t,100,100],"hsv"));const i=le(t,0,360,0,100);this.markerElem_.style.left=`${i}%`}onValueChange_(){this.update_()}},zQ=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new HQ(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new qo(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=le(Ge(e.point.x,0,e.bounds.width),0,e.bounds.width,0,360),s=this.value.rawValue,[,r,o,l]=s.getComponents("hsv");this.value.setRawValue(new ve([i,r,o,l],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=tn(Lo(!1),Ls(e));if(t===0)return;const i=this.value.rawValue,[s,r,o,l]=i.getComponents("hsv");this.value.setRawValue(new ve([s+t,r,o,l],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){tn(Lo(!1),Ls(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const Xm=W("svp"),gE=64;let qQ=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Xm()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("canvas");i.height=gE,i.width=gE,i.classList.add(Xm("c")),this.element.appendChild(i),this.canvasElement=i;const s=e.createElement("div");s.classList.add(Xm("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=sZ(this.canvasElement);if(!e)return;const i=this.value.rawValue.getComponents("hsv"),s=this.canvasElement.width,r=this.canvasElement.height,o=e.getImageData(0,0,s,r),l=o.data;for(let h=0;h<r;h++)for(let c=0;c<s;c++){const p=le(c,0,s,0,100),d=le(h,0,r,100,0),m=y2(i[0],p,d),f=(h*s+c)*4;l[f]=m[0],l[f+1]=m[1],l[f+2]=m[2],l[f+3]=255}e.putImageData(o,0,0);const a=le(i[1],0,100,0,100);this.markerElem_.style.left=`${a}%`;const u=le(i[2],0,100,100,0);this.markerElem_.style.top=`${u}%`}onValueChange_(){this.update_()}},GQ=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new qQ(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new qo(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=le(e.point.x,0,e.bounds.width,0,100),s=le(e.point.y,0,e.bounds.height,100,0),[r,,,o]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new ve([r,i,s,o],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){g2(e.key)&&e.preventDefault();const[t,i,s,r]=this.value.rawValue.getComponents("hsv"),o=Lo(!1),l=tn(o,Ls(e)),a=tn(o,Zu(e));l===0&&a===0||this.value.setRawValue(new ve([t,i+l,s+a,r],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){const t=Lo(!1),i=tn(t,Ls(e)),s=tn(t,Zu(e));i===0&&s===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},YQ=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.hPaletteC_=new zQ(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new GQ(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=t.supportsAlpha?{palette:new DQ(e,{value:this.value,viewProps:this.viewProps}),text:new Oh(e,{parser:Rr,props:ge.fromObject({pointerScale:.01,keyScale:.1,formatter:cn(2)}),value:at(0,{constraint:new _p({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Sa({primary:this.value,secondary:this.alphaIcs_.text.value,forward:i=>i.getComponents()[3],backward:(i,s)=>{const r=i.getComponents();return r[3]=s,new ve(r,i.mode)}}),this.textsC_=new UQ(e,{colorType:t.colorType,value:this.value,viewProps:this.viewProps}),this.view=new uQ(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}};const Wm=W("colsw");let XQ=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(Wm()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(Wm("sw")),this.element.appendChild(i),this.swatchElem_=i;const s=e.createElement("button");s.classList.add(Wm("b")),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s,this.update_()}update_(){const e=this.value.rawValue;this.swatchElem_.style.backgroundColor=dg(e)}onValueChange_(){this.update_()}},WQ=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new XQ(e,{value:this.value,viewProps:this.viewProps})}},pg=class{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=ng.create(t.expanded),this.swatchC_=new WQ(e,{value:this.value,viewProps:this.viewProps});const i=this.swatchC_.view.buttonElement;i.addEventListener("blur",this.onButtonBlur_),i.addEventListener("click",this.onButtonClick_),this.textC_=new lg(e,{parser:t.parser,props:ge.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new tQ(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=t.pickerLayout==="popup"?new _2(e,{viewProps:this.viewProps}):null;const s=new YQ(e,{colorType:t.colorType,supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});s.view.allFocusableElements.forEach(r=>{r.addEventListener("blur",this.onPopupChildBlur_),r.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=s,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(s.view.element),Sa({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:r=>r,backward:(r,o)=>o})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),ig(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=h2(e);i&&t.contains(i)||i&&i===this.swatchC_.view.buttonElement&&!Wb(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}};function ZQ(n){return Si(n.getComponents("rgb")).reduce((e,t)=>e<<8|Math.floor(t)&255,0)}function QQ(n){return n.getComponents("rgb").reduce((e,t,i)=>{const s=Math.floor(i===3?t*255:t)&255;return e<<8|s},0)>>>0}function JQ(n){return new ve([n>>16&255,n>>8&255,n&255],"rgb")}function eJ(n){return new ve([n>>24&255,n>>16&255,n>>8&255,le(n&255,0,255,0,1)],"rgb")}function tJ(n){return typeof n!="number"?ve.black():JQ(n)}function nJ(n){return typeof n!="number"?ve.black():eJ(n)}function Dc(n,e){return typeof n!="object"||Te(n)?!1:e in n&&typeof n[e]=="number"}function K2(n){return Dc(n,"r")&&Dc(n,"g")&&Dc(n,"b")}function U2(n){return K2(n)&&Dc(n,"a")}function H2(n){return K2(n)}function mg(n,e){if(n.mode!==e.mode||n.type!==e.type)return!1;const t=n.getComponents(),i=e.getComponents();for(let s=0;s<t.length;s++)if(t[s]!==i[s])return!1;return!0}function CE(n){return"a"in n?[n.r,n.g,n.b,n.a]:[n.r,n.g,n.b]}function iJ(n){const e=F2(n);return e?(t,i)=>{jh(t,e(i))}:null}function sJ(n){const e=n?QQ:ZQ;return(t,i)=>{jh(t,e(i))}}function rJ(n,e,t){const s=Ft(e,t).toRgbaObject();n.writeProperty("r",s.r),n.writeProperty("g",s.g),n.writeProperty("b",s.b),n.writeProperty("a",s.a)}function oJ(n,e,t){const s=Ft(e,t).toRgbaObject();n.writeProperty("r",s.r),n.writeProperty("g",s.g),n.writeProperty("b",s.b)}function lJ(n,e){return(t,i)=>{n?rJ(t,i,e):oJ(t,i,e)}}function aJ(n){var e;return!!(!((e=n?.color)===null||e===void 0)&&e.alpha)}function uJ(n){return n?e=>dg(e,"0x"):e=>cg(e,"0x")}function hJ(n){return"color"in n||n.view==="color"}St({id:"input-color-number",type:"input",accept:(n,e)=>{if(typeof n!="number"||!hJ(e))return null;const t=ag(e);return t?{initialValue:n,params:Object.assign(Object.assign({},t),{supportsAlpha:aJ(e)})}:null},binding:{reader:n=>n.params.supportsAlpha?nJ:tJ,equals:mg,writer:n=>sJ(n.params.supportsAlpha)},controller:n=>{var e,t;return new pg(n.document,{colorType:"int",expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:uJ(n.params.supportsAlpha),parser:Nh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.supportsAlpha,value:n.value,viewProps:n.viewProps})}});function cJ(n,e){if(!H2(n))return Ft(ve.black(),e);if(e==="int"){const t=CE(n);return new ve(t,"rgb")}if(e==="float"){const t=CE(n);return new ug(t,"rgb")}return Ft(ve.black(),"int")}function dJ(n){return U2(n)}function pJ(n){return e=>{const t=cJ(e,n);return Ft(t,"int")}}function mJ(n,e){return t=>n?I2(t,e):B2(t,e)}St({id:"input-color-object",type:"input",accept:(n,e)=>{var t;if(!H2(n))return null;const i=ag(e);return i?{initialValue:n,params:Object.assign(Object.assign({},i),{colorType:(t=V2(e))!==null&&t!==void 0?t:"int"})}:null},binding:{reader:n=>pJ(n.params.colorType),equals:mg,writer:n=>lJ(dJ(n.initialValue),n.params.colorType)},controller:n=>{var e,t;const i=U2(n.initialValue);return new pg(n.document,{colorType:n.params.colorType,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:mJ(i,n.params.colorType),parser:Nh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:i,value:n.value,viewProps:n.viewProps})}});St({id:"input-color-string",type:"input",accept:(n,e)=>{if(typeof n!="string"||e.view==="text")return null;const t=$Q(n,V2(e));if(!t)return null;const i=F2(t);if(!i)return null;const s=ag(e);return s?{initialValue:n,params:Object.assign(Object.assign({},s),{format:t,stringifier:i})}:null},binding:{reader:()=>VQ,equals:mg,writer:n=>{const e=iJ(n.params.format);if(!e)throw So.notBindable();return e}},controller:n=>{var e,t;return new pg(n.document,{colorType:n.params.format.type,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:n.params.stringifier,parser:Nh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.format.alpha,value:n.value,viewProps:n.viewProps})}});let vg=class{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map((i,s)=>{var r,o;return(o=(r=this.components[s])===null||r===void 0?void 0:r.constrain(i))!==null&&o!==void 0?o:i});return this.asm_.fromComponents(t)}};const PE=W("pndtxt");let vJ=class{constructor(e,t){this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add(PE()),this.textViews.forEach(i=>{const s=e.createElement("div");s.classList.add(PE("a")),s.appendChild(i.element),this.element.appendChild(s)})}};function fJ(n,e,t){return new Oh(n,{arrayPosition:t===0?"fst":t===e.axes.length-1?"lst":"mid",parser:e.parser,props:e.axes[t].textProps,value:at(0,{constraint:e.axes[t].constraint}),viewProps:e.viewProps})}let fg=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map((i,s)=>fJ(e,t,s)),this.acs_.forEach((i,s)=>{Sa({primary:this.value,secondary:i.value,forward:r=>t.assembly.toComponents(r)[s],backward:(r,o)=>{const l=t.assembly.toComponents(r);return l[s]=o,t.assembly.fromComponents(l)}})}),this.view=new vJ(e,{textViews:this.acs_.map(i=>i.view)})}get textControllers(){return this.acs_}},_J=class extends Xb{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(e){this.controller.valueController.sliderController.props.set("max",e)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(e){this.controller.valueController.sliderController.props.set("min",e)}};function wJ(n,e){const t=[],i=i2(n,e);i&&t.push(i);const s=s2(n);s&&t.push(s);const r=og(n.options);return r&&t.push(r),new Rh(t)}St({id:"input-number",type:"input",accept:(n,e)=>{if(typeof n!="number")return null;const t=bt(e,i=>Object.assign(Object.assign({},o2(i)),{options:i.optional.custom(Cp),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>e2,constraint:n=>wJ(n.params,n.initialValue),writer:n=>jh},controller:n=>{const e=n.value,t=n.constraint,i=t&&cd(t,gp);if(i)return new ia(n.document,{props:new ge({options:i.values.value("options")}),value:e,viewProps:n.viewProps});const s=r2(n.params,e.rawValue),r=t&&cd(t,_p);return r?new fE(n.document,Object.assign(Object.assign({},WZ(Object.assign(Object.assign({},s),{keyScale:at(s.keyScale),max:r.values.value("max"),min:r.values.value("min")}))),{parser:Rr,value:e,viewProps:n.viewProps})):new Oh(n.document,{parser:Rr,props:ge.fromObject(s),value:e,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="number"?null:n.controller.valueController instanceof fE?new _J(n.controller):n.controller.valueController instanceof ia?new rg(n.controller):null}});let xr=class{constructor(e=0,t=0){this.x=e,this.y=t}getComponents(){return[this.x,this.y]}static isObject(e){if(Te(e))return!1;const t=e.x,i=e.y;return!(typeof t!="number"||typeof i!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y}toObject(){return{x:this.x,y:this.y}}};const z2={toComponents:n=>n.getComponents(),fromComponents:n=>new xr(...n)},dl=W("p2d");let bJ=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(dl()),t.viewProps.bindClassModifiers(this.element),bs(t.expanded,ka(this.element,dl(void 0,"expanded")));const i=e.createElement("div");i.classList.add(dl("h")),this.element.appendChild(i);const s=e.createElement("button");s.classList.add(dl("b")),s.appendChild(bp(e,"p2dpad")),t.viewProps.bindDisabled(s),i.appendChild(s),this.buttonElement=s;const r=e.createElement("div");if(r.classList.add(dl("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(dl("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}};const nr=W("p2dp");let gJ=class{constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=e.createElement("div"),this.element.classList.add(nr()),t.layout==="popup"&&this.element.classList.add(nr(void 0,"p")),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(nr("p")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.padElement=i;const s=e.createElementNS(di,"svg");s.classList.add(nr("g")),this.padElement.appendChild(s),this.svgElem_=s;const r=e.createElementNS(di,"line");r.classList.add(nr("ax")),r.setAttributeNS(null,"x1","0"),r.setAttributeNS(null,"y1","50%"),r.setAttributeNS(null,"x2","100%"),r.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(r);const o=e.createElementNS(di,"line");o.classList.add(nr("ax")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","0"),o.setAttributeNS(null,"x2","50%"),o.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(o);const l=e.createElementNS(di,"line");l.classList.add(nr("l")),l.setAttributeNS(null,"x1","50%"),l.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(l),this.lineElem_=l;const a=e.createElement("div");a.classList.add(nr("m")),this.padElement.appendChild(a),this.markerElem_=a,t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,t]=this.value.rawValue.getComponents(),i=this.props_.get("max"),s=le(e,-i,+i,0,100),r=le(t,-i,+i,0,100),o=this.props_.get("invertsY")?100-r:r;this.lineElem_.setAttributeNS(null,"x2",`${s}%`),this.lineElem_.setAttributeNS(null,"y2",`${o}%`),this.markerElem_.style.left=`${s}%`,this.markerElem_.style.top=`${o}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}};function yE(n,e,t){return[tn(e[0],Ls(n)),tn(e[1],Zu(n))*(t?1:-1)]}let CJ=class{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new gJ(e,{layout:t.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new qo(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=this.props.get("max"),s=le(e.point.x,0,e.bounds.width,-i,+i),r=le(this.props.get("invertsY")?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-i,+i);this.value.setRawValue(new xr(s,r),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onPadKeyDown_(e){g2(e.key)&&e.preventDefault();const[t,i]=yE(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(new xr(this.value.rawValue.x+t,this.value.rawValue.y+i),{forceEmit:!1,last:!1})}onPadKeyUp_(e){const[t,i]=yE(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},PJ=class{constructor(e,t){var i,s;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=ng.create(t.expanded),this.popC_=t.pickerLayout==="popup"?new _2(e,{viewProps:this.viewProps}):null;const r=new CJ(e,{layout:t.pickerLayout,props:new ge({invertsY:at(t.invertsY),max:at(t.max),xKeyScale:t.axes[0].textProps.value("keyScale"),yKeyScale:t.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});r.view.allFocusableElements.forEach(o=>{o.addEventListener("blur",this.onPopupChildBlur_),o.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=r,this.textC_=new fg(e,{assembly:z2,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new bJ(e,{expanded:this.foldable_.value("expanded"),pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(i=this.view.buttonElement)===null||i===void 0||i.addEventListener("blur",this.onPadButtonBlur_),(s=this.view.buttonElement)===null||s===void 0||s.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Sa({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:o=>o,backward:(o,l)=>l})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),ig(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=h2(e);i&&t.contains(i)||i&&i===this.view.buttonElement&&!Wb(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.view.buttonElement.focus()}};function yJ(n){return xr.isObject(n)?new xr(n.x,n.y):new xr}function EJ(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y)}function xJ(n,e){return new vg({assembly:z2,components:[hs(Object.assign(Object.assign({},n),n.x),e.x),hs(Object.assign(Object.assign({},n),n.y),e.y)]})}function EE(n,e){var t,i;if(!Te(n.min)||!Te(n.max))return Math.max(Math.abs((t=n.min)!==null&&t!==void 0?t:0),Math.abs((i=n.max)!==null&&i!==void 0?i:0));const s=n2(n);return Math.max(Math.abs(s)*10,Math.abs(e)*10)}function $J(n,e){var t,i;const s=EE(ko(n,(t=n.x)!==null&&t!==void 0?t:{}),e.x),r=EE(ko(n,(i=n.y)!==null&&i!==void 0?i:{}),e.y);return Math.max(s,r)}function VJ(n){if(!("y"in n))return!1;const e=n.y;return e&&"inverted"in e?!!e.inverted:!1}St({id:"input-point2d",type:"input",accept:(n,e)=>{if(!xr.isObject(n))return null;const t=bt(e,i=>Object.assign(Object.assign({},Qu(i)),{expanded:i.optional.boolean,picker:i.optional.custom(P2),readonly:i.optional.constant(!1),x:i.optional.custom(fr),y:i.optional.object(Object.assign(Object.assign({},Qu(i)),{inverted:i.optional.boolean}))}));return t?{initialValue:n,params:t}:null},binding:{reader:()=>yJ,constraint:n=>xJ(n.params,n.initialValue),equals:xr.equals,writer:()=>EJ},controller:n=>{var e,t;const i=n.document,s=n.value,r=n.constraint,o=[n.params.x,n.params.y];return new PJ(i,{axes:s.rawValue.getComponents().map((l,a)=>{var u;return Gb({constraint:r.components[a],initialValue:l,params:ko(n.params,(u=o[a])!==null&&u!==void 0?u:{})})}),expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,invertsY:VJ(n.params),max:$J(n.params,s.rawValue),parser:Rr,pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",value:s,viewProps:n.viewProps})}});let Nl=class{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if(Te(e))return!1;const t=e.x,i=e.y,s=e.z;return!(typeof t!="number"||typeof i!="number"||typeof s!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}};const q2={toComponents:n=>n.getComponents(),fromComponents:n=>new Nl(...n)};function kJ(n){return Nl.isObject(n)?new Nl(n.x,n.y,n.z):new Nl}function SJ(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z)}function LJ(n,e){return new vg({assembly:q2,components:[hs(Object.assign(Object.assign({},n),n.x),e.x),hs(Object.assign(Object.assign({},n),n.y),e.y),hs(Object.assign(Object.assign({},n),n.z),e.z)]})}St({id:"input-point3d",type:"input",accept:(n,e)=>{if(!Nl.isObject(n))return null;const t=bt(e,i=>Object.assign(Object.assign({},Qu(i)),{readonly:i.optional.constant(!1),x:i.optional.custom(fr),y:i.optional.custom(fr),z:i.optional.custom(fr)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>kJ,constraint:n=>LJ(n.params,n.initialValue),equals:Nl.equals,writer:n=>SJ},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z];return new fg(n.document,{assembly:q2,axes:e.rawValue.getComponents().map((s,r)=>{var o;return Gb({constraint:t.components[r],initialValue:s,params:ko(n.params,(o=i[r])!==null&&o!==void 0?o:{})})}),parser:Rr,value:e,viewProps:n.viewProps})}});let Bl=class{constructor(e=0,t=0,i=0,s=0){this.x=e,this.y=t,this.z=i,this.w=s}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if(Te(e))return!1;const t=e.x,i=e.y,s=e.z,r=e.w;return!(typeof t!="number"||typeof i!="number"||typeof s!="number"||typeof r!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}};const G2={toComponents:n=>n.getComponents(),fromComponents:n=>new Bl(...n)};function AJ(n){return Bl.isObject(n)?new Bl(n.x,n.y,n.z,n.w):new Bl}function MJ(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z),n.writeProperty("w",e.w)}function TJ(n,e){return new vg({assembly:G2,components:[hs(Object.assign(Object.assign({},n),n.x),e.x),hs(Object.assign(Object.assign({},n),n.y),e.y),hs(Object.assign(Object.assign({},n),n.z),e.z),hs(Object.assign(Object.assign({},n),n.w),e.w)]})}St({id:"input-point4d",type:"input",accept:(n,e)=>{if(!Bl.isObject(n))return null;const t=bt(e,i=>Object.assign(Object.assign({},Qu(i)),{readonly:i.optional.constant(!1),w:i.optional.custom(fr),x:i.optional.custom(fr),y:i.optional.custom(fr),z:i.optional.custom(fr)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>AJ,constraint:n=>TJ(n.params,n.initialValue),equals:Bl.equals,writer:n=>MJ},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z,n.params.w];return new fg(n.document,{assembly:G2,axes:e.rawValue.getComponents().map((s,r)=>{var o;return Gb({constraint:t.components[r],initialValue:s,params:ko(n.params,(o=i[r])!==null&&o!==void 0?o:{})})}),parser:Rr,value:e,viewProps:n.viewProps})}});function DJ(n){const e=[],t=og(n.options);return t&&e.push(t),new Rh(e)}St({id:"input-string",type:"input",accept:(n,e)=>{if(typeof n!="string")return null;const t=bt(e,i=>({readonly:i.optional.constant(!1),options:i.optional.custom(Cp)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>b2,constraint:n=>DJ(n.params),writer:n=>jh},controller:n=>{const e=n.document,t=n.value,i=n.constraint,s=i&&cd(i,gp);return s?new ia(e,{props:new ge({options:s.values.value("options")}),value:t,viewProps:n.viewProps}):new lg(e,{parser:r=>r,props:ge.fromObject({formatter:lf}),value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="string"?null:n.controller.valueController instanceof ia?new rg(n.controller):null}});const yp={monitor:{defaultInterval:200,defaultRows:3}},xE=W("mll");let RJ=class{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(xE()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("textarea");i.classList.add(xE("i")),i.style.height=`calc(var(${C2("containerUnitSize")}) * ${t.rows})`,i.readOnly=!0,t.viewProps.bindDisabled(i),this.element.appendChild(i),this.textareaElem_=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.textareaElem_,t=e.scrollTop===e.scrollHeight-e.clientHeight,i=[];this.value.rawValue.forEach(s=>{s!==void 0&&i.push(this.formatter_(s))}),e.textContent=i.join(`
`),t&&(e.scrollTop=e.scrollHeight)}onValueUpdate_(){this.update_()}},_g=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new RJ(e,{formatter:t.formatter,rows:t.rows,value:this.value,viewProps:this.viewProps})}};const $E=W("sgl");let OJ=class{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add($E()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add($E("i")),i.readOnly=!0,i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.value.rawValue,t=e[e.length-1];this.inputElement.value=t!==void 0?this.formatter_(t):""}onValueUpdate_(){this.update_()}},wg=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new OJ(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}};St({id:"monitor-bool",type:"monitor",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=bt(e,i=>({readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>w2},controller:n=>{var e;return n.value.rawValue.length===1?new wg(n.document,{formatter:vE,value:n.value,viewProps:n.viewProps}):new _g(n.document,{formatter:vE,rows:(e=n.params.rows)!==null&&e!==void 0?e:yp.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}});let jJ=class extends Xb{get max(){return this.controller.valueController.props.get("max")}set max(e){this.controller.valueController.props.set("max",e)}get min(){return this.controller.valueController.props.get("min")}set min(e){this.controller.valueController.props.set("min",e)}};const ir=W("grl");let NJ=class{constructor(e,t){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(ir()),t.viewProps.bindClassModifiers(this.element),this.formatter_=t.formatter,this.props_=t.props,this.cursor_=t.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const i=e.createElementNS(di,"svg");i.classList.add(ir("g")),i.style.height=`calc(var(${C2("containerUnitSize")}) * ${t.rows})`,this.element.appendChild(i),this.svgElem_=i;const s=e.createElementNS(di,"polyline");this.svgElem_.appendChild(s),this.lineElem_=s;const r=e.createElement("div");r.classList.add(ir("t"),W("tt")()),this.element.appendChild(r),this.tooltipElem_=r,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const e=this.svgElem_.getBoundingClientRect(),t=this.value.rawValue.length-1,i=this.props_.get("min"),s=this.props_.get("max"),r=[];this.value.rawValue.forEach((h,c)=>{if(h===void 0)return;const p=le(c,0,t,0,e.width),d=le(h,i,s,e.height,0);r.push([p,d].join(","))}),this.lineElem_.setAttributeNS(null,"points",r.join(" "));const o=this.tooltipElem_,l=this.value.rawValue[this.cursor_.rawValue];if(l===void 0){o.classList.remove(ir("t","a"));return}const a=le(this.cursor_.rawValue,0,t,0,e.width),u=le(l,i,s,e.height,0);o.style.left=`${a}px`,o.style.top=`${u}px`,o.textContent=`${this.formatter_(l)}`,o.classList.contains(ir("t","a"))||(o.classList.add(ir("t","a"),ir("t","in")),hd(o),o.classList.remove(ir("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}},Y2=class{constructor(e,t){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.cursor_=at(-1),this.view=new NJ(e,{cursor:this.cursor_,formatter:t.formatter,rows:t.rows,props:this.props,value:this.value,viewProps:this.viewProps}),!Wb(e))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const i=new qo(this.view.element);i.emitter.on("down",this.onGraphPointerDown_),i.emitter.on("move",this.onGraphPointerMove_),i.emitter.on("up",this.onGraphPointerUp_)}}importProps(e){return Ki(e,null,t=>({max:t.required.number,min:t.required.number}),t=>(this.props.set("max",t.max),this.props.set("min",t.min),!0))}exportProps(){return Ui(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(e){const t=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(le(e.offsetX,0,t.width,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){if(!e.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(le(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}};function af(n){return Te(n.format)?cn(2):n.format}function BJ(n){var e;return n.value.rawValue.length===1?new wg(n.document,{formatter:af(n.params),value:n.value,viewProps:n.viewProps}):new _g(n.document,{formatter:af(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:yp.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}function IJ(n){var e,t,i;return new Y2(n.document,{formatter:af(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:yp.monitor.defaultRows,props:ge.fromObject({max:(t=n.params.max)!==null&&t!==void 0?t:100,min:(i=n.params.min)!==null&&i!==void 0?i:0}),value:n.value,viewProps:n.viewProps})}function VE(n){return n.view==="graph"}St({id:"monitor-number",type:"monitor",accept:(n,e)=>{if(typeof n!="number")return null;const t=bt(e,i=>({format:i.optional.function,max:i.optional.number,min:i.optional.number,readonly:i.required.constant(!0),rows:i.optional.number,view:i.optional.string}));return t?{initialValue:n,params:t}:null},binding:{defaultBufferSize:n=>VE(n)?64:1,reader:n=>e2},controller:n=>VE(n.params)?IJ(n):BJ(n),api:n=>n.controller.valueController instanceof Y2?new jJ(n.controller):null});St({id:"monitor-string",type:"monitor",accept:(n,e)=>{if(typeof n!="string")return null;const t=bt(e,i=>({multiline:i.optional.boolean,readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>b2},controller:n=>{var e;const t=n.value;return t.rawValue.length>1||n.params.multiline?new _g(n.document,{formatter:lf,rows:(e=n.params.rows)!==null&&e!==void 0?e:yp.monitor.defaultRows,value:t,viewProps:n.viewProps}):new wg(n.document,{formatter:lf,value:t,viewProps:n.viewProps})}});const kE=W("txtr");class FJ{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(kE()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("textarea");i.rows=t.rows,i.cols=22,i.placeholder=t.placeholder,i.classList.add(kE("i")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){this.inputElement.value=this.value_.rawValue}onChange_(){this.refresh()}}class KJ{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.rows=t.rows,this.placeholder=t.placeholder,this.view=new FJ(e,{value:this.value,viewProps:this.viewProps,rows:this.rows,placeholder:this.placeholder}),this.view.inputElement.addEventListener("keyup",this.onInputChange_)}onInputChange_(e){const i=e.currentTarget.value;this.value.rawValue=i,this.view.refresh()}}St({id:"input-template",type:"input",accept(n,e){if(typeof n!="string")return null;const t=bt(e,i=>({view:i.required.constant("textarea"),rows:i.optional.number,placeholder:i.optional.string}));return t?{initialValue:n,params:t}:null},binding:{reader(n){return e=>typeof e=="string"?e:""},writer(n){return(e,t)=>{e.write(t)}}},controller(n){var e,t;return new KJ(n.document,{value:n.value,rows:(e=n.params.rows)!==null&&e!==void 0?e:3,placeholder:(t=n.params.placeholder)!==null&&t!==void 0?t:"Enter text here",viewProps:n.viewProps})}});function UJ(n){let e,t;return e=new $h({props:{theme:n[4],userCreatedPane:!1,$$slots:{default:[qJ]},$$scope:{ctx:n}}}),{c(){A(e.$$.fragment)},l(i){M(e.$$.fragment,i)},m(i,s){T(e,i,s),t=!0},p(i,s){const r={};s&16&&(r.theme=i[4]),s&16399&&(r.$$scope={dirty:s,ctx:i}),e.$set(r)},i(i){t||(_(e.$$.fragment,i),t=!0)},o(i){b(e.$$.fragment,i),t=!1},d(i){D(e,i)}}}function HJ(n){let e,t,i,s;const r=[YJ,GJ],o=[];function l(a,u){return 0}return e=l(),t=o[e]=r[e](n),{c(){t.c(),i=R()},l(a){t.l(a),i=R()},m(a,u){o[e].m(a,u),O(a,i,u),s=!0},p(a,u){t.p(a,u)},i(a){s||(_(t),s=!0)},o(a){b(t),s=!1},d(a){a&&E(i),o[e].d(a)}}}function zJ(n){let e;const t=n[11].default,i=mn(t,n,n[14],null);return{c(){i&&i.c()},l(s){i&&i.l(s)},m(s,r){i&&i.m(s,r),e=!0},p(s,r){i&&i.p&&(!e||r&16384)&&vn(i,t,s,s[14],e?_n(t,s[14],r,null):fn(s[14]),null)},i(s){e||(_(i,s),e=!0)},o(s){b(i,s),e=!1},d(s){i&&i.d(s)}}}function qJ(n){let e,t,i;function s(o){n[13](o)}let r={disabled:n[2],title:n[1],userExpandable:n[3],$$slots:{default:[zJ]},$$scope:{ctx:n}};return n[0]!==void 0&&(r.expanded=n[0]),e=new Ju({props:r}),y.push(()=>k(e,"expanded",s)),{c(){A(e.$$.fragment)},l(o){M(e.$$.fragment,o)},m(o,l){T(e,o,l),i=!0},p(o,l){const a={};l&4&&(a.disabled=o[2]),l&2&&(a.title=o[1]),l&8&&(a.userExpandable=o[3]),l&16384&&(a.$$scope={dirty:l,ctx:o}),!t&&l&1&&(t=!0,a.expanded=o[0],V(()=>t=!1)),e.$set(a)},i(o){i||(_(e.$$.fragment,o),i=!0)},o(o){b(e.$$.fragment,o),i=!1},d(o){D(e,o)}}}function GJ(n){let e,t,i,s;e=new Ir({props:{keysAdd:["containerUnitSize"],theme:n[4]}});let r=n[0]&&SE(n);return{c(){A(e.$$.fragment),t=kr(),r&&r.c(),i=R()},l(o){M(e.$$.fragment,o),t=Sr(o),r&&r.l(o),i=R()},m(o,l){T(e,o,l),O(o,t,l),r&&r.m(o,l),O(o,i,l),s=!0},p(o,l){const a={};l&16&&(a.theme=o[4]),e.$set(a),o[0]?r?(r.p(o,l),l&1&&_(r,1)):(r=SE(o),r.c(),_(r,1),r.m(i.parentNode,i)):r&&(ii(),b(r,1,1,()=>{r=null}),si())},i(o){s||(_(e.$$.fragment,o),_(r),s=!0)},o(o){b(e.$$.fragment,o),b(r),s=!1},d(o){o&&(E(t),E(i)),D(e,o),r&&r.d(o)}}}function YJ(n){let e,t;const i=n[11].default,s=mn(i,n,n[14],null);return{c(){e=rn("div"),s&&s.c(),this.h()},l(r){e=on(r,"DIV",{style:!0});var o=ln(e);s&&s.l(o),o.forEach(E),this.h()},h(){Pe(e,"display","none")},m(r,o){O(r,e,o),s&&s.m(e,null),n[12](e),t=!0},p(r,o){s&&s.p&&(!t||o&16384)&&vn(s,i,r,r[14],t?_n(i,r[14],o,null):fn(r[14]),null)},i(r){t||(_(s,r),t=!0)},o(r){b(s,r),t=!1},d(r){r&&E(e),s&&s.d(r),n[12](null)}}}function SE(n){let e,t,i;e=new Ir({props:{keysAdd:["containerVerticalPadding","containerVerticalPadding"],theme:n[4]}});const s=n[11].default,r=mn(s,n,n[14],null);return{c(){A(e.$$.fragment),t=kr(),r&&r.c()},l(o){M(e.$$.fragment,o),t=Sr(o),r&&r.l(o)},m(o,l){T(e,o,l),O(o,t,l),r&&r.m(o,l),i=!0},p(o,l){const a={};l&16&&(a.theme=o[4]),e.$set(a),r&&r.p&&(!i||l&16384)&&vn(r,s,o,o[14],i?_n(s,o[14],l,null):fn(o[14]),null)},i(o){i||(_(e.$$.fragment,o),_(r,o),i=!0)},o(o){b(e.$$.fragment,o),b(r,o),i=!1},d(o){o&&E(t),D(e,o),r&&r.d(o)}}}function XJ(n){let e,t,i,s;const r=[HJ,UJ],o=[];function l(a,u){return a[6]?0:1}return e=l(n),t=o[e]=r[e](n),{c(){t.c(),i=R()},l(a){t.l(a),i=R()},m(a,u){o[e].m(a,u),O(a,i,u),s=!0},p(a,[u]){t.p(a,u)},i(a){s||(_(t),s=!0)},o(a){b(t),s=!1},d(a){a&&E(i),o[e].d(a)}}}function WJ(n,e,t){let i,s,{$$slots:r={},$$scope:o}=e,{title:l="Folder"}=e,{disabled:a=!1}=e,{expanded:u=!0}=e,{userExpandable:h=!0}=e,{theme:c=void 0}=e;const p=mi("parentStore");Ps(n,p,g=>t(10,i=g));const d=Pf();Ps(n,d,g=>t(15,s=g));const m=mi("userCreatedPane");let f,v,w;mc("parentStore",d);function P(){Hx(d,s=i.addFolder({disabled:a,expanded:u,index:v,title:l}),s),s.on("fold",()=>{t(0,u=s.expanded)}),t(9,w=s)}ca(()=>{t(8,v=f?R_(f):0)}),ha(()=>{s?.dispose()});function Ce(g){y[g?"unshift":"push"](()=>{f=g,t(5,f)})}function x(g){u=g,t(0,u)}return n.$$set=g=>{"title"in g&&t(1,l=g.title),"disabled"in g&&t(2,a=g.disabled),"expanded"in g&&t(0,u=g.expanded),"userExpandable"in g&&t(3,h=g.userExpandable),"theme"in g&&t(4,c=g.theme),"$$scope"in g&&t(14,o=g.$$scope)},n.$$.update=()=>{n.$$.dirty&514&&w&&t(9,w.title=l,w),n.$$.dirty&516&&w&&t(9,w.disabled=a,w),n.$$.dirty&513&&w&&u!==void 0&&t(9,w.expanded=u,w),n.$$.dirty&1792&&i&&!w&&v!==void 0&&P(),n.$$.dirty&520&&w&&NV(h,w.element,"tp-fldv_b","tp-fldv_m"),n.$$.dirty&1040&&c&&i&&(m||!D_(i))&&console.warn("Set theme on the <Pane> component, not on its children! (Check nested <Folder> components for a theme prop.)")},[u,l,a,h,c,f,p,d,v,w,i,r,Ce,x,o]}class Ju extends Je{constructor(e){super(),et(this,e,WJ,XJ,Qe,{title:1,disabled:2,expanded:0,userExpandable:3,theme:4})}}var Zm={local:{},session:{}};function ZJ(n){return n==="local"?localStorage:sessionStorage}function LE(n,e,t){var i,s;const r=(i=t?.serializer)!=null?i:JSON,o=(s=t?.storage)!=null?s:"local",l=typeof window<"u"&&typeof document<"u",a=l?ZJ(o):null;function u(h,c){a?.setItem(h,r.stringify(c))}if(!Zm[o][n]){const h=Pf(e,d=>{const m=a?.getItem(n);if(m&&d(r.parse(m)),l&&o=="local"){const f=v=>{v.key===n&&d(v.newValue?r.parse(v.newValue):null)};return window.addEventListener("storage",f),()=>window.removeEventListener("storage",f)}}),{subscribe:c,set:p}=h;Zm[o][n]={set(d){u(n,d),p(d)},update(d){return h.update(m=>{const f=d(m);return u(n,f),f})},subscribe:c}}return Zm[o][n]}const{window:QJ}=pT;function JJ(n){let e;const t=n[25].default,i=mn(t,n,n[32],null);return{c(){i&&i.c()},l(s){i&&i.l(s)},m(s,r){i&&i.m(s,r),e=!0},p(s,r){i&&i.p&&(!e||r[1]&2)&&vn(i,t,s,s[32],e?_n(t,s[32],r,null):fn(s[32]),null)},i(s){e||(_(i,s),e=!0)},o(s){b(i,s),e=!1},d(s){i&&i.d(s)}}}function eee(n){let e,t,i,s,r,o=`${n[1]}px`,l=`${n[2]}px`,a=`${n[3]}px`,u,h,c;const p=[{scale:n[7]},{title:n[6]},Ar(n[16],"position")];function d(v){n[26](v)}function m(v){n[27](v)}let f={$$slots:{default:[JJ]},$$scope:{ctx:n}};for(let v=0;v<p.length;v+=1)f=B(f,p[v]);return n[0]!==void 0&&(f.expanded=n[0]),n[10]!==void 0&&(f.paneRef=n[10]),t=new uw({props:f}),y.push(()=>k(t,"expanded",d)),y.push(()=>k(t,"paneRef",m)),{c(){e=rn("div"),A(t.$$.fragment),this.h()},l(v){e=on(v,"DIV",{class:!0});var w=ln(e);M(t.$$.fragment,w),w.forEach(E),this.h()},h(){Cu(e,"class","svelte-tweakpane-ui draggable-container svelte-1imixqv"),iT(()=>n[29].call(e)),Vl(e,"not-collapsable",!n[5]),Vl(e,"not-resizable",!n[4]),Pe(e,"left",o),Pe(e,"padding",n[8]),Pe(e,"top",l),Pe(e,"width",a),Pe(e,"z-index",n[14])},m(v,w){O(v,e,w),T(t,e,null),n[28](e),r=sT(e,n[29].bind(e)),u=!0,h||(c=[Fp(QJ,"resize",n[15]),Fp(e,"focus",n[30],!0),Fp(e,"pointerdown",n[31],!0)],h=!0)},p(v,w){const P=w[0]&65728?zt(p,[w[0]&128&&{scale:v[7]},w[0]&64&&{title:v[6]},w[0]&65536&&qt(Ar(v[16],"position"))]):{};w[1]&2&&(P.$$scope={dirty:w,ctx:v}),!i&&w[0]&1&&(i=!0,P.expanded=v[0],V(()=>i=!1)),!s&&w[0]&1024&&(s=!0,P.paneRef=v[10],V(()=>s=!1)),t.$set(P),(!u||w[0]&32)&&Vl(e,"not-collapsable",!v[5]),(!u||w[0]&16)&&Vl(e,"not-resizable",!v[4]),w[0]&2&&o!==(o=`${v[1]}px`)&&Pe(e,"left",o),w[0]&256&&Pe(e,"padding",v[8]),w[0]&4&&l!==(l=`${v[2]}px`)&&Pe(e,"top",l),w[0]&8&&a!==(a=`${v[3]}px`)&&Pe(e,"width",a),w[0]&16384&&Pe(e,"z-index",v[14])},i(v){u||(_(t.$$.fragment,v),u=!0)},o(v){b(t.$$.fragment,v),u=!1},d(v){v&&E(e),D(t),n[28](null),r(),h=!1,Ux(c)}}}const hc="svelte-tweakpane-ui-draggable-position-",tee="1",pl=[];let Qm=1e3;function nee(n,e,t){let i;const s=["storePositionLocally","localStoreId","expanded","collapseChildrenToFit","x","y","width","resizable","userExpandable","minWidth","maxWidth","title","scale","padding"];let r=je(e,s),o,l=nt,a=()=>(l(),l=rT(d,C=>t(40,o=C)),d);n.$$.on_destroy.push(()=>l());let{$$slots:u={},$$scope:h}=e,{storePositionLocally:c=!0}=e,{localStoreId:p=tee}=e,d;c&&a(d=LE(`${hc}${p}`,{x:0,y:0,expanded:!0,width:350}));let{expanded:m=o?.expanded??!0}=e,{collapseChildrenToFit:f=!1}=e,{x:v=o?.x??0}=e,{y:w=o?.y??0}=e,{width:P=o?.width??256}=e,{resizable:Ce=!0}=e,{userExpandable:x=!0}=e,{minWidth:g=200}=e,{maxWidth:Wt=600}=e,{title:ke="Tweakpane"}=e,{scale:tt=1}=e,{padding:Mt="0"}=e,pt,S,wn,mt,Da,Kr,Ra,li,Ds,Np=Qm;function zM(){p!==void 0&&(pl.includes(p)&&console.warn('Multiple instances of <Pane> with `mode="draggable"` and `storePositionLocally=true` detected. You must explicitly set unique localStoreId property on each component to avoid collisions.'),pl.push(p))}function qM(){p&&(pl.splice(pl.indexOf(p),1),localStorage.removeItem(`${hc}${p}`))}function GM(C){C!==void 0&&d!==void 0&&m!==void 0&&P!==void 0&&v!==void 0&&w!==void 0&&a(t(9,d=LE(`${hc}${p}`,{x:v,y:w,expanded:m,width:P})))}function yC(){if(v!==void 0&&w!==void 0&&P!==void 0){const C=li,Yi=Ds;t(23,li=document.documentElement.clientWidth),t(24,Ds=document.documentElement.clientHeight);const ai=li-C,Oa=Ds-Yi,tT=(v+P/2)/li,nT=(w+Kr/2)/Ds;!Number.isNaN(ai)&&tT>=.5&&t(1,v+=ai),!Number.isNaN(Oa)&&nT>=.5&&t(2,w+=Oa)}}const Wh=C=>{C.stopPropagation()};let EC=0,Bp=0,xC=0,Ip=0;const Zh=C=>{C.stopPropagation(),C.target&&P!==void 0&&C.target===mt&&t(3,P=P<i?i:g)},Qh=C=>{v!==void 0&&w!==void 0&&C.button===0&&C.target instanceof HTMLElement&&(Ip=0,C.target.setPointerCapture(C.pointerId),C.target.addEventListener("pointermove",Jh),C.target.addEventListener("pointerup",ec),EC=P??0,Bp=v-C.pageX,xC=w-C.pageY)},Jh=C=>{C.target instanceof HTMLElement&&P!==void 0&&g!==void 0&&v!==void 0&&w!==void 0&&(C.target===wn?(Ip+=Math.hypot(C.movementX,C.movementY),t(1,v=C.pageX+Bp),t(2,w=C.pageY+xC)):C.target===mt&&t(3,P=lm(C.pageX+Bp+EC-v,g,i)))},ec=C=>{C.stopImmediatePropagation(),C.target instanceof HTMLElement&&(C.target.releasePointerCapture(C.pointerId),C.target.removeEventListener("pointermove",Jh),C.target.removeEventListener("pointerup",ec),C.target===wn&&Ip<3&&x&&t(10,pt.expanded=!pt.expanded,pt))},$C=C=>{C.preventDefault()};ca(()=>{yC(),pt?S.append(pt.element):console.warn("no pane ref in draggable"),S.addEventListener("touchmove",$C,{passive:!1}),wn=S.querySelector(".tp-rotv_t"),wn.addEventListener("click",Wh),wn.addEventListener("dblclick",Zh),wn.addEventListener("pointerdown",Qh),mt=wn.parentElement?.appendChild(document.createElement("div")),mt&&(mt.className="tp-custom-width-handle",mt.textContent="",mt.addEventListener("click",Wh),mt.addEventListener("dblclick",Zh),mt.addEventListener("pointerdown",Qh))}),ha(()=>{wn&&(wn.removeEventListener("click",Wh),wn.removeEventListener("dblclick",Zh),wn.removeEventListener("pointerdown",Qh),wn.removeEventListener("pointermove",Jh),wn.removeEventListener("pointerup",ec)),mt&&(mt.removeEventListener("click",Wh),mt.removeEventListener("dblclick",Zh),mt.removeEventListener("pointerdown",Qh),mt.removeEventListener("pointermove",Jh),mt.removeEventListener("pointerup",ec)),S&&S.removeEventListener("touchmove",$C),p!==void 0&&pl.splice(pl.indexOf(p),1)});function YM(C){mt&&(mt.style.display=C?"block":"none")}function VC(C,Yi=Number.MAX_SAFE_INTEGER){if(Yi>0)for(const ai of C)if("expanded"in ai)ai.expanded&&(Yi--,ai.expanded=!1),"children"in ai&&VC(ai.children,Yi);else{const Oa=oF(ai);Oa&&rF(ai)&&(Yi--,Oa.click())}}function XM(C){m=C,t(0,m)}function WM(C){pt=C,t(10,pt)}function ZM(C){y[C?"unshift":"push"](()=>{S=C,t(11,S)})}function QM(){Da=this.clientHeight,Ra=this.clientWidth,t(12,Da),t(13,Ra)}const JM=()=>{t(14,Np=++Qm)},eT=()=>{t(14,Np=++Qm)};return n.$$set=C=>{e=B(B({},e),Cn(C)),t(16,r=je(e,s)),"storePositionLocally"in C&&t(17,c=C.storePositionLocally),"localStoreId"in C&&t(18,p=C.localStoreId),"expanded"in C&&t(0,m=C.expanded),"collapseChildrenToFit"in C&&t(19,f=C.collapseChildrenToFit),"x"in C&&t(1,v=C.x),"y"in C&&t(2,w=C.y),"width"in C&&t(3,P=C.width),"resizable"in C&&t(4,Ce=C.resizable),"userExpandable"in C&&t(5,x=C.userExpandable),"minWidth"in C&&t(20,g=C.minWidth),"maxWidth"in C&&t(21,Wt=C.maxWidth),"title"in C&&t(6,ke=C.title),"scale"in C&&t(7,tt=C.scale),"padding"in C&&t(8,Mt=C.padding),"$$scope"in C&&t(32,h=C.$$scope)},n.$$.update=()=>{if(n.$$.dirty[0]&1040&&pt&&Ce&&YM(Ce),n.$$.dirty[0]&6272&&S)if(tt===void 0||tt===1)t(22,Kr=Da);else{const C=window.getComputedStyle(S),Yi=Number.parseFloat(C.paddingTop)+Number.parseFloat(C.paddingBottom);t(22,Kr=(Da-Yi)*tt+Yi)}n.$$.dirty[0]&33039374&&Kr!==void 0&&li!==void 0&&Ds!==void 0&&v!==void 0&&w!==void 0&&P!==void 0&&g!==void 0&&Wt!==void 0&&(f&&Kr>Ds&&VC(pt.children),t(1,v=lm(v,0,Math.max(0,li-Ra))),t(2,w=lm(w,0,Math.max(0,Ds-Kr))),li<Ra&&t(3,P=Math.max(g,Math.min(Wt,li)))),n.$$.dirty[0]&10485762&&(i=Math.min(Wt??600,li-(v??0))),n.$$.dirty[0]&393216&&c&&zM(),n.$$.dirty[0]&393216&&!c&&qM(),n.$$.dirty[0]&262144&&p!==`${hc}${p}`&&GM(p),n.$$.dirty[0]&393743&&c&&p!==void 0&&v!==void 0&&w!==void 0&&P!==void 0&&m!==void 0&&d?.set({x:v,y:w,expanded:m,width:P})},[m,v,w,P,Ce,x,ke,tt,Mt,d,pt,S,Da,Ra,Np,yC,r,c,p,f,g,Wt,Kr,li,Ds,u,XM,WM,ZM,QM,JM,eT,h]}class iee extends Je{constructor(e){super(),et(this,e,nee,eee,Qe,{storePositionLocally:17,localStoreId:18,expanded:0,collapseChildrenToFit:19,x:1,y:2,width:3,resizable:4,userExpandable:5,minWidth:20,maxWidth:21,title:6,scale:7,padding:8},null,[-1,-1])}}function see(n){let e;const t=n[8].default,i=mn(t,n,n[11],null);return{c(){i&&i.c()},l(s){i&&i.l(s)},m(s,r){i&&i.m(s,r),e=!0},p(s,r){i&&i.p&&(!e||r&2048)&&vn(i,t,s,s[11],e?_n(t,s[11],r,null):fn(s[11]),null)},i(s){e||(_(i,s),e=!0)},o(s){b(i,s),e=!1},d(s){i&&i.d(s)}}}function ree(n){let e,t,i,s,r;const o=[{title:n[1]},Ar(n[3],"position")];function l(h){n[9](h)}function a(h){n[10](h)}let u={$$slots:{default:[see]},$$scope:{ctx:n}};for(let h=0;h<o.length;h+=1)u=B(u,o[h]);return n[0]!==void 0&&(u.expanded=n[0]),n[2]!==void 0&&(u.paneRef=n[2]),t=new uw({props:u}),y.push(()=>k(t,"expanded",l)),y.push(()=>k(t,"paneRef",a)),{c(){e=rn("div"),A(t.$$.fragment),this.h()},l(h){e=on(h,"DIV",{style:!0});var c=ln(e);M(t.$$.fragment,c),c.forEach(E),this.h()},h(){Pe(e,"display","none")},m(h,c){O(h,e,c),T(t,e,null),r=!0},p(h,[c]){const p=c&10?zt(o,[c&2&&{title:h[1]},c&8&&qt(Ar(h[3],"position"))]):{};c&2048&&(p.$$scope={dirty:c,ctx:h}),!i&&c&1&&(i=!0,p.expanded=h[0],V(()=>i=!1)),!s&&c&4&&(s=!0,p.paneRef=h[2],V(()=>s=!1)),t.$set(p)},i(h){r||(_(t.$$.fragment,h),r=!0)},o(h){b(t.$$.fragment,h),r=!1},d(h){h&&E(e),D(t)}}}function oee(n,e,t){const i=["expanded","x","y","width","title"];let s=je(e,i),{$$slots:r={},$$scope:o}=e,{expanded:l=void 0}=e,{x:a=void 0}=e,{y:u=void 0}=e,{width:h=void 0}=e,{title:c="Tweakpane"}=e,p,d;function m(v){l=v,t(0,l)}function f(v){p=v,t(2,p)}return n.$$set=v=>{e=B(B({},e),Cn(v)),t(3,s=je(e,i)),"expanded"in v&&t(0,l=v.expanded),"x"in v&&t(4,a=v.x),"y"in v&&t(5,u=v.y),"width"in v&&t(6,h=v.width),"title"in v&&t(1,c=v.title),"$$scope"in v&&t(11,o=v.$$scope)},n.$$.update=()=>{n.$$.dirty&4&&p!==void 0&&p.element.parentElement&&t(7,d=p.element.parentElement),n.$$.dirty&144&&d!==void 0&&a!==void 0&&(d.style.setProperty("right","unset"),d.style.setProperty("left",`${a}px`)),n.$$.dirty&160&&d!==void 0&&u!==void 0&&d.style.setProperty("top",`${u}px`),n.$$.dirty&192&&d!==void 0&&h!==void 0&&d.style.setProperty("width",`${h}px`)},[l,c,p,s,a,u,h,d,r,m,f,o]}class lee extends Je{constructor(e){super(),et(this,e,oee,ree,Qe,{expanded:0,x:4,y:5,width:6,title:1})}}function aee(n){let e,t,i,s;const r=[dee,cee],o=[];function l(a,u){return 0}return e=l(),t=o[e]=r[e](n),{c(){t.c(),i=R()},l(a){t.l(a),i=R()},m(a,u){o[e].m(a,u),O(a,i,u),s=!0},p(a,u){t.p(a,u)},i(a){s||(_(t),s=!0)},o(a){b(t),s=!1},d(a){a&&E(i),o[e].d(a)}}}function uee(n){let e,t,i;const s=[{width:n[1]},Ar(n[5],"storePositionLocally")];function r(l){n[11](l)}let o={$$slots:{default:[mee]},$$scope:{ctx:n}};for(let l=0;l<s.length;l+=1)o=B(o,s[l]);return n[0]!==void 0&&(o.expanded=n[0]),e=new $h({props:o}),y.push(()=>k(e,"expanded",r)),{c(){A(e.$$.fragment)},l(l){M(e.$$.fragment,l)},m(l,a){T(e,l,a),i=!0},p(l,a){const u=a&34?zt(s,[a&2&&{width:l[1]},a&32&&qt(Ar(l[5],"storePositionLocally"))]):{};a&32768&&(u.$$scope={dirty:a,ctx:l}),!t&&a&1&&(t=!0,u.expanded=l[0],V(()=>t=!1)),e.$set(u)},i(l){i||(_(e.$$.fragment,l),i=!0)},o(l){b(e.$$.fragment,l),i=!1},d(l){D(e,l)}}}function hee(n){let e,t,i,s;const r=[fee,vee],o=[];function l(a,u){return 0}return e=l(),t=o[e]=r[e](n),{c(){t.c(),i=R()},l(a){t.l(a),i=R()},m(a,u){o[e].m(a,u),O(a,i,u),s=!0},p(a,u){t.p(a,u)},i(a){s||(_(t),s=!0)},o(a){b(t),s=!1},d(a){a&&E(i),o[e].d(a)}}}function cee(n){let e,t;const i=n[6].default,s=mn(i,n,n[15],null);return{c(){e=rn("div"),s&&s.c(),this.h()},l(r){e=on(r,"DIV",{style:!0});var o=ln(e);s&&s.l(o),o.forEach(E),this.h()},h(){Pe(e,"display","none")},m(r,o){O(r,e,o),s&&s.m(e,null),t=!0},p(r,o){s&&s.p&&(!t||o&32768)&&vn(s,i,r,r[15],t?_n(i,r[15],o,null):fn(r[15]),null)},i(r){t||(_(s,r),t=!0)},o(r){b(s,r),t=!1},d(r){r&&E(e),s&&s.d(r)}}}function dee(n){let e,t,i,s,r;const o=[{width:n[1]},n[5]];function l(c){n[12](c)}function a(c){n[13](c)}function u(c){n[14](c)}let h={$$slots:{default:[pee]},$$scope:{ctx:n}};for(let c=0;c<o.length;c+=1)h=B(h,o[c]);return n[0]!==void 0&&(h.expanded=n[0]),n[2]!==void 0&&(h.x=n[2]),n[3]!==void 0&&(h.y=n[3]),e=new lee({props:h}),y.push(()=>k(e,"expanded",l)),y.push(()=>k(e,"x",a)),y.push(()=>k(e,"y",u)),{c(){A(e.$$.fragment)},l(c){M(e.$$.fragment,c)},m(c,p){T(e,c,p),r=!0},p(c,p){const d=p&34?zt(o,[p&2&&{width:c[1]},p&32&&qt(c[5])]):{};p&32768&&(d.$$scope={dirty:p,ctx:c}),!t&&p&1&&(t=!0,d.expanded=c[0],V(()=>t=!1)),!i&&p&4&&(i=!0,d.x=c[2],V(()=>i=!1)),!s&&p&8&&(s=!0,d.y=c[3],V(()=>s=!1)),e.$set(d)},i(c){r||(_(e.$$.fragment,c),r=!0)},o(c){b(e.$$.fragment,c),r=!1},d(c){D(e,c)}}}function pee(n){let e;const t=n[6].default,i=mn(t,n,n[15],null);return{c(){i&&i.c()},l(s){i&&i.l(s)},m(s,r){i&&i.m(s,r),e=!0},p(s,r){i&&i.p&&(!e||r&32768)&&vn(i,t,s,s[15],e?_n(t,s[15],r,null):fn(s[15]),null)},i(s){e||(_(i,s),e=!0)},o(s){b(i,s),e=!1},d(s){i&&i.d(s)}}}function mee(n){let e;const t=n[6].default,i=mn(t,n,n[15],null);return{c(){i&&i.c()},l(s){i&&i.l(s)},m(s,r){i&&i.m(s,r),e=!0},p(s,r){i&&i.p&&(!e||r&32768)&&vn(i,t,s,s[15],e?_n(t,s[15],r,null):fn(s[15]),null)},i(s){e||(_(i,s),e=!0)},o(s){b(i,s),e=!1},d(s){i&&i.d(s)}}}function vee(n){let e,t;const i=n[6].default,s=mn(i,n,n[15],null);return{c(){e=rn("div"),s&&s.c(),this.h()},l(r){e=on(r,"DIV",{style:!0});var o=ln(e);s&&s.l(o),o.forEach(E),this.h()},h(){Pe(e,"display","none")},m(r,o){O(r,e,o),s&&s.m(e,null),t=!0},p(r,o){s&&s.p&&(!t||o&32768)&&vn(s,i,r,r[15],t?_n(i,r[15],o,null):fn(r[15]),null)},i(r){t||(_(s,r),t=!0)},o(r){b(s,r),t=!1},d(r){r&&E(e),s&&s.d(r)}}}function fee(n){let e,t,i,s,r,o;const l=[n[5]];function a(d){n[7](d)}function u(d){n[8](d)}function h(d){n[9](d)}function c(d){n[10](d)}let p={$$slots:{default:[_ee]},$$scope:{ctx:n}};for(let d=0;d<l.length;d+=1)p=B(p,l[d]);return n[0]!==void 0&&(p.expanded=n[0]),n[1]!==void 0&&(p.width=n[1]),n[2]!==void 0&&(p.x=n[2]),n[3]!==void 0&&(p.y=n[3]),e=new iee({props:p}),y.push(()=>k(e,"expanded",a)),y.push(()=>k(e,"width",u)),y.push(()=>k(e,"x",h)),y.push(()=>k(e,"y",c)),{c(){A(e.$$.fragment)},l(d){M(e.$$.fragment,d)},m(d,m){T(e,d,m),o=!0},p(d,m){const f=m&32?zt(l,[qt(d[5])]):{};m&32768&&(f.$$scope={dirty:m,ctx:d}),!t&&m&1&&(t=!0,f.expanded=d[0],V(()=>t=!1)),!i&&m&2&&(i=!0,f.width=d[1],V(()=>i=!1)),!s&&m&4&&(s=!0,f.x=d[2],V(()=>s=!1)),!r&&m&8&&(r=!0,f.y=d[3],V(()=>r=!1)),e.$set(f)},i(d){o||(_(e.$$.fragment,d),o=!0)},o(d){b(e.$$.fragment,d),o=!1},d(d){D(e,d)}}}function _ee(n){let e;const t=n[6].default,i=mn(t,n,n[15],null);return{c(){i&&i.c()},l(s){i&&i.l(s)},m(s,r){i&&i.m(s,r),e=!0},p(s,r){i&&i.p&&(!e||r&32768)&&vn(i,t,s,s[15],e?_n(t,s[15],r,null):fn(s[15]),null)},i(s){e||(_(i,s),e=!0)},o(s){b(i,s),e=!1},d(s){i&&i.d(s)}}}function wee(n){let e,t,i,s;const r=[hee,uee,aee],o=[];function l(a,u){return a[4]===void 0||a[4]==="draggable"?0:a[4]==="inline"?1:a[4]==="fixed"?2:-1}return~(e=l(n))&&(t=o[e]=r[e](n)),{c(){t&&t.c(),i=R()},l(a){t&&t.l(a),i=R()},m(a,u){~e&&o[e].m(a,u),O(a,i,u),s=!0},p(a,[u]){let h=e;e=l(a),e===h?~e&&o[e].p(a,u):(t&&(ii(),b(o[h],1,1,()=>{o[h]=null}),si()),~e?(t=o[e],t?t.p(a,u):(t=o[e]=r[e](a),t.c()),_(t,1),t.m(i.parentNode,i)):t=null)},i(a){s||(_(t),s=!0)},o(a){b(t),s=!1},d(a){a&&E(i),~e&&o[e].d(a)}}}function bee(n,e,t){const i=["expanded","position","width","x","y"];let s=je(e,i),{$$slots:r={},$$scope:o}=e,{expanded:l=void 0}=e,{position:a=void 0}=e,{width:u=void 0}=e,{x:h=void 0}=e,{y:c=void 0}=e;oT(()=>{(e.position==="inline"||e.position==="fixed")&&(t(2,h=e.x),t(3,c=e.y),t(1,u=e.width),t(0,l=e.expanded))});function p(x){l=x,t(0,l)}function d(x){u=x,t(1,u)}function m(x){h=x,t(2,h)}function f(x){c=x,t(3,c)}function v(x){l=x,t(0,l)}function w(x){l=x,t(0,l)}function P(x){h=x,t(2,h)}function Ce(x){c=x,t(3,c)}return n.$$set=x=>{t(16,e=B(B({},e),Cn(x))),t(5,s=je(e,i)),"expanded"in x&&t(0,l=x.expanded),"position"in x&&t(4,a=x.position),"width"in x&&t(1,u=x.width),"x"in x&&t(2,h=x.x),"y"in x&&t(3,c=x.y),"$$scope"in x&&t(15,o=x.$$scope)},e=Cn(e),[l,u,h,c,a,s,r,p,d,m,f,v,w,P,Ce,o]}class gee extends Je{constructor(e){super(),et(this,e,bee,wee,Qe,{expanded:0,position:4,width:1,x:2,y:3})}}function AE(n,e,t){const i=n.slice();return i[11]=e[t],i[12]=e,i[13]=t,i}function Cee(n){let e,t;return e=new $h({props:{theme:n[2],userCreatedPane:!1,$$slots:{default:[yee]},$$scope:{ctx:n}}}),{c(){A(e.$$.fragment)},l(i){M(e.$$.fragment,i)},m(i,s){T(e,i,s),t=!0},p(i,s){const r={};s&4&&(r.theme=i[2]),s&16387&&(r.$$scope={dirty:s,ctx:i}),e.$set(r)},i(i){t||(_(e.$$.fragment,i),t=!0)},o(i){b(e.$$.fragment,i),t=!1},d(i){D(e,i)}}}function Pee(n){let e=[],t=new Map,i,s,r=Hl(Object.keys(n[1]));const o=l=>l[11];for(let l=0;l<r.length;l+=1){let a=AE(n,r,l),u=o(a);t.set(u,e[l]=ME(u,a))}return{c(){for(let l=0;l<e.length;l+=1)e[l].c();i=R()},l(l){for(let a=0;a<e.length;a+=1)e[a].l(l);i=R()},m(l,a){for(let u=0;u<e.length;u+=1)e[u]&&e[u].m(l,a);O(l,i,a),s=!0},p(l,a){a&19&&(r=Hl(Object.keys(l[1])),ii(),e=vT(e,a,o,1,l,r,t,i.parentNode,mT,ME,i,AE),si())},i(l){if(!s){for(let a=0;a<r.length;a+=1)_(e[a]);s=!0}},o(l){for(let a=0;a<e.length;a+=1)b(e[a]);s=!1},d(l){l&&E(i);for(let a=0;a<e.length;a+=1)e[a].d(l)}}}function yee(n){let e,t,i,s;function r(a){n[9](a)}function o(a){n[10](a)}let l={};return n[1]!==void 0&&(l.object=n[1]),n[0]!==void 0&&(l.prettyLabels=n[0]),e=new bg({props:l}),y.push(()=>k(e,"object",r)),y.push(()=>k(e,"prettyLabels",o)),{c(){A(e.$$.fragment)},l(a){M(e.$$.fragment,a)},m(a,u){T(e,a,u),s=!0},p(a,u){const h={};!t&&u&2&&(t=!0,h.object=a[1],V(()=>t=!1)),!i&&u&1&&(i=!0,h.prettyLabels=a[0],V(()=>i=!1)),e.$set(h)},i(a){s||(_(e.$$.fragment,a),s=!0)},o(a){b(e.$$.fragment,a),s=!1},d(a){D(e,a)}}}function Eee(n){let e,t,i;function s(o){n[8](o)}let r={key:n[11],label:ra(n[11],n[0])};return n[1]!==void 0&&(r.object=n[1]),e=new hw({props:r}),y.push(()=>k(e,"object",s)),{c(){A(e.$$.fragment)},l(o){M(e.$$.fragment,o)},m(o,l){T(e,o,l),i=!0},p(o,l){const a={};l&2&&(a.key=o[11]),l&3&&(a.label=ra(o[11],o[0])),!t&&l&2&&(t=!0,a.object=o[1],V(()=>t=!1)),e.$set(a)},i(o){i||(_(e.$$.fragment,o),i=!0)},o(o){b(e.$$.fragment,o),i=!1},d(o){D(e,o)}}}function xee(n){let e,t,i;function s(o){n[7](o,n[11])}let r={label:ra(n[11],n[0])};return n[1][n[11]]!==void 0&&(r.value=n[1][n[11]]),e=new YL({props:r}),y.push(()=>k(e,"value",s)),{c(){A(e.$$.fragment)},l(o){M(e.$$.fragment,o)},m(o,l){T(e,o,l),i=!0},p(o,l){n=o;const a={};l&3&&(a.label=ra(n[11],n[0])),!t&&l&2&&(t=!0,a.value=n[1][n[11]],V(()=>t=!1)),e.$set(a)},i(o){i||(_(e.$$.fragment,o),i=!0)},o(o){b(e.$$.fragment,o),i=!1},d(o){D(e,o)}}}function $ee(n){let e,t;return e=new Ju({props:{title:ra(n[11],n[0]),$$slots:{default:[Vee]},$$scope:{ctx:n}}}),{c(){A(e.$$.fragment)},l(i){M(e.$$.fragment,i)},m(i,s){T(e,i,s),t=!0},p(i,s){const r={};s&3&&(r.title=ra(i[11],i[0])),s&16387&&(r.$$scope={dirty:s,ctx:i}),e.$set(r)},i(i){t||(_(e.$$.fragment,i),t=!0)},o(i){b(e.$$.fragment,i),t=!1},d(i){D(e,i)}}}function Vee(n){let e,t,i,s,r;function o(u){n[5](u,n[11])}function l(u){n[6](u)}let a={};return n[1][n[11]]!==void 0&&(a.object=n[1][n[11]]),n[0]!==void 0&&(a.prettyLabels=n[0]),e=new bg({props:a}),y.push(()=>k(e,"object",o)),y.push(()=>k(e,"prettyLabels",l)),{c(){A(e.$$.fragment),s=kr()},l(u){M(e.$$.fragment,u),s=Sr(u)},m(u,h){T(e,u,h),O(u,s,h),r=!0},p(u,h){n=u;const c={};!t&&h&2&&(t=!0,c.object=n[1][n[11]],V(()=>t=!1)),!i&&h&1&&(i=!0,c.prettyLabels=n[0],V(()=>i=!1)),e.$set(c)},i(u){r||(_(e.$$.fragment,u),r=!0)},o(u){b(e.$$.fragment,u),r=!1},d(u){u&&E(s),D(e,u)}}}function ME(n,e){let t,i,s,r,o,l;const a=[$ee,xee,Eee],u=[];function h(c,p){return p&2&&(i=null),i==null&&(i=c[1][c[11]].constructor===Object&&!k_(c[1][c[11]])&&!c[4](c[1][c[11]])),i?0:typeof c[1][c[11]]=="string"?1:2}return s=h(e,-1),r=u[s]=a[s](e),{key:n,first:null,c(){t=R(),r.c(),o=R(),this.h()},l(c){t=R(),r.l(c),o=R(),this.h()},h(){this.first=t},m(c,p){O(c,t,p),u[s].m(c,p),O(c,o,p),l=!0},p(c,p){e=c;let d=s;s=h(e,p),s===d?u[s].p(e,p):(ii(),b(u[d],1,1,()=>{u[d]=null}),si(),r=u[s],r?r.p(e,p):(r=u[s]=a[s](e),r.c()),_(r,1),r.m(o.parentNode,o))},i(c){l||(_(r),l=!0)},o(c){b(r),l=!1},d(c){c&&(E(t),E(o)),u[s].d(c)}}}function kee(n){let e,t,i,s;const r=[Pee,Cee],o=[];function l(a,u){return a[3]?0:1}return e=l(n),t=o[e]=r[e](n),{c(){t.c(),i=R()},l(a){t.l(a),i=R()},m(a,u){o[e].m(a,u),O(a,i,u),s=!0},p(a,[u]){t.p(a,u)},i(a){s||(_(t),s=!0)},o(a){b(t),s=!1},d(a){a&&E(i),o[e].d(a)}}}function ra(n,e=!0){return e?n.replace(/([\da-z])([A-Z])/g,"$1 $2").replace(/[_-]+/g," ").toLowerCase().replace(/\b[a-z]/g,t=>t.toUpperCase()):n}function See(n,e,t){let{theme:i=void 0}=e,{prettyLabels:s=!0}=e,{object:r}=e;const o=mi("parentStore");function l(m){return ms.isObject(m)||so.isObject(m)||ro.isObject(m)}function a(m,f){n.$$.not_equal(r[f],m)&&(r[f]=m,t(1,r))}function u(m){s=m,t(0,s)}function h(m,f){n.$$.not_equal(r[f],m)&&(r[f]=m,t(1,r))}function c(m){r=m,t(1,r)}function p(m){r=m,t(1,r)}function d(m){s=m,t(0,s)}return n.$$set=m=>{"theme"in m&&t(2,i=m.theme),"prettyLabels"in m&&t(0,s=m.prettyLabels),"object"in m&&t(1,r=m.object)},[s,r,i,o,l,a,u,h,c,p,d]}class bg extends Je{constructor(e){super(),et(this,e,See,kee,Qe,{theme:2,prettyLabels:0,object:1})}}function Lee(n){let e,t,i;const s=[n[1]];function r(l){n[3](l)}let o={};for(let l=0;l<s.length;l+=1)o=B(o,s[l]);return n[0]!==void 0&&(o.value=n[0]),e=new qk({props:o}),y.push(()=>k(e,"value",r)),{c(){A(e.$$.fragment)},l(l){M(e.$$.fragment,l)},m(l,a){T(e,l,a),i=!0},p(l,a){const u=a&2?zt(s,[qt(l[1])]):{};!t&&a&1&&(t=!0,u.value=l[0],V(()=>t=!1)),e.$set(u)},i(l){i||(_(e.$$.fragment,l),i=!0)},o(l){b(e.$$.fragment,l),i=!1},d(l){D(e,l)}}}function Aee(n){let e,t,i;const s=[n[1]];function r(l){n[2](l)}let o={};for(let l=0;l<s.length;l+=1)o=B(o,s[l]);return n[0]!==void 0&&(o.value=n[0]),e=new YL({props:o}),y.push(()=>k(e,"value",r)),{c(){A(e.$$.fragment)},l(l){M(e.$$.fragment,l)},m(l,a){T(e,l,a),i=!0},p(l,a){const u=a&2?zt(s,[qt(l[1])]):{};!t&&a&1&&(t=!0,u.value=l[0],V(()=>t=!1)),e.$set(u)},i(l){i||(_(e.$$.fragment,l),i=!0)},o(l){b(e.$$.fragment,l),i=!1},d(l){D(e,l)}}}function Mee(n){let e,t,i,s;const r=[Aee,Lee],o=[];function l(a,u){return typeof a[0]=="string"?0:1}return e=l(n),t=o[e]=r[e](n),{c(){t.c(),i=R()},l(a){t.l(a),i=R()},m(a,u){o[e].m(a,u),O(a,i,u),s=!0},p(a,[u]){let h=e;e=l(a),e===h?o[e].p(a,u):(ii(),b(o[h],1,1,()=>{o[h]=null}),si(),t=o[e],t?t.p(a,u):(t=o[e]=r[e](a),t.c()),_(t,1),t.m(i.parentNode,i))},i(a){s||(_(t),s=!0)},o(a){b(t),s=!1},d(a){a&&E(i),o[e].d(a)}}}function Tee(n,e,t){const i=["value"];let s=je(e,i),{value:r}=e;function o(a){r=a,t(0,r)}function l(a){r=a,t(0,r)}return n.$$set=a=>{e=B(B({},e),Cn(a)),t(1,s=je(e,i)),"value"in a&&t(0,r=a.value)},[r,s,o,l]}class Dee extends Je{constructor(e){super(),et(this,e,Tee,Mee,Qe,{value:0})}}function Ree(n){let e,t;return e=new Ir({props:{keysAdd:["containerVerticalPadding","containerVerticalPadding"],theme:n[6].theme}}),{c(){A(e.$$.fragment)},l(i){M(e.$$.fragment,i)},m(i,s){T(e,i,s),t=!0},p(i,s){const r={};s&64&&(r.theme=i[6].theme),e.$set(r)},i(i){t||(_(e.$$.fragment,i),t=!0)},o(i){b(e.$$.fragment,i),t=!1},d(i){D(e,i)}}}function Oee(n){let e,t,i;const s=[{options:n[4]},n[5]];function r(l){n[9](l)}let o={};for(let l=0;l<s.length;l+=1)o=B(o,s[l]);return n[2]!==void 0&&(o.ref=n[2]),e=new zk({props:o}),y.push(()=>k(e,"ref",r)),{c(){A(e.$$.fragment)},l(l){M(e.$$.fragment,l)},m(l,a){T(e,l,a),i=!0},p(l,a){const u=a&48?zt(s,[a&16&&{options:l[4]},a&32&&qt(l[5])]):{};!t&&a&4&&(t=!0,u.ref=l[2],V(()=>t=!1)),e.$set(u)},i(l){i||(_(e.$$.fragment,l),i=!0)},o(l){b(e.$$.fragment,l),i=!1},d(l){D(e,l)}}}function jee(n){let e,t,i,s,r,o,l;const a=[Oee,Ree],u=[];function h(d,m){return 0}e=h(),t=u[e]=a[e](n);const c=n[8].default,p=mn(c,n,n[7],null);return{c(){t.c(),i=kr(),s=rn("div"),r=rn("div"),o=rn("div"),p&&p.c(),this.h()},l(d){t.l(d),i=Sr(d),s=on(d,"DIV",{class:!0});var m=ln(s);r=on(m,"DIV",{class:!0});var f=ln(r);o=on(f,"DIV",{class:!0});var v=ln(o);p&&p.l(v),v.forEach(E),f.forEach(E),m.forEach(E),this.h()},h(){Cu(o,"class","svelte-jeevyw"),Vl(o,"reset",n[1]),Cu(r,"class","element-container svelte-jeevyw"),Pe(r,"height",null),Pe(r,"max-height",n[0]===void 0?null:`${n[0]}px`),Pe(r,"overflow",null),Cu(s,"class","element svelte-jeevyw")},m(d,m){u[e].m(d,m),O(d,i,m),O(d,s,m),Fc(s,r),Fc(r,o),p&&p.m(o,null),n[10](s),l=!0},p(d,[m]){t.p(d,m),p&&p.p&&(!l||m&128)&&vn(p,c,d,d[7],l?_n(c,d[7],m,null):fn(d[7]),null),(!l||m&2)&&Vl(o,"reset",d[1]),m&1&&Pe(r,"height",null),m&1&&Pe(r,"max-height",d[0]===void 0?null:`${d[0]}px`)},i(d){l||(_(t),_(p,d),l=!0)},o(d){b(t),b(p,d),l=!1},d(d){d&&(E(i),E(s)),u[e].d(d),p&&p.d(d),n[10](null)}}}function Nee(n,e,t){const i=["maxHeight","resetStyle"];let s=je(e,i),{$$slots:r={},$$scope:o}=e,{maxHeight:l=void 0}=e,{resetStyle:a=!0}=e;const u={view:"separator"};let h,c;function p(m){h=m,t(2,h)}function d(m){y[m?"unshift":"push"](()=>{c=m,t(3,c)})}return n.$$set=m=>{t(6,e=B(B({},e),Cn(m))),t(5,s=je(e,i)),"maxHeight"in m&&t(0,l=m.maxHeight),"resetStyle"in m&&t(1,a=m.resetStyle),"$$scope"in m&&t(7,o=m.$$scope)},n.$$.update=()=>{n.$$.dirty&12&&h&&h.element&&h.element.replaceChildren(c)},e=Cn(e),[l,a,h,c,u,s,e,o,r,p,d]}class Bee extends Je{constructor(e){super(),et(this,e,Nee,jee,Qe,{maxHeight:0,resetStyle:1})}}function De(n){return n==null}function gg(n){return n!==null&&typeof n=="object"}function uf(n){return n!==null&&typeof n=="object"}function Iee(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function Ao(n,e){return Array.from(new Set([...Object.keys(n),...Object.keys(e)])).reduce((i,s)=>{const r=n[s],o=e[s];return uf(r)&&uf(o)?Object.assign(Object.assign({},i),{[s]:Ao(r,o)}):Object.assign(Object.assign({},i),{[s]:s in e?o:r})},{})}function Fee(n){return gg(n)?"target"in n:!1}const Kee={alreadydisposed:()=>"View has been already disposed",invalidparams:n=>`Invalid parameters for '${n.name}'`,nomatchingcontroller:n=>`No matching controller for '${n.key}'`,nomatchingview:n=>`No matching view for '${JSON.stringify(n.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:n=>`Not compatible with  plugin '${n.id}'`,propertynotfound:n=>`Property '${n.name}' not found`,shouldneverhappen:()=>"This error should never happen"};let Mo=class $l{static alreadyDisposed(){return new $l({type:"alreadydisposed"})}static notBindable(){return new $l({type:"notbindable"})}static notCompatible(e,t){return new $l({type:"notcompatible",context:{id:`${e}.${t}`}})}static propertyNotFound(e){return new $l({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new $l({type:"shouldneverhappen"})}constructor(e){var t;this.message=(t=Kee[e.type](e.context))!==null&&t!==void 0?t:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}toString(){return this.message}},TE=class X2{constructor(e,t){this.obj_=e,this.key=t}static isBindable(e){return!(e===null||typeof e!="object"&&typeof e!="function")}read(){return this.obj_[this.key]}write(e){this.obj_[this.key]=e}writeProperty(e,t){const i=this.read();if(!X2.isBindable(i))throw Mo.notBindable();if(!(e in i))throw Mo.propertyNotFound(e);i[e]=t}},Xt=class{constructor(){this.observers_={}}on(e,t){let i=this.observers_[e];return i||(i=this.observers_[e]=[]),i.push({handler:t}),this}off(e,t){const i=this.observers_[e];return i&&(this.observers_[e]=i.filter(s=>s.handler!==t)),this}emit(e,t){const i=this.observers_[e];i&&i.forEach(s=>{s.handler(t)})}},Uee=class{constructor(e,t){var i;this.constraint_=t?.constraint,this.equals_=(i=t?.equals)!==null&&i!==void 0?i:(s,r)=>s===r,this.emitter=new Xt,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},s=this.constraint_?this.constraint_.constrain(e):e,r=this.rawValue_;this.equals_(r,s)&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=s,this.emitter.emit("change",{options:i,previousRawValue:r,rawValue:s,sender:this}))}},Hee=class{constructor(e){this.emitter=new Xt,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},s=this.value_;s===e&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:i,previousRawValue:s,rawValue:this.value_,sender:this}))}},zee=class{constructor(e){this.emitter=new Xt,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}};function ut(n,e){const t=e?.constraint,i=e?.equals;return!t&&!i?new Hee(n):new Uee(n,e)}function qee(n){return[new zee(n),(e,t)=>{n.setRawValue(e,t)}]}let _e=class W2{constructor(e){this.emitter=new Xt,this.valMap_=e;for(const t in this.valMap_)this.valMap_[t].emitter.on("change",()=>{this.emitter.emit("change",{key:t,sender:this})})}static createCore(e){return Object.keys(e).reduce((i,s)=>Object.assign(i,{[s]:ut(e[s])}),{})}static fromObject(e){const t=this.createCore(e);return new W2(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}},Ep=class{constructor(e){this.values=_e.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");return Math.min(Math.max(e,i),t)}},Gee=class{constructor(e){this.values=_e.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");let s=e;return De(i)||(s=Math.max(s,i)),De(t)||(s=Math.min(s,t)),s}},Yee=class{constructor(e,t=0){this.step=e,this.origin=t}constrain(e){const t=this.origin%this.step,i=Math.round((e-t)/this.step);return t+i*this.step}},Xee=class{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}};const Wee={"**":(n,e)=>Math.pow(n,e),"*":(n,e)=>n*e,"/":(n,e)=>n/e,"%":(n,e)=>n%e,"+":(n,e)=>n+e,"-":(n,e)=>n-e,"<<":(n,e)=>n<<e,">>":(n,e)=>n>>e,">>>":(n,e)=>n>>>e,"&":(n,e)=>n&e,"^":(n,e)=>n^e,"|":(n,e)=>n|e};let Zee=class{constructor(e,t,i){this.left=t,this.operator=e,this.right=i}evaluate(){const e=Wee[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}};const Qee={"+":n=>n,"-":n=>-n,"~":n=>~n};let Jee=class{constructor(e,t){this.operator=e,this.expression=t}evaluate(){const e=Qee[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}};function Cg(n){return(e,t)=>{for(let i=0;i<n.length;i++){const s=n[i](e,t);if(s!=="")return s}return""}}function eh(n,e){var t;const i=n.substr(e).match(/^\s+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function ete(n,e){const t=n.substr(e,1);return t.match(/^[1-9]$/)?t:""}function th(n,e){var t;const i=n.substr(e).match(/^[0-9]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function tte(n,e){const t=th(n,e);if(t!=="")return t;const i=n.substr(e,1);if(e+=1,i!=="-"&&i!=="+")return"";const s=th(n,e);return s===""?"":i+s}function Pg(n,e){const t=n.substr(e,1);if(e+=1,t.toLowerCase()!=="e")return"";const i=tte(n,e);return i===""?"":t+i}function Z2(n,e){const t=n.substr(e,1);if(t==="0")return t;const i=ete(n,e);return e+=i.length,i===""?"":i+th(n,e)}function nte(n,e){const t=Z2(n,e);if(e+=t.length,t==="")return"";const i=n.substr(e,1);if(e+=i.length,i!==".")return"";const s=th(n,e);return e+=s.length,t+i+s+Pg(n,e)}function ite(n,e){const t=n.substr(e,1);if(e+=t.length,t!==".")return"";const i=th(n,e);return e+=i.length,i===""?"":t+i+Pg(n,e)}function ste(n,e){const t=Z2(n,e);return e+=t.length,t===""?"":t+Pg(n,e)}const rte=Cg([nte,ite,ste]);function ote(n,e){var t;const i=n.substr(e).match(/^[01]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function lte(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0b")return"";const i=ote(n,e);return i===""?"":t+i}function ate(n,e){var t;const i=n.substr(e).match(/^[0-7]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function ute(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0o")return"";const i=ate(n,e);return i===""?"":t+i}function hte(n,e){var t;const i=n.substr(e).match(/^[0-9a-f]+/i);return(t=i&&i[0])!==null&&t!==void 0?t:""}function cte(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0x")return"";const i=hte(n,e);return i===""?"":t+i}const dte=Cg([lte,ute,cte]),pte=Cg([dte,rte]);function mte(n,e){const t=pte(n,e);return e+=t.length,t===""?null:{evaluable:new Xee(t),cursor:e}}function vte(n,e){const t=n.substr(e,1);if(e+=t.length,t!=="(")return null;const i=J2(n,e);if(!i)return null;e=i.cursor,e+=eh(n,e).length;const s=n.substr(e,1);return e+=s.length,s!==")"?null:{evaluable:i.evaluable,cursor:e}}function fte(n,e){var t;return(t=mte(n,e))!==null&&t!==void 0?t:vte(n,e)}function Q2(n,e){const t=fte(n,e);if(t)return t;const i=n.substr(e,1);if(e+=i.length,i!=="+"&&i!=="-"&&i!=="~")return null;const s=Q2(n,e);return s?(e=s.cursor,{cursor:e,evaluable:new Jee(i,s.evaluable)}):null}function _te(n,e,t){t+=eh(e,t).length;const i=n.filter(s=>e.startsWith(s,t))[0];return i?(t+=i.length,t+=eh(e,t).length,{cursor:t,operator:i}):null}function wte(n,e){return(t,i)=>{const s=n(t,i);if(!s)return null;i=s.cursor;let r=s.evaluable;for(;;){const o=_te(e,t,i);if(!o)break;i=o.cursor;const l=n(t,i);if(!l)return null;i=l.cursor,r=new Zee(o.operator,r,l.evaluable)}return r?{cursor:i,evaluable:r}:null}}const bte=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((n,e)=>wte(n,e),Q2);function J2(n,e){return e+=eh(n,e).length,bte(n,e)}function gte(n){const e=J2(n,0);return!e||e.cursor+eh(n,e.cursor).length!==n.length?null:e.evaluable}function Or(n){var e;const t=gte(n);return(e=t?.evaluate())!==null&&e!==void 0?e:null}function eA(n){if(typeof n=="number")return n;if(typeof n=="string"){const e=Or(n);if(!De(e))return e}return 0}function dn(n){return e=>e.toFixed(Math.max(Math.min(n,20),0))}function ae(n,e,t,i,s){const r=(n-e)/(t-e);return i+r*(s-i)}function DE(n){return String(n.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Ye(n,e,t){return Math.min(Math.max(n,e),t)}function tA(n,e){return(n%e+e)%e}function Cte(n,e){return De(n.step)?Math.max(DE(e),2):DE(n.step)}function nA(n){var e;return(e=n.step)!==null&&e!==void 0?e:1}function Pte(n,e){var t;const i=Math.abs((t=n.step)!==null&&t!==void 0?t:e);return i===0?.1:Math.pow(10,Math.floor(Math.log10(i))-1)}function iA(n,e){return De(n.step)?null:new Yee(n.step,e)}function sA(n){return!De(n.max)&&!De(n.min)?new Ep({max:n.max,min:n.min}):!De(n.max)||!De(n.min)?new Gee({max:n.max,min:n.min}):null}function rA(n,e){var t,i,s;return{formatter:(t=n.format)!==null&&t!==void 0?t:dn(Cte(n,e)),keyScale:(i=n.keyScale)!==null&&i!==void 0?i:nA(n),pointerScale:(s=n.pointerScale)!==null&&s!==void 0?s:Pte(n,e)}}function oA(n){return{format:n.optional.function,keyScale:n.optional.number,max:n.optional.number,min:n.optional.number,pointerScale:n.optional.number,step:n.optional.number}}function yg(n){return{constraint:n.constraint,textProps:_e.fromObject(rA(n.params,n.initialValue))}}let xp=class{constructor(e){this.controller=e}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(e){this.controller.viewProps.set("disabled",e)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(e){this.controller.viewProps.set("hidden",e)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(e){return this.controller.importState(e)}exportState(){return this.controller.exportState()}},$p=class{constructor(e){this.target=e}},lA=class extends $p{constructor(e,t,i){super(e),this.value=t,this.last=i??!0}},yte=class extends $p{constructor(e,t){super(e),this.expanded=t}},Ete=class extends $p{constructor(e,t){super(e),this.index=t}},Eg=class extends xp{constructor(e){super(e),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new Xt,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(e){this.controller.tag=e}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}refresh(){this.controller.value.fetch()}onValueChange_(e){const t=this.controller.value;this.emitter_.emit("change",new lA(this,t.binding.target.read(),e.options.last))}};function xte(n,e){const i=Object.keys(e).reduce((s,r)=>{if(s===void 0)return;const o=e[r],l=o(n[r]);return l.succeeded?Object.assign(Object.assign({},s),{[r]:l.value}):void 0},{});return i}function $te(n,e){return n.reduce((t,i)=>{if(t===void 0)return;const s=e(i);if(!(!s.succeeded||s.value===void 0))return[...t,s.value]},[])}function Vte(n){return n===null?!1:typeof n=="object"}function ns(n){return e=>t=>{if(!e&&t===void 0)return{succeeded:!1,value:void 0};if(e&&t===void 0)return{succeeded:!0,value:void 0};const i=n(t);return i!==void 0?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}function RE(n){return{custom:e=>ns(e)(n),boolean:ns(e=>typeof e=="boolean"?e:void 0)(n),number:ns(e=>typeof e=="number"?e:void 0)(n),string:ns(e=>typeof e=="string"?e:void 0)(n),function:ns(e=>typeof e=="function"?e:void 0)(n),constant:e=>ns(t=>t===e?e:void 0)(n),raw:ns(e=>e)(n),object:e=>ns(t=>{if(Vte(t))return xte(t,e)})(n),array:e=>ns(t=>{if(Array.isArray(t))return $te(t,e)})(n)}}const hf={optional:RE(!0),required:RE(!1)};function gt(n,e){const t=e(hf),i=hf.required.object(t)(n);return i.succeeded?i.value:void 0}function Hi(n,e,t,i){if(e&&!e(n))return!1;const s=gt(n,t);return s?i(s):!1}function zi(n,e){var t;return Ao((t=n?.())!==null&&t!==void 0?t:{},e)}function Rc(n){return"value"in n}function kte(n){if(!gg(n)||!("binding"in n))return!1;const e=n.binding;return Fee(e)}const pi="http://www.w3.org/2000/svg";function pd(n){n.offsetHeight}function Ste(n,e){const t=n.style.transition;n.style.transition="none",e(),n.style.transition=t}function xg(n){return n.ontouchstart!==void 0}function Lte(n){const e=n.ownerDocument.defaultView;return e&&"document"in e?n.getContext("2d",{willReadFrequently:!0}):null}const Ate={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Vp(n,e){const t=n.createElementNS(pi,"svg");return t.innerHTML=Ate[e],t}function aA(n,e,t){n.insertBefore(e,n.children[t])}function $g(n){n.parentElement&&n.parentElement.removeChild(n)}function uA(n){for(;n.children.length>0;)n.removeChild(n.children[0])}function Mte(n){for(;n.childNodes.length>0;)n.removeChild(n.childNodes[0])}function hA(n){return n.relatedTarget?n.relatedTarget:"explicitOriginalTarget"in n?n.explicitOriginalTarget:null}function gs(n,e){n.emitter.on("change",t=>{e(t.rawValue)}),e(n.rawValue)}function Li(n,e,t){gs(n.value(e),t)}const Tte="tp";function Z(n){return(t,i)=>[Tte,"-",n,"v",t?`_${t}`:"",i?`-${i}`:""].join("")}const pu=Z("lbl");function Dte(n,e){const t=n.createDocumentFragment();return e.split(`
`).map(s=>n.createTextNode(s)).forEach((s,r)=>{r>0&&t.appendChild(n.createElement("br")),t.appendChild(s)}),t}let Rte=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(pu()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(pu("l")),Li(t.props,"label",r=>{De(r)?this.element.classList.add(pu(void 0,"nol")):(this.element.classList.remove(pu(void 0,"nol")),Mte(i),i.appendChild(Dte(e,r)))}),this.element.appendChild(i),this.labelElement=i;const s=e.createElement("div");s.classList.add(pu("v")),this.element.appendChild(s),this.valueElement=s}},cA=class{constructor(e,t){this.props=t.props,this.valueController=t.valueController,this.viewProps=t.valueController.viewProps,this.view=new Rte(e,{props:t.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(e){return Hi(e,null,t=>({label:t.optional.string}),t=>(this.props.set("label",t.label),!0))}exportProps(){return zi(null,{label:this.props.get("label")})}};function Ote(){return["veryfirst","first","last","verylast"]}const OE=Z(""),jE={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};let Vg=class{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",()=>{Ote().forEach(i=>{t.classList.remove(OE(void 0,jE[i]))}),this.blade.get("positions").forEach(i=>{t.classList.add(OE(void 0,jE[i]))})}),this.viewProps.handleDispose(()=>{$g(t)})}get parent(){return this.parent_}set parent(e){this.parent_=e,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(e){return Hi(e,null,t=>({disabled:t.required.boolean,hidden:t.required.boolean}),t=>(this.viewProps.importState(t),!0))}exportState(){return zi(null,Object.assign({},this.viewProps.exportState()))}},jte=class extends xp{get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get title(){var e;return(e=this.controller.buttonController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.buttonController.props.set("title",e)}on(e,t){const i=t.bind(this);return this.controller.buttonController.emitter.on(e,()=>{i(new $p(this))}),this}};function Nte(n,e,t){t?n.classList.add(e):n.classList.remove(e)}function La(n,e){return t=>{Nte(n,e,t)}}function kg(n,e){gs(n,t=>{e.textContent=t??""})}const Jm=Z("btn");let Bte=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Jm()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("button");i.classList.add(Jm("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(Jm("t")),kg(t.props.value("title"),s),this.buttonElement.appendChild(s)}},Ite=class{constructor(e,t){this.emitter=new Xt,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new Bte(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(e){return Hi(e,null,t=>({title:t.optional.string}),t=>(this.props.set("title",t.title),!0))}exportProps(){return zi(null,{title:this.props.get("title")})}onClick_(){this.emitter.emit("click",{sender:this})}},NE=class extends Vg{constructor(e,t){const i=new Ite(e,{props:t.buttonProps,viewProps:t.viewProps}),s=new cA(e,{blade:t.blade,props:t.labelProps,valueController:i});super({blade:t.blade,view:s.view,viewProps:t.viewProps}),this.buttonController=i,this.labelController=s}importState(e){return Hi(e,t=>super.importState(t)&&this.buttonController.importProps(t)&&this.labelController.importProps(t),()=>({}),()=>!0)}exportState(){return zi(()=>super.exportState(),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}},Fte=class{constructor(e){const[t,i]=e.split("-"),s=t.split(".");this.major=parseInt(s[0],10),this.minor=parseInt(s[1],10),this.patch=parseInt(s[2],10),this.prerelease=i??null}toString(){const e=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[e,this.prerelease].join("-"):e}};const Kte=new Fte("2.0.1");function Lt(n){return Object.assign({core:Kte},n)}Lt({id:"button",type:"blade",accept(n){const e=gt(n,t=>({title:t.required.string,view:t.required.constant("button"),label:t.optional.string}));return e?{params:e}:null},controller(n){return new NE(n.document,{blade:n.blade,buttonProps:_e.fromObject({title:n.params.title}),labelProps:_e.fromObject({label:n.params.label}),viewProps:n.viewProps})},api(n){return n.controller instanceof NE?new jte(n.controller):null}});function Ute(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}function Hte(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}function zte(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}function qte(n){return gg(n)?"refresh"in n&&typeof n.refresh=="function":!1}function Gte(n,e){if(!TE.isBindable(n))throw Mo.notBindable();return new TE(n,e)}let Yte=class{constructor(e,t){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=e,this.emitter_=new Xt,this.pool_=t,this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map(e=>this.pool_.createApi(e))}addBinding(e,t,i){const s=i??{},r=this.controller_.element.ownerDocument,o=this.pool_.createBinding(r,Gte(e,t),s),l=this.pool_.createBindingApi(o);return this.add(l,s.index)}addFolder(e){return Hte(this,e)}addButton(e){return Ute(this,e)}addTab(e){return zte(this,e)}add(e,t){const i=e.controller;return this.controller_.rack.add(i,t),e}remove(e){this.controller_.rack.remove(e.controller)}addBlade(e){const t=this.controller_.element.ownerDocument,i=this.pool_.createBlade(t,e),s=this.pool_.createApi(i);return this.add(s,e.index)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}refresh(){this.children.forEach(e=>{qte(e)&&e.refresh()})}onRackValueChange_(e){const t=e.bladeController,i=this.pool_.createApi(t),s=kte(t.value)?t.value.binding:null;this.emitter_.emit("change",new lA(i,s?s.target.read():t.value.rawValue,e.options.last))}},Sg=class extends xp{constructor(e,t){super(e),this.rackApi_=new Yte(e.rackController,t)}refresh(){this.rackApi_.refresh()}},Lg=class extends Vg{constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps}),this.rackController=e.rackController}importState(e){return Hi(e,t=>super.importState(t),t=>({children:t.required.array(t.required.raw)}),t=>this.rackController.rack.children.every((i,s)=>i.importState(t.children[s])))}exportState(){return zi(()=>super.exportState(),{children:this.rackController.rack.children.map(e=>e.exportState())})}};function cf(n){return"rackController"in n}let Xte=class{constructor(e){this.emitter=new Xt,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const t of this.allItems())if(e(t))return t;return null}includes(e){return this.cache_.has(e)}add(e,t){if(this.includes(e))throw Mo.shouldNeverHappen();const i=t!==void 0?t:this.items_.length;this.items_.splice(i,0,e),this.cache_.add(e);const s=this.extract_(e);s&&(s.emitter.on("add",this.onSubListAdd_),s.emitter.on("remove",this.onSubListRemove_),s.allItems().forEach(r=>{this.cache_.add(r)})),this.emitter.emit("add",{index:i,item:e,root:this,target:this})}remove(e){const t=this.items_.indexOf(e);if(t<0)return;this.items_.splice(t,1),this.cache_.delete(e);const i=this.extract_(e);i&&(i.allItems().forEach(s=>{this.cache_.delete(s)}),i.emitter.off("add",this.onSubListAdd_),i.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}};function Wte(n,e){for(let t=0;t<n.length;t++){const i=n[t];if(Rc(i)&&i.value===e)return i}return null}function Zte(n){return cf(n)?n.rackController.rack.bcSet_:null}let Qte=class{constructor(e){var t,i;this.emitter=new Xt,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=(t=e.blade)!==null&&t!==void 0?t:null,(i=this.blade_)===null||i===void 0||i.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=e.viewProps,this.bcSet_=new Xte(Zte),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,t){var i;(i=e.parent)===null||i===void 0||i.remove(e),e.parent=this,this.bcSet_.add(e,t)}remove(e){e.parent=null,this.bcSet_.remove(e)}find(e){return this.bcSet_.allItems().filter(e)}onSetAdd_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,root:t,sender:this}),!t)return;const i=e.item;if(i.viewProps.emitter.on("change",this.onChildViewPropsChange_),i.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),i.viewProps.handleDispose(this.onChildDispose_),Rc(i))i.value.emitter.on("change",this.onChildValueChange_);else if(cf(i)){const s=i.rackController.rack;if(s){const r=s.emitter;r.on("layout",this.onRackLayout_),r.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,root:t,sender:this}),!t)return;const i=e.item;if(Rc(i))i.value.emitter.off("change",this.onChildValueChange_);else if(cf(i)){const s=i.rackController.rack;if(s){const r=s.emitter;r.off("layout",this.onRackLayout_),r.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){const e=this.bcSet_.items.filter(s=>!s.viewProps.get("hidden")),t=e[0],i=e[e.length-1];this.bcSet_.items.forEach(s=>{const r=[];s===t&&(r.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&r.push("veryfirst")),s===i&&(r.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&r.push("verylast")),s.blade.set("positions",r)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(t=>t.viewProps.get("disposed")).forEach(t=>{this.bcSet_.remove(t)})}onChildValueChange_(e){const t=Wte(this.find(Rc),e.sender);if(!t)throw Mo.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:t,options:e.options,sender:this})}onRackLayout_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(e){this.emitter.emit("valuechange",{bladeController:e.bladeController,options:e.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}},Ag=class{constructor(e){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=e.element,this.viewProps=e.viewProps;const t=new Qte({blade:e.root?void 0:e.blade,viewProps:e.viewProps});t.emitter.on("add",this.onRackAdd_),t.emitter.on("remove",this.onRackRemove_),this.rack=t,this.viewProps.handleDispose(()=>{for(let i=this.rack.children.length-1;i>=0;i--)this.rack.children[i].viewProps.set("disposed",!0)})}onRackAdd_(e){e.root&&aA(this.element,e.bladeController.view.element,e.index)}onRackRemove_(e){e.root&&$g(e.bladeController.view.element)}};function dA(){return new _e({positions:ut([],{equals:Iee})})}let Mg=class pA extends _e{constructor(e){super(e)}static create(e){const t={completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},i=_e.createCore(t);return new pA(i)}get styleExpanded(){var e;return(e=this.get("temporaryExpanded"))!==null&&e!==void 0?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!De(e)?`${e}px`:"auto"}bindExpandedClass(e,t){const i=()=>{this.styleExpanded?e.classList.add(t):e.classList.remove(t)};Li(this,"expanded",i),Li(this,"temporaryExpanded",i)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}};function Jte(n,e){let t=0;return Ste(e,()=>{n.set("expandedHeight",null),n.set("temporaryExpanded",!0),pd(e),t=e.clientHeight,n.set("temporaryExpanded",null),pd(e)}),t}function BE(n,e){e.style.height=n.styleHeight}function Tg(n,e){n.value("expanded").emitter.on("beforechange",()=>{if(n.set("completed",!1),De(n.get("expandedHeight"))){const t=Jte(n,e);t>0&&n.set("expandedHeight",t)}n.set("shouldFixHeight",!0),pd(e)}),n.emitter.on("change",()=>{BE(n,e)}),BE(n,e),e.addEventListener("transitionend",t=>{t.propertyName==="height"&&n.cleanUpTransition()})}let ene=class extends Sg{constructor(e,t){super(e,t),this.emitter_=new Xt,this.controller.foldable.value("expanded").emitter.on("change",i=>{this.emitter_.emit("fold",new yte(this,i.sender.rawValue))}),this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)})}get expanded(){return this.controller.foldable.get("expanded")}set expanded(e){this.controller.foldable.set("expanded",e)}get title(){return this.controller.props.get("title")}set title(e){this.controller.props.set("title",e)}get children(){return this.rackApi_.children}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){return this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}};const mA=Z("cnt");let tne=class{constructor(e,t){var i;this.className_=Z((i=t.viewName)!==null&&i!==void 0?i:"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),mA()),t.viewProps.bindClassModifiers(this.element),this.foldable_=t.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),Li(this.foldable_,"completed",La(this.element,this.className_(void 0,"cpl")));const s=e.createElement("button");s.classList.add(this.className_("b")),Li(t.props,"title",u=>{De(u)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s;const r=e.createElement("div");r.classList.add(this.className_("i")),this.element.appendChild(r);const o=e.createElement("div");o.classList.add(this.className_("t")),kg(t.props.value("title"),o),this.buttonElement.appendChild(o),this.titleElement=o;const l=e.createElement("div");l.classList.add(this.className_("m")),this.buttonElement.appendChild(l);const a=e.createElement("div");a.classList.add(this.className_("c")),this.element.appendChild(a),this.containerElement=a}},IE=class extends Lg{constructor(e,t){var i;const s=Mg.create((i=t.expanded)!==null&&i!==void 0?i:!0),r=new tne(e,{foldable:s,props:t.props,viewName:t.root?"rot":void 0,viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new Ag({blade:t.blade,element:r.containerElement,root:t.root,viewProps:t.viewProps}),view:r})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=t.props,this.foldable=s,Tg(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(e){return Hi(e,t=>super.importState(t),t=>({expanded:t.required.boolean,title:t.optional.string}),t=>(this.foldable.set("expanded",t.expanded),this.props.set("title",t.title),!0))}exportState(){return zi(()=>super.exportState(),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}};Lt({id:"folder",type:"blade",accept(n){const e=gt(n,t=>({title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean}));return e?{params:e}:null},controller(n){return new IE(n.document,{blade:n.blade,expanded:n.params.expanded,props:_e.fromObject({title:n.params.title}),viewProps:n.viewProps})},api(n){return n.controller instanceof IE?new ene(n.controller,n.pool):null}});const nne=Z("");function FE(n,e){return La(n,nne(void 0,e))}let Dg=class vA extends _e{constructor(e){var t;super(e),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=qee(ut(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(e){var t,i,s;const r=e??{};return new vA(_e.createCore({disabled:(t=r.disabled)!==null&&t!==void 0?t:!1,disposed:!1,hidden:(i=r.hidden)!==null&&i!==void 0?i:!1,parent:(s=r.parent)!==null&&s!==void 0?s:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(e){gs(this.globalDisabled_,FE(e,"disabled")),Li(this,"hidden",FE(e,"hidden"))}bindDisabled(e){gs(this.globalDisabled_,t=>{e.disabled=t})}bindTabIndex(e){gs(this.globalDisabled_,t=>{e.tabIndex=t?-1:0})}handleDispose(e){this.value("disposed").emitter.on("change",t=>{t&&e()})}importState(e){this.set("disabled",e.disabled),this.set("hidden",e.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){const e=this.get("parent");return(e?e.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(e){var t;const i=e.previousRawValue;i?.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}};const KE=Z("tbp");let ine=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(KE()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(KE("c")),this.element.appendChild(i),this.containerElement=i}};const mu=Z("tbi");let sne=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(mu()),t.viewProps.bindClassModifiers(this.element),Li(t.props,"selected",r=>{r?this.element.classList.add(mu(void 0,"sel")):this.element.classList.remove(mu(void 0,"sel"))});const i=e.createElement("button");i.classList.add(mu("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(mu("t")),kg(t.props.value("title"),s),this.buttonElement.appendChild(s),this.titleElement=s}},rne=class{constructor(e,t){this.emitter=new Xt,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new sne(e,{props:t.props,viewProps:t.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}},df=class extends Lg{constructor(e,t){const i=new ine(e,{viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new Ag({blade:t.blade,element:i.containerElement,viewProps:t.viewProps}),view:i})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new rne(e,{props:t.itemProps,viewProps:Dg.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=t.props,Li(this.props,"selected",s=>{this.itemController.props.set("selected",s),this.viewProps.set("hidden",!s)})}get itemController(){return this.ic_}importState(e){return Hi(e,t=>super.importState(t),t=>({selected:t.required.boolean,title:t.required.string}),t=>(this.ic_.props.set("selected",t.selected),this.ic_.props.set("title",t.title),!0))}exportState(){return zi(()=>super.exportState(),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}},one=class extends Sg{constructor(e,t){super(e,t),this.emitter_=new Xt,this.onSelect_=this.onSelect_.bind(this),this.pool_=t,this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)}),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(e){const t=this.controller.view.element.ownerDocument,i=new df(t,{blade:dA(),itemProps:_e.fromObject({selected:!1,title:e.title}),props:_e.fromObject({selected:!1}),viewProps:Dg.create()}),s=this.pool_.createApi(i);return this.rackApi_.add(s,e.index)}removePage(e){this.rackApi_.remove(this.rackApi_.children[e])}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}onSelect_(e){this.emitter_.emit("select",new Ete(this,e.rawValue))}},lne=class extends Sg{get title(){var e;return(e=this.controller.itemController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.itemController.props.set("title",e)}get selected(){return this.controller.props.get("selected")}set selected(e){this.controller.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addBlade(e){return this.rackApi_.addBlade(e)}};const UE=-1;let ane=class{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=ut(!0),this.selectedIndex=ut(UE),this.items_=[]}add(e,t){const i=t??this.items_.length;this.items_.splice(i,0,e),e.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(e){const t=this.items_.indexOf(e);t<0||(this.items_.splice(t,1),e.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=UE,this.empty.rawValue=!0;return}const e=this.items_.findIndex(t=>t.rawValue);e<0?(this.items_.forEach((t,i)=>{t.rawValue=i===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((t,i)=>{t.rawValue=i===e}),this.selectedIndex.rawValue=e),this.empty.rawValue=!1}onItemSelectedChange_(e){if(e.rawValue){const t=this.items_.findIndex(i=>i===e.sender);this.items_.forEach((i,s)=>{i.rawValue=s===t}),this.selectedIndex.rawValue=t}else this.keepSelection_()}};const vu=Z("tab");let une=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(vu(),mA()),t.viewProps.bindClassModifiers(this.element),gs(t.empty,La(this.element,vu(void 0,"nop")));const i=e.createElement("div");i.classList.add(vu("t")),this.element.appendChild(i),this.itemsElement=i;const s=e.createElement("div");s.classList.add(vu("i")),this.element.appendChild(s);const r=e.createElement("div");r.classList.add(vu("c")),this.element.appendChild(r),this.contentsElement=r}},HE=class extends Lg{constructor(e,t){const i=new ane,s=new une(e,{empty:i.empty,viewProps:t.viewProps});super({blade:t.blade,rackController:new Ag({blade:t.blade,element:s.contentsElement,viewProps:t.viewProps}),view:s}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const r=this.rackController.rack;r.emitter.on("add",this.onRackAdd_),r.emitter.on("remove",this.onRackRemove_),this.tab=i}add(e,t){this.rackController.rack.add(e,t)}remove(e){this.rackController.rack.remove(this.rackController.rack.children[e])}onRackAdd_(e){if(!e.root)return;const t=e.bladeController;aA(this.view.itemsElement,t.itemController.view.element,e.index),t.itemController.viewProps.set("parent",this.viewProps),this.tab.add(t.props.value("selected"))}onRackRemove_(e){if(!e.root)return;const t=e.bladeController;$g(t.itemController.view.element),t.itemController.viewProps.set("parent",null),this.tab.remove(t.props.value("selected"))}};Lt({id:"tab",type:"blade",accept(n){const e=gt(n,t=>({pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")}));return!e||e.pages.length===0?null:{params:e}},controller(n){const e=new HE(n.document,{blade:n.blade,viewProps:n.viewProps});return n.params.pages.forEach(t=>{const i=new df(n.document,{blade:dA(),itemProps:_e.fromObject({selected:!1,title:t.title}),props:_e.fromObject({selected:!1}),viewProps:Dg.create()});e.add(i)}),e},api(n){return n.controller instanceof HE?new one(n.controller,n.pool):n.controller instanceof df?new lne(n.controller,n.pool):null}});let Rg=class extends Eg{get options(){return this.controller.valueController.props.get("options")}set options(e){this.controller.valueController.props.set("options",e)}};class hne{constructor(){this.disabled=!1,this.emitter=new Xt}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class cne{constructor(e,t){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=e,this.emitter=new Xt,this.interval_=t,this.setTimer_()}get disabled(){return this.disabled_}set disabled(e){this.disabled_=e,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const e=this.doc_.defaultView;e&&e.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const e=this.doc_.defaultView;e&&(this.timerId_=e.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}let Bh=class{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce((t,i)=>i.constrain(t),e)}};function md(n,e){if(n instanceof e)return n;if(n instanceof Bh){const t=n.constraints.reduce((i,s)=>i||(s instanceof e?s:null),null);if(t)return t}return null}let kp=class{constructor(e){this.values=_e.fromObject({options:e})}constrain(e){const t=this.values.get("options");return t.length===0||t.filter(s=>s.value===e).length>0?e:t[0].value}};function Sp(n){var e;const t=hf;if(Array.isArray(n))return(e=gt({items:n},i=>({items:i.required.array(i.required.object({text:i.required.string,value:i.required.raw}))})))===null||e===void 0?void 0:e.items;if(typeof n=="object")return t.required.raw(n).value}function fA(n){if(Array.isArray(n))return n;const e=[];return Object.keys(n).forEach(t=>{e.push({text:t,value:n[t]})}),e}function Og(n){return De(n)?null:new kp(fA(n))}const ev=Z("lst");let dne=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add(ev()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("select");i.classList.add(ev("s")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.selectElement=i;const s=e.createElement("div");s.classList.add(ev("m")),s.appendChild(Vp(e,"dropdown")),this.element.appendChild(s),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,Li(this.props_,"options",r=>{uA(this.selectElement),r.forEach(o=>{const l=e.createElement("option");l.textContent=o.text,this.selectElement.appendChild(l)}),this.update_()})}update_(){const e=this.props_.get("options").map(t=>t.value);this.selectElement.selectedIndex=e.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}},oa=class{constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new dne(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const t=e.currentTarget;this.value.rawValue=this.props.get("options")[t.selectedIndex].value}importProps(e){return Hi(e,null,t=>({options:t.required.custom(Sp)}),t=>(this.props.set("options",fA(t.options)),!0))}exportProps(){return zi(null,{options:this.props.get("options")})}};const zE=Z("pop");let pne=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(zE()),t.viewProps.bindClassModifiers(this.element),gs(t.shows,La(this.element,zE(void 0,"v")))}},_A=class{constructor(e,t){this.shows=ut(!1),this.viewProps=t.viewProps,this.view=new pne(e,{shows:this.shows,viewProps:this.viewProps})}};const qE=Z("txt");let mne=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(qE()),t.viewProps.bindClassModifiers(this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);const i=e.createElement("input");i.classList.add(qE("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}},jg=class{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new mne(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const i=e.currentTarget.value,s=this.parser_(i);De(s)||(this.value.rawValue=s),this.view.refresh()}};function vne(n){return String(n)}function wA(n){return n==="false"?!1:!!n}function GE(n){return vne(n)}function fne(n){return e=>n.reduce((t,i)=>t!==null?t:i(e),null)}const _ne=dn(0);function vd(n){return _ne(n)+"%"}function bA(n){return String(n)}function pf(n){return n}function Aa({primary:n,secondary:e,forward:t,backward:i}){let s=!1;function r(o){s||(s=!0,o(),s=!1)}n.emitter.on("change",o=>{r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),e.emitter.on("change",o=>{r(()=>{n.setRawValue(i(n.rawValue,e.rawValue),o.options)}),r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),{forceEmit:!1,last:!0})})}function nn(n,e){const t=n*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+t:e.downKey?-t:0}function nh(n){return{altKey:n.altKey,downKey:n.key==="ArrowDown",shiftKey:n.shiftKey,upKey:n.key==="ArrowUp"}}function As(n){return{altKey:n.altKey,downKey:n.key==="ArrowLeft",shiftKey:n.shiftKey,upKey:n.key==="ArrowRight"}}function wne(n){return n==="ArrowUp"||n==="ArrowDown"}function gA(n){return wne(n)||n==="ArrowLeft"||n==="ArrowRight"}function tv(n,e){var t,i;const s=e.ownerDocument.defaultView,r=e.getBoundingClientRect();return{x:n.pageX-(((t=s&&s.scrollX)!==null&&t!==void 0?t:0)+r.left),y:n.pageY-(((i=s&&s.scrollY)!==null&&i!==void 0?i:0)+r.top)}}let Go=class{constructor(e){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new Xt,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault(),(t=e.currentTarget)===null||t===void 0||t.focus();const i=this.elem_.ownerDocument;i.addEventListener("mousemove",this.onDocumentMouseMove_),i.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(tv(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(tv(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(tv(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchMove_(e){const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchEnd_(e){var t;const i=(t=e.targetTouches.item(0))!==null&&t!==void 0?t:this.lastTouch_,s=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(i?{x:i.clientX-s.left,y:i.clientY-s.top}:void 0),sender:this,shiftKey:e.shiftKey})}};const Nn=Z("txt");let bne=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(Nn(),Nn(void 0,"num")),t.arrayPosition&&this.element.classList.add(Nn(void 0,t.arrayPosition)),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(Nn("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Nn()),this.inputElement.classList.add(Nn("i"));const s=e.createElement("div");s.classList.add(Nn("k")),this.element.appendChild(s),this.knobElement=s;const r=e.createElementNS(pi,"svg");r.classList.add(Nn("g")),this.knobElement.appendChild(r);const o=e.createElementNS(pi,"path");o.classList.add(Nn("gb")),r.appendChild(o),this.guideBodyElem_=o;const l=e.createElementNS(pi,"path");l.classList.add(Nn("gh")),r.appendChild(l),this.guideHeadElem_=l;const a=e.createElement("div");a.classList.add(Z("tt")()),this.knobElement.appendChild(a),this.tooltipElem_=a,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.refresh()}onDraggingChange_(e){if(e.rawValue===null){this.element.classList.remove(Nn(void 0,"drg"));return}this.element.classList.add(Nn(void 0,"drg"));const t=e.rawValue/this.props_.get("pointerScale"),i=t+(t>0?-1:t<0?1:0),s=Ye(-i,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${i+s},0 L${i},4 L${i+s},8`,`M ${t},-1 L${t},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${t},4`);const r=this.props_.get("formatter");this.tooltipElem_.textContent=r(this.value.rawValue),this.tooltipElem_.style.left=`${t}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}},Ih=class{constructor(e,t){var i;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=t.parser,this.props=t.props,this.sliderProps_=(i=t.sliderProps)!==null&&i!==void 0?i:null,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=ut(null),this.view=new bne(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const s=new Go(this.view.knobElement);s.emitter.on("down",this.onPointerDown_),s.emitter.on("move",this.onPointerMove_),s.emitter.on("up",this.onPointerUp_)}constrainValue_(e){var t,i;const s=(t=this.sliderProps_)===null||t===void 0?void 0:t.get("min"),r=(i=this.sliderProps_)===null||i===void 0?void 0:i.get("max");let o=e;return s!==void 0&&(o=Math.max(o,s)),r!==void 0&&(o=Math.min(o,r)),o}onInputChange_(e){const i=e.currentTarget.value,s=this.parser_(i);De(s)||(this.value.rawValue=this.constrainValue_(s)),this.view.refresh()}onInputKeyDown_(e){const t=nn(this.props.get("keyScale"),nh(e));t!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+t),{forceEmit:!1,last:!1})}onInputKeyUp_(e){nn(this.props.get("keyScale"),nh(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;const t=e.point.x-e.bounds.width/2;return this.constrainValue_(this.originRawValue_+t*this.props.get("pointerScale"))}onPointerMove_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}};const nv=Z("sld");let gne=class{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(nv()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(nv("t")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.trackElement=i;const s=e.createElement("div");s.classList.add(nv("k")),this.trackElement.appendChild(s),this.knobElement=s,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}update_(){const e=Ye(ae(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${e}%`}onChange_(){this.update_()}},Cne=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.props=t.props,this.view=new gne(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Go(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){e.point&&this.value.setRawValue(ae(Ye(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("min"),this.props.get("max")),t)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=nn(this.props.get("keyScale"),As(e));t!==0&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onKeyUp_(e){nn(this.props.get("keyScale"),As(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const iv=Z("sldtxt");let Pne=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(iv());const i=e.createElement("div");i.classList.add(iv("s")),this.sliderView_=t.sliderView,i.appendChild(this.sliderView_.element),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(iv("t")),this.textView_=t.textView,s.appendChild(this.textView_.element),this.element.appendChild(s)}},YE=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sliderC_=new Cne(e,{props:t.sliderProps,value:t.value,viewProps:this.viewProps}),this.textC_=new Ih(e,{parser:t.parser,props:t.textProps,sliderProps:t.sliderProps,value:t.value,viewProps:t.viewProps}),this.view=new Pne(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(e){return Hi(e,null,t=>({max:t.required.number,min:t.required.number}),t=>{const i=this.sliderC_.props;return i.set("max",t.max),i.set("min",t.min),!0})}exportProps(){const e=this.sliderC_.props;return zi(null,{max:e.get("max"),min:e.get("min")})}};function yne(n){return{sliderProps:new _e({keyScale:n.keyScale,max:n.max,min:n.min}),textProps:new _e({formatter:ut(n.formatter),keyScale:n.keyScale,pointerScale:ut(n.pointerScale)})}}const Ene={containerUnitSize:"cnt-usz"};function CA(n){return`--${Ene[n]}`}function ih(n){return oA(n)}function _r(n){if(uf(n))return gt(n,ih)}function cs(n,e){if(!n)return;const t=[],i=iA(n,e);i&&t.push(i);const s=sA(n);return s&&t.push(s),new Bh(t)}function PA(n){if(n==="inline"||n==="popup")return n}function Fh(n,e){n.write(e)}const cc=Z("ckb");let xne=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(cc()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("label");i.classList.add(cc("l")),this.element.appendChild(i);const s=e.createElement("input");s.classList.add(cc("i")),s.type="checkbox",i.appendChild(s),this.inputElement=s,t.viewProps.bindDisabled(this.inputElement);const r=e.createElement("div");r.classList.add(cc("w")),i.appendChild(r);const o=Vp(e,"check");r.appendChild(o),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}},$ne=class{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new xne(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const t=e.currentTarget;this.value.rawValue=t.checked}};function Vne(n){const e=[],t=Og(n.options);return t&&e.push(t),new Bh(e)}Lt({id:"input-bool",type:"input",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=gt(e,i=>({options:i.optional.custom(Sp),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>wA,constraint:n=>Vne(n.params),writer:n=>Fh},controller:n=>{const e=n.document,t=n.value,i=n.constraint,s=i&&md(i,kp);return s?new oa(e,{props:new _e({options:s.values.value("options")}),value:t,viewProps:n.viewProps}):new $ne(e,{value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="boolean"?null:n.controller.valueController instanceof oa?new Rg(n.controller):null}});const to=Z("col");let kne=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(to()),t.foldable.bindExpandedClass(this.element,to(void 0,"expanded")),Li(t.foldable,"completed",La(this.element,to(void 0,"cpl")));const i=e.createElement("div");i.classList.add(to("h")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(to("s")),i.appendChild(s),this.swatchElement=s;const r=e.createElement("div");if(r.classList.add(to("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(to("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}};function Sne(n,e,t){const i=Ye(n/255,0,1),s=Ye(e/255,0,1),r=Ye(t/255,0,1),o=Math.max(i,s,r),l=Math.min(i,s,r),a=o-l;let u=0,h=0;const c=(l+o)/2;return a!==0&&(h=a/(1-Math.abs(o+l-1)),i===o?u=(s-r)/a:s===o?u=2+(r-i)/a:u=4+(i-s)/a,u=u/6+(u<0?1:0)),[u*360,h*100,c*100]}function Lne(n,e,t){const i=(n%360+360)%360,s=Ye(e/100,0,1),r=Ye(t/100,0,1),o=(1-Math.abs(2*r-1))*s,l=o*(1-Math.abs(i/60%2-1)),a=r-o/2;let u,h,c;return i>=0&&i<60?[u,h,c]=[o,l,0]:i>=60&&i<120?[u,h,c]=[l,o,0]:i>=120&&i<180?[u,h,c]=[0,o,l]:i>=180&&i<240?[u,h,c]=[0,l,o]:i>=240&&i<300?[u,h,c]=[l,0,o]:[u,h,c]=[o,0,l],[(u+a)*255,(h+a)*255,(c+a)*255]}function Ane(n,e,t){const i=Ye(n/255,0,1),s=Ye(e/255,0,1),r=Ye(t/255,0,1),o=Math.max(i,s,r),l=Math.min(i,s,r),a=o-l;let u;a===0?u=0:o===i?u=60*(((s-r)/a%6+6)%6):o===s?u=60*((r-i)/a+2):u=60*((i-s)/a+4);const h=o===0?0:a/o,c=o;return[u,h*100,c*100]}function yA(n,e,t){const i=tA(n,360),s=Ye(e/100,0,1),r=Ye(t/100,0,1),o=r*s,l=o*(1-Math.abs(i/60%2-1)),a=r-o;let u,h,c;return i>=0&&i<60?[u,h,c]=[o,l,0]:i>=60&&i<120?[u,h,c]=[l,o,0]:i>=120&&i<180?[u,h,c]=[0,o,l]:i>=180&&i<240?[u,h,c]=[0,l,o]:i>=240&&i<300?[u,h,c]=[l,0,o]:[u,h,c]=[o,0,l],[(u+a)*255,(h+a)*255,(c+a)*255]}function Mne(n,e,t){const i=t+e*(100-Math.abs(2*t-100))/200;return[n,i!==0?e*(100-Math.abs(2*t-100))/i:0,t+e*(100-Math.abs(2*t-100))/(2*100)]}function Tne(n,e,t){const i=100-Math.abs(t*(200-e)/100-100);return[n,i!==0?e*t/i:0,t*(200-e)/(2*100)]}function Ai(n){return[n[0],n[1],n[2]]}function Lp(n,e){return[n[0],n[1],n[2],e]}const Dne={hsl:{hsl:(n,e,t)=>[n,e,t],hsv:Mne,rgb:Lne},hsv:{hsl:Tne,hsv:(n,e,t)=>[n,e,t],rgb:yA},rgb:{hsl:Sne,hsv:Ane,rgb:(n,e,t)=>[n,e,t]}};function la(n,e){return[e==="float"?1:n==="rgb"?255:360,e==="float"?1:n==="rgb"?255:100,e==="float"?1:n==="rgb"?255:100]}function Rne(n,e){return n===e?e:tA(n,e)}function EA(n,e,t){var i;const s=la(e,t);return[e==="rgb"?Ye(n[0],0,s[0]):Rne(n[0],s[0]),Ye(n[1],0,s[1]),Ye(n[2],0,s[2]),Ye((i=n[3])!==null&&i!==void 0?i:1,0,1)]}function XE(n,e,t,i){const s=la(e,t),r=la(e,i);return n.map((o,l)=>o/s[l]*r[l])}function xA(n,e,t){const i=XE(n,e.mode,e.type,"int"),s=Dne[e.mode][t.mode](...i);return XE(s,t.mode,"int",t.type)}let fe=class $A{static black(){return new $A([0,0,0],"rgb")}constructor(e,t){this.type="int",this.mode=t,this.comps_=EA(e,t,this.type)}getComponents(e){return Lp(xA(Ai(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}};const sr=Z("colp");let One=class{constructor(e,t){this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(sr()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(sr("hsv"));const s=e.createElement("div");s.classList.add(sr("sv")),this.svPaletteView_=t.svPaletteView,s.appendChild(this.svPaletteView_.element),i.appendChild(s);const r=e.createElement("div");r.classList.add(sr("h")),this.hPaletteView_=t.hPaletteView,r.appendChild(this.hPaletteView_.element),i.appendChild(r),this.element.appendChild(i);const o=e.createElement("div");if(o.classList.add(sr("rgb")),this.textsView_=t.textsView,o.appendChild(this.textsView_.element),this.element.appendChild(o),t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};const l=e.createElement("div");l.classList.add(sr("a"));const a=e.createElement("div");a.classList.add(sr("ap")),a.appendChild(this.alphaViews_.palette.element),l.appendChild(a);const u=e.createElement("div");u.classList.add(sr("at")),u.appendChild(this.alphaViews_.text.element),l.appendChild(u),this.element.appendChild(l)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map(t=>t.inputElement)];return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}};function jne(n){return n==="int"?"int":n==="float"?"float":void 0}function Ng(n){return gt(n,e=>({color:e.optional.object({alpha:e.optional.boolean,type:e.optional.custom(jne)}),expanded:e.optional.boolean,picker:e.optional.custom(PA),readonly:e.optional.constant(!1)}))}function To(n){return n?.1:1}function VA(n){var e;return(e=n.color)===null||e===void 0?void 0:e.type}let Bg=class{constructor(e,t){this.type="float",this.mode=t,this.comps_=EA(e,t,this.type)}getComponents(e){return Lp(xA(Ai(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}};const Nne={int:(n,e)=>new fe(n,e),float:(n,e)=>new Bg(n,e)};function Ig(n,e,t){return Nne[t](n,e)}function Bne(n){return n.type==="float"}function Ine(n){return n.type==="int"}function Fne(n){const e=n.getComponents(),t=la(n.mode,"int");return new fe([Math.round(ae(e[0],0,1,0,t[0])),Math.round(ae(e[1],0,1,0,t[1])),Math.round(ae(e[2],0,1,0,t[2])),e[3]],n.mode)}function Kne(n){const e=n.getComponents(),t=la(n.mode,"int");return new Bg([ae(e[0],0,t[0],0,1),ae(e[1],0,t[1],0,1),ae(e[2],0,t[2],0,1),e[3]],n.mode)}function Kt(n,e){if(n.type===e)return n;if(Ine(n)&&e==="float")return Kne(n);if(Bne(n)&&e==="int")return Fne(n);throw Mo.shouldNeverHappen()}function Une(n,e){return n.alpha===e.alpha&&n.mode===e.mode&&n.notation===e.notation&&n.type===e.type}function Gn(n,e){const t=n.match(/^(.+)%$/);return Math.min(t?parseFloat(t[1])*.01*e:parseFloat(n),e)}const Hne={deg:n=>n,grad:n=>n*360/400,rad:n=>n*360/(2*Math.PI),turn:n=>n*360};function kA(n){const e=n.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(n);const t=parseFloat(e[1]),i=e[2];return Hne[i](t)}function SA(n){const e=n.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Gn(e[1],255),Gn(e[2],255),Gn(e[3],255)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function zne(n){const e=SA(n);return e?new fe(e,"rgb"):null}function LA(n){const e=n.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Gn(e[1],255),Gn(e[2],255),Gn(e[3],255),Gn(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function qne(n){const e=LA(n);return e?new fe(e,"rgb"):null}function AA(n){const e=n.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[kA(e[1]),Gn(e[2],100),Gn(e[3],100)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function Gne(n){const e=AA(n);return e?new fe(e,"hsl"):null}function MA(n){const e=n.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[kA(e[1]),Gn(e[2],100),Gn(e[3],100),Gn(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function Yne(n){const e=MA(n);return e?new fe(e,"hsl"):null}function TA(n){const e=n.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];const t=n.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}function Xne(n){const e=TA(n);return e?new fe(e,"rgb"):null}function DA(n){const e=n.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),ae(parseInt(e[4]+e[4],16),0,255,0,1)];const t=n.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),ae(parseInt(t[4],16),0,255,0,1)]:null}function Wne(n){const e=DA(n);return e?new fe(e,"rgb"):null}function RA(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function WE(n){return e=>{const t=RA(e);return t?Ig(t,"rgb",n):null}}function OA(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function ZE(n){return e=>{const t=OA(e);return t?Ig(t,"rgb",n):null}}const Zne=[{parser:TA,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:DA,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:SA,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:LA,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:AA,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:MA,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:RA,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:OA,result:{alpha:!0,mode:"rgb",notation:"object"}}];function Qne(n){return Zne.reduce((e,{parser:t,result:i})=>e||(t(n)?i:null),null)}function Jne(n,e="int"){const t=Qne(n);return t?t.notation==="hex"&&e!=="float"?Object.assign(Object.assign({},t),{type:"int"}):t.notation==="func"?Object.assign(Object.assign({},t),{type:e}):null:null}function Kh(n){const e=[Xne,Wne,zne,qne,Gne,Yne];n==="int"&&e.push(WE("int"),ZE("int")),n==="float"&&e.push(WE("float"),ZE("float"));const t=fne(e);return i=>{const s=t(i);return s?Kt(s,n):null}}function eie(n){const e=Kh("int");if(typeof n!="string")return fe.black();const t=e(n);return t??fe.black()}function jA(n){const e=Ye(Math.floor(n),0,255).toString(16);return e.length===1?`0${e}`:e}function Fg(n,e="#"){const t=Ai(n.getComponents("rgb")).map(jA).join("");return`${e}${t}`}function Kg(n,e="#"){const t=n.getComponents("rgb"),i=[t[0],t[1],t[2],t[3]*255].map(jA).join("");return`${e}${i}`}function NA(n){const e=dn(0),t=Kt(n,"int");return`rgb(${Ai(t.getComponents("rgb")).map(s=>e(s)).join(", ")})`}function Oc(n){const e=dn(2),t=dn(0);return`rgba(${Kt(n,"int").getComponents("rgb").map((r,o)=>(o===3?e:t)(r)).join(", ")})`}function tie(n){const e=[dn(0),vd,vd],t=Kt(n,"int");return`hsl(${Ai(t.getComponents("hsl")).map((s,r)=>e[r](s)).join(", ")})`}function nie(n){const e=[dn(0),vd,vd,dn(2)];return`hsla(${Kt(n,"int").getComponents("hsl").map((s,r)=>e[r](s)).join(", ")})`}function BA(n,e){const t=dn(e==="float"?2:0),i=["r","g","b"],s=Kt(n,e);return`{${Ai(s.getComponents("rgb")).map((o,l)=>`${i[l]}: ${t(o)}`).join(", ")}}`}function iie(n){return e=>BA(e,n)}function IA(n,e){const t=dn(2),i=dn(e==="float"?2:0),s=["r","g","b","a"];return`{${Kt(n,e).getComponents("rgb").map((l,a)=>{const u=a===3?t:i;return`${s[a]}: ${u(l)}`}).join(", ")}}`}function sie(n){return e=>IA(e,n)}const rie=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:Fg},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:Kg},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:NA},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:Oc},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:tie},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:nie},...["int","float"].reduce((n,e)=>[...n,{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:iie(e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:sie(e)}],[])];function FA(n){return rie.reduce((e,t)=>e||(Une(t.format,n)?t.stringifier:null),null)}const fu=Z("apl");let oie=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(fu()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(fu("b")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(fu("c")),i.appendChild(s),this.colorElem_=s;const r=e.createElement("div");r.classList.add(fu("m")),this.element.appendChild(r),this.markerElem_=r;const o=e.createElement("div");o.classList.add(fu("p")),this.markerElem_.appendChild(o),this.previewElem_=o,this.update_()}update_(){const e=this.value.rawValue,t=e.getComponents("rgb"),i=new fe([t[0],t[1],t[2],0],"rgb"),s=new fe([t[0],t[1],t[2],255],"rgb"),r=["to right",Oc(i),Oc(s)];this.colorElem_.style.background=`linear-gradient(${r.join(",")})`,this.previewElem_.style.backgroundColor=Oc(e);const o=ae(t[3],0,1,0,100);this.markerElem_.style.left=`${o}%`}onValueChange_(){this.update_()}},lie=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new oie(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Go(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=e.point.x/e.bounds.width,s=this.value.rawValue,[r,o,l]=s.getComponents("hsv");this.value.setRawValue(new fe([r,o,l,i],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=nn(To(!0),As(e));if(t===0)return;const i=this.value.rawValue,[s,r,o,l]=i.getComponents("hsv");this.value.setRawValue(new fe([s,r,o,l+t],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){nn(To(!0),As(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const ml=Z("coltxt");function aie(n){const e=n.createElement("select"),t=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}];return e.appendChild(t.reduce((i,s)=>{const r=n.createElement("option");return r.textContent=s.text,r.value=s.value,i.appendChild(r),i},n.createDocumentFragment())),e}let uie=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(ml()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(ml("m")),this.modeElem_=aie(e),this.modeElem_.classList.add(ml("ms")),i.appendChild(this.modeSelectElement),t.viewProps.bindDisabled(this.modeElem_);const s=e.createElement("div");s.classList.add(ml("mm")),s.appendChild(Vp(e,"dropdown")),i.appendChild(s),this.element.appendChild(i);const r=e.createElement("div");r.classList.add(ml("w")),this.element.appendChild(r),this.inputsElem_=r,this.inputViews_=t.inputViews,this.applyInputViews_(),gs(t.mode,o=>{this.modeElem_.value=o})}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(e){this.inputViews_=e,this.applyInputViews_()}applyInputViews_(){uA(this.inputsElem_);const e=this.element.ownerDocument;this.inputViews_.forEach(t=>{const i=e.createElement("div");i.classList.add(ml("c")),i.appendChild(t.element),this.inputsElem_.appendChild(i)})}};function hie(n){return dn(n==="float"?2:0)}function cie(n,e,t){const i=la(n,e)[t];return new Ep({min:0,max:i})}function die(n,e,t){return new Ih(n,{arrayPosition:t===0?"fst":t===2?"lst":"mid",parser:e.parser,props:_e.fromObject({formatter:hie(e.colorType),keyScale:To(!1),pointerScale:e.colorType==="float"?.01:1}),value:ut(0,{constraint:cie(e.colorMode,e.colorType,t)}),viewProps:e.viewProps})}function pie(n,e){const t={colorMode:e.colorMode,colorType:e.colorType,parser:Or,viewProps:e.viewProps};return[0,1,2].map(i=>{const s=die(n,t,i);return Aa({primary:e.value,secondary:s.value,forward(r){return Kt(r,e.colorType).getComponents(e.colorMode)[i]},backward(r,o){const l=e.colorMode,u=Kt(r,e.colorType).getComponents(l);u[i]=o;const h=Ig(Lp(Ai(u),u[3]),l,e.colorType);return Kt(h,"int")}}),s})}function mie(n,e){const t=new jg(n,{parser:Kh("int"),props:_e.fromObject({formatter:Fg}),value:ut(fe.black()),viewProps:e.viewProps});return Aa({primary:e.value,secondary:t.value,forward:i=>new fe(Ai(i.getComponents()),i.mode),backward:(i,s)=>new fe(Lp(Ai(s.getComponents(i.mode)),i.getComponents()[3]),i.mode)}),[t]}function vie(n){return n!=="hex"}let fie=class{constructor(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=t.colorType,this.value=t.value,this.viewProps=t.viewProps,this.colorMode=ut(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new uie(e,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const t=this.colorMode.rawValue;return vie(t)?pie(e,{colorMode:t,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):mie(e,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(e){const t=e.currentTarget;this.colorMode.rawValue=t.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map(i=>i.view)}};const sv=Z("hpl");let _ie=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(sv()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(sv("c")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(sv("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=this.value.rawValue,[t]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=NA(new fe([t,100,100],"hsv"));const i=ae(t,0,360,0,100);this.markerElem_.style.left=`${i}%`}onValueChange_(){this.update_()}},wie=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new _ie(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Go(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=ae(Ye(e.point.x,0,e.bounds.width),0,e.bounds.width,0,360),s=this.value.rawValue,[,r,o,l]=s.getComponents("hsv");this.value.setRawValue(new fe([i,r,o,l],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=nn(To(!1),As(e));if(t===0)return;const i=this.value.rawValue,[s,r,o,l]=i.getComponents("hsv");this.value.setRawValue(new fe([s+t,r,o,l],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){nn(To(!1),As(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}};const rv=Z("svp"),QE=64;let bie=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(rv()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("canvas");i.height=QE,i.width=QE,i.classList.add(rv("c")),this.element.appendChild(i),this.canvasElement=i;const s=e.createElement("div");s.classList.add(rv("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=Lte(this.canvasElement);if(!e)return;const i=this.value.rawValue.getComponents("hsv"),s=this.canvasElement.width,r=this.canvasElement.height,o=e.getImageData(0,0,s,r),l=o.data;for(let h=0;h<r;h++)for(let c=0;c<s;c++){const p=ae(c,0,s,0,100),d=ae(h,0,r,100,0),m=yA(i[0],p,d),f=(h*s+c)*4;l[f]=m[0],l[f+1]=m[1],l[f+2]=m[2],l[f+3]=255}e.putImageData(o,0,0);const a=ae(i[1],0,100,0,100);this.markerElem_.style.left=`${a}%`;const u=ae(i[2],0,100,100,0);this.markerElem_.style.top=`${u}%`}onValueChange_(){this.update_()}},gie=class{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new bie(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Go(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=ae(e.point.x,0,e.bounds.width,0,100),s=ae(e.point.y,0,e.bounds.height,100,0),[r,,,o]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new fe([r,i,s,o],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){gA(e.key)&&e.preventDefault();const[t,i,s,r]=this.value.rawValue.getComponents("hsv"),o=To(!1),l=nn(o,As(e)),a=nn(o,nh(e));l===0&&a===0||this.value.setRawValue(new fe([t,i+l,s+a,r],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){const t=To(!1),i=nn(t,As(e)),s=nn(t,nh(e));i===0&&s===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},Cie=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.hPaletteC_=new wie(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new gie(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=t.supportsAlpha?{palette:new lie(e,{value:this.value,viewProps:this.viewProps}),text:new Ih(e,{parser:Or,props:_e.fromObject({pointerScale:.01,keyScale:.1,formatter:dn(2)}),value:ut(0,{constraint:new Ep({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Aa({primary:this.value,secondary:this.alphaIcs_.text.value,forward:i=>i.getComponents()[3],backward:(i,s)=>{const r=i.getComponents();return r[3]=s,new fe(r,i.mode)}}),this.textsC_=new fie(e,{colorType:t.colorType,value:this.value,viewProps:this.viewProps}),this.view=new One(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}};const ov=Z("colsw");let Pie=class{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(ov()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(ov("sw")),this.element.appendChild(i),this.swatchElem_=i;const s=e.createElement("button");s.classList.add(ov("b")),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s,this.update_()}update_(){const e=this.value.rawValue;this.swatchElem_.style.backgroundColor=Kg(e)}onValueChange_(){this.update_()}},yie=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new Pie(e,{value:this.value,viewProps:this.viewProps})}},Ug=class{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=Mg.create(t.expanded),this.swatchC_=new yie(e,{value:this.value,viewProps:this.viewProps});const i=this.swatchC_.view.buttonElement;i.addEventListener("blur",this.onButtonBlur_),i.addEventListener("click",this.onButtonClick_),this.textC_=new jg(e,{parser:t.parser,props:_e.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new kne(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=t.pickerLayout==="popup"?new _A(e,{viewProps:this.viewProps}):null;const s=new Cie(e,{colorType:t.colorType,supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});s.view.allFocusableElements.forEach(r=>{r.addEventListener("blur",this.onPopupChildBlur_),r.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=s,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(s.view.element),Aa({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:r=>r,backward:(r,o)=>o})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Tg(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=hA(e);i&&t.contains(i)||i&&i===this.swatchC_.view.buttonElement&&!xg(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}};function Eie(n){return Ai(n.getComponents("rgb")).reduce((e,t)=>e<<8|Math.floor(t)&255,0)}function xie(n){return n.getComponents("rgb").reduce((e,t,i)=>{const s=Math.floor(i===3?t*255:t)&255;return e<<8|s},0)>>>0}function $ie(n){return new fe([n>>16&255,n>>8&255,n&255],"rgb")}function Vie(n){return new fe([n>>24&255,n>>16&255,n>>8&255,ae(n&255,0,255,0,1)],"rgb")}function kie(n){return typeof n!="number"?fe.black():$ie(n)}function Sie(n){return typeof n!="number"?fe.black():Vie(n)}function jc(n,e){return typeof n!="object"||De(n)?!1:e in n&&typeof n[e]=="number"}function KA(n){return jc(n,"r")&&jc(n,"g")&&jc(n,"b")}function UA(n){return KA(n)&&jc(n,"a")}function HA(n){return KA(n)}function Hg(n,e){if(n.mode!==e.mode||n.type!==e.type)return!1;const t=n.getComponents(),i=e.getComponents();for(let s=0;s<t.length;s++)if(t[s]!==i[s])return!1;return!0}function JE(n){return"a"in n?[n.r,n.g,n.b,n.a]:[n.r,n.g,n.b]}function Lie(n){const e=FA(n);return e?(t,i)=>{Fh(t,e(i))}:null}function Aie(n){const e=n?xie:Eie;return(t,i)=>{Fh(t,e(i))}}function Mie(n,e,t){const s=Kt(e,t).toRgbaObject();n.writeProperty("r",s.r),n.writeProperty("g",s.g),n.writeProperty("b",s.b),n.writeProperty("a",s.a)}function Tie(n,e,t){const s=Kt(e,t).toRgbaObject();n.writeProperty("r",s.r),n.writeProperty("g",s.g),n.writeProperty("b",s.b)}function Die(n,e){return(t,i)=>{n?Mie(t,i,e):Tie(t,i,e)}}function Rie(n){var e;return!!(!((e=n?.color)===null||e===void 0)&&e.alpha)}function Oie(n){return n?e=>Kg(e,"0x"):e=>Fg(e,"0x")}function jie(n){return"color"in n||n.view==="color"}Lt({id:"input-color-number",type:"input",accept:(n,e)=>{if(typeof n!="number"||!jie(e))return null;const t=Ng(e);return t?{initialValue:n,params:Object.assign(Object.assign({},t),{supportsAlpha:Rie(e)})}:null},binding:{reader:n=>n.params.supportsAlpha?Sie:kie,equals:Hg,writer:n=>Aie(n.params.supportsAlpha)},controller:n=>{var e,t;return new Ug(n.document,{colorType:"int",expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:Oie(n.params.supportsAlpha),parser:Kh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.supportsAlpha,value:n.value,viewProps:n.viewProps})}});function Nie(n,e){if(!HA(n))return Kt(fe.black(),e);if(e==="int"){const t=JE(n);return new fe(t,"rgb")}if(e==="float"){const t=JE(n);return new Bg(t,"rgb")}return Kt(fe.black(),"int")}function Bie(n){return UA(n)}function Iie(n){return e=>{const t=Nie(e,n);return Kt(t,"int")}}function Fie(n,e){return t=>n?IA(t,e):BA(t,e)}Lt({id:"input-color-object",type:"input",accept:(n,e)=>{var t;if(!HA(n))return null;const i=Ng(e);return i?{initialValue:n,params:Object.assign(Object.assign({},i),{colorType:(t=VA(e))!==null&&t!==void 0?t:"int"})}:null},binding:{reader:n=>Iie(n.params.colorType),equals:Hg,writer:n=>Die(Bie(n.initialValue),n.params.colorType)},controller:n=>{var e,t;const i=UA(n.initialValue);return new Ug(n.document,{colorType:n.params.colorType,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:Fie(i,n.params.colorType),parser:Kh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:i,value:n.value,viewProps:n.viewProps})}});Lt({id:"input-color-string",type:"input",accept:(n,e)=>{if(typeof n!="string"||e.view==="text")return null;const t=Jne(n,VA(e));if(!t)return null;const i=FA(t);if(!i)return null;const s=Ng(e);return s?{initialValue:n,params:Object.assign(Object.assign({},s),{format:t,stringifier:i})}:null},binding:{reader:()=>eie,equals:Hg,writer:n=>{const e=Lie(n.params.format);if(!e)throw Mo.notBindable();return e}},controller:n=>{var e,t;return new Ug(n.document,{colorType:n.params.format.type,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:n.params.stringifier,parser:Kh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.format.alpha,value:n.value,viewProps:n.viewProps})}});let zg=class{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map((i,s)=>{var r,o;return(o=(r=this.components[s])===null||r===void 0?void 0:r.constrain(i))!==null&&o!==void 0?o:i});return this.asm_.fromComponents(t)}};const ex=Z("pndtxt");let Kie=class{constructor(e,t){this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add(ex()),this.textViews.forEach(i=>{const s=e.createElement("div");s.classList.add(ex("a")),s.appendChild(i.element),this.element.appendChild(s)})}};function Uie(n,e,t){return new Ih(n,{arrayPosition:t===0?"fst":t===e.axes.length-1?"lst":"mid",parser:e.parser,props:e.axes[t].textProps,value:ut(0,{constraint:e.axes[t].constraint}),viewProps:e.viewProps})}let qg=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map((i,s)=>Uie(e,t,s)),this.acs_.forEach((i,s)=>{Aa({primary:this.value,secondary:i.value,forward:r=>t.assembly.toComponents(r)[s],backward:(r,o)=>{const l=t.assembly.toComponents(r);return l[s]=o,t.assembly.fromComponents(l)}})}),this.view=new Kie(e,{textViews:this.acs_.map(i=>i.view)})}get textControllers(){return this.acs_}},Hie=class extends Eg{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(e){this.controller.valueController.sliderController.props.set("max",e)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(e){this.controller.valueController.sliderController.props.set("min",e)}};function zie(n,e){const t=[],i=iA(n,e);i&&t.push(i);const s=sA(n);s&&t.push(s);const r=Og(n.options);return r&&t.push(r),new Bh(t)}Lt({id:"input-number",type:"input",accept:(n,e)=>{if(typeof n!="number")return null;const t=gt(e,i=>Object.assign(Object.assign({},oA(i)),{options:i.optional.custom(Sp),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>eA,constraint:n=>zie(n.params,n.initialValue),writer:n=>Fh},controller:n=>{const e=n.value,t=n.constraint,i=t&&md(t,kp);if(i)return new oa(n.document,{props:new _e({options:i.values.value("options")}),value:e,viewProps:n.viewProps});const s=rA(n.params,e.rawValue),r=t&&md(t,Ep);return r?new YE(n.document,Object.assign(Object.assign({},yne(Object.assign(Object.assign({},s),{keyScale:ut(s.keyScale),max:r.values.value("max"),min:r.values.value("min")}))),{parser:Or,value:e,viewProps:n.viewProps})):new Ih(n.document,{parser:Or,props:_e.fromObject(s),value:e,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="number"?null:n.controller.valueController instanceof YE?new Hie(n.controller):n.controller.valueController instanceof oa?new Rg(n.controller):null}});let $r=class{constructor(e=0,t=0){this.x=e,this.y=t}getComponents(){return[this.x,this.y]}static isObject(e){if(De(e))return!1;const t=e.x,i=e.y;return!(typeof t!="number"||typeof i!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y}toObject(){return{x:this.x,y:this.y}}};const zA={toComponents:n=>n.getComponents(),fromComponents:n=>new $r(...n)},vl=Z("p2d");let qie=class{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(vl()),t.viewProps.bindClassModifiers(this.element),gs(t.expanded,La(this.element,vl(void 0,"expanded")));const i=e.createElement("div");i.classList.add(vl("h")),this.element.appendChild(i);const s=e.createElement("button");s.classList.add(vl("b")),s.appendChild(Vp(e,"p2dpad")),t.viewProps.bindDisabled(s),i.appendChild(s),this.buttonElement=s;const r=e.createElement("div");if(r.classList.add(vl("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(vl("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}};const rr=Z("p2dp");let Gie=class{constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=e.createElement("div"),this.element.classList.add(rr()),t.layout==="popup"&&this.element.classList.add(rr(void 0,"p")),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(rr("p")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.padElement=i;const s=e.createElementNS(pi,"svg");s.classList.add(rr("g")),this.padElement.appendChild(s),this.svgElem_=s;const r=e.createElementNS(pi,"line");r.classList.add(rr("ax")),r.setAttributeNS(null,"x1","0"),r.setAttributeNS(null,"y1","50%"),r.setAttributeNS(null,"x2","100%"),r.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(r);const o=e.createElementNS(pi,"line");o.classList.add(rr("ax")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","0"),o.setAttributeNS(null,"x2","50%"),o.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(o);const l=e.createElementNS(pi,"line");l.classList.add(rr("l")),l.setAttributeNS(null,"x1","50%"),l.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(l),this.lineElem_=l;const a=e.createElement("div");a.classList.add(rr("m")),this.padElement.appendChild(a),this.markerElem_=a,t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,t]=this.value.rawValue.getComponents(),i=this.props_.get("max"),s=ae(e,-i,+i,0,100),r=ae(t,-i,+i,0,100),o=this.props_.get("invertsY")?100-r:r;this.lineElem_.setAttributeNS(null,"x2",`${s}%`),this.lineElem_.setAttributeNS(null,"y2",`${o}%`),this.markerElem_.style.left=`${s}%`,this.markerElem_.style.top=`${o}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}};function tx(n,e,t){return[nn(e[0],As(n)),nn(e[1],nh(n))*(t?1:-1)]}let Yie=class{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new Gie(e,{layout:t.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Go(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=this.props.get("max"),s=ae(e.point.x,0,e.bounds.width,-i,+i),r=ae(this.props.get("invertsY")?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-i,+i);this.value.setRawValue(new $r(s,r),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onPadKeyDown_(e){gA(e.key)&&e.preventDefault();const[t,i]=tx(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(new $r(this.value.rawValue.x+t,this.value.rawValue.y+i),{forceEmit:!1,last:!1})}onPadKeyUp_(e){const[t,i]=tx(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}},Xie=class{constructor(e,t){var i,s;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=Mg.create(t.expanded),this.popC_=t.pickerLayout==="popup"?new _A(e,{viewProps:this.viewProps}):null;const r=new Yie(e,{layout:t.pickerLayout,props:new _e({invertsY:ut(t.invertsY),max:ut(t.max),xKeyScale:t.axes[0].textProps.value("keyScale"),yKeyScale:t.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});r.view.allFocusableElements.forEach(o=>{o.addEventListener("blur",this.onPopupChildBlur_),o.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=r,this.textC_=new qg(e,{assembly:zA,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new qie(e,{expanded:this.foldable_.value("expanded"),pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(i=this.view.buttonElement)===null||i===void 0||i.addEventListener("blur",this.onPadButtonBlur_),(s=this.view.buttonElement)===null||s===void 0||s.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Aa({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:o=>o,backward:(o,l)=>l})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Tg(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=hA(e);i&&t.contains(i)||i&&i===this.view.buttonElement&&!xg(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.view.buttonElement.focus()}};function Wie(n){return $r.isObject(n)?new $r(n.x,n.y):new $r}function Zie(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y)}function Qie(n,e){return new zg({assembly:zA,components:[cs(Object.assign(Object.assign({},n),n.x),e.x),cs(Object.assign(Object.assign({},n),n.y),e.y)]})}function nx(n,e){var t,i;if(!De(n.min)||!De(n.max))return Math.max(Math.abs((t=n.min)!==null&&t!==void 0?t:0),Math.abs((i=n.max)!==null&&i!==void 0?i:0));const s=nA(n);return Math.max(Math.abs(s)*10,Math.abs(e)*10)}function Jie(n,e){var t,i;const s=nx(Ao(n,(t=n.x)!==null&&t!==void 0?t:{}),e.x),r=nx(Ao(n,(i=n.y)!==null&&i!==void 0?i:{}),e.y);return Math.max(s,r)}function ese(n){if(!("y"in n))return!1;const e=n.y;return e&&"inverted"in e?!!e.inverted:!1}Lt({id:"input-point2d",type:"input",accept:(n,e)=>{if(!$r.isObject(n))return null;const t=gt(e,i=>Object.assign(Object.assign({},ih(i)),{expanded:i.optional.boolean,picker:i.optional.custom(PA),readonly:i.optional.constant(!1),x:i.optional.custom(_r),y:i.optional.object(Object.assign(Object.assign({},ih(i)),{inverted:i.optional.boolean}))}));return t?{initialValue:n,params:t}:null},binding:{reader:()=>Wie,constraint:n=>Qie(n.params,n.initialValue),equals:$r.equals,writer:()=>Zie},controller:n=>{var e,t;const i=n.document,s=n.value,r=n.constraint,o=[n.params.x,n.params.y];return new Xie(i,{axes:s.rawValue.getComponents().map((l,a)=>{var u;return yg({constraint:r.components[a],initialValue:l,params:Ao(n.params,(u=o[a])!==null&&u!==void 0?u:{})})}),expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,invertsY:ese(n.params),max:Jie(n.params,s.rawValue),parser:Or,pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",value:s,viewProps:n.viewProps})}});let Il=class{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if(De(e))return!1;const t=e.x,i=e.y,s=e.z;return!(typeof t!="number"||typeof i!="number"||typeof s!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}};const qA={toComponents:n=>n.getComponents(),fromComponents:n=>new Il(...n)};function tse(n){return Il.isObject(n)?new Il(n.x,n.y,n.z):new Il}function nse(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z)}function ise(n,e){return new zg({assembly:qA,components:[cs(Object.assign(Object.assign({},n),n.x),e.x),cs(Object.assign(Object.assign({},n),n.y),e.y),cs(Object.assign(Object.assign({},n),n.z),e.z)]})}Lt({id:"input-point3d",type:"input",accept:(n,e)=>{if(!Il.isObject(n))return null;const t=gt(e,i=>Object.assign(Object.assign({},ih(i)),{readonly:i.optional.constant(!1),x:i.optional.custom(_r),y:i.optional.custom(_r),z:i.optional.custom(_r)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>tse,constraint:n=>ise(n.params,n.initialValue),equals:Il.equals,writer:n=>nse},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z];return new qg(n.document,{assembly:qA,axes:e.rawValue.getComponents().map((s,r)=>{var o;return yg({constraint:t.components[r],initialValue:s,params:Ao(n.params,(o=i[r])!==null&&o!==void 0?o:{})})}),parser:Or,value:e,viewProps:n.viewProps})}});let Fl=class{constructor(e=0,t=0,i=0,s=0){this.x=e,this.y=t,this.z=i,this.w=s}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if(De(e))return!1;const t=e.x,i=e.y,s=e.z,r=e.w;return!(typeof t!="number"||typeof i!="number"||typeof s!="number"||typeof r!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}};const GA={toComponents:n=>n.getComponents(),fromComponents:n=>new Fl(...n)};function sse(n){return Fl.isObject(n)?new Fl(n.x,n.y,n.z,n.w):new Fl}function rse(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z),n.writeProperty("w",e.w)}function ose(n,e){return new zg({assembly:GA,components:[cs(Object.assign(Object.assign({},n),n.x),e.x),cs(Object.assign(Object.assign({},n),n.y),e.y),cs(Object.assign(Object.assign({},n),n.z),e.z),cs(Object.assign(Object.assign({},n),n.w),e.w)]})}Lt({id:"input-point4d",type:"input",accept:(n,e)=>{if(!Fl.isObject(n))return null;const t=gt(e,i=>Object.assign(Object.assign({},ih(i)),{readonly:i.optional.constant(!1),w:i.optional.custom(_r),x:i.optional.custom(_r),y:i.optional.custom(_r),z:i.optional.custom(_r)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>sse,constraint:n=>ose(n.params,n.initialValue),equals:Fl.equals,writer:n=>rse},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z,n.params.w];return new qg(n.document,{assembly:GA,axes:e.rawValue.getComponents().map((s,r)=>{var o;return yg({constraint:t.components[r],initialValue:s,params:Ao(n.params,(o=i[r])!==null&&o!==void 0?o:{})})}),parser:Or,value:e,viewProps:n.viewProps})}});function lse(n){const e=[],t=Og(n.options);return t&&e.push(t),new Bh(e)}Lt({id:"input-string",type:"input",accept:(n,e)=>{if(typeof n!="string")return null;const t=gt(e,i=>({readonly:i.optional.constant(!1),options:i.optional.custom(Sp)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>bA,constraint:n=>lse(n.params),writer:n=>Fh},controller:n=>{const e=n.document,t=n.value,i=n.constraint,s=i&&md(i,kp);return s?new oa(e,{props:new _e({options:s.values.value("options")}),value:t,viewProps:n.viewProps}):new jg(e,{parser:r=>r,props:_e.fromObject({formatter:pf}),value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="string"?null:n.controller.valueController instanceof oa?new Rg(n.controller):null}});const Uh={monitor:{defaultInterval:200,defaultRows:3}},ix=Z("mll");let ase=class{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(ix()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("textarea");i.classList.add(ix("i")),i.style.height=`calc(var(${CA("containerUnitSize")}) * ${t.rows})`,i.readOnly=!0,t.viewProps.bindDisabled(i),this.element.appendChild(i),this.textareaElem_=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.textareaElem_,t=e.scrollTop===e.scrollHeight-e.clientHeight,i=[];this.value.rawValue.forEach(s=>{s!==void 0&&i.push(this.formatter_(s))}),e.textContent=i.join(`
`),t&&(e.scrollTop=e.scrollHeight)}onValueUpdate_(){this.update_()}},Gg=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new ase(e,{formatter:t.formatter,rows:t.rows,value:this.value,viewProps:this.viewProps})}};const sx=Z("sgl");let use=class{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(sx()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(sx("i")),i.readOnly=!0,i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.value.rawValue,t=e[e.length-1];this.inputElement.value=t!==void 0?this.formatter_(t):""}onValueUpdate_(){this.update_()}},Yg=class{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new use(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}};Lt({id:"monitor-bool",type:"monitor",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=gt(e,i=>({readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>wA},controller:n=>{var e;return n.value.rawValue.length===1?new Yg(n.document,{formatter:GE,value:n.value,viewProps:n.viewProps}):new Gg(n.document,{formatter:GE,rows:(e=n.params.rows)!==null&&e!==void 0?e:Uh.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}});let hse=class extends Eg{get max(){return this.controller.valueController.props.get("max")}set max(e){this.controller.valueController.props.set("max",e)}get min(){return this.controller.valueController.props.get("min")}set min(e){this.controller.valueController.props.set("min",e)}};const or=Z("grl");let cse=class{constructor(e,t){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(or()),t.viewProps.bindClassModifiers(this.element),this.formatter_=t.formatter,this.props_=t.props,this.cursor_=t.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const i=e.createElementNS(pi,"svg");i.classList.add(or("g")),i.style.height=`calc(var(${CA("containerUnitSize")}) * ${t.rows})`,this.element.appendChild(i),this.svgElem_=i;const s=e.createElementNS(pi,"polyline");this.svgElem_.appendChild(s),this.lineElem_=s;const r=e.createElement("div");r.classList.add(or("t"),Z("tt")()),this.element.appendChild(r),this.tooltipElem_=r,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const e=this.svgElem_.getBoundingClientRect(),t=this.value.rawValue.length-1,i=this.props_.get("min"),s=this.props_.get("max"),r=[];this.value.rawValue.forEach((h,c)=>{if(h===void 0)return;const p=ae(c,0,t,0,e.width),d=ae(h,i,s,e.height,0);r.push([p,d].join(","))}),this.lineElem_.setAttributeNS(null,"points",r.join(" "));const o=this.tooltipElem_,l=this.value.rawValue[this.cursor_.rawValue];if(l===void 0){o.classList.remove(or("t","a"));return}const a=ae(this.cursor_.rawValue,0,t,0,e.width),u=ae(l,i,s,e.height,0);o.style.left=`${a}px`,o.style.top=`${u}px`,o.textContent=`${this.formatter_(l)}`,o.classList.contains(or("t","a"))||(o.classList.add(or("t","a"),or("t","in")),pd(o),o.classList.remove(or("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}},YA=class{constructor(e,t){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.cursor_=ut(-1),this.view=new cse(e,{cursor:this.cursor_,formatter:t.formatter,rows:t.rows,props:this.props,value:this.value,viewProps:this.viewProps}),!xg(e))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const i=new Go(this.view.element);i.emitter.on("down",this.onGraphPointerDown_),i.emitter.on("move",this.onGraphPointerMove_),i.emitter.on("up",this.onGraphPointerUp_)}}importProps(e){return Hi(e,null,t=>({max:t.required.number,min:t.required.number}),t=>(this.props.set("max",t.max),this.props.set("min",t.min),!0))}exportProps(){return zi(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(e){const t=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(ae(e.offsetX,0,t.width,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){if(!e.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(ae(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}};function mf(n){return De(n.format)?dn(2):n.format}function dse(n){var e;return n.value.rawValue.length===1?new Yg(n.document,{formatter:mf(n.params),value:n.value,viewProps:n.viewProps}):new Gg(n.document,{formatter:mf(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:Uh.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}function pse(n){var e,t,i;return new YA(n.document,{formatter:mf(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:Uh.monitor.defaultRows,props:_e.fromObject({max:(t=n.params.max)!==null&&t!==void 0?t:100,min:(i=n.params.min)!==null&&i!==void 0?i:0}),value:n.value,viewProps:n.viewProps})}function rx(n){return n.view==="graph"}Lt({id:"monitor-number",type:"monitor",accept:(n,e)=>{if(typeof n!="number")return null;const t=gt(e,i=>({format:i.optional.function,max:i.optional.number,min:i.optional.number,readonly:i.required.constant(!0),rows:i.optional.number,view:i.optional.string}));return t?{initialValue:n,params:t}:null},binding:{defaultBufferSize:n=>rx(n)?64:1,reader:n=>eA},controller:n=>rx(n.params)?pse(n):dse(n),api:n=>n.controller.valueController instanceof YA?new hse(n.controller):null});Lt({id:"monitor-string",type:"monitor",accept:(n,e)=>{if(typeof n!="string")return null;const t=gt(e,i=>({multiline:i.optional.boolean,readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>bA},controller:n=>{var e;const t=n.value;return t.rawValue.length>1||n.params.multiline?new Gg(n.document,{formatter:pf,rows:(e=n.params.rows)!==null&&e!==void 0?e:Uh.monitor.defaultRows,value:t,viewProps:n.viewProps}):new Yg(n.document,{formatter:pf,value:t,viewProps:n.viewProps})}});class mse extends xp{measureStart(e){this.controller.valueController.measureStart(e)}measureEnd(){return this.controller.valueController.measureEnd()}measure(e,t){this.controller.valueController.measure(e,t)}measureAsync(e,t){return this.controller.valueController.measureAsync(e,t)}get measureHandler(){return this.controller.valueController.measureHandler}set measureHandler(e){this.controller.valueController.measureHandler=e}}class ox extends Vg{constructor(e,t){const i=t.valueController,s=new cA(e,{blade:t.blade,props:t.labelProps,valueController:i});super({blade:t.blade,view:s.view,viewProps:i.viewProps}),this.valueController=i,this.labelController=s}}class vse{measureStart(){const e=performance.now();return()=>performance.now()-e}}function lx(n,e,t,i){function s(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function l(h){try{u(i.next(h))}catch(c){o(c)}}function a(h){try{u(i.throw(h))}catch(c){o(c)}}function u(h){h.done?r(h.value):s(h.value).then(l,a)}u((i=i.apply(n,e||[])).next())})}class XA{constructor(){this.map=new Map,this.keySet=new Set}get(e){return this.map.get(e)}getOrCreate(e,t){this.keySet.has(e)||this.keySet.add(e);let i=this.map.get(e);return i==null&&(i=t(),this.map.set(e,i)),i}set(e,t){this.keySet.has(e)||this.keySet.add(e),this.map.set(e,t)}resetUsedSet(){this.keySet.clear()}vaporize(e){for(const[t,i]of this.map.entries())this.keySet.has(t)||(this.map.delete(t),e?.([t,i]))}}function fse(n){n.splice(0,n.length)}function dc(n){let e=0;return n.forEach(t=>e+=t),e}class _se{constructor(e){this.__recalcForEach=0,this.__countUntilRecalc=0,this.__history=[],this.__index=0,this.__count=0,this.__cache=0,this.__length=e,this.__recalcForEach=e;for(let t=0;t<e;t++)this.__history[t]=0}get mean(){const e=Math.min(this.__count,this.__length);return e===0?0:this.__cache/e}get recalcForEach(){return this.__recalcForEach}set recalcForEach(e){const t=e-this.__recalcForEach;this.__recalcForEach=e,this.__countUntilRecalc=Math.max(0,this.__countUntilRecalc+t)}reset(){this.__index=0,this.__count=0,this.__cache=0,this.__countUntilRecalc=0;for(let e=0;e<this.__length;e++)this.__history[e]=0}push(e){const t=this.__history[this.__index];this.__history[this.__index]=e,this.__count++,this.__index=(this.__index+1)%this.__length,this.__countUntilRecalc===0?this.recalc():(this.__countUntilRecalc--,this.__cache-=t,this.__cache+=e)}recalc(){this.__countUntilRecalc=this.__recalcForEach;const e=this.__history.slice(0,Math.min(this.__count,this.__length)).reduce((t,i)=>t+i,0);this.__cache=e}}function vf(n,e){if(typeof e!="function")return vf(n,r=>r<e);const t=e;let i=0,s=n.length;for(;i<s;){const r=i+s>>1,o=n[r];t(o)?i=r+1:s=r}return i}class wse{constructor(e){this.__history=[],this.__sorted=[],this.__index=0,this.__length=e}get median(){return this.percentile(50)}percentile(e){return this.__history.length===0?0:this.__sorted[Math.round(e*.01*(this.__history.length-1))]}reset(){this.__index=0,this.__history=[],this.__sorted=[]}push(e){const t=this.__history[this.__index];if(this.__history[this.__index]=e,this.__index=(this.__index+1)%this.__length,this.__sorted.length===this.__length){const s=vf(this.__sorted,t);this.__sorted.splice(s,1)}const i=vf(this.__sorted,e);this.__sorted.splice(i,0,e)}}function fl(n,e){let t=0;for(let i=0;i<n.length;i++)t+=n[i]*e[i];return t}function Xg(n){return Math.min(Math.max(n,0),1)}function bse(n){return`rgb( ${n.map(t=>Xg(t)*256).join(", ")} )`}function gse(n){const e=[.13572138,4.6153926,-42.66032258,132.13108234],t=[.09140261,2.19418839,4.84296658,-14.18503333],i=[.1066733,12.64194608,-60.58204836,110.36276771],s=[-152.94239396,59.28637943],r=[4.27729857,2.82956604],o=[-89.90310912,27.34824973];n=Xg(n);const l=[1,n,n*n,n*n*n],a=[l[2],l[3]].map(h=>h*l[2]),u=[fl(l,e)+fl(a,s),fl(l,t)+fl(a,r),fl(l,i)+fl(a,o)];return bse(u)}const lr=Z("profiler");class Cse{constructor(e,t){this.targetDelta=t.targetDelta,this.deltaUnit=t.deltaUnit,this.fractionDigits=t.fractionDigits,this.calcMode=t.calcMode,this.element=e.createElement("div"),this.element.classList.add(lr()),t.viewProps.bindClassModifiers(this.element),this.svgRootElement_=e.createElementNS("http://www.w3.org/2000/svg","svg"),this.svgRootElement_.classList.add(lr("root")),this.element.appendChild(this.svgRootElement_),this.entryContainerElement_=e.createElementNS("http://www.w3.org/2000/svg","g"),this.entryContainerElement_.classList.add(lr("container")),this.entryContainerElement_.setAttribute("transform","translate( 1, 1 )"),this.svgRootElement_.appendChild(this.entryContainerElement_),this.tooltipElement_=e.createElement("div"),this.tooltipElement_.classList.add(lr("tooltip")),this.tooltipElement_.style.display="none",this.element.appendChild(this.tooltipElement_),this.tooltipInsideElement_=e.createElement("div"),this.tooltipInsideElement_.classList.add(lr("tooltipinside")),this.tooltipElement_.appendChild(this.tooltipInsideElement_),this.labelElement_=e.createElement("div"),this.labelElement_.classList.add(lr("label")),this.labelElement_.textContent=this.deltaToDisplayDelta_(0),this.element.appendChild(this.labelElement_),this.entryElementCacheMap_=new XA,this.hoveringEntry_=null}update(e){const t=this.entryToDelta_(e);this.labelElement_.textContent=this.deltaToDisplayDelta_(t),this.entryElementCacheMap_.resetUsedSet();const i=160/Math.max(this.targetDelta,t);let s=0;for(const r of e.children)this.addEntry_(r,"",this.entryContainerElement_,i).setAttribute("transform",`translate( ${s}, 0 )`),s+=this.entryToDelta_(r)*i;this.entryElementCacheMap_.vaporize(([r,o])=>{o.remove(),this.hoveringEntry_===r&&(this.hoveringEntry_=null)}),this.updateTooltip_()}updateTooltip_(){const e=this.hoveringEntry_;if(e){const t=this.entryElementCacheMap_.get(e),i=t?.getAttribute("data-delta"),s=this.deltaToDisplayDelta_(parseFloat(i??"0.0")),r=`${e}
${s}`;this.tooltipElement_.style.display="block",this.tooltipInsideElement_.textContent=r}else this.tooltipElement_.style.display="none"}addEntry_(e,t,i,s){const r=`${t}/${e.name}`,o=this.entryElementCacheMap_.getOrCreate(r,()=>{const h=document.createElementNS("http://www.w3.org/2000/svg","g");h.classList.add(lr("entry")),i.appendChild(h),this.entryElementCacheMap_.set(r,h);const c=document.createElementNS("http://www.w3.org/2000/svg","rect");return c.classList.add(lr("entryrect")),h.appendChild(c),c.addEventListener("mouseenter",()=>{this.hoveringEntry_=r,this.updateTooltip_()}),c.addEventListener("mouseleave",()=>{this.hoveringEntry_=null,this.updateTooltip_()}),h}),l=this.entryToDelta_(e);o.setAttribute("data-delta",`${l}`);const a=o.childNodes[0];a.setAttribute("width",`${Math.max(.01,l*s-1)}px`),a.setAttribute("height","9px");const u=.15+.7*Xg(l/this.targetDelta);if(a.setAttribute("fill",gse(u)),e.children.length>0){let h=0;e.children.forEach(c=>{this.addEntry_(c,r,o,s).setAttribute("transform",`translate( ${h}, 10 )`),h+=this.entryToDelta_(c)*s})}return o}entryToDelta_(e){if(this.calcMode==="frame")return e.delta;if(this.calcMode==="mean")return e.deltaMean;if(this.calcMode==="median")return e.deltaMedian;throw new Error('Unreachable! calcMode must be one of "frame", "mean", or "median"')}deltaToDisplayDelta_(e){return`${e.toFixed(this.fractionDigits)} ${this.deltaUnit}`}}class Pse{constructor(e,t){this.targetDelta=t.targetDelta,this.bufferSize=t.bufferSize,this.onTick_=this.onTick_.bind(this),this.ticker_=t.ticker,this.ticker_.emitter.on("tick",this.onTick_),this.viewProps=t.viewProps,this.view=new Cse(e,{targetDelta:this.targetDelta,deltaUnit:t.deltaUnit,fractionDigits:t.fractionDigits,calcMode:t.calcMode,viewProps:this.viewProps}),this.viewProps.handleDispose(()=>{this.ticker_.dispose()}),this.measureHandler=t.measureHandler,this.rootCalcCacheStack_=[this.createNewEntryCalcCache_()]}measureStart(e){const i=this.rootCalcCacheStack_[this.rootCalcCacheStack_.length-1].childrenCacheMap.getOrCreate(e,()=>this.createNewEntryCalcCache_());i.childrenCacheMap.resetUsedSet(),fse(i.childrenPromiseDelta),this.rootCalcCacheStack_.push(i),i.measureEnd=this.measureHandler.measureStart()}measureEnd(){return lx(this,void 0,void 0,function*(){const e=this.rootCalcCacheStack_[this.rootCalcCacheStack_.length-1],t=this.rootCalcCacheStack_[this.rootCalcCacheStack_.length-2],i=Promise.resolve(e.measureEnd());e.measureEnd=null,t.childrenPromiseDelta.push(i),this.rootCalcCacheStack_.pop(),e.childrenCacheMap.vaporize();const s=yield Promise.all(e.childrenPromiseDelta),r=dc(s),o=(yield i)-r;e.meanCalc.push(o),e.medianCalc.push(o),e.latest=o})}measure(e,t){this.measureStart(e),t(),this.measureEnd()}measureAsync(e,t){return lx(this,void 0,void 0,function*(){this.measureStart(e),yield t(),this.measureEnd()})}renderEntry(){return this.renderEntryFromCalcCache_("",this.rootCalcCacheStack_[0])}renderEntryFromCalcCache_(e,t){const i=[];for(const d of t.childrenCacheMap.keySet){const m=t.childrenCacheMap.get(d);i.push(this.renderEntryFromCalcCache_(d,m))}const s=t.latest,r=t.meanCalc.mean,o=t.medianCalc.median,l=dc(i.map(d=>d.delta)),a=dc(i.map(d=>d.deltaMean)),u=dc(i.map(d=>d.deltaMedian)),h=s+l,c=r+a,p=o+u;return{name:e,delta:h,deltaMean:c,deltaMedian:p,selfDelta:s,selfDeltaMean:r,selfDeltaMedian:o,children:i}}onTick_(){this.view.update(this.renderEntry())}createNewEntryCalcCache_(){return{meanCalc:new _se(this.bufferSize),medianCalc:new wse(this.bufferSize),latest:0,measureEnd:null,childrenCacheMap:new XA,childrenPromiseDelta:[]}}}function yse(n,e){return e===0?new hne:new cne(n,e??Uh.monitor.defaultInterval)}function Ese(n){switch(n){case"frame":case"mean":case"median":return n;default:return}}function xse(n){if(typeof n=="object"&&n!=null&&"measureStart"in n)return n;typeof n=="object"&&n!=null&&"measure"in n&&console.warn("The API of `ProfilerBladeDefaultMeasureHandler` has been changed in v0.4.0! Please define `measureStart` instead of `measure`. Fallback to the default measure handler.")}Lt({id:"profiler",type:"blade",accept(n){const e=gt(n,t=>({view:t.required.constant("profiler"),targetDelta:t.optional.number,bufferSize:t.optional.number,deltaUnit:t.optional.string,fractionDigits:t.optional.number,calcMode:t.optional.custom(Ese),label:t.optional.string,interval:t.optional.number,measureHandler:t.optional.custom(xse)}));return e?{params:e}:null},controller(n){var e,t,i,s,r,o,l;const a=(e=n.params.interval)!==null&&e!==void 0?e:500,u=(t=n.params.targetDelta)!==null&&t!==void 0?t:16.67,h=(i=n.params.bufferSize)!==null&&i!==void 0?i:30,c=(s=n.params.deltaUnit)!==null&&s!==void 0?s:"ms",p=(r=n.params.fractionDigits)!==null&&r!==void 0?r:2,d=(o=n.params.calcMode)!==null&&o!==void 0?o:"mean",m=(l=n.params.measureHandler)!==null&&l!==void 0?l:new vse;return new ox(n.document,{blade:n.blade,labelProps:_e.fromObject({label:n.params.label}),valueController:new Pse(n.document,{ticker:yse(n.document,a),targetDelta:u,bufferSize:h,deltaUnit:c,fractionDigits:p,calcMode:d,viewProps:n.viewProps,measureHandler:m})})},api(n){return n.controller instanceof ox?new mse(n.controller):null}});function Re(n){return n==null}function Wg(n){return n!==null&&typeof n=="object"}function ff(n){return n!==null&&typeof n=="object"}function $se(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function Do(n,e){return Array.from(new Set([...Object.keys(n),...Object.keys(e)])).reduce((i,s)=>{const r=n[s],o=e[s];return ff(r)&&ff(o)?Object.assign(Object.assign({},i),{[s]:Do(r,o)}):Object.assign(Object.assign({},i),{[s]:s in e?o:r})},{})}function Vse(n){return Wg(n)?"target"in n:!1}const kse={alreadydisposed:()=>"View has been already disposed",invalidparams:n=>`Invalid parameters for '${n.name}'`,nomatchingcontroller:n=>`No matching controller for '${n.key}'`,nomatchingview:n=>`No matching view for '${JSON.stringify(n.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:n=>`Not compatible with  plugin '${n.id}'`,propertynotfound:n=>`Property '${n.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class bn{static alreadyDisposed(){return new bn({type:"alreadydisposed"})}static notBindable(){return new bn({type:"notbindable"})}static notCompatible(e,t){return new bn({type:"notcompatible",context:{id:`${e}.${t}`}})}static propertyNotFound(e){return new bn({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new bn({type:"shouldneverhappen"})}constructor(e){var t;this.message=(t=kse[e.type](e.context))!==null&&t!==void 0?t:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}toString(){return this.message}}class fd{constructor(e,t){this.obj_=e,this.key=t}static isBindable(e){return!(e===null||typeof e!="object"&&typeof e!="function")}read(){return this.obj_[this.key]}write(e){this.obj_[this.key]=e}writeProperty(e,t){const i=this.read();if(!fd.isBindable(i))throw bn.notBindable();if(!(e in i))throw bn.propertyNotFound(e);i[e]=t}}class Sn{constructor(){this.observers_={}}on(e,t){let i=this.observers_[e];return i||(i=this.observers_[e]=[]),i.push({handler:t}),this}off(e,t){const i=this.observers_[e];return i&&(this.observers_[e]=i.filter(s=>s.handler!==t)),this}emit(e,t){const i=this.observers_[e];i&&i.forEach(s=>{s.handler(t)})}}class Sse{constructor(e,t){var i;this.constraint_=t?.constraint,this.equals_=(i=t?.equals)!==null&&i!==void 0?i:(s,r)=>s===r,this.emitter=new Sn,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},s=this.constraint_?this.constraint_.constrain(e):e,r=this.rawValue_;this.equals_(r,s)&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=s,this.emitter.emit("change",{options:i,previousRawValue:r,rawValue:s,sender:this}))}}class Lse{constructor(e){this.emitter=new Sn,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const i=t??{forceEmit:!1,last:!0},s=this.value_;s===e&&!i.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:i,previousRawValue:s,rawValue:this.value_,sender:this}))}}class Ase{constructor(e){this.emitter=new Sn,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}}function ht(n,e){const t=e?.constraint,i=e?.equals;return!t&&!i?new Lse(n):new Sse(n,e)}function Mse(n){return[new Ase(n),(e,t)=>{n.setRawValue(e,t)}]}class Y{constructor(e){this.emitter=new Sn,this.valMap_=e;for(const t in this.valMap_)this.valMap_[t].emitter.on("change",()=>{this.emitter.emit("change",{key:t,sender:this})})}static createCore(e){return Object.keys(e).reduce((i,s)=>Object.assign(i,{[s]:ht(e[s])}),{})}static fromObject(e){const t=this.createCore(e);return new Y(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}}class Ap{constructor(e){this.values=Y.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");return Math.min(Math.max(e,i),t)}}class Tse{constructor(e){this.values=Y.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),i=this.values.get("min");let s=e;return Re(i)||(s=Math.max(s,i)),Re(t)||(s=Math.min(s,t)),s}}class Dse{constructor(e,t=0){this.step=e,this.origin=t}constrain(e){const t=this.origin%this.step,i=Math.round((e-t)/this.step);return t+i*this.step}}class Rse{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}}const Ose={"**":(n,e)=>Math.pow(n,e),"*":(n,e)=>n*e,"/":(n,e)=>n/e,"%":(n,e)=>n%e,"+":(n,e)=>n+e,"-":(n,e)=>n-e,"<<":(n,e)=>n<<e,">>":(n,e)=>n>>e,">>>":(n,e)=>n>>>e,"&":(n,e)=>n&e,"^":(n,e)=>n^e,"|":(n,e)=>n|e};class jse{constructor(e,t,i){this.left=t,this.operator=e,this.right=i}evaluate(){const e=Ose[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const Nse={"+":n=>n,"-":n=>-n,"~":n=>~n};class Bse{constructor(e,t){this.operator=e,this.expression=t}evaluate(){const e=Nse[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function Zg(n){return(e,t)=>{for(let i=0;i<n.length;i++){const s=n[i](e,t);if(s!=="")return s}return""}}function sh(n,e){var t;const i=n.substr(e).match(/^\s+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function Ise(n,e){const t=n.substr(e,1);return t.match(/^[1-9]$/)?t:""}function rh(n,e){var t;const i=n.substr(e).match(/^[0-9]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function Fse(n,e){const t=rh(n,e);if(t!=="")return t;const i=n.substr(e,1);if(e+=1,i!=="-"&&i!=="+")return"";const s=rh(n,e);return s===""?"":i+s}function Qg(n,e){const t=n.substr(e,1);if(e+=1,t.toLowerCase()!=="e")return"";const i=Fse(n,e);return i===""?"":t+i}function WA(n,e){const t=n.substr(e,1);if(t==="0")return t;const i=Ise(n,e);return e+=i.length,i===""?"":i+rh(n,e)}function Kse(n,e){const t=WA(n,e);if(e+=t.length,t==="")return"";const i=n.substr(e,1);if(e+=i.length,i!==".")return"";const s=rh(n,e);return e+=s.length,t+i+s+Qg(n,e)}function Use(n,e){const t=n.substr(e,1);if(e+=t.length,t!==".")return"";const i=rh(n,e);return e+=i.length,i===""?"":t+i+Qg(n,e)}function Hse(n,e){const t=WA(n,e);return e+=t.length,t===""?"":t+Qg(n,e)}const zse=Zg([Kse,Use,Hse]);function qse(n,e){var t;const i=n.substr(e).match(/^[01]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function Gse(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0b")return"";const i=qse(n,e);return i===""?"":t+i}function Yse(n,e){var t;const i=n.substr(e).match(/^[0-7]+/);return(t=i&&i[0])!==null&&t!==void 0?t:""}function Xse(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0o")return"";const i=Yse(n,e);return i===""?"":t+i}function Wse(n,e){var t;const i=n.substr(e).match(/^[0-9a-f]+/i);return(t=i&&i[0])!==null&&t!==void 0?t:""}function Zse(n,e){const t=n.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0x")return"";const i=Wse(n,e);return i===""?"":t+i}const Qse=Zg([Gse,Xse,Zse]),Jse=Zg([Qse,zse]);function ere(n,e){const t=Jse(n,e);return e+=t.length,t===""?null:{evaluable:new Rse(t),cursor:e}}function tre(n,e){const t=n.substr(e,1);if(e+=t.length,t!=="(")return null;const i=QA(n,e);if(!i)return null;e=i.cursor,e+=sh(n,e).length;const s=n.substr(e,1);return e+=s.length,s!==")"?null:{evaluable:i.evaluable,cursor:e}}function nre(n,e){var t;return(t=ere(n,e))!==null&&t!==void 0?t:tre(n,e)}function ZA(n,e){const t=nre(n,e);if(t)return t;const i=n.substr(e,1);if(e+=i.length,i!=="+"&&i!=="-"&&i!=="~")return null;const s=ZA(n,e);return s?(e=s.cursor,{cursor:e,evaluable:new Bse(i,s.evaluable)}):null}function ire(n,e,t){t+=sh(e,t).length;const i=n.filter(s=>e.startsWith(s,t))[0];return i?(t+=i.length,t+=sh(e,t).length,{cursor:t,operator:i}):null}function sre(n,e){return(t,i)=>{const s=n(t,i);if(!s)return null;i=s.cursor;let r=s.evaluable;for(;;){const o=ire(e,t,i);if(!o)break;i=o.cursor;const l=n(t,i);if(!l)return null;i=l.cursor,r=new jse(o.operator,r,l.evaluable)}return r?{cursor:i,evaluable:r}:null}}const rre=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((n,e)=>sre(n,e),ZA);function QA(n,e){return e+=sh(n,e).length,rre(n,e)}function ore(n){const e=QA(n,0);return!e||e.cursor+sh(n,e.cursor).length!==n.length?null:e.evaluable}function jr(n){var e;const t=ore(n);return(e=t?.evaluate())!==null&&e!==void 0?e:null}function JA(n){if(typeof n=="number")return n;if(typeof n=="string"){const e=jr(n);if(!Re(e))return e}return 0}function pn(n){return e=>e.toFixed(Math.max(Math.min(n,20),0))}function q(n,e,t,i,s){const r=(n-e)/(t-e);return i+r*(s-i)}function ax(n){return String(n.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function Xe(n,e,t){return Math.min(Math.max(n,e),t)}function eM(n,e){return(n%e+e)%e}function lre(n,e){return Re(n.step)?Math.max(ax(e),2):ax(n.step)}function tM(n){var e;return(e=n.step)!==null&&e!==void 0?e:1}function are(n,e){var t;const i=Math.abs((t=n.step)!==null&&t!==void 0?t:e);return i===0?.1:Math.pow(10,Math.floor(Math.log10(i))-1)}function nM(n,e){return Re(n.step)?null:new Dse(n.step,e)}function iM(n){return!Re(n.max)&&!Re(n.min)?new Ap({max:n.max,min:n.min}):!Re(n.max)||!Re(n.min)?new Tse({max:n.max,min:n.min}):null}function sM(n,e){var t,i,s;return{formatter:(t=n.format)!==null&&t!==void 0?t:pn(lre(n,e)),keyScale:(i=n.keyScale)!==null&&i!==void 0?i:tM(n),pointerScale:(s=n.pointerScale)!==null&&s!==void 0?s:are(n,e)}}function rM(n){return{format:n.optional.function,keyScale:n.optional.number,max:n.optional.number,min:n.optional.number,pointerScale:n.optional.number,step:n.optional.number}}function Jg(n){return{constraint:n.constraint,textProps:Y.fromObject(sM(n.params,n.initialValue))}}class eC{constructor(e){this.controller=e}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(e){this.controller.viewProps.set("disabled",e)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(e){this.controller.viewProps.set("hidden",e)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(e){return this.controller.importState(e)}exportState(){return this.controller.exportState()}}class Mp{constructor(e){this.target=e}}class oM extends Mp{constructor(e,t,i){super(e),this.value=t,this.last=i??!0}}class ure extends Mp{constructor(e,t){super(e),this.expanded=t}}class hre extends Mp{constructor(e,t){super(e),this.index=t}}class tC extends eC{constructor(e){super(e),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new Sn,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(e){this.controller.tag=e}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}refresh(){this.controller.value.fetch()}onValueChange_(e){const t=this.controller.value;this.emitter_.emit("change",new oM(this,t.binding.target.read(),e.options.last))}}function cre(n,e){const i=Object.keys(e).reduce((s,r)=>{if(s===void 0)return;const o=e[r],l=o(n[r]);return l.succeeded?Object.assign(Object.assign({},s),{[r]:l.value}):void 0},{});return i}function dre(n,e){return n.reduce((t,i)=>{if(t===void 0)return;const s=e(i);if(!(!s.succeeded||s.value===void 0))return[...t,s.value]},[])}function pre(n){return n===null?!1:typeof n=="object"}function is(n){return e=>t=>{if(!e&&t===void 0)return{succeeded:!1,value:void 0};if(e&&t===void 0)return{succeeded:!0,value:void 0};const i=n(t);return i!==void 0?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}function ux(n){return{custom:e=>is(e)(n),boolean:is(e=>typeof e=="boolean"?e:void 0)(n),number:is(e=>typeof e=="number"?e:void 0)(n),string:is(e=>typeof e=="string"?e:void 0)(n),function:is(e=>typeof e=="function"?e:void 0)(n),constant:e=>is(t=>t===e?e:void 0)(n),raw:is(e=>e)(n),object:e=>is(t=>{if(pre(t))return cre(t,e)})(n),array:e=>is(t=>{if(Array.isArray(t))return dre(t,e)})(n)}}const _f={optional:ux(!0),required:ux(!1)};function Ct(n,e){const t=e(_f),i=_f.required.object(t)(n);return i.succeeded?i.value:void 0}function qi(n,e,t,i){if(e&&!e(n))return!1;const s=Ct(n,t);return s?i(s):!1}function Gi(n,e){var t;return Do((t=n?.())!==null&&t!==void 0?t:{},e)}function Nc(n){return"value"in n}function mre(n){if(!Wg(n)||!("binding"in n))return!1;const e=n.binding;return Vse(e)}const Yn="http://www.w3.org/2000/svg";function _d(n){n.offsetHeight}function vre(n,e){const t=n.style.transition;n.style.transition="none",e(),n.style.transition=t}function nC(n){return n.ontouchstart!==void 0}function fre(n){const e=n.ownerDocument.defaultView;return e&&"document"in e?n.getContext("2d",{willReadFrequently:!0}):null}const _re={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Tp(n,e){const t=n.createElementNS(Yn,"svg");return t.innerHTML=_re[e],t}function lM(n,e,t){n.insertBefore(e,n.children[t])}function iC(n){n.parentElement&&n.parentElement.removeChild(n)}function aM(n){for(;n.children.length>0;)n.removeChild(n.children[0])}function wre(n){for(;n.childNodes.length>0;)n.removeChild(n.childNodes[0])}function uM(n){return n.relatedTarget?n.relatedTarget:"explicitOriginalTarget"in n?n.explicitOriginalTarget:null}function Cs(n,e){n.emitter.on("change",t=>{e(t.rawValue)}),e(n.rawValue)}function Mi(n,e,t){Cs(n.value(e),t)}const bre="tp";function Q(n){return(t,i)=>[bre,"-",n,"v",t?`_${t}`:"",i?`-${i}`:""].join("")}const _u=Q("lbl");function gre(n,e){const t=n.createDocumentFragment();return e.split(`
`).map(s=>n.createTextNode(s)).forEach((s,r)=>{r>0&&t.appendChild(n.createElement("br")),t.appendChild(s)}),t}class Cre{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(_u()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(_u("l")),Mi(t.props,"label",r=>{Re(r)?this.element.classList.add(_u(void 0,"nol")):(this.element.classList.remove(_u(void 0,"nol")),wre(i),i.appendChild(gre(e,r)))}),this.element.appendChild(i),this.labelElement=i;const s=e.createElement("div");s.classList.add(_u("v")),this.element.appendChild(s),this.valueElement=s}}class Pre{constructor(e,t){this.props=t.props,this.valueController=t.valueController,this.viewProps=t.valueController.viewProps,this.view=new Cre(e,{props:t.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(e){return qi(e,null,t=>({label:t.optional.string}),t=>(this.props.set("label",t.label),!0))}exportProps(){return Gi(null,{label:this.props.get("label")})}}function yre(){return["veryfirst","first","last","verylast"]}const hx=Q(""),cx={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class hM{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",()=>{yre().forEach(i=>{t.classList.remove(hx(void 0,cx[i]))}),this.blade.get("positions").forEach(i=>{t.classList.add(hx(void 0,cx[i]))})}),this.viewProps.handleDispose(()=>{iC(t)})}get parent(){return this.parent_}set parent(e){this.parent_=e,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(e){return qi(e,null,t=>({disabled:t.required.boolean,hidden:t.required.boolean}),t=>(this.viewProps.importState(t),!0))}exportState(){return Gi(null,Object.assign({},this.viewProps.exportState()))}}class Ere extends eC{get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get title(){var e;return(e=this.controller.buttonController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.buttonController.props.set("title",e)}on(e,t){const i=t.bind(this);return this.controller.buttonController.emitter.on(e,()=>{i(new Mp(this))}),this}}function xre(n,e,t){t?n.classList.add(e):n.classList.remove(e)}function Ma(n,e){return t=>{xre(n,e,t)}}function sC(n,e){Cs(n,t=>{e.textContent=t??""})}const lv=Q("btn");class $re{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(lv()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("button");i.classList.add(lv("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(lv("t")),sC(t.props.value("title"),s),this.buttonElement.appendChild(s)}}class Vre{constructor(e,t){this.emitter=new Sn,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new $re(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(e){return qi(e,null,t=>({title:t.optional.string}),t=>(this.props.set("title",t.title),!0))}exportProps(){return Gi(null,{title:this.props.get("title")})}onClick_(){this.emitter.emit("click",{sender:this})}}class dx extends hM{constructor(e,t){const i=new Vre(e,{props:t.buttonProps,viewProps:t.viewProps}),s=new Pre(e,{blade:t.blade,props:t.labelProps,valueController:i});super({blade:t.blade,view:s.view,viewProps:t.viewProps}),this.buttonController=i,this.labelController=s}importState(e){return qi(e,t=>super.importState(t)&&this.buttonController.importProps(t)&&this.labelController.importProps(t),()=>({}),()=>!0)}exportState(){return Gi(()=>super.exportState(),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}}class kre{constructor(e){const[t,i]=e.split("-"),s=t.split(".");this.major=parseInt(s[0],10),this.minor=parseInt(s[1],10),this.patch=parseInt(s[2],10),this.prerelease=i??null}toString(){const e=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[e,this.prerelease].join("-"):e}}const Sre=new kre("2.0.1");function At(n){return Object.assign({core:Sre},n)}At({id:"button",type:"blade",accept(n){const e=Ct(n,t=>({title:t.required.string,view:t.required.constant("button"),label:t.optional.string}));return e?{params:e}:null},controller(n){return new dx(n.document,{blade:n.blade,buttonProps:Y.fromObject({title:n.params.title}),labelProps:Y.fromObject({label:n.params.label}),viewProps:n.viewProps})},api(n){return n.controller instanceof dx?new Ere(n.controller):null}});function Lre(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}function Are(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}function Mre(n,e){return n.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}function Tre(n){return Wg(n)?"refresh"in n&&typeof n.refresh=="function":!1}function Dre(n,e){if(!fd.isBindable(n))throw bn.notBindable();return new fd(n,e)}class Rre{constructor(e,t){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=e,this.emitter_=new Sn,this.pool_=t,this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map(e=>this.pool_.createApi(e))}addBinding(e,t,i){const s=i??{},r=this.controller_.element.ownerDocument,o=this.pool_.createBinding(r,Dre(e,t),s),l=this.pool_.createBindingApi(o);return this.add(l,s.index)}addFolder(e){return Are(this,e)}addButton(e){return Lre(this,e)}addTab(e){return Mre(this,e)}add(e,t){const i=e.controller;return this.controller_.rack.add(i,t),e}remove(e){this.controller_.rack.remove(e.controller)}addBlade(e){const t=this.controller_.element.ownerDocument,i=this.pool_.createBlade(t,e),s=this.pool_.createApi(i);return this.add(s,e.index)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}refresh(){this.children.forEach(e=>{Tre(e)&&e.refresh()})}onRackValueChange_(e){const t=e.bladeController,i=this.pool_.createApi(t),s=mre(t.value)?t.value.binding:null;this.emitter_.emit("change",new oM(i,s?s.target.read():t.value.rawValue,e.options.last))}}class rC extends eC{constructor(e,t){super(e),this.rackApi_=new Rre(e.rackController,t)}refresh(){this.rackApi_.refresh()}}class oC extends hM{constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps}),this.rackController=e.rackController}importState(e){return qi(e,t=>super.importState(t),t=>({children:t.required.array(t.required.raw)}),t=>this.rackController.rack.children.every((i,s)=>i.importState(t.children[s])))}exportState(){return Gi(()=>super.exportState(),{children:this.rackController.rack.children.map(e=>e.exportState())})}}function wf(n){return"rackController"in n}class Ore{constructor(e){this.emitter=new Sn,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const t of this.allItems())if(e(t))return t;return null}includes(e){return this.cache_.has(e)}add(e,t){if(this.includes(e))throw bn.shouldNeverHappen();const i=t!==void 0?t:this.items_.length;this.items_.splice(i,0,e),this.cache_.add(e);const s=this.extract_(e);s&&(s.emitter.on("add",this.onSubListAdd_),s.emitter.on("remove",this.onSubListRemove_),s.allItems().forEach(r=>{this.cache_.add(r)})),this.emitter.emit("add",{index:i,item:e,root:this,target:this})}remove(e){const t=this.items_.indexOf(e);if(t<0)return;this.items_.splice(t,1),this.cache_.delete(e);const i=this.extract_(e);i&&(i.allItems().forEach(s=>{this.cache_.delete(s)}),i.emitter.off("add",this.onSubListAdd_),i.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}}function jre(n,e){for(let t=0;t<n.length;t++){const i=n[t];if(Nc(i)&&i.value===e)return i}return null}function Nre(n){return wf(n)?n.rackController.rack.bcSet_:null}class Bre{constructor(e){var t,i;this.emitter=new Sn,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=(t=e.blade)!==null&&t!==void 0?t:null,(i=this.blade_)===null||i===void 0||i.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=e.viewProps,this.bcSet_=new Ore(Nre),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,t){var i;(i=e.parent)===null||i===void 0||i.remove(e),e.parent=this,this.bcSet_.add(e,t)}remove(e){e.parent=null,this.bcSet_.remove(e)}find(e){return this.bcSet_.allItems().filter(e)}onSetAdd_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,root:t,sender:this}),!t)return;const i=e.item;if(i.viewProps.emitter.on("change",this.onChildViewPropsChange_),i.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),i.viewProps.handleDispose(this.onChildDispose_),Nc(i))i.value.emitter.on("change",this.onChildValueChange_);else if(wf(i)){const s=i.rackController.rack;if(s){const r=s.emitter;r.on("layout",this.onRackLayout_),r.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,root:t,sender:this}),!t)return;const i=e.item;if(Nc(i))i.value.emitter.off("change",this.onChildValueChange_);else if(wf(i)){const s=i.rackController.rack;if(s){const r=s.emitter;r.off("layout",this.onRackLayout_),r.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){const e=this.bcSet_.items.filter(s=>!s.viewProps.get("hidden")),t=e[0],i=e[e.length-1];this.bcSet_.items.forEach(s=>{const r=[];s===t&&(r.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&r.push("veryfirst")),s===i&&(r.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&r.push("verylast")),s.blade.set("positions",r)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(t=>t.viewProps.get("disposed")).forEach(t=>{this.bcSet_.remove(t)})}onChildValueChange_(e){const t=jre(this.find(Nc),e.sender);if(!t)throw bn.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:t,options:e.options,sender:this})}onRackLayout_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(e){this.emitter.emit("valuechange",{bladeController:e.bladeController,options:e.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class lC{constructor(e){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=e.element,this.viewProps=e.viewProps;const t=new Bre({blade:e.root?void 0:e.blade,viewProps:e.viewProps});t.emitter.on("add",this.onRackAdd_),t.emitter.on("remove",this.onRackRemove_),this.rack=t,this.viewProps.handleDispose(()=>{for(let i=this.rack.children.length-1;i>=0;i--)this.rack.children[i].viewProps.set("disposed",!0)})}onRackAdd_(e){e.root&&lM(this.element,e.bladeController.view.element,e.index)}onRackRemove_(e){e.root&&iC(e.bladeController.view.element)}}function cM(){return new Y({positions:ht([],{equals:$se})})}class Hh extends Y{constructor(e){super(e)}static create(e){const t={completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},i=Y.createCore(t);return new Hh(i)}get styleExpanded(){var e;return(e=this.get("temporaryExpanded"))!==null&&e!==void 0?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!Re(e)?`${e}px`:"auto"}bindExpandedClass(e,t){const i=()=>{this.styleExpanded?e.classList.add(t):e.classList.remove(t)};Mi(this,"expanded",i),Mi(this,"temporaryExpanded",i)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function Ire(n,e){let t=0;return vre(e,()=>{n.set("expandedHeight",null),n.set("temporaryExpanded",!0),_d(e),t=e.clientHeight,n.set("temporaryExpanded",null),_d(e)}),t}function px(n,e){e.style.height=n.styleHeight}function aC(n,e){n.value("expanded").emitter.on("beforechange",()=>{if(n.set("completed",!1),Re(n.get("expandedHeight"))){const t=Ire(n,e);t>0&&n.set("expandedHeight",t)}n.set("shouldFixHeight",!0),_d(e)}),n.emitter.on("change",()=>{px(n,e)}),px(n,e),e.addEventListener("transitionend",t=>{t.propertyName==="height"&&n.cleanUpTransition()})}class Fre extends rC{constructor(e,t){super(e,t),this.emitter_=new Sn,this.controller.foldable.value("expanded").emitter.on("change",i=>{this.emitter_.emit("fold",new ure(this,i.sender.rawValue))}),this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)})}get expanded(){return this.controller.foldable.get("expanded")}set expanded(e){this.controller.foldable.set("expanded",e)}get title(){return this.controller.props.get("title")}set title(e){this.controller.props.set("title",e)}get children(){return this.rackApi_.children}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){return this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}}const dM=Q("cnt");class Kre{constructor(e,t){var i;this.className_=Q((i=t.viewName)!==null&&i!==void 0?i:"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),dM()),t.viewProps.bindClassModifiers(this.element),this.foldable_=t.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),Mi(this.foldable_,"completed",Ma(this.element,this.className_(void 0,"cpl")));const s=e.createElement("button");s.classList.add(this.className_("b")),Mi(t.props,"title",u=>{Re(u)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s;const r=e.createElement("div");r.classList.add(this.className_("i")),this.element.appendChild(r);const o=e.createElement("div");o.classList.add(this.className_("t")),sC(t.props.value("title"),o),this.buttonElement.appendChild(o),this.titleElement=o;const l=e.createElement("div");l.classList.add(this.className_("m")),this.buttonElement.appendChild(l);const a=e.createElement("div");a.classList.add(this.className_("c")),this.element.appendChild(a),this.containerElement=a}}class mx extends oC{constructor(e,t){var i;const s=Hh.create((i=t.expanded)!==null&&i!==void 0?i:!0),r=new Kre(e,{foldable:s,props:t.props,viewName:t.root?"rot":void 0,viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new lC({blade:t.blade,element:r.containerElement,root:t.root,viewProps:t.viewProps}),view:r})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=t.props,this.foldable=s,aC(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(e){return qi(e,t=>super.importState(t),t=>({expanded:t.required.boolean,title:t.optional.string}),t=>(this.foldable.set("expanded",t.expanded),this.props.set("title",t.title),!0))}exportState(){return Gi(()=>super.exportState(),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}At({id:"folder",type:"blade",accept(n){const e=Ct(n,t=>({title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean}));return e?{params:e}:null},controller(n){return new mx(n.document,{blade:n.blade,expanded:n.params.expanded,props:Y.fromObject({title:n.params.title}),viewProps:n.viewProps})},api(n){return n.controller instanceof mx?new Fre(n.controller,n.pool):null}});const Ure=Q("");function vx(n,e){return Ma(n,Ure(void 0,e))}class zh extends Y{constructor(e){var t;super(e),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=Mse(ht(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(e){var t,i,s;const r=e??{};return new zh(Y.createCore({disabled:(t=r.disabled)!==null&&t!==void 0?t:!1,disposed:!1,hidden:(i=r.hidden)!==null&&i!==void 0?i:!1,parent:(s=r.parent)!==null&&s!==void 0?s:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(e){Cs(this.globalDisabled_,vx(e,"disabled")),Mi(this,"hidden",vx(e,"hidden"))}bindDisabled(e){Cs(this.globalDisabled_,t=>{e.disabled=t})}bindTabIndex(e){Cs(this.globalDisabled_,t=>{e.tabIndex=t?-1:0})}handleDispose(e){this.value("disposed").emitter.on("change",t=>{t&&e()})}importState(e){this.set("disabled",e.disabled),this.set("hidden",e.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){const e=this.get("parent");return(e?e.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(e){var t;const i=e.previousRawValue;i?.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}const fx=Q("tbp");class Hre{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(fx()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(fx("c")),this.element.appendChild(i),this.containerElement=i}}const wu=Q("tbi");class zre{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(wu()),t.viewProps.bindClassModifiers(this.element),Mi(t.props,"selected",r=>{r?this.element.classList.add(wu(void 0,"sel")):this.element.classList.remove(wu(void 0,"sel"))});const i=e.createElement("button");i.classList.add(wu("b")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.buttonElement=i;const s=e.createElement("div");s.classList.add(wu("t")),sC(t.props.value("title"),s),this.buttonElement.appendChild(s),this.titleElement=s}}class qre{constructor(e,t){this.emitter=new Sn,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new zre(e,{props:t.props,viewProps:t.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class bf extends oC{constructor(e,t){const i=new Hre(e,{viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new lC({blade:t.blade,element:i.containerElement,viewProps:t.viewProps}),view:i})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new qre(e,{props:t.itemProps,viewProps:zh.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=t.props,Mi(this.props,"selected",s=>{this.itemController.props.set("selected",s),this.viewProps.set("hidden",!s)})}get itemController(){return this.ic_}importState(e){return qi(e,t=>super.importState(t),t=>({selected:t.required.boolean,title:t.required.string}),t=>(this.ic_.props.set("selected",t.selected),this.ic_.props.set("title",t.title),!0))}exportState(){return Gi(()=>super.exportState(),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}}class Gre extends rC{constructor(e,t){super(e,t),this.emitter_=new Sn,this.onSelect_=this.onSelect_.bind(this),this.pool_=t,this.rackApi_.on("change",i=>{this.emitter_.emit("change",i)}),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(e){const t=this.controller.view.element.ownerDocument,i=new bf(t,{blade:cM(),itemProps:Y.fromObject({selected:!1,title:e.title}),props:Y.fromObject({selected:!1}),viewProps:zh.create()}),s=this.pool_.createApi(i);return this.rackApi_.add(s,e.index)}removePage(e){this.rackApi_.remove(this.rackApi_.children[e])}on(e,t){const i=t.bind(this);return this.emitter_.on(e,s=>{i(s)}),this}onSelect_(e){this.emitter_.emit("select",new hre(this,e.rawValue))}}class Yre extends rC{get title(){var e;return(e=this.controller.itemController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.itemController.props.set("title",e)}get selected(){return this.controller.props.get("selected")}set selected(e){this.controller.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBinding(e,t,i){return this.rackApi_.addBinding(e,t,i)}addBlade(e){return this.rackApi_.addBlade(e)}}const _x=-1;class Xre{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=ht(!0),this.selectedIndex=ht(_x),this.items_=[]}add(e,t){const i=t??this.items_.length;this.items_.splice(i,0,e),e.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(e){const t=this.items_.indexOf(e);t<0||(this.items_.splice(t,1),e.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=_x,this.empty.rawValue=!0;return}const e=this.items_.findIndex(t=>t.rawValue);e<0?(this.items_.forEach((t,i)=>{t.rawValue=i===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((t,i)=>{t.rawValue=i===e}),this.selectedIndex.rawValue=e),this.empty.rawValue=!1}onItemSelectedChange_(e){if(e.rawValue){const t=this.items_.findIndex(i=>i===e.sender);this.items_.forEach((i,s)=>{i.rawValue=s===t}),this.selectedIndex.rawValue=t}else this.keepSelection_()}}const bu=Q("tab");class Wre{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(bu(),dM()),t.viewProps.bindClassModifiers(this.element),Cs(t.empty,Ma(this.element,bu(void 0,"nop")));const i=e.createElement("div");i.classList.add(bu("t")),this.element.appendChild(i),this.itemsElement=i;const s=e.createElement("div");s.classList.add(bu("i")),this.element.appendChild(s);const r=e.createElement("div");r.classList.add(bu("c")),this.element.appendChild(r),this.contentsElement=r}}class wx extends oC{constructor(e,t){const i=new Xre,s=new Wre(e,{empty:i.empty,viewProps:t.viewProps});super({blade:t.blade,rackController:new lC({blade:t.blade,element:s.contentsElement,viewProps:t.viewProps}),view:s}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const r=this.rackController.rack;r.emitter.on("add",this.onRackAdd_),r.emitter.on("remove",this.onRackRemove_),this.tab=i}add(e,t){this.rackController.rack.add(e,t)}remove(e){this.rackController.rack.remove(this.rackController.rack.children[e])}onRackAdd_(e){if(!e.root)return;const t=e.bladeController;lM(this.view.itemsElement,t.itemController.view.element,e.index),t.itemController.viewProps.set("parent",this.viewProps),this.tab.add(t.props.value("selected"))}onRackRemove_(e){if(!e.root)return;const t=e.bladeController;iC(t.itemController.view.element),t.itemController.viewProps.set("parent",null),this.tab.remove(t.props.value("selected"))}}At({id:"tab",type:"blade",accept(n){const e=Ct(n,t=>({pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")}));return!e||e.pages.length===0?null:{params:e}},controller(n){const e=new wx(n.document,{blade:n.blade,viewProps:n.viewProps});return n.params.pages.forEach(t=>{const i=new bf(n.document,{blade:cM(),itemProps:Y.fromObject({selected:!1,title:t.title}),props:Y.fromObject({selected:!1}),viewProps:zh.create()});e.add(i)}),e},api(n){return n.controller instanceof wx?new Gre(n.controller,n.pool):n.controller instanceof bf?new Yre(n.controller,n.pool):null}});class uC extends tC{get options(){return this.controller.valueController.props.get("options")}set options(e){this.controller.valueController.props.set("options",e)}}class qh{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce((t,i)=>i.constrain(t),e)}}function wd(n,e){if(n instanceof e)return n;if(n instanceof qh){const t=n.constraints.reduce((i,s)=>i||(s instanceof e?s:null),null);if(t)return t}return null}class Dp{constructor(e){this.values=Y.fromObject({options:e})}constrain(e){const t=this.values.get("options");return t.length===0||t.filter(s=>s.value===e).length>0?e:t[0].value}}function Rp(n){var e;const t=_f;if(Array.isArray(n))return(e=Ct({items:n},i=>({items:i.required.array(i.required.object({text:i.required.string,value:i.required.raw}))})))===null||e===void 0?void 0:e.items;if(typeof n=="object")return t.required.raw(n).value}function pM(n){if(Array.isArray(n))return n;const e=[];return Object.keys(n).forEach(t=>{e.push({text:t,value:n[t]})}),e}function hC(n){return Re(n)?null:new Dp(pM(n))}const av=Q("lst");class Zre{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add(av()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("select");i.classList.add(av("s")),t.viewProps.bindDisabled(i),this.element.appendChild(i),this.selectElement=i;const s=e.createElement("div");s.classList.add(av("m")),s.appendChild(Tp(e,"dropdown")),this.element.appendChild(s),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,Mi(this.props_,"options",r=>{aM(this.selectElement),r.forEach(o=>{const l=e.createElement("option");l.textContent=o.text,this.selectElement.appendChild(l)}),this.update_()})}update_(){const e=this.props_.get("options").map(t=>t.value);this.selectElement.selectedIndex=e.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}}class aa{constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new Zre(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const t=e.currentTarget;this.value.rawValue=this.props.get("options")[t.selectedIndex].value}importProps(e){return qi(e,null,t=>({options:t.required.custom(Rp)}),t=>(this.props.set("options",pM(t.options)),!0))}exportProps(){return Gi(null,{options:this.props.get("options")})}}const bx=Q("pop");class Qre{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(bx()),t.viewProps.bindClassModifiers(this.element),Cs(t.shows,Ma(this.element,bx(void 0,"v")))}}class mM{constructor(e,t){this.shows=ht(!1),this.viewProps=t.viewProps,this.view=new Qre(e,{shows:this.shows,viewProps:this.viewProps})}}const gx=Q("txt");class Jre{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(gx()),t.viewProps.bindClassModifiers(this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);const i=e.createElement("input");i.classList.add(gx("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}}class cC{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new Jre(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const i=e.currentTarget.value,s=this.parser_(i);Re(s)||(this.value.rawValue=s),this.view.refresh()}}function eoe(n){return String(n)}function vM(n){return n==="false"?!1:!!n}function Cx(n){return eoe(n)}function toe(n){return e=>n.reduce((t,i)=>t!==null?t:i(e),null)}const noe=pn(0);function bd(n){return noe(n)+"%"}function fM(n){return String(n)}function gf(n){return n}function Ta({primary:n,secondary:e,forward:t,backward:i}){let s=!1;function r(o){s||(s=!0,o(),s=!1)}n.emitter.on("change",o=>{r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),e.emitter.on("change",o=>{r(()=>{n.setRawValue(i(n.rawValue,e.rawValue),o.options)}),r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),o.options)})}),r(()=>{e.setRawValue(t(n.rawValue,e.rawValue),{forceEmit:!1,last:!0})})}function sn(n,e){const t=n*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+t:e.downKey?-t:0}function oh(n){return{altKey:n.altKey,downKey:n.key==="ArrowDown",shiftKey:n.shiftKey,upKey:n.key==="ArrowUp"}}function Ms(n){return{altKey:n.altKey,downKey:n.key==="ArrowLeft",shiftKey:n.shiftKey,upKey:n.key==="ArrowRight"}}function ioe(n){return n==="ArrowUp"||n==="ArrowDown"}function _M(n){return ioe(n)||n==="ArrowLeft"||n==="ArrowRight"}function uv(n,e){var t,i;const s=e.ownerDocument.defaultView,r=e.getBoundingClientRect();return{x:n.pageX-(((t=s&&s.scrollX)!==null&&t!==void 0?t:0)+r.left),y:n.pageY-(((i=s&&s.scrollY)!==null&&i!==void 0?i:0)+r.top)}}class Yo{constructor(e){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new Sn,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault(),(t=e.currentTarget)===null||t===void 0||t.focus();const i=this.elem_.ownerDocument;i.addEventListener("mousemove",this.onDocumentMouseMove_),i.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(uv(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(uv(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(uv(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchMove_(e){const t=e.targetTouches.item(0),i=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-i.left,y:t.clientY-i.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchEnd_(e){var t;const i=(t=e.targetTouches.item(0))!==null&&t!==void 0?t:this.lastTouch_,s=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(i?{x:i.clientX-s.left,y:i.clientY-s.top}:void 0),sender:this,shiftKey:e.shiftKey})}}const Bn=Q("txt");class soe{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(Bn(),Bn(void 0,"num")),t.arrayPosition&&this.element.classList.add(Bn(void 0,t.arrayPosition)),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(Bn("i")),i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Bn()),this.inputElement.classList.add(Bn("i"));const s=e.createElement("div");s.classList.add(Bn("k")),this.element.appendChild(s),this.knobElement=s;const r=e.createElementNS(Yn,"svg");r.classList.add(Bn("g")),this.knobElement.appendChild(r);const o=e.createElementNS(Yn,"path");o.classList.add(Bn("gb")),r.appendChild(o),this.guideBodyElem_=o;const l=e.createElementNS(Yn,"path");l.classList.add(Bn("gh")),r.appendChild(l),this.guideHeadElem_=l;const a=e.createElement("div");a.classList.add(Q("tt")()),this.knobElement.appendChild(a),this.tooltipElem_=a,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.refresh()}onDraggingChange_(e){if(e.rawValue===null){this.element.classList.remove(Bn(void 0,"drg"));return}this.element.classList.add(Bn(void 0,"drg"));const t=e.rawValue/this.props_.get("pointerScale"),i=t+(t>0?-1:t<0?1:0),s=Xe(-i,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${i+s},0 L${i},4 L${i+s},8`,`M ${t},-1 L${t},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${t},4`);const r=this.props_.get("formatter");this.tooltipElem_.textContent=r(this.value.rawValue),this.tooltipElem_.style.left=`${t}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}}class Gh{constructor(e,t){var i;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=t.parser,this.props=t.props,this.sliderProps_=(i=t.sliderProps)!==null&&i!==void 0?i:null,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=ht(null),this.view=new soe(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const s=new Yo(this.view.knobElement);s.emitter.on("down",this.onPointerDown_),s.emitter.on("move",this.onPointerMove_),s.emitter.on("up",this.onPointerUp_)}constrainValue_(e){var t,i;const s=(t=this.sliderProps_)===null||t===void 0?void 0:t.get("min"),r=(i=this.sliderProps_)===null||i===void 0?void 0:i.get("max");let o=e;return s!==void 0&&(o=Math.max(o,s)),r!==void 0&&(o=Math.min(o,r)),o}onInputChange_(e){const i=e.currentTarget.value,s=this.parser_(i);Re(s)||(this.value.rawValue=this.constrainValue_(s)),this.view.refresh()}onInputKeyDown_(e){const t=sn(this.props.get("keyScale"),oh(e));t!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+t),{forceEmit:!1,last:!1})}onInputKeyUp_(e){sn(this.props.get("keyScale"),oh(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;const t=e.point.x-e.bounds.width/2;return this.constrainValue_(this.originRawValue_+t*this.props.get("pointerScale"))}onPointerMove_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const hv=Q("sld");class roe{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(hv()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(hv("t")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.trackElement=i;const s=e.createElement("div");s.classList.add(hv("k")),this.trackElement.appendChild(s),this.knobElement=s,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}update_(){const e=Xe(q(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${e}%`}onChange_(){this.update_()}}class ooe{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.props=t.props,this.view=new roe(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Yo(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){e.point&&this.value.setRawValue(q(Xe(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("min"),this.props.get("max")),t)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=sn(this.props.get("keyScale"),Ms(e));t!==0&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onKeyUp_(e){sn(this.props.get("keyScale"),Ms(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const cv=Q("sldtxt");class loe{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(cv());const i=e.createElement("div");i.classList.add(cv("s")),this.sliderView_=t.sliderView,i.appendChild(this.sliderView_.element),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(cv("t")),this.textView_=t.textView,s.appendChild(this.textView_.element),this.element.appendChild(s)}}class Px{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sliderC_=new ooe(e,{props:t.sliderProps,value:t.value,viewProps:this.viewProps}),this.textC_=new Gh(e,{parser:t.parser,props:t.textProps,sliderProps:t.sliderProps,value:t.value,viewProps:t.viewProps}),this.view=new loe(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(e){return qi(e,null,t=>({max:t.required.number,min:t.required.number}),t=>{const i=this.sliderC_.props;return i.set("max",t.max),i.set("min",t.min),!0})}exportProps(){const e=this.sliderC_.props;return Gi(null,{max:e.get("max"),min:e.get("min")})}}function aoe(n){return{sliderProps:new Y({keyScale:n.keyScale,max:n.max,min:n.min}),textProps:new Y({formatter:ht(n.formatter),keyScale:n.keyScale,pointerScale:ht(n.pointerScale)})}}const uoe={containerUnitSize:"cnt-usz"};function wM(n){return`--${uoe[n]}`}function lh(n){return rM(n)}function wr(n){if(ff(n))return Ct(n,lh)}function ds(n,e){if(!n)return;const t=[],i=nM(n,e);i&&t.push(i);const s=iM(n);return s&&t.push(s),new qh(t)}function bM(n){if(n==="inline"||n==="popup")return n}function Yh(n,e){n.write(e)}const pc=Q("ckb");class hoe{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(pc()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("label");i.classList.add(pc("l")),this.element.appendChild(i);const s=e.createElement("input");s.classList.add(pc("i")),s.type="checkbox",i.appendChild(s),this.inputElement=s,t.viewProps.bindDisabled(this.inputElement);const r=e.createElement("div");r.classList.add(pc("w")),i.appendChild(r);const o=Tp(e,"check");r.appendChild(o),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class coe{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new hoe(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const t=e.currentTarget;this.value.rawValue=t.checked}}function doe(n){const e=[],t=hC(n.options);return t&&e.push(t),new qh(e)}At({id:"input-bool",type:"input",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=Ct(e,i=>({options:i.optional.custom(Rp),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>vM,constraint:n=>doe(n.params),writer:n=>Yh},controller:n=>{const e=n.document,t=n.value,i=n.constraint,s=i&&wd(i,Dp);return s?new aa(e,{props:new Y({options:s.values.value("options")}),value:t,viewProps:n.viewProps}):new coe(e,{value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="boolean"?null:n.controller.valueController instanceof aa?new uC(n.controller):null}});const no=Q("col");class poe{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(no()),t.foldable.bindExpandedClass(this.element,no(void 0,"expanded")),Mi(t.foldable,"completed",Ma(this.element,no(void 0,"cpl")));const i=e.createElement("div");i.classList.add(no("h")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(no("s")),i.appendChild(s),this.swatchElement=s;const r=e.createElement("div");if(r.classList.add(no("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(no("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}}function moe(n,e,t){const i=Xe(n/255,0,1),s=Xe(e/255,0,1),r=Xe(t/255,0,1),o=Math.max(i,s,r),l=Math.min(i,s,r),a=o-l;let u=0,h=0;const c=(l+o)/2;return a!==0&&(h=a/(1-Math.abs(o+l-1)),i===o?u=(s-r)/a:s===o?u=2+(r-i)/a:u=4+(i-s)/a,u=u/6+(u<0?1:0)),[u*360,h*100,c*100]}function voe(n,e,t){const i=(n%360+360)%360,s=Xe(e/100,0,1),r=Xe(t/100,0,1),o=(1-Math.abs(2*r-1))*s,l=o*(1-Math.abs(i/60%2-1)),a=r-o/2;let u,h,c;return i>=0&&i<60?[u,h,c]=[o,l,0]:i>=60&&i<120?[u,h,c]=[l,o,0]:i>=120&&i<180?[u,h,c]=[0,o,l]:i>=180&&i<240?[u,h,c]=[0,l,o]:i>=240&&i<300?[u,h,c]=[l,0,o]:[u,h,c]=[o,0,l],[(u+a)*255,(h+a)*255,(c+a)*255]}function foe(n,e,t){const i=Xe(n/255,0,1),s=Xe(e/255,0,1),r=Xe(t/255,0,1),o=Math.max(i,s,r),l=Math.min(i,s,r),a=o-l;let u;a===0?u=0:o===i?u=60*(((s-r)/a%6+6)%6):o===s?u=60*((r-i)/a+2):u=60*((i-s)/a+4);const h=o===0?0:a/o,c=o;return[u,h*100,c*100]}function gM(n,e,t){const i=eM(n,360),s=Xe(e/100,0,1),r=Xe(t/100,0,1),o=r*s,l=o*(1-Math.abs(i/60%2-1)),a=r-o;let u,h,c;return i>=0&&i<60?[u,h,c]=[o,l,0]:i>=60&&i<120?[u,h,c]=[l,o,0]:i>=120&&i<180?[u,h,c]=[0,o,l]:i>=180&&i<240?[u,h,c]=[0,l,o]:i>=240&&i<300?[u,h,c]=[l,0,o]:[u,h,c]=[o,0,l],[(u+a)*255,(h+a)*255,(c+a)*255]}function _oe(n,e,t){const i=t+e*(100-Math.abs(2*t-100))/200;return[n,i!==0?e*(100-Math.abs(2*t-100))/i:0,t+e*(100-Math.abs(2*t-100))/(2*100)]}function woe(n,e,t){const i=100-Math.abs(t*(200-e)/100-100);return[n,i!==0?e*t/i:0,t*(200-e)/(2*100)]}function Ti(n){return[n[0],n[1],n[2]]}function Op(n,e){return[n[0],n[1],n[2],e]}const boe={hsl:{hsl:(n,e,t)=>[n,e,t],hsv:_oe,rgb:voe},hsv:{hsl:woe,hsv:(n,e,t)=>[n,e,t],rgb:gM},rgb:{hsl:moe,hsv:foe,rgb:(n,e,t)=>[n,e,t]}};function ua(n,e){return[e==="float"?1:n==="rgb"?255:360,e==="float"?1:n==="rgb"?255:100,e==="float"?1:n==="rgb"?255:100]}function goe(n,e){return n===e?e:eM(n,e)}function CM(n,e,t){var i;const s=ua(e,t);return[e==="rgb"?Xe(n[0],0,s[0]):goe(n[0],s[0]),Xe(n[1],0,s[1]),Xe(n[2],0,s[2]),Xe((i=n[3])!==null&&i!==void 0?i:1,0,1)]}function yx(n,e,t,i){const s=ua(e,t),r=ua(e,i);return n.map((o,l)=>o/s[l]*r[l])}function PM(n,e,t){const i=yx(n,e.mode,e.type,"int"),s=boe[e.mode][t.mode](...i);return yx(s,t.mode,"int",t.type)}class G{static black(){return new G([0,0,0],"rgb")}constructor(e,t){this.type="int",this.mode=t,this.comps_=CM(e,t,this.type)}getComponents(e){return Op(PM(Ti(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}}const ar=Q("colp");class Coe{constructor(e,t){this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(ar()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(ar("hsv"));const s=e.createElement("div");s.classList.add(ar("sv")),this.svPaletteView_=t.svPaletteView,s.appendChild(this.svPaletteView_.element),i.appendChild(s);const r=e.createElement("div");r.classList.add(ar("h")),this.hPaletteView_=t.hPaletteView,r.appendChild(this.hPaletteView_.element),i.appendChild(r),this.element.appendChild(i);const o=e.createElement("div");if(o.classList.add(ar("rgb")),this.textsView_=t.textsView,o.appendChild(this.textsView_.element),this.element.appendChild(o),t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};const l=e.createElement("div");l.classList.add(ar("a"));const a=e.createElement("div");a.classList.add(ar("ap")),a.appendChild(this.alphaViews_.palette.element),l.appendChild(a);const u=e.createElement("div");u.classList.add(ar("at")),u.appendChild(this.alphaViews_.text.element),l.appendChild(u),this.element.appendChild(l)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map(t=>t.inputElement)];return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}}function Poe(n){return n==="int"?"int":n==="float"?"float":void 0}function dC(n){return Ct(n,e=>({color:e.optional.object({alpha:e.optional.boolean,type:e.optional.custom(Poe)}),expanded:e.optional.boolean,picker:e.optional.custom(bM),readonly:e.optional.constant(!1)}))}function Ro(n){return n?.1:1}function yM(n){var e;return(e=n.color)===null||e===void 0?void 0:e.type}class pC{constructor(e,t){this.type="float",this.mode=t,this.comps_=CM(e,t,this.type)}getComponents(e){return Op(PM(Ti(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}}const yoe={int:(n,e)=>new G(n,e),float:(n,e)=>new pC(n,e)};function mC(n,e,t){return yoe[t](n,e)}function Eoe(n){return n.type==="float"}function xoe(n){return n.type==="int"}function $oe(n){const e=n.getComponents(),t=ua(n.mode,"int");return new G([Math.round(q(e[0],0,1,0,t[0])),Math.round(q(e[1],0,1,0,t[1])),Math.round(q(e[2],0,1,0,t[2])),e[3]],n.mode)}function Voe(n){const e=n.getComponents(),t=ua(n.mode,"int");return new pC([q(e[0],0,t[0],0,1),q(e[1],0,t[1],0,1),q(e[2],0,t[2],0,1),e[3]],n.mode)}function Ut(n,e){if(n.type===e)return n;if(xoe(n)&&e==="float")return Voe(n);if(Eoe(n)&&e==="int")return $oe(n);throw bn.shouldNeverHappen()}function koe(n,e){return n.alpha===e.alpha&&n.mode===e.mode&&n.notation===e.notation&&n.type===e.type}function Xn(n,e){const t=n.match(/^(.+)%$/);return Math.min(t?parseFloat(t[1])*.01*e:parseFloat(n),e)}const Soe={deg:n=>n,grad:n=>n*360/400,rad:n=>n*360/(2*Math.PI),turn:n=>n*360};function EM(n){const e=n.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(n);const t=parseFloat(e[1]),i=e[2];return Soe[i](t)}function xM(n){const e=n.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Xn(e[1],255),Xn(e[2],255),Xn(e[3],255)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function Loe(n){const e=xM(n);return e?new G(e,"rgb"):null}function $M(n){const e=n.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Xn(e[1],255),Xn(e[2],255),Xn(e[3],255),Xn(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function Aoe(n){const e=$M(n);return e?new G(e,"rgb"):null}function VM(n){const e=n.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[EM(e[1]),Xn(e[2],100),Xn(e[3],100)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function Moe(n){const e=VM(n);return e?new G(e,"hsl"):null}function kM(n){const e=n.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[EM(e[1]),Xn(e[2],100),Xn(e[3],100),Xn(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function Toe(n){const e=kM(n);return e?new G(e,"hsl"):null}function SM(n){const e=n.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];const t=n.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}function Doe(n){const e=SM(n);return e?new G(e,"rgb"):null}function LM(n){const e=n.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),q(parseInt(e[4]+e[4],16),0,255,0,1)];const t=n.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),q(parseInt(t[4],16),0,255,0,1)]:null}function Roe(n){const e=LM(n);return e?new G(e,"rgb"):null}function AM(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function Ex(n){return e=>{const t=AM(e);return t?mC(t,"rgb",n):null}}function MM(n){const e=n.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function xx(n){return e=>{const t=MM(e);return t?mC(t,"rgb",n):null}}const Ooe=[{parser:SM,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:LM,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:xM,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:$M,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:VM,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:kM,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:AM,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:MM,result:{alpha:!0,mode:"rgb",notation:"object"}}];function joe(n){return Ooe.reduce((e,{parser:t,result:i})=>e||(t(n)?i:null),null)}function Noe(n,e="int"){const t=joe(n);return t?t.notation==="hex"&&e!=="float"?Object.assign(Object.assign({},t),{type:"int"}):t.notation==="func"?Object.assign(Object.assign({},t),{type:e}):null:null}function Xh(n){const e=[Doe,Roe,Loe,Aoe,Moe,Toe];n==="int"&&e.push(Ex("int"),xx("int")),n==="float"&&e.push(Ex("float"),xx("float"));const t=toe(e);return i=>{const s=t(i);return s?Ut(s,n):null}}function Boe(n){const e=Xh("int");if(typeof n!="string")return G.black();const t=e(n);return t??G.black()}function TM(n){const e=Xe(Math.floor(n),0,255).toString(16);return e.length===1?`0${e}`:e}function vC(n,e="#"){const t=Ti(n.getComponents("rgb")).map(TM).join("");return`${e}${t}`}function fC(n,e="#"){const t=n.getComponents("rgb"),i=[t[0],t[1],t[2],t[3]*255].map(TM).join("");return`${e}${i}`}function DM(n){const e=pn(0),t=Ut(n,"int");return`rgb(${Ti(t.getComponents("rgb")).map(s=>e(s)).join(", ")})`}function Bc(n){const e=pn(2),t=pn(0);return`rgba(${Ut(n,"int").getComponents("rgb").map((r,o)=>(o===3?e:t)(r)).join(", ")})`}function Ioe(n){const e=[pn(0),bd,bd],t=Ut(n,"int");return`hsl(${Ti(t.getComponents("hsl")).map((s,r)=>e[r](s)).join(", ")})`}function Foe(n){const e=[pn(0),bd,bd,pn(2)];return`hsla(${Ut(n,"int").getComponents("hsl").map((s,r)=>e[r](s)).join(", ")})`}function RM(n,e){const t=pn(e==="float"?2:0),i=["r","g","b"],s=Ut(n,e);return`{${Ti(s.getComponents("rgb")).map((o,l)=>`${i[l]}: ${t(o)}`).join(", ")}}`}function Koe(n){return e=>RM(e,n)}function OM(n,e){const t=pn(2),i=pn(e==="float"?2:0),s=["r","g","b","a"];return`{${Ut(n,e).getComponents("rgb").map((l,a)=>{const u=a===3?t:i;return`${s[a]}: ${u(l)}`}).join(", ")}}`}function Uoe(n){return e=>OM(e,n)}const Hoe=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:vC},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:fC},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:DM},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:Bc},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:Ioe},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:Foe},...["int","float"].reduce((n,e)=>[...n,{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:Koe(e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:Uoe(e)}],[])];function jM(n){return Hoe.reduce((e,t)=>e||(koe(t.format,n)?t.stringifier:null),null)}const gu=Q("apl");class zoe{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(gu()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(gu("b")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(gu("c")),i.appendChild(s),this.colorElem_=s;const r=e.createElement("div");r.classList.add(gu("m")),this.element.appendChild(r),this.markerElem_=r;const o=e.createElement("div");o.classList.add(gu("p")),this.markerElem_.appendChild(o),this.previewElem_=o,this.update_()}update_(){const e=this.value.rawValue,t=e.getComponents("rgb"),i=new G([t[0],t[1],t[2],0],"rgb"),s=new G([t[0],t[1],t[2],255],"rgb"),r=["to right",Bc(i),Bc(s)];this.colorElem_.style.background=`linear-gradient(${r.join(",")})`,this.previewElem_.style.backgroundColor=Bc(e);const o=q(t[3],0,1,0,100);this.markerElem_.style.left=`${o}%`}onValueChange_(){this.update_()}}class qoe{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new zoe(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Yo(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=e.point.x/e.bounds.width,s=this.value.rawValue,[r,o,l]=s.getComponents("hsv");this.value.setRawValue(new G([r,o,l,i],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=sn(Ro(!0),Ms(e));if(t===0)return;const i=this.value.rawValue,[s,r,o,l]=i.getComponents("hsv");this.value.setRawValue(new G([s,r,o,l+t],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){sn(Ro(!0),Ms(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const _l=Q("coltxt");function Goe(n){const e=n.createElement("select"),t=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}];return e.appendChild(t.reduce((i,s)=>{const r=n.createElement("option");return r.textContent=s.text,r.value=s.value,i.appendChild(r),i},n.createDocumentFragment())),e}class Yoe{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(_l()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(_l("m")),this.modeElem_=Goe(e),this.modeElem_.classList.add(_l("ms")),i.appendChild(this.modeSelectElement),t.viewProps.bindDisabled(this.modeElem_);const s=e.createElement("div");s.classList.add(_l("mm")),s.appendChild(Tp(e,"dropdown")),i.appendChild(s),this.element.appendChild(i);const r=e.createElement("div");r.classList.add(_l("w")),this.element.appendChild(r),this.inputsElem_=r,this.inputViews_=t.inputViews,this.applyInputViews_(),Cs(t.mode,o=>{this.modeElem_.value=o})}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(e){this.inputViews_=e,this.applyInputViews_()}applyInputViews_(){aM(this.inputsElem_);const e=this.element.ownerDocument;this.inputViews_.forEach(t=>{const i=e.createElement("div");i.classList.add(_l("c")),i.appendChild(t.element),this.inputsElem_.appendChild(i)})}}function Xoe(n){return pn(n==="float"?2:0)}function Woe(n,e,t){const i=ua(n,e)[t];return new Ap({min:0,max:i})}function Zoe(n,e,t){return new Gh(n,{arrayPosition:t===0?"fst":t===2?"lst":"mid",parser:e.parser,props:Y.fromObject({formatter:Xoe(e.colorType),keyScale:Ro(!1),pointerScale:e.colorType==="float"?.01:1}),value:ht(0,{constraint:Woe(e.colorMode,e.colorType,t)}),viewProps:e.viewProps})}function Qoe(n,e){const t={colorMode:e.colorMode,colorType:e.colorType,parser:jr,viewProps:e.viewProps};return[0,1,2].map(i=>{const s=Zoe(n,t,i);return Ta({primary:e.value,secondary:s.value,forward(r){return Ut(r,e.colorType).getComponents(e.colorMode)[i]},backward(r,o){const l=e.colorMode,u=Ut(r,e.colorType).getComponents(l);u[i]=o;const h=mC(Op(Ti(u),u[3]),l,e.colorType);return Ut(h,"int")}}),s})}function Joe(n,e){const t=new cC(n,{parser:Xh("int"),props:Y.fromObject({formatter:vC}),value:ht(G.black()),viewProps:e.viewProps});return Ta({primary:e.value,secondary:t.value,forward:i=>new G(Ti(i.getComponents()),i.mode),backward:(i,s)=>new G(Op(Ti(s.getComponents(i.mode)),i.getComponents()[3]),i.mode)}),[t]}function ele(n){return n!=="hex"}class tle{constructor(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=t.colorType,this.value=t.value,this.viewProps=t.viewProps,this.colorMode=ht(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new Yoe(e,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const t=this.colorMode.rawValue;return ele(t)?Qoe(e,{colorMode:t,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):Joe(e,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(e){const t=e.currentTarget;this.colorMode.rawValue=t.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map(i=>i.view)}}const dv=Q("hpl");class nle{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(dv()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("div");i.classList.add(dv("c")),this.element.appendChild(i);const s=e.createElement("div");s.classList.add(dv("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=this.value.rawValue,[t]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=DM(new G([t,100,100],"hsv"));const i=q(t,0,360,0,100);this.markerElem_.style.left=`${i}%`}onValueChange_(){this.update_()}}class ile{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new nle(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Yo(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=q(Xe(e.point.x,0,e.bounds.width),0,e.bounds.width,0,360),s=this.value.rawValue,[,r,o,l]=s.getComponents("hsv");this.value.setRawValue(new G([i,r,o,l],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=sn(Ro(!1),Ms(e));if(t===0)return;const i=this.value.rawValue,[s,r,o,l]=i.getComponents("hsv");this.value.setRawValue(new G([s+t,r,o,l],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){sn(Ro(!1),Ms(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const pv=Q("svp"),$x=64;class sle{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(pv()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const i=e.createElement("canvas");i.height=$x,i.width=$x,i.classList.add(pv("c")),this.element.appendChild(i),this.canvasElement=i;const s=e.createElement("div");s.classList.add(pv("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=fre(this.canvasElement);if(!e)return;const i=this.value.rawValue.getComponents("hsv"),s=this.canvasElement.width,r=this.canvasElement.height,o=e.getImageData(0,0,s,r),l=o.data;for(let h=0;h<r;h++)for(let c=0;c<s;c++){const p=q(c,0,s,0,100),d=q(h,0,r,100,0),m=gM(i[0],p,d),f=(h*s+c)*4;l[f]=m[0],l[f+1]=m[1],l[f+2]=m[2],l[f+3]=255}e.putImageData(o,0,0);const a=q(i[1],0,100,0,100);this.markerElem_.style.left=`${a}%`;const u=q(i[2],0,100,100,0);this.markerElem_.style.top=`${u}%`}onValueChange_(){this.update_()}}class rle{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new sle(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Yo(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=q(e.point.x,0,e.bounds.width,0,100),s=q(e.point.y,0,e.bounds.height,100,0),[r,,,o]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new G([r,i,s,o],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){_M(e.key)&&e.preventDefault();const[t,i,s,r]=this.value.rawValue.getComponents("hsv"),o=Ro(!1),l=sn(o,Ms(e)),a=sn(o,oh(e));l===0&&a===0||this.value.setRawValue(new G([t,i+l,s+a,r],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){const t=Ro(!1),i=sn(t,Ms(e)),s=sn(t,oh(e));i===0&&s===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class ole{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.hPaletteC_=new ile(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new rle(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=t.supportsAlpha?{palette:new qoe(e,{value:this.value,viewProps:this.viewProps}),text:new Gh(e,{parser:jr,props:Y.fromObject({pointerScale:.01,keyScale:.1,formatter:pn(2)}),value:ht(0,{constraint:new Ap({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Ta({primary:this.value,secondary:this.alphaIcs_.text.value,forward:i=>i.getComponents()[3],backward:(i,s)=>{const r=i.getComponents();return r[3]=s,new G(r,i.mode)}}),this.textsC_=new tle(e,{colorType:t.colorType,value:this.value,viewProps:this.viewProps}),this.view=new Coe(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}}const mv=Q("colsw");class lle{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(mv()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(mv("sw")),this.element.appendChild(i),this.swatchElem_=i;const s=e.createElement("button");s.classList.add(mv("b")),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s,this.update_()}update_(){const e=this.value.rawValue;this.swatchElem_.style.backgroundColor=fC(e)}onValueChange_(){this.update_()}}class ale{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new lle(e,{value:this.value,viewProps:this.viewProps})}}class _C{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=Hh.create(t.expanded),this.swatchC_=new ale(e,{value:this.value,viewProps:this.viewProps});const i=this.swatchC_.view.buttonElement;i.addEventListener("blur",this.onButtonBlur_),i.addEventListener("click",this.onButtonClick_),this.textC_=new cC(e,{parser:t.parser,props:Y.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new poe(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=t.pickerLayout==="popup"?new mM(e,{viewProps:this.viewProps}):null;const s=new ole(e,{colorType:t.colorType,supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});s.view.allFocusableElements.forEach(r=>{r.addEventListener("blur",this.onPopupChildBlur_),r.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=s,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(s.view.element),Ta({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:r=>r,backward:(r,o)=>o})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),aC(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=uM(e);i&&t.contains(i)||i&&i===this.swatchC_.view.buttonElement&&!nC(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function ule(n){return Ti(n.getComponents("rgb")).reduce((e,t)=>e<<8|Math.floor(t)&255,0)}function hle(n){return n.getComponents("rgb").reduce((e,t,i)=>{const s=Math.floor(i===3?t*255:t)&255;return e<<8|s},0)>>>0}function cle(n){return new G([n>>16&255,n>>8&255,n&255],"rgb")}function dle(n){return new G([n>>24&255,n>>16&255,n>>8&255,q(n&255,0,255,0,1)],"rgb")}function ple(n){return typeof n!="number"?G.black():cle(n)}function mle(n){return typeof n!="number"?G.black():dle(n)}function Ic(n,e){return typeof n!="object"||Re(n)?!1:e in n&&typeof n[e]=="number"}function NM(n){return Ic(n,"r")&&Ic(n,"g")&&Ic(n,"b")}function BM(n){return NM(n)&&Ic(n,"a")}function IM(n){return NM(n)}function wC(n,e){if(n.mode!==e.mode||n.type!==e.type)return!1;const t=n.getComponents(),i=e.getComponents();for(let s=0;s<t.length;s++)if(t[s]!==i[s])return!1;return!0}function Vx(n){return"a"in n?[n.r,n.g,n.b,n.a]:[n.r,n.g,n.b]}function vle(n){const e=jM(n);return e?(t,i)=>{Yh(t,e(i))}:null}function fle(n){const e=n?hle:ule;return(t,i)=>{Yh(t,e(i))}}function _le(n,e,t){const s=Ut(e,t).toRgbaObject();n.writeProperty("r",s.r),n.writeProperty("g",s.g),n.writeProperty("b",s.b),n.writeProperty("a",s.a)}function wle(n,e,t){const s=Ut(e,t).toRgbaObject();n.writeProperty("r",s.r),n.writeProperty("g",s.g),n.writeProperty("b",s.b)}function ble(n,e){return(t,i)=>{n?_le(t,i,e):wle(t,i,e)}}function gle(n){var e;return!!(!((e=n?.color)===null||e===void 0)&&e.alpha)}function Cle(n){return n?e=>fC(e,"0x"):e=>vC(e,"0x")}function Ple(n){return"color"in n||n.view==="color"}At({id:"input-color-number",type:"input",accept:(n,e)=>{if(typeof n!="number"||!Ple(e))return null;const t=dC(e);return t?{initialValue:n,params:Object.assign(Object.assign({},t),{supportsAlpha:gle(e)})}:null},binding:{reader:n=>n.params.supportsAlpha?mle:ple,equals:wC,writer:n=>fle(n.params.supportsAlpha)},controller:n=>{var e,t;return new _C(n.document,{colorType:"int",expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:Cle(n.params.supportsAlpha),parser:Xh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.supportsAlpha,value:n.value,viewProps:n.viewProps})}});function yle(n,e){if(!IM(n))return Ut(G.black(),e);if(e==="int"){const t=Vx(n);return new G(t,"rgb")}if(e==="float"){const t=Vx(n);return new pC(t,"rgb")}return Ut(G.black(),"int")}function Ele(n){return BM(n)}function xle(n){return e=>{const t=yle(e,n);return Ut(t,"int")}}function $le(n,e){return t=>n?OM(t,e):RM(t,e)}At({id:"input-color-object",type:"input",accept:(n,e)=>{var t;if(!IM(n))return null;const i=dC(e);return i?{initialValue:n,params:Object.assign(Object.assign({},i),{colorType:(t=yM(e))!==null&&t!==void 0?t:"int"})}:null},binding:{reader:n=>xle(n.params.colorType),equals:wC,writer:n=>ble(Ele(n.initialValue),n.params.colorType)},controller:n=>{var e,t;const i=BM(n.initialValue);return new _C(n.document,{colorType:n.params.colorType,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:$le(i,n.params.colorType),parser:Xh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:i,value:n.value,viewProps:n.viewProps})}});At({id:"input-color-string",type:"input",accept:(n,e)=>{if(typeof n!="string"||e.view==="text")return null;const t=Noe(n,yM(e));if(!t)return null;const i=jM(t);if(!i)return null;const s=dC(e);return s?{initialValue:n,params:Object.assign(Object.assign({},s),{format:t,stringifier:i})}:null},binding:{reader:()=>Boe,equals:wC,writer:n=>{const e=vle(n.params.format);if(!e)throw bn.notBindable();return e}},controller:n=>{var e,t;return new _C(n.document,{colorType:n.params.format.type,expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,formatter:n.params.stringifier,parser:Xh("int"),pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n.params.format.alpha,value:n.value,viewProps:n.viewProps})}});class bC{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map((i,s)=>{var r,o;return(o=(r=this.components[s])===null||r===void 0?void 0:r.constrain(i))!==null&&o!==void 0?o:i});return this.asm_.fromComponents(t)}}const kx=Q("pndtxt");class Vle{constructor(e,t){this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add(kx()),this.textViews.forEach(i=>{const s=e.createElement("div");s.classList.add(kx("a")),s.appendChild(i.element),this.element.appendChild(s)})}}function kle(n,e,t){return new Gh(n,{arrayPosition:t===0?"fst":t===e.axes.length-1?"lst":"mid",parser:e.parser,props:e.axes[t].textProps,value:ht(0,{constraint:e.axes[t].constraint}),viewProps:e.viewProps})}class gC{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map((i,s)=>kle(e,t,s)),this.acs_.forEach((i,s)=>{Ta({primary:this.value,secondary:i.value,forward:r=>t.assembly.toComponents(r)[s],backward:(r,o)=>{const l=t.assembly.toComponents(r);return l[s]=o,t.assembly.fromComponents(l)}})}),this.view=new Vle(e,{textViews:this.acs_.map(i=>i.view)})}get textControllers(){return this.acs_}}class Sle extends tC{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(e){this.controller.valueController.sliderController.props.set("max",e)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(e){this.controller.valueController.sliderController.props.set("min",e)}}function Lle(n,e){const t=[],i=nM(n,e);i&&t.push(i);const s=iM(n);s&&t.push(s);const r=hC(n.options);return r&&t.push(r),new qh(t)}At({id:"input-number",type:"input",accept:(n,e)=>{if(typeof n!="number")return null;const t=Ct(e,i=>Object.assign(Object.assign({},rM(i)),{options:i.optional.custom(Rp),readonly:i.optional.constant(!1)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>JA,constraint:n=>Lle(n.params,n.initialValue),writer:n=>Yh},controller:n=>{const e=n.value,t=n.constraint,i=t&&wd(t,Dp);if(i)return new aa(n.document,{props:new Y({options:i.values.value("options")}),value:e,viewProps:n.viewProps});const s=sM(n.params,e.rawValue),r=t&&wd(t,Ap);return r?new Px(n.document,Object.assign(Object.assign({},aoe(Object.assign(Object.assign({},s),{keyScale:ht(s.keyScale),max:r.values.value("max"),min:r.values.value("min")}))),{parser:jr,value:e,viewProps:n.viewProps})):new Gh(n.document,{parser:jr,props:Y.fromObject(s),value:e,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="number"?null:n.controller.valueController instanceof Px?new Sle(n.controller):n.controller.valueController instanceof aa?new uC(n.controller):null}});class Vr{constructor(e=0,t=0){this.x=e,this.y=t}getComponents(){return[this.x,this.y]}static isObject(e){if(Re(e))return!1;const t=e.x,i=e.y;return!(typeof t!="number"||typeof i!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y}toObject(){return{x:this.x,y:this.y}}}const FM={toComponents:n=>n.getComponents(),fromComponents:n=>new Vr(...n)},wl=Q("p2d");class Ale{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(wl()),t.viewProps.bindClassModifiers(this.element),Cs(t.expanded,Ma(this.element,wl(void 0,"expanded")));const i=e.createElement("div");i.classList.add(wl("h")),this.element.appendChild(i);const s=e.createElement("button");s.classList.add(wl("b")),s.appendChild(Tp(e,"p2dpad")),t.viewProps.bindDisabled(s),i.appendChild(s),this.buttonElement=s;const r=e.createElement("div");if(r.classList.add(wl("t")),i.appendChild(r),this.textElement=r,t.pickerLayout==="inline"){const o=e.createElement("div");o.classList.add(wl("p")),this.element.appendChild(o),this.pickerElement=o}else this.pickerElement=null}}const ur=Q("p2dp");class Mle{constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=e.createElement("div"),this.element.classList.add(ur()),t.layout==="popup"&&this.element.classList.add(ur(void 0,"p")),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(ur("p")),t.viewProps.bindTabIndex(i),this.element.appendChild(i),this.padElement=i;const s=e.createElementNS(Yn,"svg");s.classList.add(ur("g")),this.padElement.appendChild(s),this.svgElem_=s;const r=e.createElementNS(Yn,"line");r.classList.add(ur("ax")),r.setAttributeNS(null,"x1","0"),r.setAttributeNS(null,"y1","50%"),r.setAttributeNS(null,"x2","100%"),r.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(r);const o=e.createElementNS(Yn,"line");o.classList.add(ur("ax")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","0"),o.setAttributeNS(null,"x2","50%"),o.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(o);const l=e.createElementNS(Yn,"line");l.classList.add(ur("l")),l.setAttributeNS(null,"x1","50%"),l.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(l),this.lineElem_=l;const a=e.createElement("div");a.classList.add(ur("m")),this.padElement.appendChild(a),this.markerElem_=a,t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,t]=this.value.rawValue.getComponents(),i=this.props_.get("max"),s=q(e,-i,+i,0,100),r=q(t,-i,+i,0,100),o=this.props_.get("invertsY")?100-r:r;this.lineElem_.setAttributeNS(null,"x2",`${s}%`),this.lineElem_.setAttributeNS(null,"y2",`${o}%`),this.markerElem_.style.left=`${s}%`,this.markerElem_.style.top=`${o}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}}function Sx(n,e,t){return[sn(e[0],Ms(n)),sn(e[1],oh(n))*(t?1:-1)]}class Tle{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new Mle(e,{layout:t.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Yo(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const i=this.props.get("max"),s=q(e.point.x,0,e.bounds.width,-i,+i),r=q(this.props.get("invertsY")?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-i,+i);this.value.setRawValue(new Vr(s,r),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onPadKeyDown_(e){_M(e.key)&&e.preventDefault();const[t,i]=Sx(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(new Vr(this.value.rawValue.x+t,this.value.rawValue.y+i),{forceEmit:!1,last:!1})}onPadKeyUp_(e){const[t,i]=Sx(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&i===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Dle{constructor(e,t){var i,s;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=Hh.create(t.expanded),this.popC_=t.pickerLayout==="popup"?new mM(e,{viewProps:this.viewProps}):null;const r=new Tle(e,{layout:t.pickerLayout,props:new Y({invertsY:ht(t.invertsY),max:ht(t.max),xKeyScale:t.axes[0].textProps.value("keyScale"),yKeyScale:t.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});r.view.allFocusableElements.forEach(o=>{o.addEventListener("blur",this.onPopupChildBlur_),o.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=r,this.textC_=new gC(e,{assembly:FM,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new Ale(e,{expanded:this.foldable_.value("expanded"),pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(i=this.view.buttonElement)===null||i===void 0||i.addEventListener("blur",this.onPadButtonBlur_),(s=this.view.buttonElement)===null||s===void 0||s.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Ta({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:o=>o,backward:(o,l)=>l})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),aC(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,i=e.relatedTarget;(!i||!t.contains(i))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,i=uM(e);i&&t.contains(i)||i&&i===this.view.buttonElement&&!nC(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.view.buttonElement.focus()}}function Rle(n){return Vr.isObject(n)?new Vr(n.x,n.y):new Vr}function Ole(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y)}function jle(n,e){return new bC({assembly:FM,components:[ds(Object.assign(Object.assign({},n),n.x),e.x),ds(Object.assign(Object.assign({},n),n.y),e.y)]})}function Lx(n,e){var t,i;if(!Re(n.min)||!Re(n.max))return Math.max(Math.abs((t=n.min)!==null&&t!==void 0?t:0),Math.abs((i=n.max)!==null&&i!==void 0?i:0));const s=tM(n);return Math.max(Math.abs(s)*10,Math.abs(e)*10)}function Nle(n,e){var t,i;const s=Lx(Do(n,(t=n.x)!==null&&t!==void 0?t:{}),e.x),r=Lx(Do(n,(i=n.y)!==null&&i!==void 0?i:{}),e.y);return Math.max(s,r)}function Ble(n){if(!("y"in n))return!1;const e=n.y;return e&&"inverted"in e?!!e.inverted:!1}At({id:"input-point2d",type:"input",accept:(n,e)=>{if(!Vr.isObject(n))return null;const t=Ct(e,i=>Object.assign(Object.assign({},lh(i)),{expanded:i.optional.boolean,picker:i.optional.custom(bM),readonly:i.optional.constant(!1),x:i.optional.custom(wr),y:i.optional.object(Object.assign(Object.assign({},lh(i)),{inverted:i.optional.boolean}))}));return t?{initialValue:n,params:t}:null},binding:{reader:()=>Rle,constraint:n=>jle(n.params,n.initialValue),equals:Vr.equals,writer:()=>Ole},controller:n=>{var e,t;const i=n.document,s=n.value,r=n.constraint,o=[n.params.x,n.params.y];return new Dle(i,{axes:s.rawValue.getComponents().map((l,a)=>{var u;return Jg({constraint:r.components[a],initialValue:l,params:Do(n.params,(u=o[a])!==null&&u!==void 0?u:{})})}),expanded:(e=n.params.expanded)!==null&&e!==void 0?e:!1,invertsY:Ble(n.params),max:Nle(n.params,s.rawValue),parser:jr,pickerLayout:(t=n.params.picker)!==null&&t!==void 0?t:"popup",value:s,viewProps:n.viewProps})}});class Kl{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if(Re(e))return!1;const t=e.x,i=e.y,s=e.z;return!(typeof t!="number"||typeof i!="number"||typeof s!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const KM={toComponents:n=>n.getComponents(),fromComponents:n=>new Kl(...n)};function Ile(n){return Kl.isObject(n)?new Kl(n.x,n.y,n.z):new Kl}function Fle(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z)}function Kle(n,e){return new bC({assembly:KM,components:[ds(Object.assign(Object.assign({},n),n.x),e.x),ds(Object.assign(Object.assign({},n),n.y),e.y),ds(Object.assign(Object.assign({},n),n.z),e.z)]})}At({id:"input-point3d",type:"input",accept:(n,e)=>{if(!Kl.isObject(n))return null;const t=Ct(e,i=>Object.assign(Object.assign({},lh(i)),{readonly:i.optional.constant(!1),x:i.optional.custom(wr),y:i.optional.custom(wr),z:i.optional.custom(wr)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>Ile,constraint:n=>Kle(n.params,n.initialValue),equals:Kl.equals,writer:n=>Fle},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z];return new gC(n.document,{assembly:KM,axes:e.rawValue.getComponents().map((s,r)=>{var o;return Jg({constraint:t.components[r],initialValue:s,params:Do(n.params,(o=i[r])!==null&&o!==void 0?o:{})})}),parser:jr,value:e,viewProps:n.viewProps})}});class Ul{constructor(e=0,t=0,i=0,s=0){this.x=e,this.y=t,this.z=i,this.w=s}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if(Re(e))return!1;const t=e.x,i=e.y,s=e.z,r=e.w;return!(typeof t!="number"||typeof i!="number"||typeof s!="number"||typeof r!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const UM={toComponents:n=>n.getComponents(),fromComponents:n=>new Ul(...n)};function Ule(n){return Ul.isObject(n)?new Ul(n.x,n.y,n.z,n.w):new Ul}function Hle(n,e){n.writeProperty("x",e.x),n.writeProperty("y",e.y),n.writeProperty("z",e.z),n.writeProperty("w",e.w)}function zle(n,e){return new bC({assembly:UM,components:[ds(Object.assign(Object.assign({},n),n.x),e.x),ds(Object.assign(Object.assign({},n),n.y),e.y),ds(Object.assign(Object.assign({},n),n.z),e.z),ds(Object.assign(Object.assign({},n),n.w),e.w)]})}At({id:"input-point4d",type:"input",accept:(n,e)=>{if(!Ul.isObject(n))return null;const t=Ct(e,i=>Object.assign(Object.assign({},lh(i)),{readonly:i.optional.constant(!1),w:i.optional.custom(wr),x:i.optional.custom(wr),y:i.optional.custom(wr),z:i.optional.custom(wr)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>Ule,constraint:n=>zle(n.params,n.initialValue),equals:Ul.equals,writer:n=>Hle},controller:n=>{const e=n.value,t=n.constraint,i=[n.params.x,n.params.y,n.params.z,n.params.w];return new gC(n.document,{assembly:UM,axes:e.rawValue.getComponents().map((s,r)=>{var o;return Jg({constraint:t.components[r],initialValue:s,params:Do(n.params,(o=i[r])!==null&&o!==void 0?o:{})})}),parser:jr,value:e,viewProps:n.viewProps})}});function qle(n){const e=[],t=hC(n.options);return t&&e.push(t),new qh(e)}At({id:"input-string",type:"input",accept:(n,e)=>{if(typeof n!="string")return null;const t=Ct(e,i=>({readonly:i.optional.constant(!1),options:i.optional.custom(Rp)}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>fM,constraint:n=>qle(n.params),writer:n=>Yh},controller:n=>{const e=n.document,t=n.value,i=n.constraint,s=i&&wd(i,Dp);return s?new aa(e,{props:new Y({options:s.values.value("options")}),value:t,viewProps:n.viewProps}):new cC(e,{parser:r=>r,props:Y.fromObject({formatter:gf}),value:t,viewProps:n.viewProps})},api(n){return typeof n.controller.value.rawValue!="string"?null:n.controller.valueController instanceof aa?new uC(n.controller):null}});const jp={monitor:{defaultInterval:200,defaultRows:3}},Ax=Q("mll");class Gle{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(Ax()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("textarea");i.classList.add(Ax("i")),i.style.height=`calc(var(${wM("containerUnitSize")}) * ${t.rows})`,i.readOnly=!0,t.viewProps.bindDisabled(i),this.element.appendChild(i),this.textareaElem_=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.textareaElem_,t=e.scrollTop===e.scrollHeight-e.clientHeight,i=[];this.value.rawValue.forEach(s=>{s!==void 0&&i.push(this.formatter_(s))}),e.textContent=i.join(`
`),t&&(e.scrollTop=e.scrollHeight)}onValueUpdate_(){this.update_()}}class CC{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new Gle(e,{formatter:t.formatter,rows:t.rows,value:this.value,viewProps:this.viewProps})}}const Mx=Q("sgl");class Yle{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(Mx()),t.viewProps.bindClassModifiers(this.element);const i=e.createElement("input");i.classList.add(Mx("i")),i.readOnly=!0,i.type="text",t.viewProps.bindDisabled(i),this.element.appendChild(i),this.inputElement=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.value.rawValue,t=e[e.length-1];this.inputElement.value=t!==void 0?this.formatter_(t):""}onValueUpdate_(){this.update_()}}class PC{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new Yle(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}}At({id:"monitor-bool",type:"monitor",accept:(n,e)=>{if(typeof n!="boolean")return null;const t=Ct(e,i=>({readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>vM},controller:n=>{var e;return n.value.rawValue.length===1?new PC(n.document,{formatter:Cx,value:n.value,viewProps:n.viewProps}):new CC(n.document,{formatter:Cx,rows:(e=n.params.rows)!==null&&e!==void 0?e:jp.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}});class Xle extends tC{get max(){return this.controller.valueController.props.get("max")}set max(e){this.controller.valueController.props.set("max",e)}get min(){return this.controller.valueController.props.get("min")}set min(e){this.controller.valueController.props.set("min",e)}}const hr=Q("grl");class Wle{constructor(e,t){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(hr()),t.viewProps.bindClassModifiers(this.element),this.formatter_=t.formatter,this.props_=t.props,this.cursor_=t.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const i=e.createElementNS(Yn,"svg");i.classList.add(hr("g")),i.style.height=`calc(var(${wM("containerUnitSize")}) * ${t.rows})`,this.element.appendChild(i),this.svgElem_=i;const s=e.createElementNS(Yn,"polyline");this.svgElem_.appendChild(s),this.lineElem_=s;const r=e.createElement("div");r.classList.add(hr("t"),Q("tt")()),this.element.appendChild(r),this.tooltipElem_=r,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const e=this.svgElem_.getBoundingClientRect(),t=this.value.rawValue.length-1,i=this.props_.get("min"),s=this.props_.get("max"),r=[];this.value.rawValue.forEach((h,c)=>{if(h===void 0)return;const p=q(c,0,t,0,e.width),d=q(h,i,s,e.height,0);r.push([p,d].join(","))}),this.lineElem_.setAttributeNS(null,"points",r.join(" "));const o=this.tooltipElem_,l=this.value.rawValue[this.cursor_.rawValue];if(l===void 0){o.classList.remove(hr("t","a"));return}const a=q(this.cursor_.rawValue,0,t,0,e.width),u=q(l,i,s,e.height,0);o.style.left=`${a}px`,o.style.top=`${u}px`,o.textContent=`${this.formatter_(l)}`,o.classList.contains(hr("t","a"))||(o.classList.add(hr("t","a"),hr("t","in")),_d(o),o.classList.remove(hr("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class HM{constructor(e,t){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.cursor_=ht(-1),this.view=new Wle(e,{cursor:this.cursor_,formatter:t.formatter,rows:t.rows,props:this.props,value:this.value,viewProps:this.viewProps}),!nC(e))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const i=new Yo(this.view.element);i.emitter.on("down",this.onGraphPointerDown_),i.emitter.on("move",this.onGraphPointerMove_),i.emitter.on("up",this.onGraphPointerUp_)}}importProps(e){return qi(e,null,t=>({max:t.required.number,min:t.required.number}),t=>(this.props.set("max",t.max),this.props.set("min",t.min),!0))}exportProps(){return Gi(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(e){const t=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(q(e.offsetX,0,t.width,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){if(!e.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(q(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function Cf(n){return Re(n.format)?pn(2):n.format}function Zle(n){var e;return n.value.rawValue.length===1?new PC(n.document,{formatter:Cf(n.params),value:n.value,viewProps:n.viewProps}):new CC(n.document,{formatter:Cf(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:jp.monitor.defaultRows,value:n.value,viewProps:n.viewProps})}function Qle(n){var e,t,i;return new HM(n.document,{formatter:Cf(n.params),rows:(e=n.params.rows)!==null&&e!==void 0?e:jp.monitor.defaultRows,props:Y.fromObject({max:(t=n.params.max)!==null&&t!==void 0?t:100,min:(i=n.params.min)!==null&&i!==void 0?i:0}),value:n.value,viewProps:n.viewProps})}function Tx(n){return n.view==="graph"}At({id:"monitor-number",type:"monitor",accept:(n,e)=>{if(typeof n!="number")return null;const t=Ct(e,i=>({format:i.optional.function,max:i.optional.number,min:i.optional.number,readonly:i.required.constant(!0),rows:i.optional.number,view:i.optional.string}));return t?{initialValue:n,params:t}:null},binding:{defaultBufferSize:n=>Tx(n)?64:1,reader:n=>JA},controller:n=>Tx(n.params)?Qle(n):Zle(n),api:n=>n.controller.valueController instanceof HM?new Xle(n.controller):null});At({id:"monitor-string",type:"monitor",accept:(n,e)=>{if(typeof n!="string")return null;const t=Ct(e,i=>({multiline:i.optional.boolean,readonly:i.required.constant(!0),rows:i.optional.number}));return t?{initialValue:n,params:t}:null},binding:{reader:n=>fM},controller:n=>{var e;const t=n.value;return t.rawValue.length>1||n.params.multiline?new CC(n.document,{formatter:gf,rows:(e=n.params.rows)!==null&&e!==void 0?e:jp.monitor.defaultRows,value:t,viewProps:n.viewProps}):new PC(n.document,{formatter:gf,value:t,viewProps:n.viewProps})}});class Dx{constructor(){this.drawer=e=>`L ${e[0]} ${e[1]}`}}class Jle{constructor(){this.drawer=(e,t,i)=>{const[s,r]=this.controlPoint(i[t-1],i[t-2],e),[o,l]=this.controlPoint(e,i[t-1],i[t+1],!0);return`C ${s},${r} ${o},${l} ${e[0]},${e[1]}`}}controlPoint(e,t,i,s){const r=t||e,o=i||e,l=.2,a=o[0]-r[0],u=o[1]-r[1],h=Math.sqrt(Math.pow(a,2)+Math.pow(u,2))*l,c=Math.atan2(u,a)+(s?Math.PI:0),p=e[0]+Math.cos(c)*h,d=e[1]+Math.sin(c)*h;return[p,d]}}const Rx=Q("wfm");class eae{constructor(e,t){switch(this.element=e.createElement("div"),this.element.classList.add(Rx()),t.viewProps.bindClassModifiers(this.element),this.svgElem=e.createElementNS(Yn,"svg"),this.svgElem.classList.add(Rx("g")),this.element.appendChild(this.svgElem),this.pathElem=e.createElementNS(Yn,"path"),this.svgElem.appendChild(this.pathElem),this.props=t.props,this.value=t.value,this.value.emitter.on("change",this.onValueChange_.bind(this)),this.props.get("lineStyle")){case"linear":this.lineDrawerProvider=new Dx;break;case"bezier":this.lineDrawerProvider=new Jle;break;default:this.lineDrawerProvider=new Dx;break}this.refresh(),t.viewProps.handleDispose(()=>{this.value.emitter.off("change",this.onValueChange_)})}svgPath(e,t){return e.reduce((s,r,o,l)=>o===0?`M ${r[0]},${r[1]}`:`${s} ${t(r,o,l)}`,"")}refresh(){var e,t;const i=this.svgElem.getBoundingClientRect(),s=this.value.rawValue[0];if(s){const r=(e=this.props.get("min"))!==null&&e!==void 0?e:Math.min(...s)-1,o=(t=this.props.get("max"))!==null&&t!==void 0?t:Math.max(...s)+1,l=o-r,a=[],u=s.length-1,h=s.length>32?0:i.width/(s.length-1),c=l>50?0:i.height/l;this.element.style.backgroundSize=`${h}px ${c}px`,s.forEach((d,m)=>{if(d===void 0)return;const f=q(m,0,u,0,i.width),v=q(d,r,o,i.height,0);a.push([Math.floor(f),Math.floor(v)])});const p=this.svgPath(a,this.lineDrawerProvider.drawer);this.pathElem.setAttributeNS(null,"d",p)}}onValueChange_(){this.refresh()}}class tae{constructor(e,t){this.value=t.value,this.props=t.props,this.viewProps=t.viewProps,this.viewProps.handleDispose(()=>{}),this.view=new eae(e,{value:this.value,viewProps:this.viewProps,props:this.props})}}function nae(n){return"view"in n&&n.view==="waveform"}function Ox(n){return typeof n=="object"?"length"in n:!1}At({id:"monitor-waveform",type:"monitor",accept:(n,e)=>{if(!Ox(n))return null;const t=Ct(e,i=>({max:i.optional.number,min:i.optional.number,style:i.optional.custom(s=>s==="linear"||s==="bezier"?s:void 0),view:i.optional.string}));return t?{initialValue:n,params:t}:null},binding:{defaultBufferSize:n=>nae(n)?64:1,reader:n=>e=>Ox(e)?e:[]},controller:n=>{var e,t,i;return new tae(n.document,{props:Y.fromObject({max:(e="max"in n.params?n.params.max:null)!==null&&e!==void 0?e:null,min:(t="min"in n.params?n.params.min:null)!==null&&t!==void 0?t:null,lineStyle:(i="style"in n.params?n.params.style:null)!==null&&i!==void 0?i:"linear"}),value:n.value,viewProps:n.viewProps})}});function jx(n,e,t){const i=n.slice();return i[3]=e[t],i}function Nx(n){let e,t=n[3]+"",i,s;return{c(){e=rn("div"),i=lT(t),s=kr()},l(r){e=on(r,"DIV",{});var o=ln(e);i=aT(o,t),s=Sr(o),o.forEach(E)},m(r,o){O(r,e,o),Fc(e,i),Fc(e,s)},p(r,o){o&2&&t!==(t=r[3]+"")&&uT(i,t)},d(r){r&&E(e)}}}function iae(n){let e,t=Hl(n[1]),i=[];for(let s=0;s<t.length;s+=1)i[s]=Nx(jx(n,t,s));return{c(){e=rn("div");for(let s=0;s<i.length;s+=1)i[s].c();this.h()},l(s){e=on(s,"DIV",{class:!0});var r=ln(e);for(let o=0;o<i.length;o+=1)i[o].l(r);r.forEach(E),this.h()},h(){Cu(e,"class","scroller p-2 text-white text-xs font-body h-64 overflow-y-scroll break-all svelte-19cipwr")},m(s,r){O(s,e,r);for(let o=0;o<i.length;o+=1)i[o]&&i[o].m(e,null);n[2](e)},p(s,[r]){if(r&2){t=Hl(s[1]);let o;for(o=0;o<t.length;o+=1){const l=jx(s,t,o);i[o]?i[o].p(l,r):(i[o]=Nx(l),i[o].c(),i[o].m(e,null))}for(;o<i.length;o+=1)i[o].d(1);i.length=t.length}},i:nt,o:nt,d(s){s&&E(e),zx(i,s),n[2](null)}}}function sae(n,e,t){let i;Ps(n,hT,o=>t(1,i=o));let s;{const o=l=>{for(let a of l)a.type==="childList"&&s?.scrollTo(0,s.scrollHeight)};ca(()=>{new MutationObserver(o).observe(s,{childList:!0})})}function r(o){y[o?"unshift":"push"](()=>{s=o,t(0,s)})}return[s,i,r]}class rae extends Je{constructor(e){super(),et(this,e,sae,iae,Qe,{})}}function Bx(n,e,t){const i=n.slice();return i[13]=e[t],i[14]=e,i[15]=t,i}function oae(n){let e,t,i;function s(o){n[7](o)}let r={};return n[5]!==void 0&&(r.object=n[5]),e=new bg({props:r}),y.push(()=>k(e,"object",s)),{c(){A(e.$$.fragment)},l(o){M(e.$$.fragment,o)},m(o,l){T(e,o,l),i=!0},p(o,l){const a={};!t&&l&32&&(t=!0,a.object=o[5],V(()=>t=!1)),e.$set(a)},i(o){i||(_(e.$$.fragment,o),i=!0)},o(o){b(e.$$.fragment,o),i=!1},d(o){D(e,o)}}}function lae(n){let e,t,i;function s(o){n[10](o,n[13])}let r={label:n[13]};return n[0][n[13]].value!==void 0&&(r.value=n[0][n[13]].value),e=new Dee({props:r}),y.push(()=>k(e,"value",s)),{c(){A(e.$$.fragment)},l(o){M(e.$$.fragment,o)},m(o,l){T(e,o,l),i=!0},p(o,l){n=o;const a={};l&1&&(a.label=n[13]),!t&&l&1&&(t=!0,a.value=n[0][n[13]].value,V(()=>t=!1)),e.$set(a)},i(o){i||(_(e.$$.fragment,o),i=!0)},o(o){b(e.$$.fragment,o),i=!1},d(o){D(e,o)}}}function aae(n){let e,t,i=n[0][n[13]].type==="slider"&&Ix(n);return{c(){i&&i.c(),e=R()},l(s){i&&i.l(s),e=R()},m(s,r){i&&i.m(s,r),O(s,e,r),t=!0},p(s,r){s[0][s[13]].type==="slider"?i?(i.p(s,r),r&1&&_(i,1)):(i=Ix(s),i.c(),_(i,1),i.m(e.parentNode,e)):i&&(ii(),b(i,1,1,()=>{i=null}),si())},i(s){t||(_(i),t=!0)},o(s){b(i),t=!1},d(s){s&&E(e),i&&i.d(s)}}}function Ix(n){let e,t,i;const s=[{label:n[13]},n[0][n[13]].options];function r(l){n[9](l,n[13])}let o={};for(let l=0;l<s.length;l+=1)o=B(o,s[l]);return n[0][n[13]].value!==void 0&&(o.value=n[0][n[13]].value),e=new cW({props:o}),y.push(()=>k(e,"value",r)),{c(){A(e.$$.fragment)},l(l){M(e.$$.fragment,l)},m(l,a){T(e,l,a),i=!0},p(l,a){n=l;const u=a&1?zt(s,[{label:n[13]},qt(n[0][n[13]].options)]):{};!t&&a&1&&(t=!0,u.value=n[0][n[13]].value,V(()=>t=!1)),e.$set(u)},i(l){i||(_(e.$$.fragment,l),i=!0)},o(l){b(e.$$.fragment,l),i=!1},d(l){D(e,l)}}}function Fx(n){let e,t,i,s;const r=[aae,lae],o=[];function l(a,u){return a[0][a[13]].type?0:1}return e=l(n),t=o[e]=r[e](n),{c(){t.c(),i=R()},l(a){t.l(a),i=R()},m(a,u){o[e].m(a,u),O(a,i,u),s=!0},p(a,u){let h=e;e=l(a),e===h?o[e].p(a,u):(ii(),b(o[h],1,1,()=>{o[h]=null}),si(),t=o[e],t?t.p(a,u):(t=o[e]=r[e](a),t.c()),_(t,1),t.m(i.parentNode,i))},i(a){s||(_(t),s=!0)},o(a){b(t),s=!1},d(a){a&&E(i),o[e].d(a)}}}function uae(n){let e,t,i=Hl(Object.keys(n[0])),s=[];for(let o=0;o<i.length;o+=1)s[o]=Fx(Bx(n,i,o));const r=o=>b(s[o],1,1,()=>{s[o]=null});return{c(){for(let o=0;o<s.length;o+=1)s[o].c();e=R()},l(o){for(let l=0;l<s.length;l+=1)s[l].l(o);e=R()},m(o,l){for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(o,l);O(o,e,l),t=!0},p(o,l){if(l&1){i=Hl(Object.keys(o[0]));let a;for(a=0;a<i.length;a+=1){const u=Bx(o,i,a);s[a]?(s[a].p(u,l),_(s[a],1)):(s[a]=Fx(u),s[a].c(),_(s[a],1),s[a].m(e.parentNode,e))}for(ii(),a=i.length;a<s.length;a+=1)r(a);si()}},i(o){if(!t){for(let l=0;l<i.length;l+=1)_(s[l]);t=!0}},o(o){s=s.filter(Boolean);for(let l=0;l<s.length;l+=1)b(s[l]);t=!1},d(o){o&&E(e),zx(s,o)}}}function Kx(n){let e,t,i;function s(o){n[12](o)}let r={title:"Debug",$$slots:{default:[cae]},$$scope:{ctx:n}};return n[4]!==void 0&&(r.expanded=n[4]),e=new Ju({props:r}),y.push(()=>k(e,"expanded",s)),{c(){A(e.$$.fragment)},l(o){M(e.$$.fragment,o)},m(o,l){T(e,o,l),i=!0},p(o,l){const a={};l&65536&&(a.$$scope={dirty:l,ctx:o}),!t&&l&16&&(t=!0,a.expanded=o[4],V(()=>t=!1)),e.$set(a)},i(o){i||(_(e.$$.fragment,o),i=!0)},o(o){b(e.$$.fragment,o),i=!1},d(o){D(e,o)}}}function hae(n){let e,t;return e=new rae({}),{c(){A(e.$$.fragment)},l(i){M(e.$$.fragment,i)},m(i,s){T(e,i,s),t=!0},i(i){t||(_(e.$$.fragment,i),t=!0)},o(i){b(e.$$.fragment,i),t=!1},d(i){D(e,i)}}}function cae(n){let e,t;return e=new Bee({props:{$$slots:{default:[hae]},$$scope:{ctx:n}}}),{c(){A(e.$$.fragment)},l(i){M(e.$$.fragment,i)},m(i,s){T(e,i,s),t=!0},p(i,s){const r={};s&65536&&(r.$$scope={dirty:s,ctx:i}),e.$set(r)},i(i){t||(_(e.$$.fragment,i),t=!0)},o(i){b(e.$$.fragment,i),t=!1},d(i){D(e,i)}}}function dae(n){let e,t,i,s,r,o,l,a;function u(m){n[8](m)}let h={title:"Global",$$slots:{default:[oae]},$$scope:{ctx:n}};n[2]!==void 0&&(h.expanded=n[2]),e=new Ju({props:h}),y.push(()=>k(e,"expanded",u));function c(m){n[11](m)}let p={title:"Renderer",$$slots:{default:[uae]},$$scope:{ctx:n}};n[3]!==void 0&&(p.expanded=n[3]),s=new Ju({props:p}),y.push(()=>k(s,"expanded",c));let d=n[6]&&Kx(n);return{c(){A(e.$$.fragment),i=kr(),A(s.$$.fragment),o=kr(),d&&d.c(),l=R()},l(m){M(e.$$.fragment,m),i=Sr(m),M(s.$$.fragment,m),o=Sr(m),d&&d.l(m),l=R()},m(m,f){T(e,m,f),O(m,i,f),T(s,m,f),O(m,o,f),d&&d.m(m,f),O(m,l,f),a=!0},p(m,f){const v={};f&65568&&(v.$$scope={dirty:f,ctx:m}),!t&&f&4&&(t=!0,v.expanded=m[2],V(()=>t=!1)),e.$set(v);const w={};f&65537&&(w.$$scope={dirty:f,ctx:m}),!r&&f&8&&(r=!0,w.expanded=m[3],V(()=>r=!1)),s.$set(w),m[6]?d?(d.p(m,f),f&64&&_(d,1)):(d=Kx(m),d.c(),_(d,1),d.m(l.parentNode,l)):d&&(ii(),b(d,1,1,()=>{d=null}),si())},i(m){a||(_(e.$$.fragment,m),_(s.$$.fragment,m),_(d),a=!0)},o(m){b(e.$$.fragment,m),b(s.$$.fragment,m),b(d),a=!1},d(m){m&&(E(i),E(o),E(l)),D(e,m),D(s,m),d&&d.d(m)}}}function pae(n){let e,t;return e=new gee({props:{position:n[1]?"fixed":"inline",y:50,title:"",$$slots:{default:[dae]},$$scope:{ctx:n}}}),{c(){A(e.$$.fragment)},l(i){M(e.$$.fragment,i)},m(i,s){T(e,i,s),t=!0},p(i,[s]){const r={};s&2&&(r.position=i[1]?"fixed":"inline"),s&65661&&(r.$$scope={dirty:s,ctx:i}),e.$set(r)},i(i){t||(_(e.$$.fragment,i),t=!0)},o(i){b(e.$$.fragment,i),t=!1},d(i){D(e,i)}}}function mae(n,e,t){let i,s;Ps(n,kC,v=>t(5,i=v)),Ps(n,cT,v=>t(6,s=v));let{params:r}=e,{fixed:o=!1}=e,l=!0,a=!0,u=!0;function h(v){i=v,kC.set(i)}function c(v){l=v,t(2,l)}function p(v,w){n.$$.not_equal(r[w].value,v)&&(r[w].value=v,t(0,r))}function d(v,w){n.$$.not_equal(r[w].value,v)&&(r[w].value=v,t(0,r))}function m(v){a=v,t(3,a)}function f(v){u=v,t(4,u)}return n.$$set=v=>{"params"in v&&t(0,r=v.params),"fixed"in v&&t(1,o=v.fixed)},[r,o,l,a,u,i,s,h,c,p,d,m,f]}class m0e extends Je{constructor(e){super(),et(this,e,mae,pae,Qe,{params:0,fixed:1})}}export{m0e as P,Hl as e,pT as g};
